<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Esing的小站</title>
  
  <subtitle>随便写点</subtitle>
  <link href="https://blog.esing.dev/atom.xml" rel="self"/>
  
  <link href="https://blog.esing.dev/"/>
  <updated>2025-10-23T14:53:20.925Z</updated>
  <id>https://blog.esing.dev/</id>
  
  <author>
    <name>Esing</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>LaTeX代码开启连字等特性</title>
    <link href="https://blog.esing.dev/2025/10/23/latex-ligature/"/>
    <id>https://blog.esing.dev/2025/10/23/latex-ligature/</id>
    <published>2025-10-23T11:27:57.000Z</published>
    <updated>2025-10-23T14:53:20.925Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>在 <a href="/2024/11/19/latex-code-highlight/" title="LaTeX插入代码并设置高亮">LaTeX插入代码并设置高亮</a>中，使用<code>minted</code>和<code>listings</code> 为代码块添加了高亮。但许多等宽字体都包含连字（Ligature）特性，可以增强代码的可读性，视觉效果更好。那如何在代码块里也开启连字特性呢？</p><div class="note primary flat"><p>这里安利<a href="https://github.com/subframe7536/maple-font">Maple Mono</a>字体，对中文显示极其友好，完美的中英文2:1比例，还支持Nerd Font。我已经将所有等宽字体都换成<code>Maple Mono Normal NF CN</code>了。</p></div><h2 id="修改样式">修改样式</h2><p>首先要确保使用了<code>fontspec</code>宏包：<code>\RequirePackage&#123;fontspec&#125;</code></p><p>接着指定等宽字体，并添加：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">\setmonofont[</span><br><span class="line">    AutoFakeBold=true,</span><br><span class="line">    ItalicFont=MapleItalic,     % 指定斜体字体</span><br><span class="line">    Contextuals = Alternate,    % 开启连字</span><br><span class="line">    Ligatures = Common,         % liga</span><br><span class="line">    CharacterVariant=&#123;1,62,63&#125;, % cv特性</span><br><span class="line">    StylisticSet=&#123;3,11&#125;,        % ss特性</span><br><span class="line">    Extension = .ttf,</span><br><span class="line">    Path=fonts/</span><br><span class="line">]&#123;Maple&#125;</span><br></pre></td></tr></table></figure><p>随后重新编译就可以了！</p><p>经过测试，<code>verbatim</code>环境下一切正常，<code>listings</code>环境下仅有部分连字生效，原因不明。</p><img src="https://webp.esing.dev/img/image-20251023214343776_251023_2143_caYa.png" alt="verbatim环境" style="zoom:50%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;在 &lt;a href=&quot;/2024/11/19/latex-code-highlight/&quot; title=&quot;LaTeX插入代码并设置高亮&quot;&gt;LaTeX插入代</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="LaTeX" scheme="https://blog.esing.dev/tags/LaTeX/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：第四篇</title>
    <link href="https://blog.esing.dev/2025/10/21/vd-p4/"/>
    <id>https://blog.esing.dev/2025/10/21/vd-p4/</id>
    <published>2025-10-21T01:49:28.000Z</published>
    <updated>2025-10-23T14:58:06.125Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Cache">Cache</h2><p>可参考 <a href="/2024/06/12/coae-p6/" title="计算机原理与嵌入式系统笔记：第六篇">计算机原理与嵌入式系统笔记：第六篇</a></p><h3 id="CPI">CPI</h3><h3 id="平均访问时间">平均访问时间</h3><p>平均访问时间</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Cache&quot;&gt;Cache&lt;/h2&gt;
&lt;p&gt;可参考 &lt;a href=&quot;/2024/06/12/coae-p6/&quot; title=&quot;计算机原理与嵌入式系统笔记：第六篇&quot;&gt;计算机原理与嵌入式系</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>更适合Powershell体质的grep</title>
    <link href="https://blog.esing.dev/2025/10/20/powershell-grep/"/>
    <id>https://blog.esing.dev/2025/10/20/powershell-grep/</id>
    <published>2025-10-20T02:16:02.000Z</published>
    <updated>2025-10-20T02:48:18.038Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>Powershell下筛选字符串有<code>findstr</code>指令。但我用<code>grep</code>习惯了，一时半会不想改<s>主要是findstr字太多了</s></p><p>所以自己写一个脚本来模拟grep功能。</p><h2 id="代码">代码</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"></span><br><span class="line">:: 检查参数</span><br><span class="line"><span class="keyword">if</span> &quot;%~<span class="number">1</span>&quot;==&quot;&quot; (</span><br><span class="line">    <span class="built_in">echo</span> 用法: grep 搜索词</span><br><span class="line">    <span class="built_in">echo</span> 示例: command | grep 搜索词</span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">:: 搜索词是第一个参数</span><br><span class="line"><span class="built_in">set</span> &quot;searchterm=%~<span class="number">1</span>&quot;</span><br><span class="line"></span><br><span class="line">:: 处理标准输入并搜索</span><br><span class="line"><span class="keyword">for</span> /f &quot;usebackq tokens=*&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (`<span class="built_in">findstr</span> /i /L /C:&quot;<span class="variable">%searchterm%</span>&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>`) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">%%a</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">endlocal</span></span><br><span class="line"><span class="keyword">exit</span> /b <span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;Powershell下筛选字符串有&lt;code&gt;findstr&lt;/code&gt;指令。但我用&lt;code&gt;grep&lt;/code&gt;习惯了，一时半会不想改&lt;s&gt;主要是</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Powershell" scheme="https://blog.esing.dev/tags/Powershell/"/>
    
  </entry>
  
  <entry>
    <title>HDLBits刷题之旅鼠冲冲冲</title>
    <link href="https://blog.esing.dev/2025/10/07/hdlbits-lemmings4/"/>
    <id>https://blog.esing.dev/2025/10/07/hdlbits-lemmings4/</id>
    <published>2025-10-07T11:57:39.000Z</published>
    <updated>2025-10-07T15:24:15.092Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p><a href="https://zh.wikipedia.org/wiki/%E7%99%BE%E6%88%B0%E5%B0%8F%E6%97%85%E9%BC%A0">百战小旅鼠</a>1991年由DMA Design（今rockstar north，蓝R）开发。</p><p>旅鼠会左右走，还会挖洞。如果下落太久了还会摔得四分五裂<s>坠机了</s></p><h2 id="思路">思路</h2><p>七个状态：左右、下落左右、向下挖时原本朝向左右，以及四分五裂。</p><h2 id="代码">代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span>  clk,</span><br><span class="line">    <span class="keyword">input</span>  areset,      <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span>  bump_left,</span><br><span class="line">    <span class="keyword">input</span>  bump_right,</span><br><span class="line">    <span class="keyword">input</span>  ground,</span><br><span class="line">    <span class="keyword">input</span>  dig,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah,</span><br><span class="line">    <span class="keyword">output</span> digging</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> LEFT = <span class="number">0</span>, RIGHT = <span class="number">1</span>, FALLING_LEFT = <span class="number">2</span>, FALLING_RIGHT = <span class="number">3</span>, DIGGING_LEFT = <span class="number">4</span>,</span><br><span class="line">        DIGGING_RIGHT = <span class="number">5</span>, SPLAT = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] count, next_count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">        next_count = count;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line"></span><br><span class="line">            LEFT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (!ground) <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_LEFT;</span><br><span class="line">                    next_count = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (dig) next_state = DIGGING_LEFT;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (bump_left) next_state = RIGHT;</span><br><span class="line">                <span class="keyword">else</span> next_state = LEFT;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            RIGHT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (!ground) <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_RIGHT;</span><br><span class="line">                    next_count = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (dig) next_state = DIGGING_RIGHT;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (bump_right) next_state = LEFT;</span><br><span class="line">                <span class="keyword">else</span> next_state = RIGHT;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            FALLING_LEFT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground) <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (count &gt;= <span class="number">20</span>) <span class="keyword">begin</span></span><br><span class="line">                        next_state = SPLAT;</span><br><span class="line">                        next_count = count;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                        next_state = LEFT;</span><br><span class="line">                        next_count = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_LEFT;</span><br><span class="line">                    next_count = count + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            FALLING_RIGHT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground) <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (count &gt;= <span class="number">20</span>) <span class="keyword">begin</span></span><br><span class="line">                        next_state = SPLAT;</span><br><span class="line">                        next_count = count;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                        next_state = RIGHT;</span><br><span class="line">                        next_count = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_RIGHT;</span><br><span class="line">                    next_count = count + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            DIGGING_LEFT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground) next_state = DIGGING_LEFT;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_LEFT;</span><br><span class="line">                    next_count = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            DIGGING_RIGHT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground) next_state = DIGGING_RIGHT;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_RIGHT;</span><br><span class="line">                    next_count = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            SPLAT: next_state = SPLAT;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>: next_state = LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= LEFT;</span><br><span class="line">            count &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">            count &lt;= next_count;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// assign aaah       = (state == FALLING_LEFT) || (state == FALLING_RIGHT);</span></span><br><span class="line">    <span class="comment">// assign digging    = (state == DIGGING_LEFT) || (state == DIGGING_RIGHT);</span></span><br><span class="line">    <span class="comment">// assign walk_left  = (state == LEFT);</span></span><br><span class="line">    <span class="comment">// assign walk_right = (state == RIGHT);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> &#123;aaah, digging, walk_left, walk_right&#125; = (state == SPLAT) ?</span><br><span class="line">        <span class="number">4&#x27;b0000</span> : &#123;&#123;(state == FALLING_LEFT) || (state == FALLING_RIGHT)&#125;,</span><br><span class="line">                   &#123;(state == DIGGING_LEFT) || (state == DIGGING_RIGHT)&#125;,</span><br><span class="line">                   &#123;(state == LEFT)&#125;, &#123;(state == RIGHT)&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="排查错误">排查错误</h2><p>一开始未设置<code>next_count</code>，直接给<code>count</code>赋值，会报错：Can't resolve multiple constant drivers for net &quot;count[4]&quot;。因此，需要像状态切换那样，设置一个新的<code>next_count</code>。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E7%99%BE%E6%88%B0%E5%B0%8F%E6%97%85%E</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="HDLBits" scheme="https://blog.esing.dev/tags/HDLBits/"/>
    
  </entry>
  
  <entry>
    <title>HDLBits刷题之生命游戏</title>
    <link href="https://blog.esing.dev/2025/10/05/hdlbits-conwaylife/"/>
    <id>https://blog.esing.dev/2025/10/05/hdlbits-conwaylife/</id>
    <published>2025-10-05T04:44:18.000Z</published>
    <updated>2025-10-05T10:14:09.164Z</updated>
    
    <content type="html"><![CDATA[<div class="note info flat"><p>纪念<a href="https://zh.wikipedia.org/wiki/%E7%B4%84%E7%BF%B0%C2%B7%E4%BD%95%E9%A0%93%C2%B7%E5%BA%B7%E5%A8%81">约翰·霍顿·康威</a>，他因新冠于2020年4月11日逝世，享年82岁。</p></div><h2 id="前言">前言</h2><p><a href="https://hdlbits.01xz.net/wiki/Conwaylife">Conwaylife - HDLBits</a></p><p>康威的生命游戏在科学美国人上刊登过，小时候还看到过，印象很深。</p><p>简单来说，就是对一个矩阵进行轮次变换，对每个元素的变换规则如下：</p><ul><li>0-1 个邻居：单元格变为 0</li><li>2 个邻居：单元格状态不变</li><li>3 个邻居：单元格变为 1</li><li>4 个及以上邻居：单元格变为 0</li></ul><p>要注意的是矩阵四周是“连续”的，即首尾相接。可以理解成桌面壁纸的平铺。</p><h2 id="思路">思路</h2><p>连续的意思就是说边界处会发生“跳变”。那我整一个四周大一圈的矩阵把它包进去就可以了。</p><p>然后在每个时钟沿进行判断，再赋新的值给寄存器即可。</p><h2 id="代码">代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span>              clk,</span><br><span class="line">    <span class="keyword">input</span>              load,</span><br><span class="line">    <span class="keyword">input</span>      [<span class="number">255</span>:<span class="number">0</span>] data,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">255</span>:<span class="number">0</span>] q</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">18</span>*<span class="number">18</span>-<span class="number">1</span>:<span class="number">0</span>] temp;</span><br><span class="line">    <span class="keyword">wire</span> [    <span class="number">255</span>:<span class="number">0</span>] out_temp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 区分对待</span></span><br><span class="line">    <span class="keyword">assign</span> temp[<span class="number">17</span>:<span class="number">0</span>]          = &#123;q[<span class="number">240</span>], q[<span class="number">255</span>:<span class="number">240</span>], q[<span class="number">255</span>]&#125;;</span><br><span class="line">    <span class="keyword">assign</span> temp[<span class="number">18</span>*<span class="number">18</span>-<span class="number">1</span>:<span class="number">18</span>*<span class="number">17</span>] = &#123;q[<span class="number">0</span>], q[<span class="number">15</span>:<span class="number">0</span>], q[<span class="number">15</span>]&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">genvar</span> i;</span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">17</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span> : origin_mat</span><br><span class="line">            <span class="keyword">assign</span> temp[<span class="number">18</span>*(i+<span class="number">1</span>)-<span class="number">1</span>:<span class="number">18</span>*i] = &#123;q[<span class="number">16</span>*(i-<span class="number">1</span>)], q[<span class="number">16</span>*i-<span class="number">1</span>:<span class="number">16</span>*(i-<span class="number">1</span>)], q[<span class="number">16</span>*i-<span class="number">1</span>]&#125;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">genvar</span> j, k;</span><br><span class="line">    <span class="comment">// verilog_format: off</span></span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j = j + <span class="number">1</span>) <span class="keyword">begin</span> : temp_row</span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">16</span>; k = k + <span class="number">1</span>) <span class="keyword">begin</span> : temp_col</span><br><span class="line">                <span class="keyword">localparam</span> <span class="keyword">integer</span> idx = <span class="number">18</span> * (j + <span class="number">1</span>) + k + <span class="number">1</span>;</span><br><span class="line">                <span class="comment">// 保存最多为 8 的邻居和，4 位足矣</span></span><br><span class="line">                <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] nbr_sum;</span><br><span class="line">                <span class="keyword">wire</span> loc_inst;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">assign</span> nbr_sum =</span><br><span class="line">                    temp[idx-<span class="number">1</span>]   + temp[idx+<span class="number">1</span>] +</span><br><span class="line">                    temp[idx-<span class="number">18</span>]  + temp[idx+<span class="number">18</span>] +</span><br><span class="line">                    temp[idx-<span class="number">18</span>-<span class="number">1</span>]+ temp[idx-<span class="number">18</span>+<span class="number">1</span>] +</span><br><span class="line">                    temp[idx+<span class="number">18</span>-<span class="number">1</span>]+ temp[idx+<span class="number">18</span>+<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">assign</span> loc_inst = (nbr_sum &lt;  <span class="number">2</span>)  ? <span class="number">1&#x27;b0</span> :</span><br><span class="line">                                  (nbr_sum == <span class="number">2</span>) ? temp[idx] :</span><br><span class="line">                                  (nbr_sum == <span class="number">3</span>) ? <span class="number">1&#x27;b1</span> :</span><br><span class="line">                                  <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">assign</span> out_temp[<span class="number">16</span>*j + k] = loc_inst;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (load) <span class="keyword">begin</span></span><br><span class="line">            q &lt;= data;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            q &lt;= out_temp;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="改进">改进</h2><p><a href="https://blog.csdn.net/m0_74101820/article/details/145619118">HDLbits: verilog实现Conwaylife二维元胞自动机 - CSDN</a>简化了数组的表示，采用二维数组：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不包含testbench</span></span><br><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> load,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">255</span>:<span class="number">0</span>] data,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">255</span>:<span class="number">0</span>] q ); </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        q = <span class="number">256&#x27;h0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//填充为18*18</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">17</span>:<span class="number">0</span>] q_t [<span class="number">17</span>:<span class="number">0</span>]; <span class="comment">//填充后的q_table;</span></span><br><span class="line">    <span class="keyword">genvar</span> i;</span><br><span class="line">    <span class="keyword">generate</span> <span class="comment">//利用循环将q_t的每一行依次填充</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span>: assign_value</span><br><span class="line">            <span class="keyword">assign</span> q_t[i+<span class="number">1</span>][<span class="number">17</span>:<span class="number">0</span>] = &#123;q[i*<span class="number">16</span>], q[i*<span class="number">16</span>+:<span class="number">16</span>], q[i*<span class="number">16</span>+<span class="number">15</span>]&#125;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">//q_t 18*18 的第一行q_t[0]和最后一行q_t[17]单独赋值，由于这两行相当于原矩阵颠倒了后的值</span></span><br><span class="line">        <span class="keyword">assign</span> q_t[<span class="number">0</span>][<span class="number">17</span>:<span class="number">0</span>] = &#123;q[<span class="number">15</span>*<span class="number">16</span>], q[<span class="number">15</span>*<span class="number">16</span>+:<span class="number">16</span>], q[<span class="number">15</span>*<span class="number">16</span>+<span class="number">15</span>]&#125;;</span><br><span class="line">        <span class="keyword">assign</span> q_t[<span class="number">17</span>][<span class="number">17</span>:<span class="number">0</span>] = &#123;q[<span class="number">0</span>], q[<span class="number">0</span>*<span class="number">16</span>+:<span class="number">16</span>], q[<span class="number">0</span>*<span class="number">16</span>+<span class="number">15</span>]&#125;;</span><br><span class="line">    <span class="keyword">endgenerate</span> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//判断数量,</span></span><br><span class="line">    <span class="keyword">wire</span>[<span class="number">3</span>:<span class="number">0</span>] q_cnt[<span class="number">15</span>:<span class="number">0</span>][<span class="number">15</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">255</span>:<span class="number">0</span>] q_temp;</span><br><span class="line">    <span class="keyword">genvar</span> j,k;</span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j&lt;<span class="number">16</span>; j=j+<span class="number">1</span>) <span class="keyword">begin</span>:loop_out</span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k&lt;<span class="number">16</span>; k=k+<span class="number">1</span>) <span class="keyword">begin</span>:loop_in</span><br><span class="line">                <span class="comment">//依次计算每个位置的邻居数量q_cnt</span></span><br><span class="line">                <span class="keyword">assign</span> q_cnt[j][k] = q_t[j+<span class="number">1</span>][k] + q_t[j+<span class="number">1</span>][k+<span class="number">2</span>] + q_t[j][k] + q_t[j][k+<span class="number">2</span>] + q_t[j][k+<span class="number">1</span>] + q_t[j+<span class="number">2</span>][k] + q_t[j+<span class="number">2</span>][k+<span class="number">2</span>] + q_t[j+<span class="number">2</span>][k+<span class="number">1</span>];</span><br><span class="line">                <span class="comment">//利用三目运算符判断数量，决定下一时刻该位置的q值</span></span><br><span class="line">                <span class="keyword">assign</span> q_temp[j*<span class="number">16</span>+k] = (q_cnt[j][k]==<span class="number">4&#x27;d3</span>)? <span class="number">1&#x27;b1</span>: </span><br><span class="line">                                                            ((q_cnt[j][k]==<span class="number">4&#x27;b0010</span>)? q[j*<span class="number">16</span>+k] :</span><br><span class="line">                                                                                    <span class="number">1&#x27;b0</span>);</span><br><span class="line">            <span class="keyword">end</span> </span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//上升沿赋值</span></span><br><span class="line">    <span class="keyword">integer</span> m;</span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (load) <span class="keyword">begin</span></span><br><span class="line">            q&lt;=data;</span><br><span class="line">        <span class="keyword">end</span> </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            q&lt;=q_temp;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info flat&quot;&gt;&lt;p&gt;纪念&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E7%B4%84%E7%BF%B0%C2%B7%E4%</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="HDLBits" scheme="https://blog.esing.dev/tags/HDLBits/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：第三篇</title>
    <link href="https://blog.esing.dev/2025/09/28/vd-p3/"/>
    <id>https://blog.esing.dev/2025/09/28/vd-p3/</id>
    <published>2025-09-28T02:48:34.000Z</published>
    <updated>2025-10-25T08:41:54.508Z</updated>
    
    <content type="html"><![CDATA[<h2 id="RISC-V简介">RISC-V简介</h2><p>也可以看一下 <a href="/2024/04/20/dsd-p12/" title="数字系统设计复习笔记：第十二篇">数字系统设计复习笔记：第十二篇</a></p><h3 id="寄存器">寄存器</h3><p>RV32/64I指令集定义了32个32/64位的通用整数寄存器x0～x31，其中x0固定用于存放数据0；寄存器位数决定了其可以访问的地址空间大小。</p><table><thead><tr><th>寄存器</th><th>别名</th><th>常见用途</th></tr></thead><tbody><tr><td><code>x1</code></td><td><code>ra</code></td><td><strong>返回地址 (Return Address)</strong>：<code>jal</code> 指令自动将返回地址存入此处。</td></tr><tr><td><code>x2</code></td><td><code>sp</code></td><td><strong>栈指针 (Stack Pointer)</strong>：指向当前栈顶。</td></tr><tr><td><code>x3</code></td><td><code>gp</code></td><td><strong>全局指针 (Global Pointer)</strong>：指向 2048 字节的小数据区（<code>.sdata</code>），用于高效访问小全局变量。</td></tr><tr><td><code>x4</code></td><td><code>tp</code></td><td><strong>线程指针 (Thread Pointer)</strong>：用于线程本地存储（TLS）。</td></tr><tr><td><code>x5</code></td><td><code>t0</code></td><td><strong>临时寄存器 (Temporary)</strong>：调用者保存（caller-saved）。</td></tr><tr><td><code>x6</code>–<code>x7</code></td><td><code>t1</code>, <code>t2</code></td><td>额外的临时寄存器。</td></tr><tr><td><code>x8</code></td><td><code>s0</code> / <code>fp</code></td><td><strong>保存寄存器 / 帧指针</strong>：被调用者保存（callee-saved）。也可用作帧指针。</td></tr><tr><td><code>x9</code></td><td><code>s1</code></td><td>保存寄存器。</td></tr><tr><td><code>x10</code>–<code>x17</code></td><td><code>a0</code>–<code>a7</code></td><td><strong>函数参数和返回值</strong>：传递前 8 个参数；<code>a0</code>/<code>a1</code> 也用于返回值。</td></tr><tr><td><code>x18</code>–<code>x27</code></td><td><code>s2</code>–<code>s11</code></td><td><strong>保存寄存器</strong>：被调用者保存，适合存放局部变量。</td></tr><tr><td><code>x28</code>–<code>x31</code></td><td><code>t3</code>–<code>t6</code></td><td>临时寄存器。</td></tr></tbody></table><h3 id="指令组成">指令组成</h3><p>也可以看一下 <a href="/2025/04/07/riscvcod-intro/" title="从零开始学RISCV：序篇">从零开始学RISCV：序篇</a></p><h2 id="单周期RISC-V处理器的数据通路">单周期RISC-V处理器的数据通路</h2><h3 id="I-Type-LOAD">I-Type (LOAD)</h3><p><code>lw</code>的指令格式为I-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:20]    [19:15]    [14:12]    [11:7]    [6:0]</span><br><span class="line">imm        rs1        funct3     rd        op</span><br><span class="line">12bits     5bits      3bits      5bits     7bits</span><br></pre></td></tr></table></figure><p>首先从<u>指令内存</u>中取指，根据<code>op</code>决定是<code>lw</code>指令，随后从指令中拆分出寄存器地址<code>rs1</code>并从<u>寄存器堆</u>中读取对应地址的值，再将立即数<code>imm</code>从12位补全到32位，接着将两个值送进ALU进行运算。运算完成后，将结果输入<u>数据内存</u>，读取对应地址数据值，再将数据值传回<u>寄存器堆</u>，写入目标寄存器<code>rd</code>，最后决定下一个指令的地址为PC+4，送回<u>PC寄存器</u>。</p><img src="https://webp.esing.dev/img/image-20250928165620259_250928_1656_YRpN.png" alt="lw单周期数据通路" style="zoom: 67%;" /><h3 id="S-Type">S-Type</h3><p><code>sw</code>的指令格式为S-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:25]    [24:20]    [19:15]    [14:12]    [11:7]    [6:0]</span><br><span class="line">imm[11:5]  rs2        rs1        funct3     imm[4:0]  op</span><br><span class="line">6bits      5bits      5bits      3bits      5bits     7bits</span><br></pre></td></tr></table></figure><p>首先从<u>指令内存</u>中取指，根据<code>op</code>决定是<code>sw</code>指令，随后从指令中拆分出寄存器地址<code>rs1</code>并从<u>寄存器堆</u>中读取对应地址的值，再将立即数<code>imm</code>从12位补全到32位，接着将两个值送进ALU进行运算。运算完成后，将结果输入<u>数据内存</u>，以选择目标地址，再将数据值从<u>寄存器堆</u>传入<u>数据内存</u>，最后决定下一个指令的地址为PC+4，送回<u>PC寄存器</u>。</p><img src="https://webp.esing.dev/img/image-20250928175757718_250928_1757_Zf1h.png" alt="sw单周期数据通路" style="zoom: 67%;" /><h3 id="R-Type">R-Type</h3><p><code>or</code>的指令格式为R-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:25]    [24:20]    [19:15]    [14:12]    [11:7]    [6:0]</span><br><span class="line">funct7     rs2        rs1        funct3     rd        op</span><br><span class="line">6bits      5bits      5bits      3bits      5bits     7bits</span><br></pre></td></tr></table></figure><p>首先从<u>指令内存</u>中取指，根据<code>op</code>只能决定是R-Type指令，具体为什么指令还需要读取<code>funct7</code>和<code>funct3</code>进行判断。判断为<code>or</code>后，从指令中拆分出寄存器地址<code>rs1</code>与<code>rs2</code>，并从<u>寄存器堆</u>中读取对应地址的值，不经过立即数拓展，直接送入<u>ALU</u>进行比较，随后将数据值传回<u>寄存器堆</u>，写入目标寄存器<code>rd</code>，最后决定下一个指令的地址为PC+4，送回<u>PC寄存器</u>。</p><img src="https://webp.esing.dev/img/image-20250928183326295_250928_1833_xlwm.png" alt="or单周期数据通路" style="zoom: 67%;" /><h3 id="B-Type">B-Type</h3><p><code>beq</code>的指令格式为B-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:25]        [24:20]    [19:15]    [14:12]    [11:7]        [6:0]</span><br><span class="line">imm[12, 10:5]  rs2        rs1        funct3     imm[4:1, 11]  op</span><br><span class="line">6bits          5bits      5bits      3bits      5bits         7bits</span><br></pre></td></tr></table></figure><p>首先从指令内存中取指，根据<code>op</code>决定为B-Type，随后从指令中拆分出寄存器地址<code>rs1</code>与<code>rs2</code>，并从<u>寄存器堆</u>中读取对应地址的值，接着将两个值送进ALU进行运算，结果为14-14=0。运算完成后，将CPSR的Z设置为1。同时，立即数扩展产生-12，与PC相加，得到新的PC地址，并送入PC选择器以便随后使用。</p><div class="note info flat"><p>这里为什么是-12？</p><p><code>0xFFA</code>为<code>1111_1111_1010</code>，负数补码为取反加一，因此是<code>0000_0000_0101(2)+1(2)=0110(2)=6(10)</code>。所以<code>0xFFA</code>为-6。又因为要低位拓展为0，即算术左移，相当于乘以2，所以最终的立即数为-12。</p><p>注意这里的立即数是<code>imm[12:1]</code>，低位还需要补0。最终为13位立即数，表达式为：<br><code>{20{Instr[31]}, Instr[7], Instr[30:25], Instr[11:8], 1'b0}</code></p></div><img src="https://webp.esing.dev/img/image-20251014225812729_251014_2258_CvjQ.png" alt="beq单周期数据通路" style="zoom:60%;" /><h3 id="控制信号生成">控制信号生成</h3><p>单周期处理器的控制单元基于<code>op</code>、<code>funct3</code>和 <code>funct7</code>设计控制信号。RV32I 指令集只使用<code>funct7</code>的第 5 位。</p><img src="https://webp.esing.dev/img/image-20251014235722929_251014_2357_hnTB.png" alt="控制信号生成的高层与底层结构图" style="zoom: 50%;" /><h3 id="增强的I-Type指令支持">增强的I-Type指令支持</h3><p>对于<code>addi</code>指令，其同样为I-Type，但是仅靠先前的通路无法执行，因其控制信号与<code>lw</code>不同。<code>ImmSrc</code>依旧为00，<code>ALUSrc</code>为1，代表使用立即数扩展后的结果。但<code>ResultSrc</code>为0，代表直接使用ALU的计算结果而不从数据寄存器取值。</p><img src="https://webp.esing.dev/img/image-20251015105925057_251015_1059_TE5F.png" alt="addi单周期数据通路以及控制信号" style="zoom: 60%;" /><h3 id="J-Type">J-Type</h3><p><code>jal</code>的指令格式为J-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:11]                   [11:7]        [6:0]</span><br><span class="line">imm[20, 10:1, 11, 19:12]  rd            op</span><br><span class="line">20bits                    5bits         7bits</span><br></pre></td></tr></table></figure><p>首先从<u>指令内存</u>中取指，根据<code>op</code>决定为J-Type，随后从指令中拆分出寄存器地址<code>rd</code>，并将<code>pc+4</code>写入<u>寄存器堆</u>，再将立即数<code>imm</code>从21位补全到32位，和<code>pc</code>一起送入<u>ALU</u>进行运算，求得新的地址值，最后传回<u>PC寄存器</u>。</p><div class="note warning flat"><p>I/S-Type的立即数均为12位，B-Type的立即数为13位，J-Type最长，为21位！</p><p>和B-Type类似，J-Type同样需要低位补0（乘以2）。</p></div><img src="https://webp.esing.dev/img/image-20251015110657612_251015_1106_opzy.png" alt="jal单周期数据通路以及控制信号" style="zoom:60%;" /><h3 id="执行时间">执行时间</h3><p>对于单周期处理器来说，周期时间受限于关键路径，即执行时间最长的路径。通常，路径中的瓶颈在内存存取、ALU和寄存器堆读写中。</p><img id="table" src="https://webp.esing.dev/img/image-20251015111222002_251015_1112_zf5L.png" alt="各组件执行任务所需时间" style="zoom:50%;" /><p>对于所有指令操作，<code>lw</code>是执行最长的。可将时间简化为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mrow><msub><mi mathvariant="normal">c</mi><mo lspace="0em" rspace="0em">−</mo></msub><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi></mrow></msub><mo>=</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">p</mi><mi mathvariant="normal">c</mi><msub><mi mathvariant="normal">q</mi><mo lspace="0em" rspace="0em">−</mo></msub><mi mathvariant="normal">P</mi><mi mathvariant="normal">C</mi></mrow></msub><mo>+</mo><mn>2</mn><msub><mi>t</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">m</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">d</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">A</mi><mi mathvariant="normal">L</mi><mi mathvariant="normal">U</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">x</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">p</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{\mathrm{c_{-}single}}=t_{\mathrm{pcq_{-}PC}}+2t_{\mathrm{mem}}+t_{\mathrm{RFread}}+t_{\mathrm{ALU}}+t_{\mathrm{mux}}+t_{\mathrm{RFsetup}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9751em;vertical-align:-0.2918em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span><span class="mord mathrm mtight">single</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2918em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9068em;vertical-align:-0.2918em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">pc</span><span class="mord mtight"><span class="mord mathrm mtight">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span><span class="mord mathrm mtight">PC</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2918em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">mem</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">RFread</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">ALU</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">mux</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">RFsetup</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><h2 id="多周期RISC-V处理器">多周期RISC-V处理器</h2><p>单周期处理器有 3 个明显的缺点。首先，使用两个独立的内存分别存储指令和数据，而大多数处理器只有一个内存用于存储指令和数据；其次，需要足够长的时钟周期支持最慢的指令<code>lw</code>, 尽管大多数指令可能更快；最后，用了 3 个加法器（1 个在 ALU 中，2 个用于实现 PC 逻辑），而加法器是相对昂贵的电路，尤其是需要快速时价格更高。</p><p>对于多周期处理器，使用组合内存，既存储指令也存储数据。这样，可以在一个周期读取指令而在另一个周期读取或写入数据。</p><img src="https://webp.esing.dev/img/image-20251021092607468_251021_0926_V9Wk.png" alt="多周期处理器结构，注意有一个用于存储旧PC的寄存器" style="zoom:50%;" /><h2 id="流水线RISC-V处理器">流水线RISC-V处理器</h2><p>这应该是处理器的最终形态了：用流水线来增加吞吐量。</p><p>参考 <a href="/2024/06/16/coae-p10/" title="计算机原理与嵌入式系统笔记：第十篇">计算机原理与嵌入式系统笔记：第十篇</a></p><p><img src="https://webp.esing.dev/img/image-20251025005741517_251025_0057_IzT8.png" alt="带控制器的流水线处理器"></p><h3 id="性能计算">性能计算</h3><p>我们假定：</p><ul><li>40% 的load指令被下一条指令使用；</li><li>50% 的分支指令预测错误；</li><li>不停滞时Load CPI = 1, 停滞时为2；</li><li>不停滞时Branch CPI = 1,停滞时为3；</li></ul><p>对于平均Load CPI，计算为 1x0.6+2x0.4=1.4；分支CPI同理，可求得为2。</p><p>对于 SPECINT2000 benchmark 测评程序：</p><ul><li>25% loads</li><li>10% stores</li><li>11% branches</li><li>2% jumps</li><li>52% R-type/I-type ALU</li></ul><p>因此，可求得平均CPI为 0.25x1.4+ 0.1x1 + 0.11x2 + 0.02x3 + 0.52x1 = 1.25。</p><h3 id="执行时间-2">执行时间</h3><p>参考上面的<a href="#table">表格</a>，计算关键路径：</p><img src="https://webp.esing.dev/img/image-20251025010402054_251025_0104_IGyY.png" alt="流水线处理器关键路径" style="zoom: 50%;" /><p>可列出流水线周期表达式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mrow><mi>c</mi><mi mathvariant="normal">_</mi><mi>p</mi><mi>i</mi><mi>p</mi><mi>e</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>=</mo><msub><mi>t</mi><mrow><mi>p</mi><mi>c</mi><mi>q</mi></mrow></msub><mo>+</mo><mn>4</mn><msub><mi>t</mi><mtext>mux</mtext></msub><mo>+</mo><msub><mi>t</mi><mtext>ALU</mtext></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>A</mi><mi>N</mi><mi>D</mi><mo>−</mo><mi>O</mi><mi>R</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mtext>setup</mtext></msub></mrow><annotation encoding="application/x-tex">T_{c\_pipelined} = t_{pcq} + 4t_\text{mux} + t_\text{ALU} + t_{AND-OR} + t_\text{setup}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0503em;vertical-align:-0.367em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">4</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">mux</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">ALU</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8234em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">OR</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">setup</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>求得流水线的周期为350ps。因此，执行1000亿条指令的程序，在求得CPI为1.25的状况下，总消耗时间为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>100</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>×</mo><mn>1.25</mn><mo>×</mo><mo stretchy="false">(</mo><mn>350</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>12</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>44</mn><mtext> </mtext><mi>s</mi></mrow><annotation encoding="application/x-tex">100\times10^9\times1.25\times(350\times10^{12})=44\ s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">100</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1.25</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">350</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">44</span><span class="mspace"> </span><span class="mord mathnormal">s</span></span></span></span></span></p><table><thead><tr><th>处理器</th><th>执行时间</th><th>加速比</th></tr></thead><tbody><tr><td>单周期</td><td>75s</td><td>1</td></tr><tr><td>多周期</td><td>155s</td><td>0.5</td></tr><tr><td>流水线</td><td>44s</td><td>1.7</td></tr></tbody></table><h2 id="先进微架构">先进微架构</h2><ul><li><strong>超标量（Superscalar）架构</strong>：在一个时钟周期内发射多条指令（例如 Intel Core、AMD Zen 系列）。</li><li><strong>深度流水线（Deep Pipeline）</strong>：将指令执行分解为更多阶段（例如 Intel NetBurst 曾达到 31 级流水线）。</li><li><strong>动态流水线调整</strong>：现代架构（如 Apple M1、AMD Zen 4）可根据功耗和负载动态调整流水线深度。</li><li><strong>乱序执行（Out-of-Order Execution）</strong>：打破程序的指令顺序约束，动态调度以最大化执行单元利用率。</li><li><strong>寄存器重命名（Register Renaming）</strong>：避免伪依赖（false dependency），提升并行度。</li><li><strong>混合架构（Hybrid Architecture）</strong>：如 Intel Alder Lake 的 Performance Core 与 Efficiency Core。</li><li><strong>多线程（Multithreading）</strong>：如 Intel 的 Hyper-Threading（超线程）技术</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;RISC-V简介&quot;&gt;RISC-V简介&lt;/h2&gt;
&lt;p&gt;也可以看一下 &lt;a href=&quot;/2024/04/20/dsd-p12/&quot; title=&quot;数字系统设计复习笔记：第十二篇&quot;&gt;数字系</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>隐秘参数APP使用ADB打印更多信息</title>
    <link href="https://blog.esing.dev/2025/09/21/hiddenprobe-adb/"/>
    <id>https://blog.esing.dev/2025/09/21/hiddenprobe-adb/</id>
    <published>2025-09-21T12:41:33.000Z</published>
    <updated>2025-09-23T05:58:42.912Z</updated>
    
    <content type="html"><![CDATA[<p>最近在用“隐秘参数”这款APP查看手机信息。软件内有提示说无法获取的信息要用ADB命令，奈何软件太久没更新，帮助链接已经失效了。</p><p>上网查询了一下，要在CMD里运行下面命令（Powershell执行时会报错，不知道为啥）：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> /F &quot;tokens=<span class="number">2</span> delims=:&quot; %p <span class="keyword">IN</span> (&#x27;adb shell pm <span class="built_in">path</span> com.x1y9.probe&#x27;) <span class="keyword">do</span> adb shell CLASSPATH=%p app_process / com.x1y9.app.MainActivity</span><br></pre></td></tr></table></figure><p>额外的参数就会被打印到终端了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近在用“隐秘参数”这款APP查看手机信息。软件内有提示说无法获取的信息要用ADB命令，奈何软件太久没更新，帮助链接已经失效了。&lt;/p&gt;
&lt;p&gt;上网查询了一下，要在CMD里运行下面命令（Powe</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="ADB" scheme="https://blog.esing.dev/tags/ADB/"/>
    
    <category term="隐秘参数" scheme="https://blog.esing.dev/tags/%E9%9A%90%E7%A7%98%E5%8F%82%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：第二篇</title>
    <link href="https://blog.esing.dev/2025/09/17/vd-p2/"/>
    <id>https://blog.esing.dev/2025/09/17/vd-p2/</id>
    <published>2025-09-17T12:00:34.000Z</published>
    <updated>2025-10-24T10:17:43.198Z</updated>
    
    <content type="html"><![CDATA[<h2 id="浮点数">浮点数</h2><h3 id="浮点数标准">浮点数标准</h3><p>IEEE标准754-1985定义了浮点数的<strong>存储格式、运算规则、舍入方式以及特殊值的处理</strong>（如无穷大、NaN等）。其核心思想是用科学计数法的形式来表示实数：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>R</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>s</mi></msup><mo>×</mo><mi>M</mi><mo>×</mo><msup><mn>2</mn><mi>E</mi></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>s</mi></msup><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>F</mi><mo stretchy="false">)</mo><mo>×</mo><msup><mn>2</mn><mi>E</mi></msup></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}R &amp;= (-1)^s \times M \times 2^E \\  &amp;= (-1)^s \times (1+F) \times 2^E\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.1027em;vertical-align:-1.3013em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8013em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span><span style="top:-2.3587em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3013em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8013em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span></span></span></span></span></span></span><span style="top:-2.3587em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3013em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>其中：</p><ul><li>s为符号位；</li><li>M为尾数，即有效数字部分，在1-2之间；</li><li>F为小数部分，在0-1之间；</li><li>E为指数，表示以 2 为底的幂次。</li></ul><p>IEEE 754 定义了多种精度格式，最常用的是单精度浮点数与双精度浮点数：</p><ul><li><strong>单精度浮点数 总共 32 位（4 字节）</strong><ul><li>1 位符号位</li><li>8 位指数（偏移量为 127）</li><li>23 位尾数（实际精度为 24 位，因为有隐含的前导 1）</li></ul></li><li><strong>双精度浮点数 总共 64 位（8 字节）</strong><ul><li>1 位符号位</li><li>11 位指数（偏移量为 1023）</li><li>52 位尾数（实际 53 位精度）</li></ul></li></ul><p>此外，IEEE 754 还定义了许多特殊情况：</p><table><thead><tr><th>情况</th><th>指数部分</th><th>尾数部分</th><th>含义</th></tr></thead><tbody><tr><td>正常数</td><td>非全0非全1</td><td>任意</td><td>正规浮点数</td></tr><tr><td>零</td><td rowspan="2">全为0</td><td>全为0</td><td>+0 或 -0（符号位决定）</td></tr><tr><td>非规约数（Denormal/Subnormal）</td><td>非全0</td><td>表示非常接近0的数，扩展下溢范围</td></tr><tr><td>无穷大（Infinity）</td><td rowspan="2">全为1</td><td>全为0</td><td>如 1.0/0.0 → +∞</td></tr><tr><td>NaN（Not a Number）</td><td>非全0</td><td>非法操作结果，如 0/0、√(-1)</td></tr></tbody></table><h3 id="相对精度">相对精度</h3><p>在浮点数表示中，<strong>相对精度是近似恒定的</strong>（在同一个指数区间内），这是浮点数优于定点数的关键之一。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>F</mi><mi>N</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>23</mn><mo>×</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>10</mn></msub><mn>2</mn><mo>≈</mo><mn>23</mn><mo>×</mo><mn>0.3</mn><mo>≈</mo><mn>6</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>D</mi><mi>N</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>52</mn><mo>×</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>10</mn></msub><mn>2</mn><mo>≈</mo><mn>52</mn><mo>×</mo><mn>0.3</mn><mo>≈</mo><mn>16</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}F_N &amp;= 23 \times \log_{10}2 \approx 23 \times 0.3 \approx 6 \\D_N &amp;= 52 \times \log_{10}2 \approx 52 \times 0.3 \approx 16\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">23</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">23</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">0.3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">6</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">52</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">52</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">0.3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">16</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><h3 id="浮点加法">浮点加法</h3><p>计算分四步走：</p><ol><li>对齐数字：按较小的指数移动数字</li><li>整数及尾数相加</li><li>规格化结果并检查是否上溢或下溢</li><li>若有必要，进位并再次规格化</li></ol><p>首先考虑4位的十进制：9.999 × 10<sup>1</sup> + 1.610 × 10<sup>–1</sup> = ?</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">9</span><span class="variable">.999</span>  × <span class="number">10</span>^<span class="number">1</span> + <span class="number">1</span><span class="variable">.610</span> × <span class="number">10</span>^–<span class="number">1</span></span><br><span class="line">=  <span class="number">9</span><span class="variable">.999</span>  × <span class="number">10</span>^<span class="number">1</span> + <span class="number">0</span><span class="variable">.016</span> × <span class="number">10</span>^<span class="number">1</span>  <span class="comment">// 对齐</span></span><br><span class="line">= <span class="number">10</span><span class="variable">.015</span>  × <span class="number">10</span>^<span class="number">1</span>                 <span class="comment">// 整数与尾数相加</span></span><br><span class="line">=  <span class="number">1</span><span class="variable">.0015</span> × <span class="number">10</span>^<span class="number">2</span>                 <span class="comment">// 规格化结果</span></span><br><span class="line">=  <span class="number">1</span><span class="variable">.002</span>  × <span class="number">10</span>^<span class="number">2</span>                 <span class="comment">// 进位并再次规格化</span></span><br></pre></td></tr></table></figure><p>随后考虑4位的二进制：1.000<sub>2</sub> × 2<sup>–1</sup> + –1.110<sub>2</sub> × 2<sup>–2</sup> (0.5 + –0.4375) = ？</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125; + –<span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">2</span>&#125; (<span class="number">0</span><span class="variable">.5</span> + –<span class="number">0</span><span class="variable">.4375</span>)</span><br><span class="line">= <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125; + –<span class="number">0</span><span class="variable">.111</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125; <span class="comment">// 对齐</span></span><br><span class="line">= <span class="number">0</span><span class="variable">.001</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125;                      <span class="comment">// 整数与尾数相加</span></span><br><span class="line">= <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;-<span class="number">4</span>&#125;                      <span class="comment">// 规格化，未溢出</span></span><br><span class="line">= <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;-<span class="number">4</span>&#125; = <span class="number">0</span><span class="variable">.0625</span>             <span class="comment">// 无需进位与规格化</span></span><br></pre></td></tr></table></figure><h4 id="硬件实现">硬件实现</h4><p>显然，与整数加法器相比，浮点加法器的硬件结构要复杂得多。考虑到其复杂性，在一个时钟周期内完成会花费太长时间，因此通常设计为需要几个周期才能完成计算。常用流水线来实现。</p><img src="https://webp.esing.dev/img/image-20250917225620166_250917_2256_8Hqr.png" alt="浮点加法器硬件结构图" style="zoom: 33%;" /><h3 id="浮点乘法">浮点乘法</h3><p>与加法相比，浮点数乘法计算分五步走：</p><ol><li>把指数相加</li><li>整数及尾数相乘</li><li>规格化结果并检查是否上溢或下溢</li><li>若有必要，进位并再次规格化</li><li><strong>确定符号位</strong></li></ol><p>首先考虑4位的十进制：1.110 × 10<sup>10</sup> × 9.200 × 10<sup>–5</sup> = ?</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">1</span><span class="variable">.110</span>  × <span class="number">10</span>^<span class="number">10</span> × <span class="number">9</span><span class="variable">.200</span> × <span class="number">10</span>^–<span class="number">5</span></span><br><span class="line">=  <span class="number">1</span><span class="variable">.110</span>  × <span class="number">9</span><span class="variable">.200</span> × <span class="number">10</span>^(<span class="number">10</span> - <span class="number">5</span>)  <span class="comment">// 指数相加</span></span><br><span class="line">= <span class="number">10</span><span class="variable">.212</span>  × <span class="number">10</span>^<span class="number">5</span>                 <span class="comment">// 整数与尾数相乘</span></span><br><span class="line">=  <span class="number">1</span><span class="variable">.0212</span> × <span class="number">10</span>^<span class="number">6</span>                 <span class="comment">// 规格化结果</span></span><br><span class="line">=  <span class="number">1</span><span class="variable">.021</span>  × <span class="number">10</span>^<span class="number">6</span>                 <span class="comment">// 进位并再次规格化</span></span><br><span class="line">= +<span class="number">1</span><span class="variable">.021</span>  × <span class="number">10</span>^<span class="number">6</span>                 <span class="comment">// 确定符号位</span></span><br></pre></td></tr></table></figure><p>随后考虑4位的二进制：1.000<sub>2</sub> × 2<sup>–1</sup> × –1.110<sub>2</sub> × 2<sup>–2</sup> (0.5 × –0.4375) = ？</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125; × –<span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">2</span>&#125; (<span class="number">0</span><span class="variable">.5</span> × –<span class="number">0</span><span class="variable">.4375</span>)</span><br><span class="line">Unbiased: –<span class="number">1</span> + –<span class="number">2</span> = –<span class="number">3</span>              <span class="comment">// 把指数相加</span></span><br><span class="line">Biased: (–<span class="number">1</span> + <span class="number">127</span>) + (–<span class="number">2</span> + <span class="number">127</span>)</span><br><span class="line">         = –<span class="number">3</span> + <span class="number">254</span> – <span class="number">127</span> </span><br><span class="line">         = –<span class="number">3</span> + <span class="number">127</span></span><br><span class="line"> =  <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>)  × <span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>)            <span class="comment">// 整数与尾数相乘</span></span><br><span class="line"> =  <span class="number">1</span><span class="variable">.1102</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;-<span class="number">3</span>&#125;</span><br><span class="line"> =  <span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>)  × <span class="number">2</span>^&#123;–<span class="number">3</span>&#125;              <span class="comment">// 规格化，未溢出</span></span><br><span class="line"> =  <span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>)  × <span class="number">2</span>^&#123;–<span class="number">3</span>&#125;              <span class="comment">// 无需进位与规格化</span></span><br><span class="line"> = -<span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>)  × <span class="number">2</span>^&#123;–<span class="number">3</span>&#125; = –<span class="number">0</span><span class="variable">.21875</span>   <span class="comment">// 确定符号位</span></span><br></pre></td></tr></table></figure><h2 id="有限状态机">有限状态机</h2><a href="/2024/04/19/dsd-p8/" title="数字系统设计复习笔记：第八篇">数字系统设计复习笔记：第八篇</a><h2 id="时序">时序</h2><p><s>给我干哪来了，这还是VLSI设计吗</s></p><a href="/2024/10/04/dcmos-p5/" title="数字CMOS集成电路复习笔记：第五篇">数字CMOS集成电路复习笔记：第五篇</a><img src="https://webp.esing.dev/img/image-20250919134935882_250919_1349_0011.png" alt="简单的时序分析例子" style="zoom: 33%;" /><h3 id="同步与异步">同步与异步</h3><ul><li>如果所有的状态转换被限制在精确的时间点上周期性地发生，这些时间点由一个被称为时钟的特殊信号决定，那么这个（子）电路被称为<strong>同步运行</strong> ；</li><li>当一个（子）电路中的部分或全部存储元素被允许独立于全局而改变它们的状态时，该电路就被称作<strong>异步运行</strong> 。</li></ul><h3 id="设计原则">设计原则</h3><p><strong>同步时序设计的第一个指导原则：</strong></p><ul><li>异步复位信号（何时进入启动状态）</li><li>时钟信号（何时从一个状态进入下一个状态）</li><li>信息信号（进入什么状态，产生什么输出）</li></ul><p>这三类的信号不能混合处理。</p><p>二进制组合逻辑操作（即除反相器和缓冲器以外的逻辑门）需要被严格限制在信息信号中。此外，时钟和非同步复位由扇出树专门分配。</p><p><strong>同步时序设计的第二个指导原则：</strong></p><p>使<strong>时钟周期足够长</strong>，以便在下一个有效的时钟边沿指示寄存器（和其他存储设备）接受新的数据之前，所有的瞬态效应都已经消失了！</p><h3 id="错误示例">错误示例</h3><img src="https://webp.esing.dev/img/image-20250921123000462_250921_1230_wqK2.png" alt="该电路把与门直连到时钟线上去，可能门控信号会产生毛刺" style="zoom:33%;" /><h2 id="功率和能耗">功率和能耗</h2><a href="/2024/09/05/dcmos-p3/" title="数字CMOS集成电路复习笔记：第三篇">数字CMOS集成电路复习笔记：第三篇</a><h3 id="活动因子">活动因子</h3><p>活动因子指的是电路中信号实际翻转的概率，就是翻转概率。对于完全随机的数据，P为0.5。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="true">‾</mo></mover><mo>=</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mi>i</mi></msub><mspace linebreak="newline"></mspace><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mover accent="true"><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="true">‾</mo></mover><mo>∗</mo><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\overline{P_i} = 1-P_i \\a_i = \overline{P_i} * P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0333em;vertical-align:-0.15em;"></span><span class="mord overline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0333em;vertical-align:-0.15em;"></span><span class="mord overline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>通过ANDs和ORs传播的数据具有较低的活动系数，根据设计而变化。通常可以估算为a约为0.1。</p><img src="https://webp.esing.dev/img/image-20250923114714569_250923_1147_Ex03.png" alt="逻辑门的开关概率" style="zoom:50%;" /><h3 id="电源门控">电源门控</h3><p>当块处于空闲状态时，关闭其电源以节省漏电。可以使用虚拟VDD（VDDV），使用输出隔离门防止无效的逻辑电平进入下一个块。</p><h3 id="减少算法和架构层面的活动">减少算法和架构层面的活动</h3><p>在所有的设计层面上搜索不相关的开关活动并将其削减：</p><ul><li>大限度地减少整体计算工作。</li><li>放宽计算精度、音频/图片/视频质量、编码增益、响应时间等要求，以换取更好的能效。</li><li>限制灵活性以换取更好的能效。</li><li>删减或简化控制流和操作模式。</li><li>仔细优化所有字宽和存储容量。</li><li>最大化保持本地的数据交换，避免片外和片间通信。</li><li>避免空闲等待和轮询循环。</li><li>远离具有内存刷新周期的DRAM。</li></ul><h2 id="性能">性能</h2><h3 id="相对性能与CPI">相对性能与CPI</h3><p>引入相对性能：若A的CPU时间为B的x倍，则B相对A快x倍。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right" columnspacing="0em 1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mtext>CPI</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">U</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">s</mi></mrow><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">U</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">U</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">s</mi></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>×</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi></mrow><mo>×</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">I</mi></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>×</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi></mrow><mo>×</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">I</mi></mrow></mrow><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">R</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\text{CPI} &amp;=  \frac{\mathrm{CPU\ Clock\ Cycles}}{\mathrm{Instruction\ Count}}\\ \\\mathrm{CPU\ Time}&amp;= \mathrm{CPU\ Clock\ Cycles}&amp;\times\mathrm{Clock\ Cycle\ Time}\\&amp;= \mathrm{Instruction\ Count}\times \mathrm{CPI}&amp;\times \mathrm{Clock\ Cycle\ Time}\\&amp;= \frac{\mathrm{Instruction\ Count}\times \mathrm{CPI}}{\mathrm{Clock\ Rate}}\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:9.2038em;vertical-align:-4.3519em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.8519em;"><span style="top:-6.8519em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord text"><span class="mord">CPI</span></span></span></span><span style="top:-5.0259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"></span></span><span style="top:-3.5259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">CPU</span><span class="mspace"> </span><span class="mord mathrm">Time</span></span></span></span><span style="top:-2.0259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"></span></span><span style="top:-0.0056em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.3519em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.8519em;"><span style="top:-6.8519em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Instruction</span><span class="mspace"> </span><span class="mord mathrm">Count</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">CPU</span><span class="mspace"> </span><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycles</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.5259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathrm">CPU</span><span class="mspace"> </span><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycles</span></span></span></span><span style="top:-2.0259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathrm">Instruction</span><span class="mspace"> </span><span class="mord mathrm">Count</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathrm">CPI</span></span></span></span><span style="top:-0.0056em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Rate</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Instruction</span><span class="mspace"> </span><span class="mord mathrm">Count</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathrm">CPI</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.3519em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9944em;"><span style="top:-3.1544em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">×</span><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycle</span><span class="mspace"> </span><span class="mord mathrm">Time</span></span></span></span><span style="top:-1.6544em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">×</span><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycle</span><span class="mspace"> </span><span class="mord mathrm">Time</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0056em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>注意<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi></mrow><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">R</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\mathrm{Clock\ Cycle\ Time} = \dfrac{1}{\mathrm{Clock\ Rate}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycle</span><span class="mspace"> </span><span class="mord mathrm">Time</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Rate</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p><h3 id="性能也有上限：阿姆达尔定律">性能也有上限：阿姆达尔定律</h3><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">T</mi><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub><mo>=</mo><mfrac><msub><mi mathvariant="normal">T</mi><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub><mtext>improvement factor</mtext></mfrac><mo>+</mo><msub><mi mathvariant="normal">T</mi><mrow><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathrm{T_{improved}}=\frac{\mathrm{T_{affected}}}{\text{improvement factor}}+\mathrm{T_{unaffected}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathrm">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">improved</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">improvement factor</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">affected</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathrm">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">unaffected</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>举个例子：乘法运算占据总运算100s中的80s，能否改进乘法模块，以至于把整个运算速度提高5倍?</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>20</mn><mo>=</mo><mfrac><mn>80</mn><mi>n</mi></mfrac><mo>+</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">20=\frac{80}{n}+20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">20</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">80</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">20</span></span></span></span></span></p><p>显然是无解的。</p><h3 id="低功耗谬论：Low-Power-at-Idle">低功耗谬论：Low Power at Idle</h3><p>让系统在空闲时更省电并不等于整体能耗更低，节能的真正关键是完成工作所需的总能量（Energy to Complete a Task, ETC），而不是空闲时的功耗。<strong>因此，应当让CPU尽可能快地完成任务然后睡晕过去。</strong></p><h3 id="指标陷阱：MIPS-as-a-Performance-Metric">指标陷阱：MIPS as a Performance Metric</h3><p>为什么不能将MIPS（Million Instructions Per Second，每秒百万条指令）作为衡量计算机性能的标准？</p><p>MIPS（Million Instructions Per Second） 表示每秒执行的指令数量，计算公式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>MIPS</mtext><mo>=</mo><mfrac><mtext>Instruction Count</mtext><mrow><mtext>Execution Time</mtext><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow></mfrac><mo>=</mo><mfrac><mtext>Clock Rate</mtext><mrow><mtext>CPI</mtext><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{MIPS} = \frac{\text{Instruction Count}}{\text{Execution Time} \times 10^6} = \frac{\text{Clock Rate}}{\text{CPI} \times 10^6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">MIPS</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Execution Time</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Instruction Count</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1408em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">CPI</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Clock Rate</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>因此，程序性能取决于 <strong>“指令数 × CPI”</strong>，MIPS 只与 CPI 有关，不反映程序实际工作量。同时，在一个CPU上，不同的程序的CPI是不同的。</p><p>举个例子：</p><ul><li>机器 A：CPI = 1，频率 = 1GHz → 1000 MIPS；</li><li>机器 B：CPI = 2，频率 = 2GHz → 1000 MIPS；</li><li>但机器 B 每条指令的执行时间更长（总时间也可能更慢）。</li></ul><p>再举一个例子：</p><ul><li>程序 X（优化版）执行 1000 条复杂指令完成任务；</li><li>程序 Y（低效版）执行 2000 条简单指令完成相同任务。</li><li>假设两台机器均为 1GHz，且CPI 相同，则程序 Y 的 MIPS 值更高。</li><li>但实际上，<strong>X 执行更快，性能更好</strong>！</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;浮点数&quot;&gt;浮点数&lt;/h2&gt;
&lt;h3 id=&quot;浮点数标准&quot;&gt;浮点数标准&lt;/h3&gt;
&lt;p&gt;IEEE标准754-1985定义了浮点数的&lt;strong&gt;存储格式、运算规则、舍入方式以及特殊值的</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>修改Verilog非阻塞赋值的字体样式</title>
    <link href="https://blog.esing.dev/2025/09/17/nonblocking-display/"/>
    <id>https://blog.esing.dev/2025/09/17/nonblocking-display/</id>
    <published>2025-09-17T02:47:59.000Z</published>
    <updated>2025-09-17T03:16:15.849Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>经常写Verilog的朋友都知道，Verilog的<strong>非阻塞赋值</strong>符号是<code> &lt; = </code>。但是对于大部分开启了连字的等宽字体，这样子写后，会显示为<code>&lt;=</code>而非<code style="font-feature-settings: 'calt' 1, 'cv01' 1, 'cv63' 1 !important;">&lt;=</code>。显然，前者的显示方法是<strong>错误</strong>的。如何显示为后者呢？</p><h2 id="OpenType字体：随心所欲自定义">OpenType字体：随心所欲自定义</h2><p>微软和 Adobe 在 1996 年开发了 OpenType 字体格式，基于 TrueType 和 PostScript 的技术，旨在提供更强大的功能。最重要的一点，便是支持连字、替代字形、上下标、旧式数字等<strong>高级排版特性</strong>。此外，为了不同场合下自定义，OpenType 字体包含了许多可开启的特性。</p><p>我使用<a href="https://github.com/subframe7536/maple-font">Maple Mono Normal NF CN</a>作为系统与博客的等宽字体，因其对中文十分友好。查看文档可知，在<code>v7.1</code>版本加入了<code>cv63</code>特性，即替代<code>&lt;=</code>为箭头样式。因此，只需手动指定某一语言下的样式即可。</p><h2 id="VSCode自定义">VSCode自定义</h2><p>我曾经试过在VSCode的配置中搜索<code>@lang:verilog</code>，以确保设置应用于Verilog语言，但是好像字体修改部分并不会生效。没办法，只能修改工作区配置了。</p><p>在工作区配置的<code>settings.json</code>中加上：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;editor.fontLigatures&quot;: &quot;&#x27;calt&#x27;, &#x27;cv63&#x27;&quot;,</span><br></pre></td></tr></table></figure><p>即可确保Verilog下非阻塞赋值正常显示。</p><h2 id="博客修改字体">博客修改字体</h2><p>博客的代码字体显示是由CSS样式表控制的。查看网页源代码可知，层级如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">figure</span> <span class="attr">class</span>=<span class="string">&quot;highlight verilog&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;code&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pre</span>&gt;</span></span><br><span class="line">                // ......</span><br><span class="line">                <span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">figure</span>&gt;</span></span><br></pre></td></tr></table></figure><p>因此需要确保<code>class</code>为<code>highlight verilog</code>的情况下覆盖<code>&lt;pre&gt;</code>标签的样式。手动加一个样式表，将选择器写具体以提升优先级：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#article-container</span> <span class="selector-tag">figure</span><span class="selector-class">.highlight</span><span class="selector-class">.verilog</span> <span class="selector-tag">td</span><span class="selector-class">.code</span> pre &#123;</span><br><span class="line">    <span class="attribute">font-feature-settings</span>: <span class="string">&quot;calt&quot;</span> <span class="number">1</span>, <span class="string">&quot;cv01&quot;</span> <span class="number">1</span>, <span class="string">&quot;cv61&quot;</span> <span class="number">1</span>, <span class="string">&quot;cv63&quot;</span> <span class="number">1</span> <span class="meta">!important</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即可在Verilog语言下正常显示非阻塞赋值。</p><h2 id="测试">测试</h2><p>测试一下！</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Verilog</span></span><br><span class="line"><span class="keyword">module</span> dff (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">wire</span> clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">wire</span> d,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span>  q</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        q &lt;= d;     <span class="comment">// 我是箭头！</span></span><br><span class="line">    <span class="keyword">end</span>             <span class="comment">// &lt;=========&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Python</span></span><br><span class="line"><span class="keyword">if</span> a &lt;= b:           <span class="comment">## 我不是箭头，但可以是！</span></span><br><span class="line">    <span class="built_in">print</span>(a, b)      <span class="comment">## &lt;=========&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;经常写Verilog的朋友都知道，Verilog的&lt;strong&gt;非阻塞赋值&lt;/strong&gt;符号是&lt;code&gt; &amp;lt; = &lt;/code&gt;。但是对于大</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="博客" scheme="https://blog.esing.dev/tags/%E5%8D%9A%E5%AE%A2/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VSCode" scheme="https://blog.esing.dev/tags/VSCode/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：第一篇</title>
    <link href="https://blog.esing.dev/2025/09/16/vd-p1/"/>
    <id>https://blog.esing.dev/2025/09/16/vd-p1/</id>
    <published>2025-09-16T04:54:12.000Z</published>
    <updated>2025-10-23T17:09:41.034Z</updated>
    
    <content type="html"><![CDATA[<h2 id="加法器">加法器</h2><h3 id="全加器-Full-Adder-FA">全加器 Full Adder FA</h3><p>很简单，输入1bit的两个数以及前一级的进位，输出和与进位符：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> f_add (</span><br><span class="line">    <span class="keyword">input</span>  a,</span><br><span class="line">    <span class="keyword">input</span>  b,</span><br><span class="line">    <span class="keyword">input</span>  cin,</span><br><span class="line">    <span class="keyword">output</span> sum,</span><br><span class="line">    <span class="keyword">output</span> cout</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">assign</span> &#123;cout, sum&#125; = a + b + cin;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="行波进位加法器-Ripple-Carry-Adder-RCA">行波进位加法器 Ripple-Carry Adder RCA</h3><p>我们把N个上面的全加器<code>f_add</code>首尾串联，便得到了一长串全加器链，它们的计算输入是N位，进位输入与输出均为1位。每次进行计算时，前一个的进位输出都会传进后一个的进位输入，看起来就像是<strong>进位在一整条全加器链上产生了波动</strong>，因此称其为“行波进位加法器”。</p><img src="https://webp.esing.dev/img/image-20250916141938050_250916_1419_B9jW.png" alt="行波进位加法器" style="zoom: 33%;" /><p>显然，行波进位加法器的优点是结构简单——只需串联就行，但缺点是延时太长。如上图所示，N个全加器串联后，总延时为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mrow><mi>r</mi><mi>i</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>e</mi></mrow></msub><mo>=</mo><mi>N</mi><mo>⋅</mo><msub><mi>t</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t_{ripple} = N \cdot t_{fa}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">ppl</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>，这是很致命的。</p><h3 id="超前进位加法器-Carry-Lookahead-Adder-CLA">超前进位加法器 Carry-Lookahead Adder CLA</h3><p><a href="#%E8%A1%8C%E6%B3%A2%E8%BF%9B%E4%BD%8D%E5%8A%A0%E6%B3%95%E5%99%A8">上面</a>的行波进位加法器之所以延时太长，是因为每一位的进位计算都依赖前一位，层层叠加导致计算只能串行进行。那有没有什么办法能提高计算速度，比如计算出后续的进位而不依赖前面的结果呢？有的兄弟有的。</p><p>为了方便，我们定义两个新的信号为<strong>产生信号</strong>和<strong>传播信号</strong>，并对输入数据A与B的每一位都进行计算：</p><ul><li><p><strong>进位产生Generate</strong>：如果A<sub>i</sub>和B<sub>i</sub>均为1，那么第i位就会产生一个进位输出：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mi>i</mi></msub><mo>=</mo><msub><mi>A</mi><mi>i</mi></msub><mo>⋅</mo><msub><mi>B</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">G_i = A_i \cdot B_i </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p></li><li><p><strong>进位传播Propagate</strong>: 如果A<sub>i</sub>或B<sub>i</sub>为1，那么第i位将把一个进位输入传播到进位输出:</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>i</mi></msub><mo>=</mo><msub><mi>A</mi><mi>i</mi></msub><mo>+</mo><msub><mi>B</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">P_i = A_i + B_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p></li><li><p><strong>进位输出CarryOut</strong>: 第i的进位输出Ci表达式为：</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>=</mo><msub><mi>A</mi><mi>i</mi></msub><mo>⋅</mo><msub><mi>B</mi><mi>i</mi></msub><mo>+</mo><msub><mi>P</mi><mi>i</mi></msub><mo>⋅</mo><msub><mi>C</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>G</mi><mi>i</mi></msub><mo>+</mo><msub><mi>P</mi><mi>i</mi></msub><msub><mi>C</mi><mrow><mi>i</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">C_i = A_i \cdot B_i + P_i \cdot C_{i-1} = G_i + P_iC_{i-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0502em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8917em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span></p></li></ul><p>将上面的流程应用到每一位，因其进位求值不需要前一级的结果，而是可以直接由每一位计算出，因此称其为“超前进位加法器”。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> cla_3bit (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">2</span>:<span class="number">0</span>] a,</span><br><span class="line">    b,</span><br><span class="line">    inputcin,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>] cout,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>] sum</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] p, g;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> p = a ^ b;  <span class="comment">// propagate</span></span><br><span class="line">    <span class="keyword">assign</span> g = a &amp; b;  <span class="comment">// generate</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span></span><br><span class="line">        cout[<span class="number">0</span>] = g[<span class="number">0</span>] | (p[<span class="number">0</span>] &amp; cin),</span><br><span class="line">        cout[<span class="number">1</span>] = g[<span class="number">1</span>] | (p[<span class="number">1</span>] &amp; g[<span class="number">0</span>]) |</span><br><span class="line">                 (p[<span class="number">1</span>] &amp; p[<span class="number">0</span>] &amp; cin),</span><br><span class="line">        cout[<span class="number">2</span>] = g[<span class="number">2</span>] | (p[<span class="number">2</span>] &amp; g[<span class="number">1</span>]) | </span><br><span class="line">                 (p[<span class="number">2</span>] &amp; p[<span class="number">1</span>] &amp; g[<span class="number">0</span>]) |</span><br><span class="line">                 (p[<span class="number">2</span>] &amp; p[<span class="number">1</span>] &amp; p[<span class="number">0</span>] &amp; cin);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> sum = p ^ &#123;cout[<span class="number">1</span>:<span class="number">0</span>], cin&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="前缀加法器-Parallel-Prefix-Adder-PPA">前缀加法器 Parallel-Prefix Adder PPA</h3><p>观察<a href="#%E8%B6%85%E5%89%8D%E8%BF%9B%E4%BD%8D%E5%8A%A0%E6%B3%95%E5%99%A8">上面</a>的超前进位加法器，可以发现，我们并行计算每一位的进位，比原本的串行计算更快得出结果。还有什么地方可以提升速度呢？</p><p>我们使用“归约”的思想可以得到前缀加法器。前缀加法器是一种高性能的进位计算结构，其核心思想是通过<strong>前缀树结构</strong>实现多级并行归约，<strong>更高效地并行计算每一位的进位结果</strong>：</p><ul><li>计算每一位的 g 和 p;</li><li>采用<strong>分层归约</strong>方式，逐步合并相邻位的 g 和 p，形成前缀树。例如Kogge-Stone结构：<ul><li>第一层合并相邻两位</li><li>第二层合并更远的位</li><li>直到所有进位都被并行计算出来</li></ul></li><li>进位的生成是通过<strong>多级归约</strong>实现的，层数为 log2(N)，N为位宽。</li><li>最终和的计算与<a href="#%E8%B6%85%E5%89%8D%E8%BF%9B%E4%BD%8D%E5%8A%A0%E6%B3%95%E5%99%A8">超前进位加法器</a>类似。</li></ul><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一个Kogge-Stone结构的3bit前缀加法器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> prefix_adder_3bit (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">2</span>:<span class="number">0</span>] a,</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">2</span>:<span class="number">0</span>] b,</span><br><span class="line">    inputcin,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>] sum,</span><br><span class="line">    <span class="keyword">output</span>       cout</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>] p, g;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>] c;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 预处理</span></span><br><span class="line">    <span class="keyword">assign</span> p = a ^ b;  <span class="comment">// 传递</span></span><br><span class="line">    <span class="keyword">assign</span> g = a &amp; b;  <span class="comment">// 产生</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 前缀进位计算（Kogge-Stone结构）</span></span><br><span class="line">    <span class="comment">// 第一层</span></span><br><span class="line">    <span class="keyword">wire</span> g1_0, p1_0;</span><br><span class="line">    <span class="keyword">assign</span> g1_0 = g[<span class="number">1</span>] | (p[<span class="number">1</span>] &amp; g[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">assign</span> p1_0 = p[<span class="number">1</span>] &amp; p[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> g2_1, p2_1;</span><br><span class="line">    <span class="keyword">assign</span> g2_1 = g[<span class="number">2</span>] | (p[<span class="number">2</span>] &amp; g[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">assign</span> p2_1 = p[<span class="number">2</span>] &amp; p[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二层</span></span><br><span class="line">    <span class="keyword">wire</span> g2_0;</span><br><span class="line">    <span class="keyword">assign</span> g2_0 = g[<span class="number">2</span>] | (p[<span class="number">2</span>] &amp; g1_0);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 进位</span></span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">0</span>] = cin;</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">1</span>] = g[<span class="number">0</span>] | (p[<span class="number">0</span>] &amp; cin);</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">2</span>] = g1_0 | (p1_0 &amp; cin);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 求和</span></span><br><span class="line">    <span class="keyword">assign</span> sum  = p ^ c;</span><br><span class="line">    <span class="keyword">assign</span> cout = g2_0 | (p[<span class="number">2</span>] &amp; p1_0 &amp; cin);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>再来一个8bit的例子：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> prefix_adder_8bit (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">7</span>:<span class="number">0</span>] a,    <span class="comment">// 加数a，8位</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">7</span>:<span class="number">0</span>] b,    <span class="comment">// 加数b，8位</span></span><br><span class="line">    inputcin,  <span class="comment">// 输入进位</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] sum,  <span class="comment">// 求和输出</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] cout  <span class="comment">// 每一位的进位输出</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 预处理</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] p, g;</span><br><span class="line">    <span class="keyword">assign</span> p = a ^ b;</span><br><span class="line">    <span class="keyword">assign</span> g = a &amp; b;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 前缀进位计算（Kogge-Stone结构，分层归约）</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] g1, p1, g2, p2, g3, p3;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一层：相邻两位</span></span><br><span class="line">    <span class="keyword">assign</span> g1[<span class="number">0</span>] = g[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> p1[<span class="number">0</span>] = p[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">genvar</span> i;</span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">8</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span> : L1</span><br><span class="line">    <span class="keyword">assign</span> g1[i] = g[i] | (p[i] &amp; g[i-<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">assign</span> p1[i] = p[i] &amp; p[i-<span class="number">1</span>];</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二层：隔1位</span></span><br><span class="line">    <span class="keyword">assign</span> g2[<span class="number">0</span>] = g1[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> p2[<span class="number">0</span>] = p1[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> g2[<span class="number">1</span>] = g1[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">assign</span> p2[<span class="number">1</span>] = p1[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">2</span>; i &lt; <span class="number">8</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span> : L2</span><br><span class="line">    <span class="keyword">assign</span> g2[i] = g1[i] | (p1[i] &amp; g1[i-<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">assign</span> p2[i] = p1[i] &amp; p1[i-<span class="number">2</span>];</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第三层：隔2位</span></span><br><span class="line">    <span class="keyword">assign</span> g3[<span class="number">0</span>] = g2[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> p3[<span class="number">0</span>] = p2[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> g3[<span class="number">1</span>] = g2[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">assign</span> p3[<span class="number">1</span>] = p2[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">assign</span> g3[<span class="number">2</span>] = g2[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">assign</span> p3[<span class="number">2</span>] = p2[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">assign</span> g3[<span class="number">3</span>] = g2[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">assign</span> p3[<span class="number">3</span>] = p2[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">4</span>; i &lt; <span class="number">8</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span> : L3</span><br><span class="line">    <span class="keyword">assign</span> g3[i] = g2[i] | (p2[i] &amp; g2[i-<span class="number">4</span>]);</span><br><span class="line">    <span class="keyword">assign</span> p3[i] = p2[i] &amp; p2[i-<span class="number">4</span>];</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 进位生成</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] c;</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">0</span>] = g[<span class="number">0</span>] | (p[<span class="number">0</span>] &amp; cin);</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">1</span>] = g1[<span class="number">1</span>] | (p1[<span class="number">1</span>] &amp; cin);</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">2</span>] = g2[<span class="number">2</span>] | (p2[<span class="number">2</span>] &amp; cin);</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">3</span>] = g2[<span class="number">3</span>] | (p2[<span class="number">3</span>] &amp; cin);</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">4</span>] = g3[<span class="number">4</span>] | (p3[<span class="number">4</span>] &amp; cin);</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">5</span>] = g3[<span class="number">5</span>] | (p3[<span class="number">5</span>] &amp; cin);</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">6</span>] = g3[<span class="number">6</span>] | (p3[<span class="number">6</span>] &amp; cin);</span><br><span class="line">    <span class="keyword">assign</span> c[<span class="number">7</span>] = g3[<span class="number">7</span>] | (p3[<span class="number">7</span>] &amp; cin);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 求和</span></span><br><span class="line">    <span class="keyword">assign</span> sum = p ^ &#123;c[<span class="number">6</span>:<span class="number">0</span>], cin&#125;;</span><br><span class="line">    <span class="keyword">assign</span> cout = c;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>也可以看这一篇：<a href="https://blog.csdn.net/nbu_dahe/article/details/121424035">树形加法器（Brent-Kung加法器） - CSDN</a></p><h3 id="进位保留加法器-Carry-Save-Adder-CSA">进位保留加法器 Carry-Save Adder CSA</h3><div class="note primary flat"><p>上课未讲，不过也介绍一下</p></div><p>进位保留加法器在执行加法运算时,不立即处理低位产生的进位,而是将其保存下来,以便后续处理，其优点是O(1)的时间复杂度，即计算时间不依赖位宽，且所有位同时处理，因此适合多个数相加。</p><p>进位保留加法器将3个n位数相加，产生2个n位输出：和(Sum)与进位(Carry)，最终结果可写为：<code>Fin = Sum + (Carry &lt;&lt; 1)</code>。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 4位进位保留加法器 (CSA) 主模块</span></span><br><span class="line"><span class="keyword">module</span> csa_4bit (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] a,     <span class="comment">// 第一个4位输入</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] b,     <span class="comment">// 第二个4位输入</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] c,     <span class="comment">// 第三个4位输入</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] sum,   <span class="comment">// 4位和输出</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] carry  <span class="comment">// 4位进位输出</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实例化4个全加器，每位一个</span></span><br><span class="line">    full_adder fa0 (a[<span class="number">0</span>],b[<span class="number">0</span>],c[<span class="number">0</span>],sum[<span class="number">0</span>],carry[<span class="number">0</span>]);</span><br><span class="line">    full_adder fa1 (a[<span class="number">1</span>],b[<span class="number">1</span>],c[<span class="number">1</span>],sum[<span class="number">1</span>],carry[<span class="number">1</span>]);</span><br><span class="line">    full_adder fa2 (a[<span class="number">2</span>],b[<span class="number">2</span>],c[<span class="number">2</span>],sum[<span class="number">2</span>],carry[<span class="number">2</span>]);</span><br><span class="line">    full_adder fa3 (a[<span class="number">3</span>],b[<span class="number">3</span>],c[<span class="number">3</span>],sum[<span class="number">3</span>],carry[<span class="number">3</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 进位传播加法器 (CPA) - 用于最终结果计算</span></span><br><span class="line"><span class="keyword">module</span> cpa_5bit (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">4</span>:<span class="number">0</span>] a,      <span class="comment">// 5位输入A (包含扩展位)</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">4</span>:<span class="number">0</span>] b,      <span class="comment">// 5位输入B  </span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">5</span>:<span class="number">0</span>] result  <span class="comment">// 6位结果输出</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> result = a + b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>主计算模块：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CSA + CPA 组合模块 - 完整的三数加法器</span></span><br><span class="line"><span class="keyword">module</span> three_input_adder_4bit (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] a,      <span class="comment">// 第一个4位输入</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] b,      <span class="comment">// 第二个4位输入</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] c,      <span class="comment">// 第三个4位输入</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">5</span>:<span class="number">0</span>] result  <span class="comment">// 6位最终结果</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] csa_sum;  <span class="comment">// CSA的和输出</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] csa_carry;  <span class="comment">// CSA的进位输出</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] carry_shifted;  <span class="comment">// 左移后的进位</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一步：使用CSA将三个4位数转换为两个数</span></span><br><span class="line">    csa_4bit csa_inst (</span><br><span class="line">        <span class="variable">.a</span>(a),</span><br><span class="line">        <span class="variable">.b</span>(b),</span><br><span class="line">        <span class="variable">.c</span>(c),</span><br><span class="line">        <span class="variable">.sum</span>(csa_sum),</span><br><span class="line">        <span class="variable">.carry</span>(csa_carry)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 进位左移1位</span></span><br><span class="line">    <span class="keyword">assign</span> carry_shifted = &#123;csa_carry, <span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二步：使用CPA计算最终结果</span></span><br><span class="line">    cpa_5bit cpa_inst (</span><br><span class="line">        <span class="variable">.a</span>     (&#123;<span class="number">1&#x27;b0</span>, csa_sum&#125;),  <span class="comment">// 扩展和到5位</span></span><br><span class="line">        <span class="variable">.b</span>     (carry_shifted),    <span class="comment">// 5位左移进位</span></span><br><span class="line">        <span class="variable">.result</span>(result)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>看这张图也很直观：</p><img src="https://webpn.esing.dev/img/ba66462b57b934e6cfa862652eb3aa4b8d255b6f_250917_1913_bYvp.png" alt="出自B站@一个郭果果" style="zoom:50%;" /><h2 id="ALU">ALU</h2><p>ALU(Arithmetic Logic Unit)，即算术逻辑单元，是计算机中负责运算和逻辑处理的核心模块。下面是一个简易的ALU结构图，包含CPSR高位的条件码标志NZCV：</p><img src="https://webp.esing.dev/img/image-20250916184708717_250916_1847_ZrYa.png" alt="可输出NZCV的简易ALU" style="zoom: 33%;" /><p>其Verilog实现也比较简单：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> easyALU (</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] a,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] b,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] op,</span><br><span class="line">    <span class="keyword">output</span> n,</span><br><span class="line">    z,</span><br><span class="line">    c,</span><br><span class="line">    v,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] r</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] m_bus, sumout;</span><br><span class="line">    <span class="keyword">wire</span> c_t, v_t1, v_t2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> n = r[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">assign</span> z = ~|r;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1&#x27;b0为加法，1&#x27;b1为减法</span></span><br><span class="line">    <span class="keyword">assign</span> &#123;c_t, sumout&#125; = a + (op[<span class="number">0</span>] ? (~b + <span class="number">1</span>) : b);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> c = c_t &amp; ~op[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> v_t1 = ~(a[<span class="number">3</span>] ^ b[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">assign</span> v_t2 = a[<span class="number">3</span>] ^ sumout[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> v = v_t1 &amp; v_t2 &amp; ~op[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">case</span> (op[<span class="number">2</span>:<span class="number">1</span>])</span><br><span class="line">    <span class="number">2&#x27;b10</span>:   r = a &amp; b;</span><br><span class="line">    <span class="number">2&#x27;b11</span>:   r = a | b;</span><br><span class="line">    <span class="keyword">default</span>: r = sumout;</span><br><span class="line"><span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>波形看起来也没啥问题：</p><p><img src="https://webp.esing.dev/img/image-20250916195606479_250916_1956_bGua.png" alt="简单ALU波形仿真"></p><h2 id="乘法器">乘法器</h2><p>乘法器输入俩N位宽的值，输出一个2N位宽的值。</p><h3 id="自动综合乘法器">自动综合乘法器</h3><p>没啥说的必要。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动综合版</span></span><br><span class="line"><span class="keyword">module</span> mul4 (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] a,  <span class="comment">// 4位乘数</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] b,  <span class="comment">// 4位被乘数</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] p   <span class="comment">// 8位乘积</span></span><br><span class="line">);</span><br><span class="line">    <span class="keyword">assign</span> p = a * b;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="结构化移位加法乘法器">结构化移位加法乘法器</h3><p>结构化移位加法乘法器很简单：算四遍之后移位相加。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构化移位加法实现版</span></span><br><span class="line"><span class="keyword">module</span> mul4_struct (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] a,  <span class="comment">// 4位乘数</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] b,  <span class="comment">// 4位被乘数</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] p   <span class="comment">// 8位乘积</span></span><br><span class="line">);</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] ab0, ab1, ab2, ab3;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 部分积生成</span></span><br><span class="line">    <span class="keyword">assign</span> ab0 = b[<span class="number">0</span>] ? &#123;<span class="number">4&#x27;b0</span>, a&#125; : <span class="number">8&#x27;b0</span>,        <span class="comment">// a*1 or 0, 不移位</span></span><br><span class="line">           ab1 = b[<span class="number">1</span>] ? &#123;<span class="number">3&#x27;b0</span>, a, <span class="number">1&#x27;b0</span>&#125; : <span class="number">8&#x27;b0</span>,  <span class="comment">// a*2 or 0, 左移1位</span></span><br><span class="line">           ab2 = b[<span class="number">2</span>] ? &#123;<span class="number">2&#x27;b0</span>, a, <span class="number">2&#x27;b0</span>&#125; : <span class="number">8&#x27;b0</span>,  <span class="comment">// a*4 or 0, 左移2位</span></span><br><span class="line">           ab3 = b[<span class="number">3</span>] ? &#123;<span class="number">1&#x27;b0</span>, a, <span class="number">3&#x27;b0</span>&#125; : <span class="number">8&#x27;b0</span>;  <span class="comment">// a*8 or 0, 左移3位</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 部分积相加</span></span><br><span class="line">    <span class="keyword">assign</span> p = ab0 + ab1 + ab2 + ab3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="阵列乘法器">阵列乘法器</h3><p>上面的<a href="#%E7%BB%93%E6%9E%84%E5%8C%96%E7%A7%BB%E4%BD%8D%E5%8A%A0%E6%B3%95%E4%B9%98%E6%B3%95%E5%99%A8">乘法器</a>依旧用到加法，最终计算是串行计算，会降低计算速度。考虑并行计算，提出了阵列乘法器：</p><img src="https://webp.esing.dev/img/image-20250916224909879_250916_2249_qj7f.png" alt="阵列乘法器结构图" style="zoom: 50%;" /><p>实现代码如下：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> array_mul4 (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] a,</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] b,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] p</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] ab0 = &#123;<span class="number">4</span>&#123;a[<span class="number">0</span>]&#125;&#125; &amp; b;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] ab1 = &#123;<span class="number">4</span>&#123;a[<span class="number">1</span>]&#125;&#125; &amp; b;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] ab2 = &#123;<span class="number">4</span>&#123;a[<span class="number">2</span>]&#125;&#125; &amp; b;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] ab3 = &#123;<span class="number">4</span>&#123;a[<span class="number">3</span>]&#125;&#125; &amp; b;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一列</span></span><br><span class="line">    <span class="keyword">assign</span> p[<span class="number">0</span>] = ab0[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二列</span></span><br><span class="line">    <span class="keyword">wire</span> s1_0, c1_0;</span><br><span class="line">    full_adder fa1_0 (<span class="variable">.a</span>(ab1[<span class="number">0</span>]),<span class="variable">.b</span>(ab0[<span class="number">1</span>]),<span class="variable">.cin</span>(<span class="number">1&#x27;b0</span>),<span class="variable">.sum</span>(s1_0),<span class="variable">.cout</span>(c1_0));</span><br><span class="line">    <span class="keyword">assign</span> p[<span class="number">1</span>] = s1_0;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第三列</span></span><br><span class="line">    <span class="keyword">wire</span> s2_0, c2_0, s2_1, c2_1;</span><br><span class="line">    full_adder fa2_0 (<span class="variable">.a</span>(ab2[<span class="number">0</span>]),<span class="variable">.b</span>(ab1[<span class="number">1</span>]),<span class="variable">.cin</span>(<span class="number">1&#x27;b0</span>),<span class="variable">.sum</span>(s2_0),<span class="variable">.cout</span>(c2_0));</span><br><span class="line">    full_adder fa2_1 (<span class="variable">.a</span>(s2_0),  <span class="variable">.b</span>(ab0[<span class="number">2</span>]),<span class="variable">.cin</span>(c1_0),<span class="variable">.sum</span>(s2_1),<span class="variable">.cout</span>(c2_1));</span><br><span class="line">    <span class="keyword">assign</span> p[<span class="number">2</span>] = s2_1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第四列</span></span><br><span class="line">    <span class="keyword">wire</span> s3_0, c3_0, s3_1, c3_1, s3_2, c3_2;</span><br><span class="line">    full_adder fa3_0 (<span class="variable">.a</span>(ab3[<span class="number">0</span>]),<span class="variable">.b</span>(ab2[<span class="number">1</span>]),<span class="variable">.cin</span>(<span class="number">1&#x27;b0</span>),<span class="variable">.sum</span>(s3_0),<span class="variable">.cout</span>(c3_0));</span><br><span class="line">    full_adder fa3_1 (<span class="variable">.a</span>(s3_0),  <span class="variable">.b</span>(ab1[<span class="number">2</span>]),<span class="variable">.cin</span>(c2_0),<span class="variable">.sum</span>(s3_1),<span class="variable">.cout</span>(c3_1));</span><br><span class="line">    full_adder fa3_2 (<span class="variable">.a</span>(s3_1),  <span class="variable">.b</span>(ab0[<span class="number">3</span>]),<span class="variable">.cin</span>(c2_1),<span class="variable">.sum</span>(s3_2),<span class="variable">.cout</span>(c3_2));</span><br><span class="line">    <span class="keyword">assign</span> p[<span class="number">3</span>] = s3_2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第五列</span></span><br><span class="line">    <span class="keyword">wire</span> s4_0, c4_0, s4_1, c4_1, s4_2, c4_2;</span><br><span class="line">    full_adder fa4_0 (<span class="variable">.a</span>(ab3[<span class="number">1</span>]),<span class="variable">.b</span>(ab2[<span class="number">2</span>]),<span class="variable">.cin</span>(c3_0),<span class="variable">.sum</span>(s4_0),<span class="variable">.cout</span>(c4_0));</span><br><span class="line">    full_adder fa4_1 (<span class="variable">.a</span>(s4_0),  <span class="variable">.b</span>(ab1[<span class="number">3</span>]),<span class="variable">.cin</span>(c3_1),<span class="variable">.sum</span>(s4_1),<span class="variable">.cout</span>(c4_1));</span><br><span class="line">    full_adder fa4_2 (<span class="variable">.a</span>(s4_1),  <span class="variable">.b</span>(<span class="number">1&#x27;b0</span>),  <span class="variable">.cin</span>(c3_2),<span class="variable">.sum</span>(s4_2),<span class="variable">.cout</span>(c4_2));</span><br><span class="line">    <span class="keyword">assign</span> p[<span class="number">4</span>] = s4_2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第六列</span></span><br><span class="line">    <span class="keyword">wire</span> s5_0, c5_0, s5_1, c5_1;</span><br><span class="line">    full_adder fa5_0 (<span class="variable">.a</span>(ab3[<span class="number">2</span>]),<span class="variable">.b</span>(ab2[<span class="number">3</span>]),<span class="variable">.cin</span>(c4_0),<span class="variable">.sum</span>(s5_0),<span class="variable">.cout</span>(c5_0));</span><br><span class="line">    full_adder fa5_1 (<span class="variable">.a</span>(s5_0),  <span class="variable">.b</span>(c4_2),  <span class="variable">.cin</span>(c4_1),<span class="variable">.sum</span>(s5_1),<span class="variable">.cout</span>(c5_1));</span><br><span class="line">    <span class="keyword">assign</span> p[<span class="number">5</span>] = s5_1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第七列</span></span><br><span class="line">    <span class="keyword">wire</span> s6_0, c6_0;</span><br><span class="line">    full_adder fa6_0 (<span class="variable">.a</span>(ab3[<span class="number">3</span>]),<span class="variable">.b</span>(c5_1),  <span class="variable">.cin</span>(c5_0),<span class="variable">.sum</span>(s6_0),<span class="variable">.cout</span>(c6_0));</span><br><span class="line">    <span class="keyword">assign</span> p[<span class="number">6</span>] = s6_0;</span><br><span class="line">    <span class="keyword">assign</span> p[<span class="number">7</span>] = c6_0;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>阵列乘法器的优点是其时间延时可预测，且易于流水线化。完成乘法所需最长时间，由最右边的对角线以及最后一行来估算。两个N位数相乘的时间可以表示为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>t</mi><mrow><mi>A</mi><mi>M</mi></mrow></msub><mo>=</mo><msub><mi>t</mi><mrow><mi>A</mi><mi>N</mi><mi>D</mi></mrow></msub><mo>+</mo><mn>2</mn><mo stretchy="false">(</mo><mi>N</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><msub><mi>t</mi><mrow><mi>f</mi><mi>a</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t_{AM} = t_{AND} + 2(N-1)t_{fa}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mrow><mi>A</mi><mi>N</mi><mi>D</mi></mrow></msub></mrow><annotation encoding="application/x-tex">t_{AND}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>指所有的乘积项<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><msub><mi>b</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">a_ib_j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>可以由一个与门阵列同时产生。</p><h3 id="Booth编码">Booth编码</h3><p>参考文献：</p><p><a href="https://zhuanlan.zhihu.com/p/6517108565">Booth2乘法器设计 - 知乎</a></p><h4 id="工作原理">工作原理</h4><p>那有人说了：这部分积也不少啊，总共需要N个部分积。4bit还好，那我要是64bit你不炸了吗？</p><p>Booth夫妇也是一对天才，发明了Booth算法，用它将无符号的乘法推广到补码的乘法运算，并减少部分积的数量。Booth算法的基本思路是：<strong>对于具有连续0和1的组，需要产生的部分积较少</strong>。对于乘数中每个0，仅需要将前面的累加的部分积向右移动一位即可。</p><p>先看下面的式子，其中认为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">y_{-1}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>.</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>y</mi><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><mstyle mathcolor="red"><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub><mo>+</mo><mstyle mathcolor="red"><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub></mstyle><mo>+</mo><mo>⋯</mo><mo>+</mo><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><mstyle mathcolor="red"><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub></mstyle><mo>+</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><mstyle mathcolor="red"><msub><mi>y</mi><mn>0</mn></msub><mo>−</mo><msub><mi>y</mi><mn>0</mn></msub></mstyle><mo>+</mo><msub><mi>y</mi><mrow><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mn>2</mn><mo>×</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mn>2</mn><mo>×</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><mn>2</mn><mo>×</mo><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><mn>2</mn><mo>×</mo><msub><mi>y</mi><mn>0</mn></msub><mo>−</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><msub><mi>y</mi><mrow><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mo lspace="0em" rspace="0em">=</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mstyle mathcolor="blue"><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mstyle mathcolor="blue"><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub></mstyle><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub><mo>+</mo><mo>⋯</mo><mo>+</mo><msup><mn>2</mn><mn>2</mn></msup><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><mn>2</mn><msub><mi>y</mi><mn>0</mn></msub><mo>−</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><msub><mi>y</mi><mrow><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mstyle mathcolor="green"><mstyle mathsize="0.9em"><mo stretchy="false">(</mo><mo>∗</mo><mstyle mathsize="0.9em"><mo stretchy="false">)</mo></mstyle></mstyle></mstyle><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mstyle mathcolor="blue"><mo>+</mo></mstyle><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="false">(</mo><mo>−</mo><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><mo stretchy="false">(</mo><mo>−</mo><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><mo>⋯</mo><mn>2</mn><mo stretchy="false">(</mo><mo>−</mo><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><msub><mi>y</mi><mn>0</mn></msub><mo stretchy="false">)</mo><mo>+</mo><mo stretchy="false">(</mo><mo>−</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><msub><mi>y</mi><mrow><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} y=&amp; -2^{n-1}y_{n-1}\\ &amp;+2^{n-2}y_{n-2}+\textcolor{red}{2^{n-2}y_{n-2}-2^{n-2}y_{n-2}}\\ &amp;+2^{n-3}y_{n-3}+\textcolor{red}{2^{n-3}y_{n-3} -2^{n-3}y_{n-3}}+\cdots+2y_{1}+\textcolor{red}{2y_{1}-2y_{1}}+y_{0}+\textcolor{red}{y_{0}-y_{0}}+y_{-1} \\\\  =&amp; -2^{n-1}y_{n-1}\\&amp;+2\times2^{n-2}y_{n-2}-2^{n-2}y_{n-2}\\&amp;+2\times2^{n-3}y_{n-3}-2^{n-3}y_{n-3}+\cdots+2\times2y_{1}-2y_{1}+2\times y_{0}-y_{0}+y_{-1} \\\\  =&amp;\textcolor{blue}{-2^{n-1}y_{n-1}+2^{n-1}y_{n-2}}\\&amp;\textcolor{blue}{-2^{n-2}y_{n-2}+2^{n-2}y_{n-3}}-2^{n-3}y_{n-3}+\cdots+2^{2}y_{1}-2y_{1}+2y_{0}-y_{0}+y_{-1} \\\\ \textcolor{green}{\small(*\small) }=&amp; \textcolor{blue}{+}2^{n-1}(-y_{n-1}+y_{n-2})+2^{n-2}(-y_{n-2}+y_{n-3})+\cdots2(-y_{1}+y_{0})+(-y_{0}+y_{-1}) \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:18.217em;vertical-align:-8.8585em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:9.3585em;"><span style="top:-11.4944em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span><span style="top:-9.9703em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-8.4462em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-6.9462em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-5.4221em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:-3.8979em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.3738em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.8738em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:0.6503em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span></span></span><span style="top:2.1744em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:3.6744em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:5.1985em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen sizing reset-size6 size5" style="color:green;">(</span><span class="mord sizing reset-size6 size5" style="color:green;">∗</span><span class="mclose sizing reset-size6 size5" style="color:green;">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:8.8585em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:9.3585em;"><span style="top:-11.4944em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-9.9703em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">2</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">2</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-8.4462em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">3</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">3</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;">2</span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;">2</span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-5.4221em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.8979em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.3738em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:0.6503em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:blue;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:blue;"><span class="mord" style="color:blue;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:blue;"><span class="mord mtight" style="color:blue;"><span class="mord mathnormal mtight" style="color:blue;">n</span><span class="mbin mtight" style="color:blue;">−</span><span class="mord mtight" style="color:blue;">1</span></span></span></span></span></span></span></span></span><span class="mord" style="color:blue;"><span class="mord mathnormal" style="margin-right:0.03588em;color:blue;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:blue;"><span class="mord mtight" style="color:blue;"><span class="mord mathnormal mtight" style="color:blue;">n</span><span class="mbin mtight" style="color:blue;">−</span><span class="mord mtight" style="color:blue;">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:blue;">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:blue;"><span class="mord" style="color:blue;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:blue;"><span class="mord mtight" style="color:blue;"><span class="mord mathnormal mtight" style="color:blue;">n</span><span class="mbin mtight" style="color:blue;">−</span><span class="mord mtight" style="color:blue;">1</span></span></span></span></span></span></span></span></span><span class="mord" style="color:blue;"><span class="mord mathnormal" style="margin-right:0.03588em;color:blue;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:blue;"><span class="mord mtight" style="color:blue;"><span class="mord mathnormal mtight" style="color:blue;">n</span><span class="mbin mtight" style="color:blue;">−</span><span class="mord mtight" style="color:blue;">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:2.1744em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:blue;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:blue;"><span class="mord" style="color:blue;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:blue;"><span class="mord mtight" style="color:blue;"><span class="mord mathnormal mtight" style="color:blue;">n</span><span class="mbin mtight" style="color:blue;">−</span><span class="mord mtight" style="color:blue;">2</span></span></span></span></span></span></span></span></span><span class="mord" style="color:blue;"><span class="mord mathnormal" style="margin-right:0.03588em;color:blue;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:blue;"><span class="mord mtight" style="color:blue;"><span class="mord mathnormal mtight" style="color:blue;">n</span><span class="mbin mtight" style="color:blue;">−</span><span class="mord mtight" style="color:blue;">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:blue;">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:blue;"><span class="mord" style="color:blue;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:blue;"><span class="mord mtight" style="color:blue;"><span class="mord mathnormal mtight" style="color:blue;">n</span><span class="mbin mtight" style="color:blue;">−</span><span class="mord mtight" style="color:blue;">2</span></span></span></span></span></span></span></span></span><span class="mord" style="color:blue;"><span class="mord mathnormal" style="margin-right:0.03588em;color:blue;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:blue;"><span class="mord mtight" style="color:blue;"><span class="mord mathnormal mtight" style="color:blue;">n</span><span class="mbin mtight" style="color:blue;">−</span><span class="mord mtight" style="color:blue;">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:5.1985em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:blue;">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:8.8585em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>其中 (*) 式便为 1 位一组的 Booth1 算法，其编码后的表示范围为乘数的-1至1倍，采用相加和相减的操作计算补码数据的乘积。编码之后，乘数y中的位被划分为不同的组，每一组包括2位，这些组互相交叠。</p><p>比如，对于一个8bit的数<code>8'b0111_1110</code>，我们对其用 (*) 进行变换，可得到：<code>8'b1000_00(-1)0</code>，其中低四位含有一个负值1。变换后，我们可以显著减少1的数量，并使得0尽可能挨在一起。计算该乘法只需两次部分积相加，可大大加快计算速度。Booth编码的作用正在于此：<strong>它保证了在每两个连续位中最多只有一个是1或-1</strong>。</p><h4 id="改进的Booth编码">改进的Booth编码</h4><p>这还是太烦了。</p><p>能不能再简化一下？</p><p>那再来一点简单的数学化简：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>y</mi><mo>=</mo><mstyle mathcolor="red"><mo>−</mo><mn>2</mn><mo>×</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup></mstyle><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mstyle mathcolor="red"><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub></mstyle><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>4</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>4</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>5</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>5</mn></mrow></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mstyle mathcolor="red"><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>5</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>5</mn></mrow></msub><mo>−</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>5</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>5</mn></mrow></msub></mstyle><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>6</mn></mrow></msup><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>6</mn></mrow></msub><mo>+</mo><mo>⋯</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>+</mo><msup><mn>2</mn><mn>3</mn></msup><msub><mi>y</mi><mn>3</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mstyle mathcolor="red"><msup><mn>2</mn><mn>3</mn></msup><msub><mi>y</mi><mn>3</mn></msub><mo>−</mo><msup><mn>2</mn><mn>3</mn></msup><msub><mi>y</mi><mn>3</mn></msub></mstyle><mo>+</mo><msup><mn>2</mn><mn>2</mn></msup><msub><mi>y</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>+</mo><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mstyle mathcolor="red"><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub><mo>−</mo><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub></mstyle><mo>+</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><msub><mi>y</mi><mrow><mo>−</mo><mn>1</mn></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}y= \textcolor{red}{-2\times 2^{n-2}}y_{n-1}&amp;+2^{n-2}y_{n-2}\\+2^{n-3}y_{n-3}&amp;+\textcolor{red}{2^{n-3}y_{n-3} -2^{n-3}y_{n-3}}+2^{n-4}y_{n-4}\\+2^{n-5}y_{n-5}&amp;+\textcolor{red}{2^{n-5}y_{n-5} -2^{n-5}y_{n-5}}+2^{n-6}y_{n-6}+\cdots\\+2^{3}y_{3}&amp;+\textcolor{red}{2^{3}y_{3} -2^{3}y_{3}}+2^{2}y_{2}\\+2y_1&amp;+\textcolor{red}{2y_{1}-2y_{1}}+y_0+y_{-1} \\\\\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:9.0964em;vertical-align:-4.2982em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.7982em;"><span style="top:-6.9341em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord" style="color:red;">−</span><span class="mord" style="color:red;">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">2</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">+</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.8859em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">+</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">5</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.3618em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">+</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.8618em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">+</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:0.6382em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.2982em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.7982em;"><span style="top:-6.9341em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">3</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">3</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.8859em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">5</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">5</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="color:red;">n</span><span class="mbin mtight" style="color:red;">−</span><span class="mord mtight" style="color:red;">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">6</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span></span></span><span style="top:-2.3618em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">3</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">3</span></span></span></span></span></span></span></span></span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.8618em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;">2</span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord" style="color:red;">2</span><span class="mord" style="color:red;"><span class="mord mathnormal" style="margin-right:0.03588em;color:red;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mtight" style="color:red;">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.7982em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>化简可得：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>y</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msup><mo stretchy="false">(</mo><mo>−</mo><mn>2</mn><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>2</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>−</mo><mn>4</mn></mrow></msup><mo stretchy="false">(</mo><mo>−</mo><mn>2</mn><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>3</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>4</mn></mrow></msub><mo>+</mo><msub><mi>y</mi><mrow><mi>n</mi><mo>−</mo><mn>5</mn></mrow></msub><mo stretchy="false">)</mo><mo>+</mo><mo>⋯</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><msup><mn>2</mn><mn>2</mn></msup><mo stretchy="false">(</mo><mo>−</mo><mn>2</mn><msub><mi>y</mi><mn>3</mn></msub><mo>+</mo><msub><mi>y</mi><mn>2</mn></msub><mo>+</mo><msub><mi>y</mi><mn>1</mn></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mo stretchy="false">(</mo><mo>−</mo><mn>2</mn><msub><mi>y</mi><mn>1</mn></msub><mo>+</mo><msub><mi>y</mi><mn>0</mn></msub><mo>+</mo><msub><mi>y</mi><mrow><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}y &amp;=   2^{n-2}(-2y_{n-1}+y_{n-2}+y_{n-3})\\&amp;+2^{n-4}(-2y_{n-3}+y_{n-4}+y_{n-5})+\cdots\\&amp;+2^{2}(-2y_{3}+y_{2}+y_{1})\\&amp;+(-2y_{1}+y_{0}+y_{-1})\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.0723em;vertical-align:-2.7862em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.2862em;"><span style="top:-5.4221em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.8979em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.3738em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.8738em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.7862em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.2862em;"><span style="top:-5.4221em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.8979em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">4</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">⋯</span></span></span><span style="top:-2.3738em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-0.8738em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.7862em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>可知道这是 2 位一组的 Booth2 算法，其表示范围为乘数的-2至2倍。</p><p>对于有符号数补码而言，扩展其最高位对数值并无影响，因此<strong>任何奇数位宽的有符号数补码都可以看成是偶数位宽</strong>。Booth2 算法每次交叠编码的位数为 3 位，使得<strong>部分积的数目减为传统算法的一半</strong>。对于操作数位宽为奇数时，可以在其高位扩展符号位从而使位宽变成偶数。</p><p>然而，如果部分积为负数，通过符号扩展来补齐位数时将其符号位补齐为1，就会使得累加计算时出现大量进位和翻转，乘法器的功耗也会随之增加<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>。</p><h4 id="Verilog实现">Verilog实现</h4><p>Booth编码器模块：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两位Booth编码器模块</span></span><br><span class="line"><span class="comment">// 输入：3位数据（包含前一位）</span></span><br><span class="line"><span class="comment">// 输出：编码控制信号</span></span><br><span class="line"><span class="keyword">module</span> booth_encoder (</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] booth_bits,  <span class="comment">// 三位输入：&#123;Yi+1, Yi, Yi-1&#125;</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] encode  <span class="comment">// 编码输出：&#123;single, double, negative&#125;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (booth_bits)               <span class="comment">// 编码表：</span></span><br><span class="line">            <span class="number">3&#x27;b000</span>: encode = <span class="number">3&#x27;b000</span>;    <span class="comment">// 000 -&gt; 000        (加0)</span></span><br><span class="line">            <span class="number">3&#x27;b001</span>: encode = <span class="number">3&#x27;b100</span>;    <span class="comment">// 001 -&gt; 100        (加1倍被乘数)</span></span><br><span class="line">            <span class="number">3&#x27;b010</span>: encode = <span class="number">3&#x27;b100</span>;    <span class="comment">// 010 -&gt; 100        (加1倍被乘数)</span></span><br><span class="line">            <span class="number">3&#x27;b011</span>: encode = <span class="number">3&#x27;b010</span>;    <span class="comment">// 011 -&gt; 010        (加2倍被乘数)</span></span><br><span class="line">            <span class="number">3&#x27;b100</span>: encode = <span class="number">3&#x27;b011</span>;    <span class="comment">// 100 -&gt; 011        (减2倍被乘数)</span></span><br><span class="line">            <span class="number">3&#x27;b101</span>: encode = <span class="number">3&#x27;b101</span>;    <span class="comment">// 101 -&gt; 101        (减1倍被乘数)</span></span><br><span class="line">            <span class="number">3&#x27;b110</span>: encode = <span class="number">3&#x27;b101</span>;    <span class="comment">// 110 -&gt; 101        (减1倍被乘数)</span></span><br><span class="line">            <span class="number">3&#x27;b111</span>: encode = <span class="number">3&#x27;b001</span>;    <span class="comment">// 111 -&gt; 001 -&gt; 000 (减0即加0)</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>部分积生成器模块：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 部分积生成器模块</span></span><br><span class="line"><span class="comment">// 根据Booth编码信号生成相应的部分积</span></span><br><span class="line"><span class="keyword">module</span> partial_product_generator (</span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">3</span>:<span class="number">0</span>] multiplicand,    <span class="comment">// 被乘数</span></span><br><span class="line">    <span class="keyword">input</span>  [<span class="number">2</span>:<span class="number">0</span>] encode,          <span class="comment">// Booth编码：&#123;single, double, negative&#125;</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] partial_product  <span class="comment">// 部分积输出</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] multiplicand_ext;  <span class="comment">// 符号扩展的被乘数</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] temp_product;</span><br><span class="line">    <span class="keyword">wire</span> single, double, negative;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> &#123;single, double, negative&#125; = encode;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 符号扩展被乘数到8位</span></span><br><span class="line">    <span class="keyword">assign</span> multiplicand_ext = &#123;&#123;<span class="number">4</span>&#123;multiplicand[<span class="number">3</span>]&#125;&#125;, multiplicand&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据编码生成部分积</span></span><br><span class="line">    <span class="keyword">assign</span> temp_product = (single &amp;&amp; !double) ? multiplicand_ext :  <span class="comment">// +1X</span></span><br><span class="line">        (!single &amp;&amp; double) ? (multiplicand_ext &lt;&lt; <span class="number">1</span>) :             <span class="comment">// +2X</span></span><br><span class="line">        (single &amp;&amp; double) ? (multiplicand_ext &lt;&lt; <span class="number">1</span>) :              <span class="comment">// +2X (这种情况不应该出现)</span></span><br><span class="line">        <span class="number">8&#x27;b0</span>;  <span class="comment">// +0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果neg为1，则取反加1（二进制补码）</span></span><br><span class="line">    <span class="keyword">assign</span> partial_product = negative ? (~temp_product + <span class="number">1&#x27;b1</span>) : temp_product;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Booth乘法器模块：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 四位Booth编码乘法器（使用两位Booth编码）</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;booth_encoder.v&quot;</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;partial_product_generator.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> booth_multiplier_4bit (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] multiplicand,  <span class="comment">// 被乘数</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">signed</span> [<span class="number">3</span>:<span class="number">0</span>] multiplier,    <span class="comment">// 乘数</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">signed</span> [<span class="number">7</span>:<span class="number">0</span>] product        <span class="comment">// 乘积结果</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 扩展乘数以便进行两位Booth编码</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] multiplier_ext;</span><br><span class="line">    <span class="keyword">assign</span> multiplier_ext = &#123;multiplier, <span class="number">1&#x27;b0</span>&#125;;  <span class="comment">// 在末尾添加0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Booth编码器的输入和输出</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>] booth_bits_0, booth_bits_1, booth_bits_2;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">2</span>:<span class="number">0</span>] encode_0, encode_1, encode_2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成Booth编码位组</span></span><br><span class="line">    <span class="keyword">assign</span> booth_bits_0 = &#123;multiplier_ext[<span class="number">2</span>], multiplier_ext[<span class="number">1</span>], multiplier_ext[<span class="number">0</span>]&#125;;</span><br><span class="line">    <span class="keyword">assign</span> booth_bits_1 = &#123;multiplier_ext[<span class="number">4</span>], multiplier_ext[<span class="number">3</span>], multiplier_ext[<span class="number">2</span>]&#125;;</span><br><span class="line">    <span class="keyword">assign</span> booth_bits_2 = &#123;<span class="number">1&#x27;b0</span>,              <span class="number">1&#x27;b0</span>,              multiplier_ext[<span class="number">4</span>]&#125;;  </span><br><span class="line">    <span class="comment">// 最高位组，前面补0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Booth编码器实例化</span></span><br><span class="line">    booth_encoder encoder_0 (<span class="variable">.booth_bits</span>(booth_bits_0),<span class="variable">.encode</span>(encode_0));</span><br><span class="line">    booth_encoder encoder_1 (<span class="variable">.booth_bits</span>(booth_bits_1),<span class="variable">.encode</span>(encode_1));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 部分积生成器的输出</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] partial_product_0, partial_product_1;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 部分积生成器实例化</span></span><br><span class="line">    partial_product_generator ppg_0 (</span><br><span class="line">        <span class="variable">.multiplicand</span>(multiplicand),</span><br><span class="line">        <span class="variable">.encode</span>(encode_0),</span><br><span class="line">        <span class="variable">.partial_product</span>(partial_product_0)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    partial_product_generator ppg_1 (</span><br><span class="line">        <span class="variable">.multiplicand</span>(multiplicand),</span><br><span class="line">        <span class="variable">.encode</span>(encode_1),</span><br><span class="line">        <span class="variable">.partial_product</span>(partial_product_1)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 部分积移位和累加</span></span><br><span class="line">    <span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">7</span>:<span class="number">0</span>] shifted_pp_0, shifted_pp_1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> shifted_pp_0 = partial_product_0;  <span class="comment">// 不移位</span></span><br><span class="line">    <span class="keyword">assign</span> shifted_pp_1 = partial_product_1 &lt;&lt; <span class="number">2</span>;  <span class="comment">// 左移2位</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最终结果累加</span></span><br><span class="line">    <span class="keyword">assign</span> product = shifted_pp_0 + shifted_pp_1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://d.wanfangdata.com.cn/periodical/ChVQZXJpb2RpY2FsQ0hJMjAyNTA2MjISD2R6Y2xqczIwMjQyMDAxNRoIZXNmbTZqc2M">熊书伟,宋树祥. 基于符号扩展的booth乘法器设计与实现[J]. 电子测量技术,2024,47(20):124-131. DOI:10.19651/j.cnki.emt.2416555.</a> <a href="#fnref1" class="footnote-backref">↑</a></p></li></ol></section>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;加法器&quot;&gt;加法器&lt;/h2&gt;
&lt;h3 id=&quot;全加器-Full-Adder-FA&quot;&gt;全加器 Full Adder FA&lt;/h3&gt;
&lt;p&gt;很简单，输入1bit的两个数以及前一级的进位，输出</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：序篇</title>
    <link href="https://blog.esing.dev/2025/09/16/vd-intro/"/>
    <id>https://blog.esing.dev/2025/09/16/vd-intro/</id>
    <published>2025-09-16T04:39:40.000Z</published>
    <updated>2025-09-28T03:22:29.649Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>这门课可以当成是 <a href="/2024/04/17/dsd-intro/" title="数字系统设计复习笔记：序篇">数字系统设计</a> 的进阶版，内容难了不少，不过老师还是一样的（笑）</p><h2 id="目录">目录</h2><div class="timeline undefined"><div class='timeline-item headline'><div class='timeline-item-title'><div class='item-circle'><p>目录</p></div></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p><a href="/2025/09/16/vd-p1/" title="超大规模集成电路设计笔记：第一篇">第一篇</a></p></div></div><div class='timeline-item-content'><p>各种各样复杂的加法器与乘法器</p></div></div><div class='timeline-item'><div class='timeline-item-title'><div class='item-circle'><p><a href="/2025/09/17/vd-p2/" title="超大规模集成电路设计笔记：第二篇">第二篇</a></p></div></div><div class='timeline-item-content'><p>浮点数运算、时序乱乱，还有功耗</p></div></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;这门课可以当成是 &lt;a href=&quot;/2024/04/17/dsd-intro/&quot; title=&quot;数字系统设计复习笔记：序篇&quot;&gt;数字系统设计&lt;/a&gt; 的进</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>[转载] 删除某网盘附带的“智能看图”</title>
    <link href="https://blog.esing.dev/2025/09/09/fuckoff-bdimageviewer/"/>
    <id>https://blog.esing.dev/2025/09/09/fuckoff-bdimageviewer/</id>
    <published>2025-09-09T00:29:37.000Z</published>
    <updated>2025-09-10T01:40:00.805Z</updated>
    
    <content type="html"><![CDATA[<div class="note info flat"><p>本文转载自<a href="https://xzonn.top/posts/Remove-Intelligent-Image-Viewer.html">删除某网盘附带的“智能看图” - Xzonn的小站</a>，已取得原作者同意。未经许可禁止转载与商用。</p></div><h2 id="前言">前言</h2><p>某网盘更新到 7.58 版本之后附带了一个“智能看图”软件，关联了一堆常见图片格式。看了一下路径，确定是百度网盘干的。</p><h2 id="处理">处理</h2><p>目前该网盘里没有删除这个功能的设置，所以需要手动编辑一下注册表，先按 Ctrl + R 打开“运行”窗口，输入<code>regedit</code>并回车，打开注册表编辑器，然后删除以下项目： <kbd>Ctrl</kbd>+<kbd>R</kbd>打开“运行”窗口，输入<code>regedit</code>并回车，打开注册表编辑器，然后删除以下项目：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HKEY_CLASSES_ROOT\BaiduNetdiskImageViewerAssociations</span><br><span class="line">HKEY_CURRENT_USER\Software\Baidu\BaiduNetdiskImageViewer</span><br><span class="line">HKEY_CURRENT_USER\Software\RegisteredApplications\BaiduNetdiskImageViewer</span><br></pre></td></tr></table></figure><p>程序目录位于该网盘的安装目录内，默认为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%APPDATA%\baidu\BaiduNetdisk\module\ImageViewer</span><br></pre></td></tr></table></figure><p><strong>不知道一个网盘软件为什么要捆绑一个看图软件，干好自己的事不行吗？另一个网盘甚至直接把客户端捆绑了浏览器，我用 Chrome 或者 Edge 不好吗，用你那破浏览器干啥？</strong></p><p>（2025-07-07 更新）：最近这个网页访问量挺多，看来是有许多人被这个软件烦到了。这里提供一个批量删除的脚本，直接复制到记事本中，另存为<code>remove_image_viewer.bat</code>（注意，请确保保存时的编码是“ANSI”或“GBK”“GB2312”），然后****运行即可：</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">echo</span> ==========================================</span><br><span class="line"><span class="built_in">echo</span> ○○网盘“智能看图”功能卸载脚本</span><br><span class="line"><span class="built_in">echo</span> ==========================================</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> 此脚本将删除○○网盘捆绑的“智能看图”软件</span><br><span class="line"><span class="built_in">echo</span> 请确保以管理员身份运行此脚本</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">pause</span></span><br><span class="line"><span class="built_in">echo</span> 正在删除注册表项...</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line">:: 删除注册表项<span class="number">1</span>：HKEY_CLASSES_ROOT\BaiduNetdiskImageViewerAssociations</span><br><span class="line"><span class="built_in">echo</span> [<span class="number">1</span>/<span class="number">3</span>] 删除 HKEY_CLASSES_ROOT\BaiduNetdiskImageViewerAssociations</span><br><span class="line">reg delete &quot;HKEY_CLASSES_ROOT\BaiduNetdiskImageViewerAssociations&quot; /f &gt;<span class="built_in">nul</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> <span class="variable">%errorlevel%</span> <span class="keyword">equ</span> <span class="number">0</span> (</span><br><span class="line">    <span class="built_in">echo</span>     ? 删除成功</span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line">    <span class="built_in">echo</span>     ? 删除失败或项目不存在</span><br><span class="line">)</span><br><span class="line">:: 删除注册表项<span class="number">2</span>：HKEY_CURRENT_USER\Software\Baidu\BaiduNetdiskImageViewer</span><br><span class="line"><span class="built_in">echo</span> [<span class="number">2</span>/<span class="number">3</span>] 删除 HKEY_CURRENT_USER\Software\Baidu\BaiduNetdiskImageViewer</span><br><span class="line">reg delete &quot;HKEY_CURRENT_USER\Software\Baidu\BaiduNetdiskImageViewer&quot; /f &gt;<span class="built_in">nul</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> <span class="variable">%errorlevel%</span> <span class="keyword">equ</span> <span class="number">0</span> (</span><br><span class="line">    <span class="built_in">echo</span>     ? 删除成功</span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line">    <span class="built_in">echo</span>     ? 删除失败或项目不存在</span><br><span class="line">)</span><br><span class="line">:: 删除注册表项<span class="number">3</span>：HKEY_CURRENT_USER\Software\RegisteredApplications\BaiduNetdiskImageViewer</span><br><span class="line"><span class="built_in">echo</span> [<span class="number">3</span>/<span class="number">3</span>] 删除 HKEY_CURRENT_USER\Software\RegisteredApplications 中的 BaiduNetdiskImageViewer</span><br><span class="line">reg delete &quot;HKEY_CURRENT_USER\Software\RegisteredApplications&quot; /v &quot;BaiduNetdiskImageViewer&quot; /f &gt;<span class="built_in">nul</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> <span class="variable">%errorlevel%</span> <span class="keyword">equ</span> <span class="number">0</span> (</span><br><span class="line">    <span class="built_in">echo</span>     ? 删除成功</span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line">    <span class="built_in">echo</span>     ? 删除失败或项目不存在</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> 正在删除程序文件...</span><br><span class="line">:: 删除程序目录</span><br><span class="line"><span class="built_in">set</span> &quot;imageviewer_path=<span class="variable">%APPDATA%</span>\baidu\BaiduNetdisk\module\ImageViewer&quot;</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">exist</span> &quot;<span class="variable">%imageviewer_path%</span>&quot; (</span><br><span class="line">    <span class="built_in">echo</span> 找到程序目录: <span class="variable">%imageviewer_path%</span></span><br><span class="line">    <span class="built_in">echo</span> 正在删除程序文件...</span><br><span class="line">    <span class="built_in">rmdir</span> /s /q &quot;<span class="variable">%imageviewer_path%</span>&quot; &gt;<span class="built_in">nul</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="variable">%errorlevel%</span> <span class="keyword">equ</span> <span class="number">0</span> (</span><br><span class="line">        <span class="built_in">echo</span>     ? 程序文件删除成功</span><br><span class="line">    ) <span class="keyword">else</span> (</span><br><span class="line">        <span class="built_in">echo</span>     ? 程序文件删除失败，可能文件正在使用中</span><br><span class="line">        <span class="built_in">echo</span>     请手动删除: <span class="variable">%imageviewer_path%</span></span><br><span class="line">    )</span><br><span class="line">) <span class="keyword">else</span> (</span><br><span class="line">    <span class="built_in">echo</span>     程序目录不存在或已被删除</span><br><span class="line">)</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> ==========================================</span><br><span class="line"><span class="built_in">echo</span> 卸载完成！</span><br><span class="line"><span class="built_in">echo</span> ==========================================</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> 建议重启计算机以确保所有更改生效</span><br><span class="line"><span class="built_in">echo</span> 如果问题仍然存在，</span><br><span class="line"><span class="built_in">echo</span> 请检查以下路径是否还有残留文件：</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">%APPDATA%</span>\baidu\BaiduNetdisk\module\ImageViewer</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> 按任意键退出...</span><br><span class="line"><span class="built_in">pause</span> &gt;<span class="built_in">nul</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info flat&quot;&gt;&lt;p&gt;本文转载自&lt;a href=&quot;https://xzonn.top/posts/Remove-Intelligent-Image-Viewer</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="百度网盘" scheme="https://blog.esing.dev/tags/%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98/"/>
    
  </entry>
  
  <entry>
    <title>做了一张亚克力鼠标垫！</title>
    <link href="https://blog.esing.dev/2025/09/03/arcylic-mousepad/"/>
    <id>https://blog.esing.dev/2025/09/03/arcylic-mousepad/</id>
    <published>2025-09-03T08:06:33.000Z</published>
    <updated>2025-09-03T10:07:16.181Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>嘉立创最近开始面板免费打样了，有幸抢到了券。听说现在打印机器升级了，全部换成BC机器打印，颜色更鲜艳。打了两大张，一张厚亚克力一张磨砂PVC，准备做个有机玻璃鼠标垫。</p><h2 id="动手！">动手！</h2><p><img src="https://webp.esing.dev/img/IMG_20250829_001719_250903_1806_DdNA.jpg" alt="超巨大的亚克力板"></p><p><img src="https://webp.esing.dev/img/IMG_20250902_224012_250903_1806_2v8O.jpg" alt="背胶一贴，结束"></p>]]></content>
    
    
    <summary type="html">低成本自制（有机）玻璃鼠标垫</summary>
    
    
    
    <category term="随笔" scheme="https://blog.esing.dev/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="Galgame" scheme="https://blog.esing.dev/tags/Galgame/"/>
    
    <category term="DIY" scheme="https://blog.esing.dev/tags/DIY/"/>
    
    <category term="合影卡" scheme="https://blog.esing.dev/tags/%E5%90%88%E5%BD%B1%E5%8D%A1/"/>
    
  </entry>
  
  <entry>
    <title>上海之旅</title>
    <link href="https://blog.esing.dev/2025/08/12/travel-in-shanghai/"/>
    <id>https://blog.esing.dev/2025/08/12/travel-in-shanghai/</id>
    <published>2025-08-12T05:59:05.000Z</published>
    <updated>2025-09-28T03:22:58.797Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>老师安排了活，让我提前去上海和公司学习下。刚好后面还有竞赛，一并搞了。</p><p>那周末干啥呢？自然要去魔都转一转了。</p><h2 id="Day-1">Day 1</h2><p>买的上午十点的票，南京站到上海站两个小时不到。上海虹桥离市中心更远，于是买了到上海站的票。下车后准备坐地铁，结果站内直通一号线的口因为人太多被关闭了！？没办法，那就不坐一号线。</p><h3 id="上海火车站地铁站">上海火车站地铁站</h3><p><a href="https://surl.amap.com/23NcIY1TfTb">上海火车站地铁站</a>因为三线换乘的结构比较独特，因此是“出站换乘”——从四号线到二号线的地铁站，需要先刷入站再出站，在这30分钟内的出入站不会计费。话说地铁四号线和三号线居然是共用一部分内圈，两条线路使用一个站台。要是颜色看错了可就真完蛋了。</p><p>话说上海这地铁确实现代啊，甚至能刷五种支付系统的卡。可惜没带外币卡，不然体验下了。Visa和Mastercard都有专属刷卡动画来着。</p><img src="https://webp.esing.dev/img/IMG_20250802_120505_250808_1944_d2SI.jpg" alt="带NFC芯片的卡都能刷" style="zoom:25%;" /><p>地铁到汉中路后再换乘13号线，一直坐到底站张江路，就离住的临时宿舍很近了。我也不想拖着箱子走太久，于是决定坐个公交。真没想到，上海这公交站的候车凳如此独特，且不说防流浪汉，但凡来个屁股大的都坐不下。</p><img src="https://webp.esing.dev/img/IMG_20250802_134041_250808_1929_YauL.jpg" alt="并非人性化的候车凳" style="zoom: 25%;" /><p>上海NFC公交卡开卡不用花钱，但是做地铁也没啥优惠，唯一能用上的也就换乘优惠了——便宜一块钱。不如南京，但是它卡面多啊。</p><img src="https://webp.esing.dev/img/mmexport1754112015189_250808_1931_OQGx.jpg" alt="手机里有一张只支持iOS系统换卡面的NFC公交卡" style="zoom: 50%;" /><h3 id="小屋">小屋</h3><p>等了半小时车，下来找路又走了半小时。住的地方在六楼，爬上去还蛮累的。</p><img src="https://webp.esing.dev/img/IMG_20250802_141059_250808_1932_dfkt.jpg" alt="我的房子还蛮大的（大声）" style="zoom:25%;" /><p>三无宿舍——无床垫无被子无针头，全得自己买。找了个闪购全送来了，先凑合着睡吧。居然连网都没有吗，只能买个随身WiFi了。</p><p>中午没吃饭，但是又热又累就忘了。实在困了，躺着睡了会。睡醒后就去楼下的河南烩面吃了点。吃饱喝足，去日本动漫周边批发市场了。</p><h3 id="魔都秋叶原——南京东路">魔都秋叶原——南京东路</h3>    <div id="aplayer-DZvrSFwT" class="aplayer aplayer-tag-marker meting-tag-marker"         data-id="1909065892" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#ff80ac" data-volume="0.3" data-loop="none"    ></div><p>南京东路可以说是上海谷店聚集最多的地方了，各大品牌在这里也有自己的实体店。地铁站出来就是<a href="https://surl.amap.com/1lJWebrxgHx">百联ZX</a>的负一层，一堆舞萌吃排长队等着打呢。<s>awmc</s></p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250802_172441_250808_1939_ksE9.jpg","alt":"百联ZX负一楼的MC专卖店，可惜没有方形的鸡"},{"url":"https://pic.esing.dev/img/IMG_20250802_173128_250808_1939_6Tfn.jpg","alt":"ANIPLEX店，近几年他家的动漫看了不少，鬼灭、孤独摇滚、尼尔等等"},{"url":"https://pic.esing.dev/img/IMG_20250802_193454_250808_1941_tNma.jpg","alt":"卡普空官方专卖店。话说这个译名什么鬼？"},{"url":"https://pic.esing.dev/img/IMG_20250802_193718_250808_1942_5WXq.jpg","alt":"不是我喜欢的证言，直接異議あり"},{"url":"https://pic.esing.dev/img/IMG_20250802_193847_250808_1946_9RMP.jpg","alt":"电脑里有一款残血老头冒黑烟的游戏"},{"url":"https://pic.esing.dev/img/IMG_20250802_175923_250808_1947_Hwjw.jpg","alt":"还有蔚藍檔案看的。Mika酱在店里接待呢，还有端着盘子的白子^^"},{"url":"https://pic.esing.dev/img/IMG_20250802_173917_250808_1948_kNUc.jpg","alt":"炸梦乐队来了嗷。8月23还有PPP的巡回演出，可惜和竞赛冲突了，一得阁拉米的。"},{"url":"https://pic.esing.dev/img/IMG_20250802_194915_250808_1950_YM6k.jpg","alt":"唉柚子厨真恶心啊哈哈"},{"url":"https://pic.esing.dev/img/IMG_20250802_194843_250808_1950_9DN9.jpg","alt":"露娜Sama~"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>逛完了百联ZX之后，看了小红书攻略去了<a href="https://surl.amap.com/1R8yNnn1o82T">百米香榭商业街</a>。如果说百联ZX里是那种上档次的餐馆，那这边就类似那种苍蝇小馆——货杂，但也多，仔细找找，也能收获不一样的惊喜。但找了半天也没看到Galgame的谷。最多的就是素晴日了。店家说有雪碧社的，但找了半天没看到，作罢。</p><p>之后再去<a href="https://surl.amap.com/lLcurpLJ8od">新世界城</a>转转。东西也大同小异，该看的都看了。</p><h3 id="夜宵：鲜得来排骨年糕">夜宵：鲜得来排骨年糕</h3><p>鲜得来算是上海老字号了，宣称是创立于1921年的中华老字号餐饮品牌。</p><img src="https://webp.esing.dev/img/IMG_20250802_201420_250808_2009_r6iM.jpg" alt="一份套餐才33，没我想象中的贵" style="zoom:25%;" /><p>年糕是煮好的再淋上酱汁，最后放上炸排骨。酱汁是那种酸甜口，桌上另外放了辣酱油，可以配着吃。说是“辣酱油”，称作“辣根酱油”更贴切——这玩意是舶来品，起源于英国，也称作喼（jie4）汁。尝起来，有一点淡淡的芥末辣味，但并不冲，口感独特。</p><p>汤没啥亮点，咸倒是满咸，也不鲜，感觉不如家里那云面大壳好吃。年糕还不错，软糯又不失嚼劲，排骨炸的外酥里嫩，很入味。</p><h3 id="外滩">外滩</h3><p>吃完饭后就顺路去<a href="https://surl.amap.com/aRmwFNX1w6zR">外滩</a>了。上海这边的小巷子，有很多都是禁止自行车的，骑车反倒不方便。但汽车更不容易，因为有许多单行线。还好之前在逛新世界时提前买了一杯蜜雪冰城，这下派上用场了。<strong>还好我是江苏人，直接触发十三太保被动，目标过多无法被锁定。</strong></p><img src="https://webp.esing.dev/img/IMG_20250802_204118_250808_2014_z1oO.jpg" alt="今天的防御塔甚是安静啊" style="zoom:25%;" /><p>走了一天刷了1w5步数，重生之我是二次元特种兵。收工！</p><h2 id="Day-2">Day 2</h2><p>早上骑车去地铁站，路上有家包子铺，吃了几个包子。谁懂早上一杯冰豆浆的爽感啊家人们。</p><h3 id="米哈游园区">米哈游园区</h3><p>一日为原批终身为原批，更何况我还玩过崩三，于是预约了早上去米哈游园区参观。说是园区，其实也不大，就三栋楼。总感觉在哪里见过，是崩三里吗？</p><p>目前开放参观的是米哈游英业达园区的<a href="https://surl.amap.com/1RA58OV1fcfk">南楼</a>，<a href="https://surl.amap.com/1tCJwiZ1d7Er">旧总部</a>不开放参观了，不过工作人员说后续还会开放预约。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250803_095228_250903_1731_4q6y.jpg","alt":"办公楼，不给进"},{"url":"https://pic.esing.dev/img/IMG_20250803_095702_250903_1731_jmat.jpg","alt":"参观专属通行证，不过离场时还要收回"},{"url":"https://pic.esing.dev/img/IMG_20250803_095802_250903_1732_yMrr.jpg","alt":"一进门就是各类手办，乍一看都是熟悉的面孔"},{"url":"https://pic.esing.dev/img/IMG_20250803_095916_250903_1733_mygU.jpg","alt":"太伟大了原神。启动。"},{"url":"https://pic.esing.dev/img/IMG_20250803_101105_250903_1733_8HNO.jpg","alt":"之前在三星堆博物馆也看到过"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>毕竟就一层，逛完就半个小时，时间很快。工作人员有提供免费的瓶装水。</p><h3 id="游戏博物馆">游戏博物馆</h3><p>逛完后大约是10点。<a href="https://surl.amap.com/6otS4lqE1j42M">游戏博物馆</a>就在边上，来都来了就看看吧。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250803_104357_250903_1753_efbK.jpg","alt":"多加20可以拿个实体票根，选了星露谷的"},{"url":"https://pic.esing.dev/img/IMG_20250803_105702_250903_1754_7ezJ.jpg","alt":"我是Xbox非对称布局拥护者"},{"url":"https://pic.esing.dev/img/IMG_20250803_110207_250903_1754_yx8o.jpg","alt":"尼尔机械纪元的吉他谱，边上还有怪猎的游戏原声试听。山灵碟机加森海塞尔不赖。"},{"url":"https://pic.esing.dev/img/IMG_20250803_111724_250903_1759_BEfX.jpg","alt":"新游试玩，有33号远征队。自己上手了一下，死了两遍才过，感觉对攻击节奏熟悉了就能打弹反了。每次完美格挡反击时周围的人都会赞赏几句，很搞心态，不过很爽。"},{"url":"E:/Localsend/IMG_20250803_113200.jpg","alt":"经典老游，感受龙骑士07带来的温暖（不是）"},{"url":"https://pic.esing.dev/img/IMG_20250803_113959_250903_1801_vh7S.jpg","alt":"我说这游戏小时候抱过我有没有懂的"},{"url":"https://pic.esing.dev/img/IMG_20250803_113715_250903_1812_Meyv.jpg","alt":"iQOO打钱！哦已经打了那没事了"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h3 id="田林路虹漕路公交站">田林路虹漕路公交站</h3><p><a href="https://surl.amap.com/1W0HDnD172Ec">田林路虹漕路公交站</a>是明日方舟的痛车站点，有条免费专线DZ411。车上还有Coser讲解。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250803_115026_250903_1809_YXpc.jpg","alt":"痛太痛了"},{"url":"https://pic.esing.dev/img/IMG_20250803_123523_250903_1810_tJPY.jpg","alt":"也是坐上痛车了"},{"url":"https://pic.esing.dev/img/IMG_20250803_122224_250903_1810_uawT.jpg","alt":"坐在最前面的Coser小姐姐在很认真的解说。不是边上怎么还有小南娘啊"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>下来后还有明日方舟的武器展，在一个个集装箱里。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250803_124015_250903_1811_5HVZ.jpg","alt":"近看超级帅，就是不知道能不能举起来"},{"url":"https://pic.esing.dev/img/IMG_20250803_124041_250903_1822_fXNV.jpg","alt":"兔兔可爱捏"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h2 id="后记">后记</h2><p>上班了就开始985了——早上九点到单位，晚上八点回去，干五天。不过公司管两顿饭，还行。每天上班回去累得要死，实在没精力玩竞技类游戏了。</p><img src="https://opic.esing.dev/img/屏幕截图 2025-08-05 222943_250903_1839_skKI.png" alt="逢樱说得对" style="zoom: 33%;" />]]></content>
    
    
    <summary type="html">What was your mission in Shanghai ?!</summary>
    
    
    
    <category term="随笔" scheme="https://blog.esing.dev/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="二次元" scheme="https://blog.esing.dev/tags/%E4%BA%8C%E6%AC%A1%E5%85%83/"/>
    
    <category term="游记" scheme="https://blog.esing.dev/tags/%E6%B8%B8%E8%AE%B0/"/>
    
    <category term="美食" scheme="https://blog.esing.dev/tags/%E7%BE%8E%E9%A3%9F/"/>
    
    <category term="上海" scheme="https://blog.esing.dev/tags/%E4%B8%8A%E6%B5%B7/"/>
    
  </entry>
  
  <entry>
    <title>从零开始学RISC：第三篇</title>
    <link href="https://blog.esing.dev/2025/07/30/riscvcod-p3/"/>
    <id>https://blog.esing.dev/2025/07/30/riscvcod-p3/</id>
    <published>2025-07-30T01:00:50.000Z</published>
    <updated>2025-09-28T03:31:34.554Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Valid-Ready-握手">Valid_Ready 握手</h2><p>RISCV的流水线设计需要许多模块共同协作，在外部看来是流水线连续处理指令。对于流水线而言，各阶段也需要模块单独进行处理，处理完毕后交给下一级。各模块之间如何进行交流，从而得知前一级的工作已完成？设计中的<code>valid_ready</code> 协议通过两个信号 <code>valid</code> 和 <code>ready</code> 实现<strong>双向握手</strong>，确保数据在<strong>双方都准备好时</strong>才传输：</p><ul><li><code>valid</code> 表示 <strong>发送端已经准备好</strong> 发送数据，数据是有效的；</li><li><code>ready</code> 表示 <strong>接收端已经准备好</strong> 接收数据。</li></ul><p>只有当 <code>valid == 1</code> 且 <code>ready == 1</code> 时，数据才真正被“传输”。</p><h2 id="握手设计">握手设计</h2><p>对于前后级模块，不分主从，但为了方便，将发送Ready的前一级与接受Valid的后一级规定为Master，发送Valid的前一级与接受Ready的后一级定为Slave。</p><p>对于流水线模块的状态判断，采用四模式的状态机，包含<code>RUN</code>、<code>IDLE</code>、<code>WAIT</code>、<code>SAVE</code>：</p><ul><li><code>RUN</code>：正常运行状态，接收指令并执行。当上游结果可用并且下游流水级可以接收本级结果，则进入此状态；</li><li><code>IDLE</code>：空闲状态，等待新的指令输入。如果上游结果不可用或者是下游流水级忙碌，则进入此状态；</li><li><code>WAIT</code>：等待状态，此时模块忙碌。<ul><li>不同流水级对本状态的实现不同，据此，我们将流水级控制状态机分为 I 型、II 型、III 型。</li><li>I 型被实现为等待内存读写返回结果，状态机对于此状态何时结束未知；</li><li>II 型被实现为等待长指令返回结果，状态机维护一个计时器来判断此状态如何结束；</li><li>III 型被实现为等待数据冒险结束，状态机观察本级维护的前三条指令以确认冒险何时结束。</li></ul></li><li><code>SAVE</code>：保存状态，保存当前指令信息以备后续使用。</li></ul><p>不考虑流水线冲刷的情况下，我们可以很简单地写出状态切换的状态机：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> next_state = </span><br><span class="line">    (cur_state == `RUN)?</span><br><span class="line">    (</span><br><span class="line">        (wait_start)?`WAIT:</span><br><span class="line">        (s_ready &amp; m_valid)?`RUN:</span><br><span class="line">        (!m_valid)?`IDLE:</span><br><span class="line">        `SAVE</span><br><span class="line">    ):</span><br><span class="line">    (cur_state == `IDLE)?</span><br><span class="line">    (</span><br><span class="line">        (s_ready &amp; m_valid)?`RUN:</span><br><span class="line">        (m_valid)?`SAVE:</span><br><span class="line">        `IDLE</span><br><span class="line">    ):</span><br><span class="line">    (cur_state == `WAIT)?</span><br><span class="line">    (</span><br><span class="line">        (!wait_finish)?`WAIT:</span><br><span class="line">        (s_ready &amp; m_valid)?`RUN:</span><br><span class="line">        `IDLE</span><br><span class="line">    ):</span><br><span class="line">    (cur_state == `SAVE)?</span><br><span class="line">    (</span><br><span class="line">        (s_ready &amp; m_valid)?`RUN:</span><br><span class="line">        `IDLE</span><br><span class="line">    ):</span><br><span class="line">    `IDLE;</span><br></pre></td></tr></table></figure><h3 id="流水线冲刷">流水线冲刷</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Valid-Ready-握手&quot;&gt;Valid_Ready 握手&lt;/h2&gt;
&lt;p&gt;RISCV的流水线设计需要许多模块共同协作，在外部看来是流水线连续处理指令。对于流水线而言，各阶段也需要模</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="嵌入式" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="计算机原理" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
  </entry>
  
  <entry>
    <title>懒人看片神器：MPV-Lazy配置</title>
    <link href="https://blog.esing.dev/2025/07/25/mpv-lazy-conf/"/>
    <id>https://blog.esing.dev/2025/07/25/mpv-lazy-conf/</id>
    <published>2025-07-25T12:31:50.000Z</published>
    <updated>2025-09-28T03:22:23.391Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>以前一直用Potplayer做电脑播放器的，配合SVP进行补帧，看电影很舒服。后来下了点动漫看，用SVP的效果也还行，但是放大后画面会显得模糊。搜了一下，使用VS滤镜可以超分放大，但还需要自己配置。有没有方便点的项目呢？在GitHub搜了一下，还真有做好的懒人包：<a href="https://github.com/hooke007/MPV_lazy">hooke007/MPV_lazy</a>。用了一下，真的是超级方便，包含了常见的放大滤镜、补帧滤镜等，效果甚至比SVP更好。</p><h2 id="自用配置">自用配置</h2><h3 id="字幕调整相关快捷键">字幕调整相关快捷键</h3><p>对不同比例的视频，可能上下黑边的宽度不同。可以对字幕位置/字体大小调整，使其不遮挡画面。同样写入<code>portable_config/input_uosc.conf</code>。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">;                 add sub-pos -0.5</span><br><span class="line">:                 add sub-pos +0.5</span><br><span class="line">&#x27;                 add video-pan-y -0.01</span><br><span class="line">&quot;                 add video-pan-y 0.01</span><br><span class="line">/                 add sub-font-size 1</span><br><span class="line">?                 add sub-font-size -1</span><br></pre></td></tr></table></figure><h3 id="滤镜-RIFE补帧">滤镜+RIFE补帧</h3><p>个人最常用的滤镜，看720P以上缩放到2K基本没问题。写入<code>portable_config/input_uosc.conf</code>即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ctrl+3            change-list glsl-shaders clr &quot;&quot;;change-list glsl-shaders set &quot;~~/shaders/Anime4K_Denoise_Bilateral_Median.glsl;~~/shaders/Anime4K_Deblur_DoG.glsl;~~/shaders/Anime4K_Darken_HQ.glsl;~~/shaders/Anime4K_Thin_HQ.glsl;~~/shaders/Anime4K_Restore_GAN_UL.glsl;~~/shaders/Anime4K_Upscale_CNN_x2_UL.glsl;~~/shaders/Anime4K_Clamp_Highlights.glsl&quot;        #! 着色器 &gt; 自定义预设：线条加重细化+A4KGANx2放大</span><br></pre></td></tr></table></figure><h3 id="RIFE补帧-ESRGAN超分辨率放大">RIFE补帧+ESRGAN超分辨率放大</h3><p>原本想先超分放大再补帧的，结果控制台一直报错。无奈，只能先补帧再放大了。可能会有一些残影，但实际看下来没有SVP多。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### N卡专用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> vapoursynth <span class="keyword">as</span> vs</span><br><span class="line"><span class="keyword">from</span> vapoursynth <span class="keyword">import</span> core</span><br><span class="line"><span class="keyword">import</span> k7sfunc <span class="keyword">as</span> k7f</span><br><span class="line"></span><br><span class="line">clip = video_in</span><br><span class="line"></span><br><span class="line"><span class="comment"># 超分辨率参数</span></span><br><span class="line">H_Pre = <span class="number">720</span></span><br><span class="line">Lt_Hd = <span class="literal">False</span></span><br><span class="line">SR_Model = <span class="number">5005</span></span><br><span class="line">SR_Gpu = <span class="number">0</span></span><br><span class="line">SR_Gpu_T = <span class="number">2</span></span><br><span class="line">SR_St_Eng = <span class="literal">False</span></span><br><span class="line">SR_Ws_Size = <span class="number">0</span></span><br><span class="line">H_Max = <span class="number">1440</span></span><br><span class="line">SR_Lk_Fmt = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 补帧参数</span></span><br><span class="line">RIFE_H_Pre = <span class="number">1440</span></span><br><span class="line">RIFE_Lt_D2k = <span class="literal">False</span></span><br><span class="line">RIFE_Model = <span class="number">46</span></span><br><span class="line">RIFE_Ext_Proc = <span class="literal">False</span></span><br><span class="line">RIFE_T_Tta = <span class="literal">False</span></span><br><span class="line">Fps_Num = <span class="number">2</span></span><br><span class="line">Fps_Den = <span class="number">1</span></span><br><span class="line">Sc_Mode = <span class="number">1</span></span><br><span class="line">RIFE_Gpu = <span class="number">0</span></span><br><span class="line">RIFE_Gpu_T = <span class="number">2</span></span><br><span class="line">RIFE_St_Eng = <span class="literal">False</span></span><br><span class="line">RIFE_Ws_Size = <span class="number">0</span></span><br><span class="line">RIFE_Lk_Fmt = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 先补帧</span></span><br><span class="line">clip = k7f.FMT_CTRL(clip, h_max=RIFE_H_Pre, fmt_pix=<span class="number">1</span> <span class="keyword">if</span> RIFE_Lk_Fmt <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line">clip = k7f.RIFE_NV(clip, lt_d2k=RIFE_Lt_D2k, model=RIFE_Model, ext_proc=RIFE_Ext_Proc, t_tta=RIFE_T_Tta, fps_in=container_fps, fps_num=Fps_Num, fps_den=Fps_Den, sc_mode=Sc_Mode, gpu=RIFE_Gpu, gpu_t=RIFE_Gpu_T, st_eng=RIFE_St_Eng, ws_size=RIFE_Ws_Size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再超分辨率放大</span></span><br><span class="line">clip = k7f.FMT_CTRL(clip, h_max=H_Pre, fmt_pix=<span class="number">1</span> <span class="keyword">if</span> SR_Lk_Fmt <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line">clip = k7f.ESRGAN_NV(clip, lt_hd=Lt_Hd, model=SR_Model, gpu=SR_Gpu, gpu_t=SR_Gpu_T, st_eng=SR_St_Eng, ws_size=SR_Ws_Size)</span><br><span class="line">clip = k7f.FMT_CTRL(clip, h_max=H_Max, fmt_pix=<span class="number">1</span> <span class="keyword">if</span> SR_Lk_Fmt <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">clip.set_output()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">嗨，我是颠佬，这是我的看片神器~</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="APP推荐" scheme="https://blog.esing.dev/tags/APP%E6%8E%A8%E8%8D%90/"/>
    
    <category term="MPV" scheme="https://blog.esing.dev/tags/MPV/"/>
    
    <category term="二次元" scheme="https://blog.esing.dev/tags/%E4%BA%8C%E6%AC%A1%E5%85%83/"/>
    
  </entry>
  
  <entry>
    <title>兰州-天水之旅</title>
    <link href="https://blog.esing.dev/2025/07/05/travel-in-lanzhou/"/>
    <id>https://blog.esing.dev/2025/07/05/travel-in-lanzhou/</id>
    <published>2025-07-05T15:46:22.000Z</published>
    <updated>2025-07-24T15:36:24.359Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>室友是真没事干，打了一星期三角洲之后拉着我又出去旅游了。</p><p>看了眼西安附近的城市，感觉就甘肃稍微近一点。等开学后再去重庆，还能找找老同学。</p><h2 id="Day-1">Day 1</h2><p>一大早就起来买了点咖啡喝喝。结果出发后同学才发现自己身份证没带。罢了，应该也没事。</p><p>下了高铁后，走四五分钟就是<a href="https://surl.amap.com/E5sbeqEfGc">兰州中心</a>，一个很大的购物中心，颇有万达广场之感觉。</p><h3 id="午饭：阿西娅">午饭：阿西娅</h3><p>大伙都饿坏了。之前请教过兰州的同学，他推荐去阿西娅西北妈妈拿手菜，虽然是连锁店，但是味道还是不错。<a href="https://surl.amap.com/mfLQRjDU3Qs">最近的一家店</a>便在兰州中心内。进去看了下，价格并不美丽，不过说口味不错。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250610_122856_250709_0849_SQrq.jpg","alt":"大份手抓羊肉，吃着过瘾，就是有点咸"},{"url":"https://pic.esing.dev/img/IMG_20250610_124708_250709_0850_vglO.jpg","alt":"特色牛奶粥，口感顺滑，但是不是很甜"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>人均下来80一个人，还是有点贵。</p><h3 id="甘肃省博物馆">甘肃省博物馆</h3><p>吃完饭后直奔<a href="https://surl.amap.com/w2QbPoZ4Yc">甘肃省博物馆</a>。都在地铁沿途，但是中午实在是太热了，根本不想坐地铁。甘肃省博物馆是身份证预约免费参观，没带身份证报手机号也行。</p><p>讲解是只有500的档，需要拼团。当时拼了10个人，划下来一人50，还行。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250610_141347_250711_1001_xLNL.jpg","alt":"人面柄首铜匕，又称作“你这匕无语了”"},{"url":"https://pic.esing.dev/img/IMG_20250610_142649_250709_0931_K7pQ.jpg","alt":"马踏飞燕！"},{"url":"https://pic.esing.dev/img/IMG_20250610_143732_250711_1007_sFLd.jpg","alt":"超长的《仪礼》竹简"},{"url":"https://pic.esing.dev/img/IMG_20250610_143125_250711_1005_MWWS.jpg","alt":"铜车马仪仗俑队"},{"url":"https://pic.esing.dev/img/IMG_20250610_144012_250711_1005_KfxI.jpg","alt":"像是LowPloy风格的木雕"},{"url":"https://pic.esing.dev/img/IMG_20250610_141605_250711_1003_2uOC.jpg","alt":"阝爰 伯铜提梁卣"},{"url":"https://pic.esing.dev/img/IMG_20250610_150915_250715_1825_N2uV.jpg","alt":"猪面纹细颈彩陶壶。猪鼻吧这是"},{"url":"https://pic.esing.dev/img/IMG_20250610_145518_250711_1006_xg5E.jpg","alt":"古代蓝色颜料为贵，此件玻璃莲花托盏更为上品中的上品"},{"url":"https://pic.esing.dev/img/IMG_20250610_144502_250715_1831_uKzl.png","alt":"怒目圆睁、脑袋尖尖"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h3 id="向步行街进发">向步行街进发</h3><p>居住的<a href="https://surl.amap.com/pH1xXxLi8PZ">汉庭酒店</a>靠着黄河。在酒店休息完之后大约是七点，但是天亮的如同白昼，太阳都高悬于山头。出门就有卖老酸奶的，奶皮色泽淡黄，看着极为诱人。</p><img src="https://webp.esing.dev/img/IMG_20250610_190120_250715_1819_Wh5Y.jpg" alt="大胡子老酸奶" style="zoom: 25%;" /><p>口感偏甜，同学吃了几口受不了了。我一爱吃甜食的都感觉稍微甜了一点，但是并不腻。</p><p>沿着黄河岸边走一走，傍晚的阳光稍有刺眼，但并不热。河边的两份吹过，煞是惬意。路过<a href="https://surl.amap.com/pah7mMRp1co">金城老码头</a>，河岸边全是茶座，最具特色的便是“三泡台”。“三泡台”又称“盖碗茶”，因茶具由茶盖、茶碗、茶托三部分组成而得名，是回族传统风俗茶饮，也是甘肃的传统糖饮料。茶叶中配以桂圆、枸杞、葡萄干、红枣、杏脯等食料，再放入一大块冰糖，甜度Max，这应当就是中国传统的果茶吧。</p><p>再往前走，便到了<a href="https://surl.amap.com/gOVrgH29dhl">中山桥</a>。中山桥，又称为兰州黄河铁桥，是中国近代史上整个西北地区第一座引进外国技术建造的桥梁，由美国桥梁公司设计、德国泰来洋行承建、中国工匠施工的合作模式建造。说白了，就是外国设计中国出力。清光绪三十四年（1908年）5月9日，兰州黄河铁桥工程正式开工；到了清宣统元年（1909年）8月19日，兰州黄河铁桥才正式竣工通行。民国十七年（1928年），为纪念孙中山先生，始称“中山桥”。南京曾经也有一座“中山桥”，不过后续因为填河筑路而被拆了。</p><img src="https://webp.esing.dev/img/IMG_20250610_191743_250715_1821_o5VV.jpg" alt="中山铁桥百年纪念碑" style="zoom: 25%;" /><p>桥另一侧的山是<a href="https://surl.amap.com/2MK19dx1x02B">白塔山公园</a>。公园内绿树成荫。站在观景台看向城区都要被树木遮挡一半视野。</p><img src="https://webp.esing.dev/img/IMG_20250610_193806_250715_1824_TfHx.jpg" alt="白塔山公园遥望城区" style="zoom: 25%;" /><p>搜到的小红书攻略说中山桥七点半会开灯，但是等到了八点都没有开，可能是因为天亮的很。</p><h3 id="晚饭：美食街-烤肉">晚饭：美食街+烤肉</h3><p>从白塔山公园回来，过了中山桥，刚好经过<a href="https://surl.amap.com/q9u8e5nQ37c">白式特色烤年糕</a>。店里人很多，许多人是来吃烧烤的。烤年糕等了四五分钟才好，刚烤出来的年糕口感极为酥脆，内部却是软糯，配上调味料，绝赞。</p><p>再一直直走，便是<a href="https://surl.amap.com/pXOcHJj1y7qr">张掖路商业街</a>。商场众多，小吃也不少。拐进小巷子，在小区的门口，便是有名的<a href="https://surl.amap.com/q0mkq7be7hl">首赫关东煮</a>。他家的秘制甜辣汁好吃，不过不是清真。整体口味感觉也没有非常出色的地方，但是架不住太便宜了，20元买了满满两大桶，一个人吃能吃半饱。和同学分着吃，大伙手都是满的，因此没拍图片。</p><p><a href="https://surl.amap.com/q5xExOlj52x">兰与茶</a>是这里的本地奶茶品牌。兰州特色奶茶当属甜醅子奶茶不可——青稞和燕麦发酵后加入香醇可口的奶茶中，还有一种淡淡的酒味，冰过之后甜醅子的涩味更少，口感更佳。13块钱可以点到满满一大杯，加的甜醅子也很足，可以边喝边嚼。同学点了柠檬杏皮茶，口感和冰红茶一模一样。</p><p>继续直走，走到<a href="https://surl.amap.com/1oO8PczaBa">正宁路小吃夜市</a>。夜市的小吃很多，本地特色小吃也不少。点了一份现煮的牛奶鸡蛋醪糟，刚出锅极烫，只能提着塑料袋等着。这边的牛奶鸡蛋醪糟全是自称老马家，那真正的老马，又不知道在哪？</p><p>从出来合计走了快一个半小时了，大伙都满饿的，于是乎找了家烤肉吃。这边的烤肉价格不便宜，口味和西安也差不多。感觉没啥特点。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250610_221639_250716_1636_mv79.jpg","alt":"兰与茶"},{"url":"https://pic.esing.dev/img/IMG_20250610_205732_250715_1847_7KxN.jpg","alt":"非常普通的烤肉"},{"url":"https://pic.esing.dev/img/IMG_20250610_204503_250716_1637_irGt.jpg","alt":"牛奶鸡蛋醪糟，表面漂浮着燕麦"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h2 id="Day-2">Day 2</h2><p>我们计划就在兰州待一天，第二天就直奔天水。</p><h3 id="早餐：兰州拉面">早餐：兰州拉面</h3><p>酒店楼下就有一家<a href="https://surl.amap.com/lTKueUhX6Mi">兰州拉面</a>。听同学说兰州拉面都差不多一个味道，也不想再去找了。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250611_074533_250716_1637_OCSy.jpg","alt":"牛肉面不贵，但是三件套的话价格就差不多"},{"url":"https://pic.esing.dev/img/IMG_20250611_074844_250716_1638_8Va2.jpg","alt":"面、蛋、干切牛肉的组合，尝了都说好"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>吃完后就直接打车去高铁站了。</p><h3 id="麦积山石窟">麦积山石窟</h3><p>天水市地跨长江、黄河两大流域，整个城市沿着渭河而建成，成一长条形。<a href="https://surl.amap.com/7iJT4HV1BfI6">天水南站</a>的位置有点尴尬：既离城区有一定距离，又离<a href="https://surl.amap.com/8ifaScAcej3">麦积山石窟</a>稍远。在高铁站打出租车，听了司机的话，决定先去麦积山石窟。</p><p>麦积山石窟，中国四大石窟之一，是中国唯一保存北朝造像体系最为完整的石窟，同时还是唯一保存有中国北朝崖阁式建筑实例的石窟，被誉为“东方雕塑艺术陈列馆”。和龙门石窟相比，麦积山不以“大小”而以“外形”著称——其造像很多都为彩塑，精细程度绝非龙门石窟的直接雕刻可比，但气势上反倒不如龙门石窟了。</p><p>景区蛮远，打车过去花了70。游客中心在山下，山上才是景区入口，上下有大巴接送。司机直接给我们送上去了，要是在下面的话还能少收点。</p><p>麦积山石窟的门票不贵，但是强行绑了往返共50的摆渡车——毕竟还是有点距离的，又是大夏天，实在不想走。解说实在是贵：麦积山石窟是分普通窟和特窟的，特窟单独收费，价格从100到200不等，洞内禁止拍照，有真人看守。要是把全套特窟看完，差不多要大2000元。看了下攻略，我们决定只看最具代表性的133特窟，价格180元。</p><p>麦积山的陡崖坡与红色山体，正是典型的丹霞地貌。红色山体是水平或变动很轻微的厚层红色砂岩、砾岩所构成，经流水向下侵蚀及重力崩塌作用形成陡峭的峰林或方山地形。</p><img src="https://webp.esing.dev/img/IMG_20250611_113211_250716_1802_t4ur.jpg" alt="山体侧面" style="zoom:25%;" /><p>再走过一个弯，变能看到悬崖峭壁上的栈道。栈道内侧，便是大小石窟。</p><img src="https://webp.esing.dev/img/IMG_20250611_113411_250716_1805_z6Yk.jpg" alt="麦积山石窟栈道" style="zoom:25%;" /><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250611_114743_250716_1806_9cSp.jpg","alt":"入口处仰视"},{"url":"https://pic.esing.dev/img/IMG_20250611_130218_250723_2334_3YLP.jpg","alt":"石窟里的功德钱，同学说佛教中规定需要用的人想拿可以拿，不知道真的假的"},{"url":"https://pic.esing.dev/img/IMG_20250611_130907_250723_2334_Iib5.jpg","alt":"琉璃珠做眼，传神"},{"url":"https://pic.esing.dev/img/IMG_20250611_132547_250723_2335_abxf.jpg","alt":"哼哈二将之口亨"},{"url":"https://pic.esing.dev/img/IMG_20250611_133034_250723_2338_ehxO.jpg","alt":"头顶的壁画，会根据视角不同变换"},{"url":"https://pic.esing.dev/img/IMG_20250611_134453_250723_2338_EcX1.jpg","alt":"栈道远眺"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>山上的栈道极高，高处风大，全程走下来胆战心惊的，生怕被大风刮下去。</p><h3 id="午晚饭：-胖子鱼">午<s>晚</s>饭： 胖子鱼</h3><p>出租车司机说天水南站附近最热门的餐饮店就是<a href="https://surl.amap.com/wl6F3yZRapX">胖子鱼</a>了。看完石窟后直奔饭店，才下午四点，不需要等候。现挑活鱼之后，下锅煮鱼片，素菜自取，按照盘子收费。</p><img src="https://webp.esing.dev/img/IMG_20250611_173640_250724_1908_m7DT.jpg" alt="现杀现涮的鱼片，极为滑嫩，吃到最后锅里只剩蘑菇了" style="zoom:25%;" /><img src="https://webp.esing.dev/img/IMG_20250611_164409_250724_1909_cAWF.jpg" alt="这玩意似乎是甘肃这边特色饮料，还蛮好喝" style="zoom:25%;" /><h3 id="夜宵：天水麻辣烫-羊头">夜宵：天水麻辣烫&amp;羊头</h3><p>晚上出来，去天水古城转转，顺便找点吃的。</p><p>天水古城感觉就和夫子庙差不多，商业气息完全盖过了人文气息。夫子庙可能还稍好一点，好歹有游船和科举博物馆呢。路过兰与茶，又点了一杯甜醅子奶茶。看到有“凭准考证免费喝奶茶”的活动，问了下收银的小姐姐考研准考证行不行，结果回答“不行的哟，我也刚考完呀……”　可爱捏(*╹▽╹*)</p><p>听说天水这的麻辣烫都差不多，随便找了一家尝尝。味道也很正常，没啥亮点但也没啥问题。</p><img src="https://webp.esing.dev/img/IMG_20250611_220329_250724_1914_qQsI.jpg" alt="看着超有食欲，可惜吃饱了吃不下" style="zoom:25%;" /><p>出了古城后，同学说想吃羊头，一直都想，老想了，可能受到老马病毒传染了。问了下店家，有紫色苹果，不过是削好的。端出来的羊头是剁好的，不是老马视频里一整个，可惜。尝了一点点，感觉口感和啃猪蹄差不多。</p><img src="https://webp.esing.dev/img/IMG_20250611_224408_250724_1918_9i8C.jpg" alt="灵魂之子，浇gia~" style="zoom: 25%;" /><p>羊头本身不热，也没浇东西，因此不需要紫色苹果重置口腔温度。解腻的话倒是可以，不过同学买了果茶。</p><img src="https://webp.esing.dev/img/IMG_20250611_204850_250724_1920_jN3u.jpg" alt="Roselia（难视）" style="zoom:25%;" /><h2 id="Day-3">Day 3</h2><p>早上起来懒得下去找吃的了，就吃了汉庭的免费早餐。</p><h3 id="伏羲庙">伏羲庙</h3><p>酒店离伏羲庙不远，一早就打车去了。</p><p>伏羲庙是中国西北地区著名古建筑群之一，始建于明成化十九年至二十年间（1483～1484年），为中国规模最大的伏羲祭祀建筑群。我们那天很幸运，一早赶上了祭祀大典的彩排——每年的夏至，两岸人民都会共同进行伏羲大典的公祭，通过参与祭祀中华人文始祖的庄严仪式，感受身为炎黄子孙的骄傲。今年的夏至是6月21号，彩排提早了两个星期便开始了。</p>]]></content>
    
    
    <summary type="html">但使龙城飞将在、不教胡马度阴山。</summary>
    
    
    
    <category term="随笔" scheme="https://blog.esing.dev/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="游记" scheme="https://blog.esing.dev/tags/%E6%B8%B8%E8%AE%B0/"/>
    
    <category term="美食" scheme="https://blog.esing.dev/tags/%E7%BE%8E%E9%A3%9F/"/>
    
    <category term="兰州" scheme="https://blog.esing.dev/tags/%E5%85%B0%E5%B7%9E/"/>
    
    <category term="天水" scheme="https://blog.esing.dev/tags/%E5%A4%A9%E6%B0%B4/"/>
    
  </entry>
  
  <entry>
    <title>洛阳之旅</title>
    <link href="https://blog.esing.dev/2025/05/08/travel-in-luoyang/"/>
    <id>https://blog.esing.dev/2025/05/08/travel-in-luoyang/</id>
    <published>2025-05-08T13:04:26.000Z</published>
    <updated>2025-07-05T15:46:31.442Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>五一没打算出去玩，直接去给竞赛提速了。主频能上200Mhz，不赖。</p><p>五一结束之后就准备去周边玩玩。看了一圈高铁两小时之内的城市，华山不适合爬，成都去过了。洛阳也不算远，景点也不少，遂决定去洛阳。</p><h2 id="Day-1">Day 1</h2><p>半夜把《爱因斯坦携爱敬上》推完了。本篇故事还不错，但是前面的割裂感太强了。新岛夕好像确实不擅长写连贯的故事。等回来再把FD推了吧哈哈</p><p>早上五点半就起来了，困死我了。</p><h3 id="龙门石窟">龙门石窟</h3><p>洛阳龙门站离<a href="https://surl.amap.com/1daOwcd1o6eg">龙门石窟</a>还蛮近的，于是下了高铁就打车直奔景区。</p><div class="note danger flat"><p>百度地图眉目了，PC端登录了也不能看地点详情，只有一个手机二维码。坐地图做不过高德开始强行推广你那个烂APP了是吧。</p></div><blockquote><p>龙门石窟位于河南省洛阳市，占地面积31.7平方千米，现存<strong>2345座</strong>佛龛，<strong>10万余尊</strong>造像，<strong>2800余块</strong>碑刻题记，是世界上<strong>造像最多、规模最大的石刻艺术宝库</strong>，被联合国教科文组织评为“<strong>中国石刻艺术的最高峰</strong>”，位居<strong>中国各大石窟之首</strong>。</p></blockquote><p>人文景点不能没有解说。准备请一个，刚进服务大厅就被气笑了。接待人员说只剩1000价位的了，工作日的上午十点解说就全没了是吧。想钱想疯了。</p><img src="https://webp.esing.dev/img/1746760945157_250509_1124_VLLK.jpg" alt="金牌讲解1000元，嘴里镶金牙了是吧" style="zoom: 33%;" /><p>龙门石窟坐落在伊河两侧，这河相传是大禹治水时所挖。伊河洛河，孕育出了“最早的中国”，称之为“东方的两河文明”也不为过。</p><img src="https://webp.esing.dev/img/1746760945151_250509_1142_GJp0.jpg" alt="波光粼粼的伊河" style="zoom: 25%;" /><p>穿过龙门桥的桥洞，再往前走一小会儿，就是“禹王池”。泉水自石穴中出，冬暖夏凉，中生水藻。禹王池池中有一块巨石，称石砭，或石笋、剑石，为太湖石质，相传是大禹开凿龙门时所用的工具。</p><p>再往前走，便是石窟群。首先是宾阳三洞，这是北魏宣武帝为孝文帝、文昭皇后主持开凿的皇家第一窟，用以铭记孝文帝迁都洛阳和进行汉化改革的历史功绩，也是我国正史中唯一有确切记载的石窟。但是，北魏时期仍然只完成了宾阳中洞，宾阳南洞、宾阳北洞一直到隋唐时期才相继完成。</p><img src="https://webp.esing.dev/img/1746760945138_250511_1316_J02o.jpg" alt="最先完成的宾阳中洞" style="zoom:25%;" /><p>过了宾阳三洞和摩崖三佛，有一口小小的泉水，名叫“珍珠泉”。南京也有个珍珠泉旅游区，不过印象中那泉也不大。泉水看着蛮清澈，但是里面有不少悬浮物，估计是池子里的。边上就有接直饮水的地方，可能是泉水引下来再净化？</p><p>继续往前走，是万佛洞。</p><img src="https://webp.esing.dev/img/1746760945130_250511_1317_H0nV.jpg" alt="千佛洞" style="zoom:25%;" /><img src="https://webp.esing.dev/img/1746760945122_250511_1317_mWaD.jpg" alt="卢舍那大佛" style="zoom: 33%;" /><p>即使是五一节后，人还是很多。可惜忘了拍大佛的侧面照了。</p><h3 id="白公墓">白公墓</h3><p>走完这一侧，到达伊河的对岸，再往前走一点就是白公墓。白居易遭诽谤贬为江州司马后便开始颠沛流离的生活，先后做过杭州刺史、苏州刺史。晚年的他在洛阳度过余生。那时候，他一心信佛，住于香山寺下，自己也号称“香山居士”。死后，便葬在了这个山清水秀的地方。</p><p>学校里的东亭，曾是白公科举登第后的暂居地。两个地点，见证了白公的一生。</p><img src="https://webp.esing.dev/img/1746760945108_250514_2253_NdJN.jpg" alt="一代诗魔,便长眠于此" style="zoom: 33%;" /><h3 id="午餐：河南牛肉汤">午餐：河南牛肉汤</h3><p>中午没回酒店，直接去洛阳博物馆周围找吃的了。都来河南了，怎么能不吃河南牛肉汤呢？搜了一下，附近有家<a href="https://surl.amap.com/dYKeIDb80CF">龙鳞路第一家牛肉汤</a>评价不错。</p><p>牛肉汤直接分价位：10元、15元、20元、30元。点了20元的牛肉汤，里面的料已经很足了。牛肉不算多，但是牛杂堆满了。</p><p>剩下的小料都是按个加。一人要了一份酥炸丸子，也是河南特色。</p><img src="https://webp.esing.dev/img/1746760945091_250521_1139_WdOL.jpg" alt="人均35吃到饱" style="zoom:50%;" /><h3 id="洛阳博物馆">洛阳博物馆</h3><p>中午吃过后就直奔洛阳博物馆。</p><p>西安的文物固然多，但洛阳的文物又有一种独特的地位：很多文物都是“跨时代”意义的——前无古人，来者中属它为首。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/1cut_250521_1635_1rRK.jpg","alt":"唐代彩绘陶马与驯马俑。静态的塑像展现出动态之美。"},{"url":"https://pic.esing.dev/img/1746760945087_250521_1640_CrWp.jpg","alt":"七级浮屠塔"},{"url":"https://pic.esing.dev/img/1746760945077_250521_1640_cYgb.jpg","alt":"长了两个小耳朵的酒器，叫斝"},{"url":"https://pic.esing.dev/img/1746760945065_250521_1652_2CSd.jpg","alt":"金丝楠木佛塔，镇馆之宝之一"},{"url":"https://pic.esing.dev/img/1747817619331_250521_1654_SNj8.jpg","alt":"唐三彩黑马。古代时黑色釉料极少，因此为上品中的上品方可用黑色。这匹马也是镇馆之宝之一。"},{"url":"https://pic.esing.dev/img/1747817619326_250521_1656_qvi3.jpg","alt":"那我问你，啊，那我问你，你的头顶怎么尖尖的？"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h3 id="存档点">存档点</h3><p>三个人出去住的选择极为有限，除了家庭房就很少有三床的旅馆。看完洛阳博物馆后，扫了共享电动车就直接骑到<a href="https://surl.amap.com/s8ZyYJDM6J4">酒店</a>了。人均60住的地方居然非常干净、空气无异味，实在是远超期望。</p><h3 id="晚餐：和记涮牛肚">晚餐：和记涮牛肚</h3><p>晚餐决定去不远处的<a href="https://surl.amap.com/8gLTc7L1q9rs">和记涮牛肚</a>吃。同样是看小红书推荐选的店。经典的火锅+涮牛肚。牛肚一元一串，正常价格吧，不过量少。没办法，牛肚还是太贵了。</p><img src="https://webp.esing.dev/img/1746760945043_250524_0909_qK9u.jpg" alt="涮牛肚就得配麻酱！" style="zoom:50%;" /><h3 id="应天门">应天门</h3><p>吃完饭再往前走走，就是<a href="https://surl.amap.com/ugAeJbH133VS">应天门</a>。应天门原名则天门，是朝廷举行登基、改元、大赦、宴会等外朝大典的场所，也曾是武则天登基之地。</p><p>门票40来着，当时觉得没必要上去就只在下面转了转。夜晚的应天门，城楼周围均会开灯，金碧辉煌，极其美丽。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/1746760945023_250524_0914_3v4a.jpg","alt":"南广场拍摄"},{"url":"https://pic.esing.dev/img/1748049179981_250524_0913_aPiO.jpg","alt":"西南角拍摄"},{"url":"https://pic.esing.dev/img/2_250524_0913_tHOP.jpg","alt":"西停车场拍摄"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h3 id="小芳茶卖部">小芳茶卖部</h3><p>洛阳的本土奶茶有两个：了了一杯和小芳茶卖部，似乎是后者更加亲民。刚好应天门边上就有一家店。看了一眼菜单，比较新奇的口味有蜂油精和薄荷奶绿。我很喜欢薄荷，于是点了杯，看评论说他家的奶茶很甜很甜，不加糖都有甜味，果不其然。我一个甜食爱好者点的不额外加糖觉得刚刚好。</p><img src="https://webp.esing.dev/img/1746760945014_250524_0920_ioJq.jpg" alt="杯子上的插画也很有年代感" style="zoom:50%;" /><p>同学说一股子牙膏味道，不好喝。可能每个人口味不一样吧。一口下去，薄荷的清香与淡淡的奶香在嘴里扩散开来，冰奶茶的冰与薄荷油的凉交织，简直就是夏夜的救赎。</p><h2 id="Day-2">Day 2</h2><h3 id="早餐：胡辣汤">早餐：胡辣汤</h3><p>早起喝汤了吗？</p><img src="https://webp.esing.dev/img/IMG_20250508_075437_250702_1540_6B8f.jpg" alt="大碗胡辣汤，过瘾" style="zoom:50%;" /><h3 id="白马寺">白马寺</h3><p>打车大约 20min 就到了<a href="https://surl.amap.com/omewast64OX">白马寺</a>，不过也可以坐班车再上地铁，嫌麻烦就直接打车了。</p><p>白马寺是中国佛教的发源地，也是佛教传入中国后兴建的第一座官办寺院。门口确有一匹石雕白马，但和白马寺无任何关系，为北宋永庆公主驸马魏咸信墓前的石刻，于1935年迁移至寺院山门前‌。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250514_184900_250702_2159_UAAN.jpg","alt":"“晨钟暮鼓”，寺内的钟鼓楼会按时间撞钟敲鼓"},{"url":"https://pic.esing.dev/img/IMG_20250508_091727_250702_2214_6hvs.jpg","alt":"听讲解说，摸摸龟头可以多子多福。"},{"url":"https://pic.esing.dev/img/IMG_20250508_101313_250702_2215_h3Fc.jpg","alt":"缅甸佛塔建筑"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>其实没啥看的。</p><h3 id="午餐：老雒阳面馆·水席">午餐：老雒阳面馆·水席</h3><p>洛阳水席评价较差，因此没吃。</p><p>洛阳这儿的“燕菜”其实就是萝卜。点了个酥炸燕菜，其实就是炸萝卜丝，蛮好吃的，和萝卜丸子很像。喜欢吃甜品，又点了一份玫瑰花造型的奶冻。中看不中吃，口感一般。红糖芋头汤很好喝，有糖芋苗之滋味。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250508_115624_250705_2333_XgF5.jpg","alt":"五个菜满满当当"},{"url":"https://pic.esing.dev/img/IMG_20250508_122821_250705_2334_hgo7.jpg","alt":"中看不中吃的奶冻"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h3 id="古墓博物馆">古墓博物馆</h3><p>走之前再去看了古墓博物馆。洛阳和古墓可谓关系密切，邙山陵墓群便在洛阳，是中国最大的陵墓群遗址，号称“东方金字塔”，因埋葬帝王最多、最集中，也被誉为“中国帝王谷”。邙山陵墓群汇集着各个时期、各种类型的古代墓葬数十万个，不过许多都被盗过。看盗墓类小说的对“洛阳铲”应该不陌生。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/IMG_20250508_153705_250705_2342_PXsg.jpg","alt":"手中无剑，影中却有剑"},{"url":"https://pic.esing.dev/img/IMG_20250508_154044_250705_2342_oN9b.jpg","alt":"精致的北宋砖雕墓"},{"url":"https://pic.esing.dev/img/IMG_20250508_161403_250705_2343_aCLL.jpg","alt":"看到一块白色的圆形了吗？那是古代盗墓贼所打下的盗洞。"},{"url":"https://pic.esing.dev/img/IMG_20250508_160001_250705_2343_jatO.jpg","alt":"“修旧如旧”的壁画"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><h3 id="返程">返程</h3><p>给室友带了杯薄荷奶绿。刚出地铁站就开始下雨，身上全湿透了。到了宿舍，小挎包的带子也断了，算是完成使命了。</p>]]></content>
    
    
    <summary type="html">国色牡丹迎君来、踏春寻梦洛阳城。</summary>
    
    
    
    <category term="随笔" scheme="https://blog.esing.dev/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="游记" scheme="https://blog.esing.dev/tags/%E6%B8%B8%E8%AE%B0/"/>
    
    <category term="美食" scheme="https://blog.esing.dev/tags/%E7%BE%8E%E9%A3%9F/"/>
    
    <category term="洛阳" scheme="https://blog.esing.dev/tags/%E6%B4%9B%E9%98%B3/"/>
    
  </entry>
  
  <entry>
    <title>MATLAB设置自定义字体时找不到系统已安装字体</title>
    <link href="https://blog.esing.dev/2025/05/01/matlab-set-custom-font/"/>
    <id>https://blog.esing.dev/2025/05/01/matlab-set-custom-font/</id>
    <published>2025-05-01T04:16:22.000Z</published>
    <updated>2025-05-01T04:30:16.659Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>最近在研究遗传算法优化PID参数的论文。本来想用Python实现的，奈何实在不会。网上有很多MATLAB的代码，学习一下。</p><p>自带的字体太虚了，看着不舒服。所有的代码字体我都换成自制的<code>JetBrains Mono Nerd Font Mono + MiSans</code>，高分屏也看的舒服。但不知道为啥，MATLAB中看不到系统已经安装的字体。</p><h2 id="解决">解决</h2><p>找到你系统上安装字体的路径，复制对应的TTF字体文件到<code>MATLAB\sys\java\jre\win64\jre\lib\fonts</code>下即可。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;最近在研究遗传算法优化PID参数的论文。本来想用Python实现的，奈何实在不会。网上有很多MATLAB的代码，学习一下。&lt;/p&gt;
&lt;p&gt;自带的字体太虚了</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="踩坑" scheme="https://blog.esing.dev/tags/%E8%B8%A9%E5%9D%91/"/>
    
    <category term="MATLAB" scheme="https://blog.esing.dev/tags/MATLAB/"/>
    
  </entry>
  
  <entry>
    <title>VSCode配置LaTeX编辑环境</title>
    <link href="https://blog.esing.dev/2025/04/21/vscode-latex-setup/"/>
    <id>https://blog.esing.dev/2025/04/21/vscode-latex-setup/</id>
    <published>2025-04-21T12:10:28.000Z</published>
    <updated>2025-09-09T00:50:53.025Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>换了新电脑，刚好配一下LaTeX环境，以便后面写毕设论文。实在用不惯Word，告辞。</p><h2 id="LaTeX配置">LaTeX配置</h2><h3 id="镜像下载">镜像下载</h3><p>搜索<code>texlive2025.iso</code>，各大高校镜像站都能下到。比如：<a href="https://mirrors.tuna.tsinghua.edu.cn/CTAN/systems/texlive/Images/texlive2025.iso">texlive2025.iso - 清华大学开源软件镜像站</a>或者是<a href="https://mirrors.xjtu.edu.cn/?mirrors=ctan%2Fsystems%2Ftexlive%2FImages%2F&amp;download=texlive2025.iso">texlive2025.iso - 西安交通大学软件镜像站</a>。</p><p>Win10及以上自带了虚拟光驱，直接双击打开就行。</p><h3 id="安装设置">安装设置</h3><p>打开挂载后的镜像，选择<code>install-tl-windows.bat</code>，运行后会得到下面的GUI安装界面：</p><img src="https://webp.esing.dev/img/image-20250421204415652_250421_2044_GA5f.png" alt="TeX Live安装界面" style="zoom:50%;" /><p>可以修改安装位置。这里点进去Advanced，展开高级设置：</p><img src="https://webp.esing.dev/img/image-20250421204516417_250421_2045_vBbQ.png" alt="TeX Live高级设置" style="zoom:50%;" /><p>然后点开<code>N. of collections</code>，选择一下语言。这里就选中文和英语，应该够了吧。此外，安装位置也可以选。全套装完大约占用10G的空间，C盘不够的就移到别的盘里安装。</p><p>之后开始安装即可。等待时间有点长，显示的一刻钟就好，实际上大约半个小时。</p><div class="note warning flat"><p>听说第一步选择管理员身份运行也可以，但是后面每次更新包都要以管理员身份运行。但我测试了一下，正常运行<code>tlshell</code>更新库好像没问题？</p><p>不选择管理员身份安装只是不能装到C盘根目录下罢了。</p></div><h3 id="小BUG">小BUG</h3><p>安装时出现卡在<code>running package-specific postactions</code>的问题：</p><img src="https://webp.esing.dev/img/image-20250421214315438_250421_2143_KUtZ.png" alt="卡住的安装界面" style="zoom:50%;" /><p>查看安装日志<code>install-tl.log</code>：</p><img src="https://webp.esing.dev/img/image-20250421230608677_250421_2306_jUNL.png" alt="安装日志" style="zoom:50%;" /><p>可以发现有安装完毕的欢迎语。应该是BUG了。</p><h3 id="添加PATH">添加PATH</h3><p>去高级系统设置里将安装目录下的<code>bin/windows</code>加到用户变量。我的是<code>C:\texlive\2025\bin\windows</code>。</p><h3 id="包管理器">包管理器</h3><p>在终端执行<code>tlshell</code>即可。开启后先在选项-Repositories中换一下源，清华和USTC都可。为什么不用交大源？是不想吗？</p><h2 id="VSCode配置">VSCode配置</h2><p>VSCode安装过程略。</p><h3 id="插件安装">插件安装</h3><p>在VSCode插件市场中搜索：<code>LaTeX Workshop</code>，安装：</p><img src="https://webp.esing.dev/img/image-20250422001905635_250422_0019_3vJ9.png" alt="LaTeX Workshop" style="zoom:50%;" /><p>之后打开任意TeX模板，在左边就会显示LaTeX选项卡。</p><h3 id="自定义编译选项">自定义编译选项</h3><p>有些模板需要多次编译，比如<code>pdflatex-&gt;pdflatex</code>，或是<code>xelatex x3</code>。这时候需要自定义编译选项。</p><p><kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>P</kbd>或者<kbd>F1</kbd>打开命令面板，输入“用户设置”，找到那个<code>preferences: Open User Settings (JSON)</code>。</p><p>打开后编辑JSON文件，添加自定义编译命令与配方：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">// ***</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;-synctex=1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-interaction=nonstopmode&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-file-line-error&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-pdf&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;-outdir=%OUTDIR%&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;%OUTDIR%/%DOCFILE%&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.recipes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XeLaTeX&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PDFLaTeX&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;BibTeX&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;LaTeXmk&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;latexmk&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;XeLaTeX*3&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex -&gt; bibtex -&gt; xelatex*2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pdflatex -&gt; bibtex -&gt; pdflatex*2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;bibtex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;pdflatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xelatex -&gt; biber -&gt; xelatex*2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;tools&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;biber&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="string">&quot;xelatex&quot;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>就可以在你的编译选项中看到自定义编译方案了。</p><p>我还加了以下设置：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.autoBuild.run&quot;</span><span class="punctuation">:</span> <span class="string">&quot;never&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.showContextMenu&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.intellisense.package.enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.message.error.show&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.message.warning.show&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.outDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./build/&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.clean.fileTypes&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="comment">// &quot;*.aux&quot;,</span></span><br><span class="line">        <span class="string">&quot;*.bbl&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.blg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.idx&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.ind&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.lof&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.lot&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.out&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.toc&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.acn&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.acr&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.alg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.glg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.glo&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.gls&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.ist&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.fls&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.log&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;*.fdb_latexmk&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.autoClean.run&quot;</span><span class="punctuation">:</span> <span class="string">&quot;onFailed&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.latex.recipe.default&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lastUsed&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.view.pdf.internal.synctex.keybinding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;double-click&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.view.pdf.viewer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tab&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.synctex.afterBuild.enabled&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.view.outline.sync.viewer&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;[bibtex]&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;editor.defaultFormatter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;James-Yu.latex-workshop&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;latex-workshop.formatting.latex&quot;</span><span class="punctuation">:</span> <span class="string">&quot;latexindent&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;换了新电脑，刚好配一下LaTeX环境，以便后面写毕设论文。实在用不惯Word，告辞。&lt;/p&gt;
&lt;h2 id=&quot;LaTeX配置&quot;&gt;LaTeX配置&lt;/h2&gt;
</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="LaTeX" scheme="https://blog.esing.dev/tags/LaTeX/"/>
    
    <category term="VSCode" scheme="https://blog.esing.dev/tags/VSCode/"/>
    
  </entry>
  
</feed>
