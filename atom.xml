<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Esing的小站</title>
  
  <subtitle>随便写点</subtitle>
  <link href="https://blog.esing.dev/atom.xml" rel="self"/>
  
  <link href="https://blog.esing.dev/"/>
  <updated>2025-12-09T18:30:37.201Z</updated>
  <id>https://blog.esing.dev/</id>
  
  <author>
    <name>Esing</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>从零开始学RISC：第六篇</title>
    <link href="https://blog.esing.dev/2025/12/09/riscvcod-p6/"/>
    <id>https://blog.esing.dev/2025/12/09/riscvcod-p6/</id>
    <published>2025-12-09T14:19:27.000Z</published>
    <updated>2025-12-09T18:30:37.201Z</updated>
    
    <content type="html"><![CDATA[<h2 id="执行-EX级-设计">执行 EX级 设计</h2><p>EX级以负责核心运算功能的<strong>ALU</strong>著称。可以说，它是CPU的灵魂。来一人一句ALU牛逼来。</p><h3 id="算数逻辑单元-ALU-sv">算数逻辑单元 <a href="http://ALU.sv">ALU.sv</a></h3><p>ALU需要完成一系列R-Type、I-Type指令的运算。对于L-Type和S-Type，它们的处理逻辑其实差不多，都是相加——这样才能让ALU输出基地址和偏移量之和，算出目标地址。</p><p>同样地，使用字符串打印的方式来增强可读性，优化Debug体验，并更好的看到指令在流水线中的流动。同样使用<code>DEBUG</code>宏进行包装，在给综合器生成最终电路前取消宏定义即可。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> ALU (</span><br><span class="line">    <span class="comment">// 操作码</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] alu_op,</span><br><span class="line">    <span class="comment">// 操作数</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src1,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src2,</span><br><span class="line">    <span class="comment">// 来自ID/EX级的立即数</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm,</span><br><span class="line">    <span class="comment">// 第二操作数选择 0: src2 1: imm</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        alu_src2_sel,</span><br><span class="line">    <span class="comment">// 结果输出</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] alu_result,</span><br><span class="line">    <span class="comment">// 标志位输出</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        zero,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        sign,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        alu_unsigned</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src2_inner;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> src2_inner = (alu_src2_sel) ? imm : src2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 运算操作</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : alu_operation</span><br><span class="line">        <span class="keyword">case</span> (alu_op)</span><br><span class="line">            <span class="comment">// 基础运算</span></span><br><span class="line">            `ALU_ADD:   alu_result = src1 + src2_inner;</span><br><span class="line">            `ALU_SUB:   alu_result = src1 - src2_inner;  <span class="comment">// src1 + (~src2 + 1)</span></span><br><span class="line">            `ALU_OR:    alu_result = src1 | src2_inner;</span><br><span class="line">            `ALU_AND:   alu_result = src1 &amp; src2_inner;</span><br><span class="line">            `ALU_XOR:   alu_result = src1 ^ src2_inner;</span><br><span class="line">            `ALU_SLL:   alu_result = src1 &lt;&lt; src2_inner[<span class="number">4</span>:<span class="number">0</span>];</span><br><span class="line">            `ALU_SRL:   alu_result = src1 &gt;&gt; src2_inner[<span class="number">4</span>:<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// 必须显式声明src1为有符号数</span></span><br><span class="line">            `ALU_SRA:   alu_result = <span class="built_in">$signed</span>(src1) &gt;&gt;&gt; src2_inner[<span class="number">4</span>:<span class="number">0</span>];</span><br><span class="line">            `ALU_SLT:   alu_result = (<span class="built_in">$signed</span>(src1) &lt; <span class="built_in">$signed</span>(src2_inner)) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">            `ALU_SLTU:  alu_result = (src1 &lt; src2_inner) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">            `ALU_RIGHT: alu_result = src2_inner;  <span class="comment">// 用于AUIPC指令</span></span><br><span class="line">            <span class="comment">// L-Type：所有load指令都是地址计算(base + offset)</span></span><br><span class="line">            `ALU_LB,</span><br><span class="line">            `ALU_LH,</span><br><span class="line">            `ALU_LW,</span><br><span class="line">            `ALU_LBU,</span><br><span class="line">            `ALU_LHU:   alu_result = src1 + src2_inner;  <span class="comment">// 地址计算</span></span><br><span class="line">            <span class="comment">// S-Type：所有store指令都是地址计算</span></span><br><span class="line">            `ALU_SB,</span><br><span class="line">            `ALU_SH,</span><br><span class="line">            `ALU_SW:    alu_result = src1 + src2_inner;  <span class="comment">// 地址计算</span></span><br><span class="line">            <span class="keyword">default</span>:    alu_result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load/Store指令使用的地址计算不放在ALU内</span></span><br><span class="line">    <span class="comment">// 拆分为独立模块 LoadStoreUnit</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 标志位输出</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        zero         = (alu_result == <span class="number">32&#x27;b0</span>);</span><br><span class="line">        sign         = alu_result[<span class="number">31</span>];</span><br><span class="line">        alu_unsigned = (src1 &lt; src2_inner);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">    <span class="comment">// 方便调试的 ASCII 指令输出</span></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">64</span>-<span class="number">1</span>:<span class="number">0</span>] aluop_ascii;</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : aluop_ascii_output</span><br><span class="line">        <span class="keyword">case</span> (alu_op)</span><br><span class="line">            `ALU_ADD:   aluop_ascii = <span class="string">&quot;AADD&quot;</span>;</span><br><span class="line">            `ALU_SUB:   aluop_ascii = <span class="string">&quot;ASUB&quot;</span>;</span><br><span class="line">            `ALU_OR:    aluop_ascii = <span class="string">&quot;AOR&quot;</span>;</span><br><span class="line">            `ALU_AND:   aluop_ascii = <span class="string">&quot;AAND&quot;</span>;</span><br><span class="line">            `ALU_XOR:   aluop_ascii = <span class="string">&quot;AXOR&quot;</span>;</span><br><span class="line">            `ALU_SLL:   aluop_ascii = <span class="string">&quot;ASLL&quot;</span>;</span><br><span class="line">            `ALU_SRL:   aluop_ascii = <span class="string">&quot;ASRL&quot;</span>;</span><br><span class="line">            `ALU_SRA:   aluop_ascii = <span class="string">&quot;ASRA&quot;</span>;</span><br><span class="line">            `ALU_SLT:   aluop_ascii = <span class="string">&quot;ASLT&quot;</span>;</span><br><span class="line">            `ALU_SLTU:  aluop_ascii = <span class="string">&quot;ASLTU&quot;</span>;</span><br><span class="line">            `ALU_RIGHT: aluop_ascii = <span class="string">&quot;ARGHT&quot;</span>;</span><br><span class="line">            `ALU_LB:    aluop_ascii = <span class="string">&quot;ALB&quot;</span>;</span><br><span class="line">            `ALU_LH:    aluop_ascii = <span class="string">&quot;ALH&quot;</span>;</span><br><span class="line">            `ALU_LW:    aluop_ascii = <span class="string">&quot;ALW&quot;</span>;</span><br><span class="line">            `ALU_LBU:   aluop_ascii = <span class="string">&quot;ALBU&quot;</span>;</span><br><span class="line">            `ALU_LHU:   aluop_ascii = <span class="string">&quot;ALHU&quot;</span>;</span><br><span class="line">            `ALU_SB:    aluop_ascii = <span class="string">&quot;ASB&quot;</span>;</span><br><span class="line">            `ALU_SH:    aluop_ascii = <span class="string">&quot;ASH&quot;</span>;</span><br><span class="line">            `ALU_SW:    aluop_ascii = <span class="string">&quot;ASW&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span>:    aluop_ascii = <span class="string">&quot;ANOP&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="meta">`<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>对于许多CPU，会将ALU运算的源操作数选择列为一个单独的二选一MUX。这里直接合并在ALU内：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> ALU (</span><br><span class="line">    <span class="comment">// 操作数</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src1,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src2,</span><br><span class="line">    <span class="comment">// 来自ID/EX级的立即数</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm,</span><br><span class="line">    <span class="comment">// 第二操作数选择 0: src2 1: imm</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        alu_src2_sel,</span><br><span class="line">    ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src2_inner;</span><br><span class="line">    <span class="keyword">assign</span> src2_inner = (alu_src2_sel) ? imm : src2;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>那为什么后面的MUX不合并呢？这是为了看起来更方便。</p><h3 id="回写数据来源选择MUX">回写数据来源选择MUX</h3><p>这一块实际上没有写成一个单独的模块，而是最终要集成在封装好的CPU模块内。想单独写一个也行，反正最终会被综合成一个多选一MUX。</p><p>我们需要选择哪些数据？看之前的 <a href="/2025/12/08/riscvcod-p5/" title="从零开始学RISC：第五篇">译码级设计</a> ，看<code>Decoder.sv</code>输出的选择信号<code>wd_sel</code>对应哪些指令：</p><ul><li>R-Type和I-Type指令的写回数据来源于ALU；</li><li>B-Type指令不需要选择回写数据，但也得给个默认值；</li><li><code>jal</code>和<code>jalr</code>两个是跳转指令，需要选择<code>pc+4</code>作为数据写入寄存器；</li><li><code>lui</code>和<code>auipc</code>这两个很特殊，是立即数扩展，因此使用扩展后从ID级传入的数据；</li><li>L-Type需要从DRAM中读取数据，因此需要在MEM级选择；</li><li>不应该有其余情况，这里写为<code>unique case</code>可以不写<code>default</code>。不过补一个最好。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;执行-EX级-设计&quot;&gt;执行 EX级 设计&lt;/h2&gt;
&lt;p&gt;EX级以负责核心运算功能的&lt;strong&gt;ALU&lt;/strong&gt;著称。可以说，它是CPU的灵魂。来一人一句ALU牛逼来。&lt;/</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="嵌入式" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="计算机原理" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>从零开始学RISC：第五篇</title>
    <link href="https://blog.esing.dev/2025/12/08/riscvcod-p5/"/>
    <id>https://blog.esing.dev/2025/12/08/riscvcod-p5/</id>
    <published>2025-12-08T12:16:34.000Z</published>
    <updated>2025-12-09T17:28:34.067Z</updated>
    
    <content type="html"><![CDATA[<h2 id="译码-ID级-设计">译码 ID级 设计</h2><p>提到译码级，那就得是译码器啊。纯组合逻辑，包你写到爽。</p><p>译码级还有什么？立即数移位也需要放在ID级，以减轻EX级的压力。</p><h3 id="指令译码器-Decoder-sv">指令译码器 <a href="http://Decoder.sv">Decoder.sv</a></h3><p>指令译码器为<strong>组合逻辑模块</strong>。我们需要哪些信号？</p><p>首先要把31位的指令分类：是RIBJSU的哪一种？之后，要根据分类，将寄存器地址拆分出来，准备送进同一级的寄存器堆来读取数据；要提取指令的<code>funct3</code>和<code>funct7</code>，以便在EX级告诉ALU“长的像的指令如何区分”；要根据指令类型，区分跳转类型和读取/写入类型，给后面的流水级进行处理；还要生成对应位的寄存器读信号，和分支指令判断信号，为后面处理数据冒险准备……要干的事情真不少。</p><p>一步一步全写上即可。推荐使用宏定义，大幅度提升可读性。</p><p>在模块内使用``ifdef DEBUG`配合上ASCII字符进行Debug是另一个小技巧。在综合时取消宏定义即可。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> Decoder (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instr,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] alu_op,</span><br><span class="line">    <span class="comment">// ALU 第一操作数来源</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        is_auipc,</span><br><span class="line">    <span class="comment">// ALU 第二操作数来源</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        alu_src,</span><br><span class="line">    <span class="comment">// 写使能</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        dram_we,          <span class="comment">// 高电平为写使能 低电平为读</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rf_we,</span><br><span class="line">    <span class="comment">// 写回数据来源</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel,</span><br><span class="line">    <span class="comment">// 分支相关</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        is_branch_instr,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">2</span>:<span class="number">0</span>] branch_type,</span><br><span class="line">    <span class="comment">// 跳转相关</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] jump_type,</span><br><span class="line">    <span class="comment">// 数据读取类型</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">3</span>:<span class="number">0</span>] sl_type,</span><br><span class="line">    <span class="comment">// 源寄存器是否在使用</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rs1_used,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rs2_used</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 提取指令字段</span></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] opcode;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] funct3;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] funct7;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        opcode = instr[<span class="number">6</span>:<span class="number">0</span>];</span><br><span class="line">        funct3 = instr[<span class="number">14</span>:<span class="number">12</span>];</span><br><span class="line">        funct7 = instr[<span class="number">31</span>:<span class="number">25</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 跳转类型判断</span></span><br><span class="line">    <span class="comment">// assign jump_type = (opcode == `OPCODE_JAL) ?</span></span><br><span class="line">    <span class="comment">//     `JUMP_JAL : (opcode == `OPCODE_JALR) ? `JUMP_JALR : `JUMP_NOP;</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_JAL:  jump_type = `JUMP_JAL;</span><br><span class="line">            `OPCODE_JALR: jump_type = `JUMP_JALR;</span><br><span class="line">            <span class="keyword">default</span>:      jump_type = `JUMP_NOP;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 源寄存器读取判断</span></span><br><span class="line">    <span class="comment">// 反向判断简化逻辑 记得去除ERROR</span></span><br><span class="line">    <span class="comment">// rs1：除了 LUI/AUIPC/JAL 之外都用到</span></span><br><span class="line">    <span class="keyword">assign</span> rs1_used = ~((opcode == `OPCODE_LUI) || (opcode == `OPCODE_AUIPC) ||</span><br><span class="line">                        (opcode == `OPCODE_JAL) || (opcode == `OPCODE_ZERO));</span><br><span class="line">    <span class="comment">// // rs2：只有 R-type / B-type / S-type 用到</span></span><br><span class="line">    <span class="keyword">assign</span> rs2_used = (opcode == `OPCODE_RTYPE) || (opcode == `OPCODE_BTYPE) ||</span><br><span class="line">        (opcode == `OPCODE_STYPE);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// [HACK] Icarus Verilog 不支持 inside 语法糖 :(</span></span><br><span class="line">    <span class="comment">// assign rs1_used = !(opcode inside &#123;</span></span><br><span class="line">    <span class="comment">//     `OPCODE_LUI,</span></span><br><span class="line">    <span class="comment">//     `OPCODE_AUIPC,</span></span><br><span class="line">    <span class="comment">//     `OPCODE_JAL</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// assign rs2_used = (opcode inside &#123;</span></span><br><span class="line">    <span class="comment">//     `OPCODE_RTYPE,</span></span><br><span class="line">    <span class="comment">//     `OPCODE_BTYPE,</span></span><br><span class="line">    <span class="comment">//     `OPCODE_STYPE</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分支类型判断</span></span><br><span class="line">    <span class="comment">// 看funct3决定具体的分支类型</span></span><br><span class="line">    <span class="comment">// assign is_branch_instr = (opcode == `OPCODE_BTYPE);</span></span><br><span class="line">    <span class="comment">// assign branch_type = funct3;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALU 第一操作数来源</span></span><br><span class="line">    <span class="comment">// 判断是否为 AUIPC 指令即可</span></span><br><span class="line">    <span class="keyword">assign</span> is_auipc = (opcode == `OPCODE_AUIPC);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALU 第二操作数来源</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : alu_src_selection</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_RTYPE,</span><br><span class="line">            `OPCODE_BTYPE:  alu_src = `ALUSRC_RS2;  <span class="comment">// 来自寄存器 rs2</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_ITYPE,</span><br><span class="line">            `OPCODE_LTYPE,</span><br><span class="line">            `OPCODE_STYPE,</span><br><span class="line">            `OPCODE_AUIPC,</span><br><span class="line">            `OPCODE_JALR:</span><br><span class="line">                            alu_src = `ALUSRC_IMM;  <span class="comment">// 来自立即数</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:        alu_src = `ALUSRC_RS2;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 回写数据来源选择</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : wb_source_selection</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_RTYPE,</span><br><span class="line">            `OPCODE_ITYPE:  wd_sel = `WD_SEL_FROM_ALU;</span><br><span class="line"></span><br><span class="line">            `OPCODE_LTYPE:  wd_sel = `WD_SEL_FROM_DRAM;</span><br><span class="line"></span><br><span class="line">            `OPCODE_JAL,</span><br><span class="line">            `OPCODE_JALR:   wd_sel = `WD_SEL_FROM_PC4;</span><br><span class="line"></span><br><span class="line">            `OPCODE_LUI,</span><br><span class="line">            `OPCODE_AUIPC:  wd_sel = `WD_SEL_FROM_IEXT;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:        wd_sel = <span class="number">2&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 寄存器堆写使能</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : rf_write_enable</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_RTYPE,</span><br><span class="line">            `OPCODE_ITYPE,</span><br><span class="line">            `OPCODE_LTYPE,</span><br><span class="line">            `OPCODE_LUI,</span><br><span class="line">            `OPCODE_AUIPC,</span><br><span class="line">            `OPCODE_JAL,</span><br><span class="line">            `OPCODE_JALR:   rf_we = <span class="number">1&#x27;b1</span>;</span><br><span class="line"></span><br><span class="line">            `OPCODE_BTYPE,</span><br><span class="line">            `OPCODE_STYPE:  rf_we = <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:        rf_we = <span class="number">1&#x27;b0</span>;  <span class="comment">// 考虑异常情况 默认不写</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据存储器写使能</span></span><br><span class="line">    <span class="keyword">assign</span> dram_we = (opcode == `OPCODE_STYPE) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALU 操作码生成</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : ALUOp_selection</span><br><span class="line">        <span class="comment">// 默认值</span></span><br><span class="line">        alu_op          = `ALU_NOP;</span><br><span class="line">        branch_type     = `BRANCH_NOP;</span><br><span class="line">        is_branch_instr = <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line"></span><br><span class="line">            `OPCODE_RTYPE, `OPCODE_ITYPE: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_ADD_SUB_MUL:</span><br><span class="line">                    <span class="comment">// 使用 case-true 结构</span></span><br><span class="line">                        <span class="keyword">case</span> (<span class="number">1&#x27;b1</span>)</span><br><span class="line">                            (opcode == `OPCODE_RTYPE) &amp;&amp;        <span class="comment">// R-Type SUB</span></span><br><span class="line">                            (funct7 == `FUNCT7_SUB):</span><br><span class="line">                                            alu_op = `ALU_SUB;</span><br><span class="line"></span><br><span class="line">                            (opcode == `OPCODE_RTYPE):          <span class="comment">// R-Type 其它（默认为 ADD）</span></span><br><span class="line">                                            alu_op = `ALU_ADD;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">default</span>:                            <span class="comment">// 非 R-type（同样默认 ADD）</span></span><br><span class="line">                                            alu_op = `ALU_ADD;</span><br><span class="line">                        <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">                    `FUNCT3_SLL_MULH:       alu_op = `ALU_SLL;</span><br><span class="line">                    `FUNCT3_SLT_MULHSU:     alu_op = `ALU_SLT;</span><br><span class="line">                    `FUNCT3_SLTU_MULHU:     alu_op = `ALU_SLTU;</span><br><span class="line">                    `FUNCT3_XOR_DIV:        alu_op = `ALU_XOR;</span><br><span class="line">                    `FUNCT3_SRL_SRA_DIVU:   alu_op = (funct7 == `FUNCT7_SRA) ?</span><br><span class="line">                                                     `ALU_SRA : `ALU_SRL;</span><br><span class="line">                    `FUNCT3_OR_REM:         alu_op = `ALU_OR;</span><br><span class="line">                    `FUNCT3_AND_REMU:       alu_op = `ALU_AND;</span><br><span class="line">                    <span class="keyword">default</span>:                alu_op = `ALU_NOP;  <span class="comment">// 默认为空</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_BTYPE: <span class="keyword">begin</span></span><br><span class="line">                alu_op = (funct3 == `FUNCT3_BLTU || funct3 == `FUNCT3_BGEU) ? `ALU_SLTU :</span><br><span class="line">                    `ALU_SUB;  <span class="comment">// 用于比较是否为有符号/无符号</span></span><br><span class="line">                <span class="comment">// 判断分支类型</span></span><br><span class="line">                <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_BEQ:  branch_type = `BRANCH_BEQ;</span><br><span class="line">                    `FUNCT3_BNE:  branch_type = `BRANCH_BNE;</span><br><span class="line">                    `FUNCT3_BLT:  branch_type = `BRANCH_BLT;</span><br><span class="line">                    `FUNCT3_BGE:  branch_type = `BRANCH_BGE;</span><br><span class="line">                    `FUNCT3_BLTU: branch_type = `BRANCH_BLTU;</span><br><span class="line">                    `FUNCT3_BGEU: branch_type = `BRANCH_BGEU;</span><br><span class="line">                    <span class="keyword">default</span>:      branch_type = `BRANCH_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">                is_branch_instr = <span class="number">1&#x27;b1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_JAL,</span><br><span class="line">            `OPCODE_LUI:            alu_op = `ALU_RIGHT;  <span class="comment">// 特殊指令</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_JALR,</span><br><span class="line">            `OPCODE_AUIPC:          alu_op = `ALU_ADD;</span><br><span class="line"></span><br><span class="line">            `OPCODE_LTYPE: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_LB:     alu_op = `ALU_LB;</span><br><span class="line">                    `FUNCT3_LBU:    alu_op = `ALU_LBU;</span><br><span class="line">                    `FUNCT3_LH:     alu_op = `ALU_LH;</span><br><span class="line">                    `FUNCT3_LHU:    alu_op = `ALU_LHU;</span><br><span class="line">                    `FUNCT3_LW:     alu_op = `ALU_LW;</span><br><span class="line">                    <span class="keyword">default</span>:        alu_op = `ALU_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_STYPE: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_SB:     alu_op = `ALU_SB;</span><br><span class="line">                    `FUNCT3_SH:     alu_op = `ALU_SH;</span><br><span class="line">                    `FUNCT3_SW:     alu_op = `ALU_SW;</span><br><span class="line">                    <span class="keyword">default</span>:        alu_op = `ALU_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:                alu_op = `ALU_NOP;  <span class="comment">// 默认加法</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 数据存取类型判断</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : sl_selection</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_LTYPE: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_LB:     sl_type = `MEM_LB;</span><br><span class="line">                    `FUNCT3_LBU:    sl_type = `MEM_LBU;</span><br><span class="line">                    `FUNCT3_LH:     sl_type = `MEM_LH;</span><br><span class="line">                    `FUNCT3_LHU:    sl_type = `MEM_LHU;</span><br><span class="line">                    `FUNCT3_LW:     sl_type = `MEM_LW;</span><br><span class="line">                    <span class="keyword">default</span>:        sl_type = `MEM_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_STYPE:<span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_SB:     sl_type = `MEM_SB;</span><br><span class="line">                    `FUNCT3_SH:     sl_type = `MEM_SH;</span><br><span class="line">                    `FUNCT3_SW:     sl_type = `MEM_SW;</span><br><span class="line">                    <span class="keyword">default</span>:        sl_type = `MEM_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">default</span>:                sl_type = `MEM_NOP;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可视化输出判断</span></span><br><span class="line">    <span class="comment">//verilog_format:off</span></span><br><span class="line"><span class="meta">`<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">  <span class="comment">// 方便调试的 ASCII 指令输出</span></span><br><span class="line">  <span class="keyword">logic</span> [<span class="number">256</span>-<span class="number">1</span>:<span class="number">0</span>] instr_ascii;</span><br><span class="line">  <span class="keyword">logic</span> [<span class="number">256</span>-<span class="number">1</span>:<span class="number">0</span>] branch_type_ascii;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">always_comb</span> <span class="keyword">begin</span> : ascii_output</span><br><span class="line">    <span class="keyword">unique</span> <span class="keyword">case</span> (branch_type)</span><br><span class="line">      `BRANCH_NOP:        branch_type_ascii = <span class="string">&quot;BRANCH_NOP&quot;</span>;</span><br><span class="line">      `BRANCH_BEQ:        branch_type_ascii = <span class="string">&quot;BRANCH_BEQ&quot;</span>;</span><br><span class="line">      `BRANCH_BNE:        branch_type_ascii = <span class="string">&quot;BRANCH_BNE&quot;</span>;</span><br><span class="line">      `BRANCH_BLT:        branch_type_ascii = <span class="string">&quot;BRANCH_BLT&quot;</span>;</span><br><span class="line">      `BRANCH_BGE:        branch_type_ascii = <span class="string">&quot;BRANCH_BGE&quot;</span>;</span><br><span class="line">      `BRANCH_BLTU:       branch_type_ascii = <span class="string">&quot;BRANCH_BLTU&quot;</span>;</span><br><span class="line">      `BRANCH_BGEU:       branch_type_ascii = <span class="string">&quot;BRANCH_BGEU&quot;</span>;</span><br><span class="line">      `BRANCH_JALR:       branch_type_ascii = <span class="string">&quot;BRANCH_JALR&quot;</span>;</span><br><span class="line">      <span class="keyword">default</span>:            branch_type_ascii = <span class="string">&quot;BRANCH_UNKNOWN&quot;</span>;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line">    <span class="comment">// 判断当前具体为32条基本指令的哪一条</span></span><br><span class="line">    <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">      `OPCODE_LUI:              instr_ascii = <span class="string">&quot;LUI&quot;</span>;</span><br><span class="line">      `OPCODE_AUIPC:            instr_ascii = <span class="string">&quot;AUIPC&quot;</span>;</span><br><span class="line">      `OPCODE_JAL:              instr_ascii = <span class="string">&quot;JAL&quot;</span>;</span><br><span class="line">      `OPCODE_JALR:             instr_ascii = <span class="string">&quot;JALR&quot;</span>;</span><br><span class="line"></span><br><span class="line">      `OPCODE_BTYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_BEQ:          instr_ascii = <span class="string">&quot;BEQ&quot;</span>;</span><br><span class="line">          `FUNCT3_BNE:          instr_ascii = <span class="string">&quot;BNE&quot;</span>;</span><br><span class="line">          `FUNCT3_BLT:          instr_ascii = <span class="string">&quot;BLT&quot;</span>;</span><br><span class="line">          `FUNCT3_BGE:          instr_ascii = <span class="string">&quot;BGE&quot;</span>;</span><br><span class="line">          `FUNCT3_BLTU:         instr_ascii = <span class="string">&quot;BLTU&quot;</span>;</span><br><span class="line">          `FUNCT3_BGEU:         instr_ascii = <span class="string">&quot;BGEU&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;B_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      `OPCODE_LTYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_LB:           instr_ascii = <span class="string">&quot;LB&quot;</span>;</span><br><span class="line">          `FUNCT3_LH:           instr_ascii = <span class="string">&quot;LH&quot;</span>;</span><br><span class="line">          `FUNCT3_LW:           instr_ascii = <span class="string">&quot;LW&quot;</span>;</span><br><span class="line">          `FUNCT3_LBU:          instr_ascii = <span class="string">&quot;LBU&quot;</span>;</span><br><span class="line">          `FUNCT3_LHU:          instr_ascii = <span class="string">&quot;LHU&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;L_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      `OPCODE_STYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_SB:           instr_ascii = <span class="string">&quot;SB&quot;</span>;</span><br><span class="line">          `FUNCT3_SH:           instr_ascii = <span class="string">&quot;SH&quot;</span>;</span><br><span class="line">          `FUNCT3_SW:           instr_ascii = <span class="string">&quot;SW&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;S_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      `OPCODE_ITYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_ADD_SUB_MUL:  instr_ascii = <span class="string">&quot;ADDI&quot;</span>;</span><br><span class="line">          `FUNCT3_SLL_MULH:     instr_ascii = <span class="string">&quot;SLLI&quot;</span>;</span><br><span class="line">          `FUNCT3_SLT_MULHSU:   instr_ascii = <span class="string">&quot;SLTI&quot;</span>;</span><br><span class="line">          `FUNCT3_SLTU_MULHU:   instr_ascii = <span class="string">&quot;SLTIU&quot;</span>;</span><br><span class="line">          `FUNCT3_XOR_DIV:      instr_ascii = <span class="string">&quot;XORI&quot;</span>;</span><br><span class="line">          `FUNCT3_SRL_SRA_DIVU: instr_ascii = (funct7 == `FUNCT7_SRAI) ? <span class="string">&quot;SRAI&quot;</span> : <span class="string">&quot;SRLI&quot;</span>;</span><br><span class="line">          `FUNCT3_OR_REM:       instr_ascii = <span class="string">&quot;ORI&quot;</span>;</span><br><span class="line">          `FUNCT3_AND_REMU:     instr_ascii = <span class="string">&quot;ANDI&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;I_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      `OPCODE_RTYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_ADD_SUB_MUL: <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (funct7 == `FUNCT7_SUB)</span><br><span class="line">                                instr_ascii = <span class="string">&quot;SUB&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (funct7 == `FUNCT7_ADD)</span><br><span class="line">                                instr_ascii = <span class="string">&quot;ADD&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span>                instr_ascii = <span class="string">&quot;R_UNKNOWN&quot;</span>;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          `FUNCT3_SLL_MULH:     instr_ascii = <span class="string">&quot;SLL&quot;</span>;</span><br><span class="line">          `FUNCT3_SLT_MULHSU:   instr_ascii = <span class="string">&quot;SLT&quot;</span>;</span><br><span class="line">          `FUNCT3_SLTU_MULHU:   instr_ascii = <span class="string">&quot;SLTU&quot;</span>;</span><br><span class="line">          `FUNCT3_XOR_DIV:      instr_ascii = <span class="string">&quot;XOR&quot;</span>;</span><br><span class="line">          `FUNCT3_SRL_SRA_DIVU: <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (funct7 == `FUNCT7_SRA)</span><br><span class="line">                                instr_ascii = <span class="string">&quot;SRA&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (funct7 == `FUNCT7_SRL)</span><br><span class="line">                                instr_ascii = <span class="string">&quot;SRL&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span>                instr_ascii = <span class="string">&quot;R_UNKNOWN&quot;</span>;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          `FUNCT3_OR_REM:       instr_ascii = <span class="string">&quot;OR&quot;</span>;</span><br><span class="line">          `FUNCT3_AND_REMU:     instr_ascii = <span class="string">&quot;AND&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;R_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">default</span>:                  instr_ascii = <span class="string">&quot;ERROR&quot;</span>;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="meta">`<span class="keyword">endif</span></span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="立即数扩展模块-imm-extener-sv">立即数扩展模块 imm_extener.sv</h3><p>立即数扩展模块也是<strong>组合逻辑模块</strong>。不需要接受译码器传出的信号，而是和译码器并行工作，同样接受32位指令<code>instr</code>后进行分类处理。当然可以写在<code>Decoder.v</code>，但是那样子有点乱。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> imm_extender (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instr,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm_out</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] opcode;</span><br><span class="line">    <span class="keyword">assign</span> opcode = instr[<span class="number">6</span>:<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : imm_classifier</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_ITYPE, `OPCODE_LTYPE, `OPCODE_JALR: <span class="keyword">begin</span>  <span class="comment">// I-type</span></span><br><span class="line">                <span class="comment">// 先输出立即数</span></span><br><span class="line">                <span class="comment">// 之后再根据 instr[30] 区分 SLLI/SRLI和SRAI</span></span><br><span class="line">                imm_out = &#123;&#123;<span class="number">20</span>&#123;instr[<span class="number">31</span>]&#125;&#125;, instr[<span class="number">31</span>:<span class="number">20</span>]&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            `OPCODE_BTYPE: <span class="keyword">begin</span>  <span class="comment">// B-type</span></span><br><span class="line">                imm_out = &#123;&#123;<span class="number">20</span>&#123;instr[<span class="number">31</span>]&#125;&#125;, instr[<span class="number">7</span>], instr[<span class="number">30</span>:<span class="number">25</span>], instr[<span class="number">11</span>:<span class="number">8</span>], <span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            `OPCODE_JAL: <span class="keyword">begin</span>  <span class="comment">// J-type</span></span><br><span class="line">                imm_out = &#123;&#123;<span class="number">12</span>&#123;instr[<span class="number">31</span>]&#125;&#125;, instr[<span class="number">19</span>:<span class="number">12</span>], instr[<span class="number">20</span>], instr[<span class="number">30</span>:<span class="number">21</span>], <span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            `OPCODE_STYPE: <span class="keyword">begin</span>  <span class="comment">// S-type</span></span><br><span class="line">                imm_out = &#123;&#123;<span class="number">20</span>&#123;instr[<span class="number">31</span>]&#125;&#125;, instr[<span class="number">31</span>:<span class="number">25</span>], instr[<span class="number">11</span>:<span class="number">7</span>]&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            `OPCODE_AUIPC, `OPCODE_LUI: <span class="keyword">begin</span>  <span class="comment">// U-type</span></span><br><span class="line">                imm_out = &#123;instr[<span class="number">31</span>:<span class="number">12</span>], <span class="number">12&#x27;b0</span>&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">begin</span></span><br><span class="line">                imm_out = <span class="number">32&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>当然，你也完全可以只传递PC然后再EX级进行移位，或者干脆合并进ALU。但是，流水线延迟最大的一级往往就是EX级，应当尽可能地减轻其负担。所以，将移位器往前移、未来的存取单元往后移。</p><h2 id="ID-EX级流水线寄存器-PR-ID-EX-sv">ID/EX级流水线寄存器 PR_ID_EX.sv</h2><p>终于，要进入下一阶段了。ID/EX级的流水线寄存器可谓是相当重要，重要性仅次于EX/MEM级，因为这一级中转了各类数据以及地址——还有未来的数据前递入口。</p><p>我们要接收译码器传出的各种控制信号，包括ALU的操作数来源<code>is_auipc</code>和<code>alu_src</code>。根据译码器判断，对于S-Type指令，在MEM级还需要写入DRAM，因此还有写使能<code>dram_we</code>，或者是寄存器写使能<code>rf_we</code>。</p><p>还有什么？别忘了判断指令存取类型的<code>sl_type</code>，后面需要在MEM级用到。</p><div class="note warning flat"><p>即使RISC-V不强制要求支持非对齐访存，<code>lb/lh</code>等指令也必须支持！</p></div><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> PR_ID_EX (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// 流水线控制信号</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        flush,</span><br><span class="line">    <span class="comment">// ID级输入</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_id_i,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_id_i,</span><br><span class="line">    <span class="comment">// input  logic [31:0] instr_id_i,</span></span><br><span class="line">    <span class="comment">// ID级输出 给EX级输入</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_ex_o,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_ex_o,</span><br><span class="line">    <span class="comment">// output logic [31:0] instr_ex_o,</span></span><br><span class="line">    <span class="comment">// 判断指令是否有效</span></span><br><span class="line">    <span class="comment">// 流水线冲刷时需要将指令置为无效</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        instr_valid_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        instr_valid_ex_o,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 寄存器堆第一寄存器数据</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD1_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD1_o,</span><br><span class="line">    <span class="comment">// 寄存器堆第二寄存器数据</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD2_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD2_o,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALUOp</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] alu_op_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] alu_op_ex_o,</span><br><span class="line">    <span class="comment">// ALU第一操作数来源 判断AUIPC</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        is_auipc_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        is_auipc_ex_o,</span><br><span class="line">    <span class="comment">// ALU第二操作数来源</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        alu_src2_sel_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        alu_src2_sel_ex_o,</span><br><span class="line">    <span class="comment">// 写使能</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        dram_we_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        dram_we_ex_o,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rf_we_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rf_we_ex_o,</span><br><span class="line">    <span class="comment">// 写回数据来源</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel_ex_o,</span><br><span class="line">    <span class="comment">// 写回寄存器地址</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wr_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wr_ex_o,</span><br><span class="line">    <span class="comment">// 分支跳转</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        is_branch_instr_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        is_branch_instr_ex_o,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">2</span>:<span class="number">0</span>] branch_type_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">2</span>:<span class="number">0</span>] branch_type_ex_o,</span><br><span class="line">    <span class="comment">// 跳转相关</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] jump_type_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] jump_type_ex_o,</span><br><span class="line">    <span class="comment">// 读取类型</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">3</span>:<span class="number">0</span>] sl_type_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">3</span>:<span class="number">0</span>] sl_type_ex_o,</span><br><span class="line">    <span class="comment">// 立即数</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm_ex_o,</span><br><span class="line">    <span class="comment">// PC跳转时地址</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_jump_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_jump_ex_o,</span><br><span class="line">    <span class="comment">// 加上前递相关</span></span><br><span class="line">    <span class="keyword">input</span>               fwd_rD1e_EX,</span><br><span class="line">    <span class="keyword">input</span>               fwd_rD2e_EX,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] fwd_rD1_EX,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] fwd_rD2_EX</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前递信号与数据</span></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD1_forwarded, rD2_forwarded;</span><br><span class="line">    <span class="comment">// 考虑了前递就不需要冲刷了</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        rD1_forwarded = fwd_rD1e_EX ? fwd_rD1_EX : rD1_i;</span><br><span class="line">        rD2_forwarded = fwd_rD2e_EX ? fwd_rD2_EX : rD2_i;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 寄存器堆数据</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            rD1_o &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            rD2_o &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            rD1_o &lt;= rD1_forwarded;</span><br><span class="line">            rD2_o &lt;= rD2_forwarded;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分支跳转相关</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            is_branch_instr_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            branch_type_ex_o     &lt;= <span class="number">3&#x27;b0</span>;</span><br><span class="line">            jump_type_ex_o       &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush) <span class="keyword">begin</span></span><br><span class="line">            is_branch_instr_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            branch_type_ex_o     &lt;= <span class="number">3&#x27;b0</span>;</span><br><span class="line">            jump_type_ex_o       &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            is_branch_instr_ex_o &lt;= is_branch_instr_id_i;</span><br><span class="line">            branch_type_ex_o     &lt;= branch_type_id_i;</span><br><span class="line">            jump_type_ex_o       &lt;= jump_type_id_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALUOp相关</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            alu_op_ex_o       &lt;= <span class="number">4&#x27;b0</span>;</span><br><span class="line">            is_auipc_ex_o     &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            alu_src2_sel_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            dram_we_ex_o      &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            sl_type_ex_o      &lt;= <span class="number">3&#x27;b0</span>;</span><br><span class="line">            imm_ex_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush) <span class="keyword">begin</span></span><br><span class="line">            alu_op_ex_o       &lt;= <span class="number">4&#x27;b0</span>;</span><br><span class="line">            is_auipc_ex_o     &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            alu_src2_sel_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            dram_we_ex_o      &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            sl_type_ex_o      &lt;= sl_type_id_i;</span><br><span class="line">            imm_ex_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            alu_op_ex_o       &lt;= alu_op_id_i;</span><br><span class="line">            is_auipc_ex_o     &lt;= is_auipc_id_i;</span><br><span class="line">            alu_src2_sel_ex_o &lt;= alu_src2_sel_id_i;</span><br><span class="line">            dram_we_ex_o      &lt;= dram_we_id_i;</span><br><span class="line">            sl_type_ex_o      &lt;= sl_type_id_i;</span><br><span class="line">            imm_ex_o          &lt;= imm_id_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写回来源</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            pc_ex_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            pc4_ex_o         &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_valid_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">            rf_we_ex_o       &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            wd_sel_ex_o      &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">            pc_jump_ex_o     &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush &amp;&amp; pc_id_i) <span class="keyword">begin</span>  <span class="comment">// 确保不是因为流水线暂停引起的冲刷</span></span><br><span class="line">            pc_ex_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            pc4_ex_o         &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_valid_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">            rf_we_ex_o       &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            wd_sel_ex_o      &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">            pc_jump_ex_o     &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            pc_ex_o          &lt;= pc_id_i;</span><br><span class="line">            pc4_ex_o         &lt;= pc4_id_i;</span><br><span class="line">            instr_valid_ex_o &lt;= instr_valid_id_i;</span><br><span class="line"></span><br><span class="line">            rf_we_ex_o       &lt;= rf_we_id_i;</span><br><span class="line">            wd_sel_ex_o      &lt;= wd_sel_id_i;</span><br><span class="line">            pc_jump_ex_o     &lt;= pc_jump_id_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写回寄存器地址</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            wr_ex_o &lt;= <span class="number">5&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush) <span class="keyword">begin</span></span><br><span class="line">            wr_ex_o &lt;= <span class="number">5&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            wr_ex_o &lt;= wr_id_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>至此，ID级也构建完成了。后面的，就是复杂的计算、疯狂的前递、吉列的<s>数据</s>斗争了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;译码-ID级-设计&quot;&gt;译码 ID级 设计&lt;/h2&gt;
&lt;p&gt;提到译码级，那就得是译码器啊。纯组合逻辑，包你写到爽。&lt;/p&gt;
&lt;p&gt;译码级还有什么？立即数移位也需要放在ID级，以减轻EX级</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="嵌入式" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="计算机原理" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>从零开始学RISC：第四篇</title>
    <link href="https://blog.esing.dev/2025/12/05/riscvcod-p4/"/>
    <id>https://blog.esing.dev/2025/12/05/riscvcod-p4/</id>
    <published>2025-12-05T15:02:05.000Z</published>
    <updated>2025-12-09T14:19:53.855Z</updated>
    
    <content type="html"><![CDATA[<h2 id="从零构建前的准备">从零构建前的准备</h2><h3 id="设计思路">设计思路</h3><p>理论知识已经准备好了，接下来该开始实践了。</p><p>如何从零开始写一个CPU？</p><p>首先要明确ISA架构：我们需要支持哪些指令？RV32的拓展很多很多，比如<code>MIAFD</code>等等。我们可以实现一个“精简版”的<code>RV32I</code>指令集CPU——连里面的<code>ecall</code>和<code>ebreak</code>都不实现。只要满足基础的38条（甚至只支持<code>lw/sw</code>，不考虑非对齐访存），就能运行80%的C语言程序。至于<code>Zicsr</code>扩展和<code>M</code>扩展等，在构建完毕后再考虑。</p><p>然后，是微架构设计：是做单周期还是多周期，亦或者流水线？是做顺序还是乱序？单发射还是多发射？饭要一口口吃，步子迈太大了容易扯着蛋。因此，做一个经典的五级流水线、顺序单发射的CPU即可。</p><p>然后，保持一个清醒的头脑。即使是一个最简单的<code>RV32I</code>CPU，也需要不下于10个模块。所有的代码加起来可能连3000行都不到，但是其中的连线无比复杂。如果不在写之前就想好，很容易莫名其妙地丢掉一条连线、一个端口，然后看波形debug半天。</p><p>时刻要记住：切不可“只见树木、不见森林”——不建议一个一个模块写，而是创建好文件后问自己：</p><ul><li>这个模块的功能是什么？</li><li>这个模块是组合逻辑电路还是时序逻辑电路？</li><li>这个模块需要哪些控制信号？</li><li>这个模块需要输出什么数据？输出给谁？</li></ul><p>边考虑这些问题边创建文件，然后，类似参考书上的指导，构建数据通路。可以不写出来，但要想清楚，哪些数据会在寄存器之间流动，并被传递到下一级流水线。等每个文件的大体框架搭建完毕，再从易到难、从组合逻辑到时序逻辑完成。一级一级流水线向前推进，写完某一级后继续完成两级之间的流水线寄存器设计。</p><h3 id="参考资料">参考资料</h3><p><a href="https://github.com/xuanhao44/HITSZ-miniRVCPU">xuanhao44 - HITSZ-miniRVCPU</a></p><h3 id="开发环境">开发环境</h3><p>参考 <a href="/2024/01/18/vscode-verilog-setup/" title="VSCode配置Verilog开发环境">VSCode配置Verilog开发环境</a> 即可。</p><div class="note primary flat"><p>这里安利一下一个超级棒的的VSCode插件：<a href="https://marketplace.visualstudio.com/items?itemName=sterben.fpga-support">Digital IDE</a></p><p>内部集成了一件模块测试、代码高亮与格式化、快速跳转等。虽然生成模块图的功能有些BUG，但是依旧非常强，瑕不掩瑜！</p><p>现在写Verilog都用它了。绝赞！</p></div><h2 id="取指-IF级-设计">取指 IF级 设计</h2><p>IF级取出指令，因此模块很少，只要实现PC程序计数器和IROM即可。</p><h3 id="程序计数器-PC-sv">程序计数器 PC.sv</h3><p>显然，程序计数器是<strong>时序逻辑模块</strong>。这里将<code>PC+4</code>的计算也合并到PC模块内。</p><p>程序计数器要干什么？既要计算出下一时刻的PC，还要考虑是否发生分支跳转——这里要接受来自<code>EX</code>级的跳转发生信号，因为B-Type类指令到<code>EX</code>级才能得出结果。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PC (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// 是否要打一拍 保持PC </span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        keep_pc,</span><br><span class="line">    <span class="comment">// 进行分支跳转</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        branch_op,</span><br><span class="line">    <span class="comment">// 分支跳转目标地址</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] branch_target,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_if,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_if</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] npc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        pc4_if = pc_if + <span class="number">4</span>;</span><br><span class="line">        npc    = branch_op ? branch_target : pc4_if;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n)       pc_if &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (keep_pc) pc_if &lt;= pc_if;</span><br><span class="line">        <span class="keyword">else</span>              pc_if &lt;= npc;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="指令存储器-IROM-sv">指令存储器 IROM.sv</h3><p>IROM即存放程序代码的Flash，只读，不依赖任何时钟信号，因此是<strong>组合逻辑模块</strong>。通常来说，IROM（指令存储器）会被放在译码级，但不自行封装时，我们也会给CPU接出<code>instr</code>和<code>pc</code>到厂商的 IROM IP核。为了方便思考，此处放在IF级即可。为了便于仿真，这里自己实现一个支持加载hex文件的IROM。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IROM 行为模型 - 用于仿真</span></span><br><span class="line"><span class="comment">// 替代 Xilinx IP 核</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> IROM (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">wire</span> [<span class="number">13</span>:<span class="number">0</span>] a,   <span class="comment">// 地址输入 (14位 = 16K words)</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span>  [<span class="number">31</span>:<span class="number">0</span>] spo  <span class="comment">// 数据输出</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 指令存储器 - 16K x 32bit</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] rom_data[<span class="number">16384</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从文件加载指令</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">integer</span> i;</span><br><span class="line">        <span class="keyword">string</span>  rom_file;  <span class="comment">// 字符串缓冲区</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16384</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// rom_data[i] = 32&#x27;h00000013;  // NOP</span></span><br><span class="line">            rom_data[i] = <span class="number">32&#x27;h0d000721</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 尝试从文件加载指令</span></span><br><span class="line">        <span class="comment">// if ($value$plusargs(&quot;IROM=%s&quot;, rom_file)) begin</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            rom_file =</span><br><span class="line">            <span class="comment">// &quot;user/data/hex/simple_test.hex&quot;</span></span><br><span class="line">            <span class="string">&quot;user/data/hex/jalr.hex&quot;</span></span><br><span class="line">            <span class="comment">// &quot;user/data/hex/myFirstTest.hex&quot;</span></span><br><span class="line">            <span class="comment">// &quot;user/data/hex/no_hazard.hex&quot;</span></span><br><span class="line">            <span class="comment">// &quot;user/data/hex/loaduse_test.hex&quot;</span></span><br><span class="line">            <span class="comment">// &quot;user/data/hex/hazard12.hex&quot;</span></span><br><span class="line">            ;</span><br><span class="line">            <span class="built_in">$readmemh</span>(rom_file, rom_data);</span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;IROM: Loaded instructions from %s&quot;</span>, rom_file);</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// 如果没有指定文件,加载默认的测试程序</span></span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;IROM: Loading default test program&quot;</span>);</span><br><span class="line">            load_default_program();</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取数据 (组合逻辑)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        spo = rom_data[a];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加载默认测试程序</span></span><br><span class="line">    <span class="keyword">task</span> <span class="keyword">automatic</span> load_default_program;</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// 更复杂的测试程序 - 测试算术、逻辑、移位指令和数据冒险</span></span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;IROM: Default test program loaded&quot;</span>);</span><br><span class="line">            rom_data[<span class="number">0</span>] = <span class="number">32&#x27;h00500093</span>;  <span class="comment">// addi x1, x0, 5      x1 = 5</span></span><br><span class="line">            rom_data[<span class="number">1</span>] = <span class="number">32&#x27;h00300113</span>;  <span class="comment">// addi x2, x0, 3      x2 = 3</span></span><br><span class="line">            rom_data[<span class="number">2</span>] = <span class="number">32&#x27;h002081b3</span>;  <span class="comment">// add  x3, x1, x2     x3 = x1 + x2 = 8</span></span><br><span class="line">            rom_data[<span class="number">3</span>] = <span class="number">32&#x27;h40208233</span>;  <span class="comment">// sub  x4, x1, x2     x4 = x1 - x2 = 2</span></span><br><span class="line">            rom_data[<span class="number">4</span>] = <span class="number">32&#x27;h0020f2b3</span>;  <span class="comment">// and  x5, x1, x2     x5 = x1 &amp; x2 = 1</span></span><br><span class="line">            rom_data[<span class="number">5</span>] = <span class="number">32&#x27;h0020e333</span>;  <span class="comment">// or   x6, x1, x2     x6 = x1 | x2 = 7</span></span><br><span class="line">            rom_data[<span class="number">6</span>] = <span class="number">32&#x27;h002093b3</span>;  <span class="comment">// sll  x7, x1, x2     x7 = x1 &lt;&lt; x2 = 40</span></span><br><span class="line">            rom_data[<span class="number">7</span>] = <span class="number">32&#x27;h0020c433</span>;  <span class="comment">// xor  x8, x1, x2     x8 = x1 ^ x2 = 6</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endtask</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>hex文件加载方式可以选择手动指定路径，也可以选择编译时传入，后者配合Makefile文件很方便，不过我选择DIDE的一键仿真。</p><h2 id="IF-ID级流水线寄存器-PR-IF-IF-sv">IF/ID级流水线寄存器 PR_IF_IF.sv</h2><p>终于到了第一道坎：两级之间的流水线寄存器。</p><p>流水线寄存器起到一个承上启下的作用，在两个阶段之间保存数据，使得指令可以连续执行。</p><p>都寄存器了，那肯定是<strong>时序逻辑模块</strong>了。</p><p>我们需要哪些信号？</p><p>首先是<code>PC</code>和<code>PC+4</code>，其中<code>PC+4</code>因为分支跳转和<code>jal/jalr</code>指令的需求，要一直送到<code>EX</code>级。接着是当前的指令，要送入下一级的译码器。</p><p>还有什么？我们肯定需要处理流水线的竞争冒险，而不能简单打一拍——就算打一拍，也要有相应的控制信号。因此，还需要<code>flush</code>和<code>stall</code>这两个控制信号，来控制IF级是否冲刷、是否停顿。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;./<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> PR_IF_ID (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// 流水线控制信号</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        flush,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        stall,</span><br><span class="line">    <span class="comment">// IF级输入</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_if_i,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_if_i,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instr_if_i,</span><br><span class="line">    <span class="comment">// IF级输出 给ID级输入</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_id_o,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_id_o,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instr_id_o,</span><br><span class="line">    <span class="comment">// 判断指令是否有效</span></span><br><span class="line">    <span class="comment">// 流水线冲刷时需要将指令置为无效</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        instr_valid_if_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        instr_valid_id_o</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            pc_id_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            pc4_id_o         &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_id_o       &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_valid_id_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush) <span class="keyword">begin</span></span><br><span class="line">            pc_id_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            pc4_id_o         &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_id_o       &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_valid_id_o &lt;= <span class="number">1&#x27;b0</span>;  <span class="comment">// 冲刷时指令无效</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (stall) <span class="keyword">begin</span></span><br><span class="line">            pc_id_o          &lt;= pc_id_o;</span><br><span class="line">            pc4_id_o         &lt;= pc4_id_o;</span><br><span class="line">            instr_id_o       &lt;= instr_id_o;</span><br><span class="line">            instr_valid_id_o &lt;= instr_valid_id_o;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            pc_id_o          &lt;= pc_if_i;</span><br><span class="line">            pc4_id_o         &lt;= pc4_if_i;</span><br><span class="line">            instr_id_o       &lt;= instr_if_i;</span><br><span class="line">            instr_valid_id_o &lt;= instr_valid_if_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>至此，IF级完毕。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;从零构建前的准备&quot;&gt;从零构建前的准备&lt;/h2&gt;
&lt;h3 id=&quot;设计思路&quot;&gt;设计思路&lt;/h3&gt;
&lt;p&gt;理论知识已经准备好了，接下来该开始实践了。&lt;/p&gt;
&lt;p&gt;如何从零开始写一个CPU</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="嵌入式" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="计算机原理" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>Cloudflare、睡覺——大规模宕机后的随想</title>
    <link href="https://blog.esing.dev/2025/11/18/cloudflare-offline-oneday/"/>
    <id>https://blog.esing.dev/2025/11/18/cloudflare-offline-oneday/</id>
    <published>2025-11-18T14:45:37.000Z</published>
    <updated>2025-11-19T02:56:36.593Z</updated>
    
    <content type="html"><![CDATA[<div class="note orange icon-padding flat"><i class="note-icon fab fa-cloudflare"></i><p>写于2025.11.18，纪念 Cloudflare 发生的大规模故障。</p></div><p>今年真是个多事之年啊。</p><p>开着组会呢，网站突然就打不开了，接着就是熟悉的小黄云500。还以为是源站挂了，随即关了浏览器再开。好家伙，GPT也卡在前面的Cloudflare Challenge 认证界面。这才意识到：Cloudflare，大抵是又<strong>炸</strong>了。而这，已经是今年的第三次了。</p><p><strong>网络菩萨、赛博义父，终究要顶不住这泼天的“流量”了吗。</strong></p><hr><p>翻了下Telegram，几乎所有群组都炸锅了：“Cloudflare” “宕机” “攻击” 的字样层出不穷。谁也不知道，究竟是一个员工的无心之举，还是一个部门的一次部署失误，亦或是什么组织的大规模网络攻击，导致了这一场灾难。微信群里同样炸了锅：同学嚷嚷着自己看文献的网站打不开、ChatGPT进不去……就连我的博客和一系列Cloudflare Workers服务也没能幸免于难，只剩下了前几天新搭建的 <a href="/2025/10/31/onelastkiss-image/" title="One Last Kiss 风格图片生成">OneLastKiss生成器</a> 还活着 TuT</p><p>看着<a href="https://www.cloudflarestatus.com/">Cloudflare Status</a>那色彩缤纷的<span style="color:#DA304C;">三</span><span style="color:#FBAE40;">色</span><span style="color:#2C7CB0;">条</span>，我不由得希望，今年结束之前不要再见到它。</p><img src="https://webp.esing.dev/img/-6116001428162677917_119_251118_2311_fD5D.jpg" alt="MJJ最不想看见的颜色（笑）" style="zoom:25%;" /><p>过了几分钟，就连监控Cloudflare状态的<a href="https://www.cloudflarestatus.com/">Cloudflare Status</a>也炸了。</p><img src="https://webp.esing.dev/img/-6116318431108861140_119_251118_2307_bqC2.jpg" alt="彻底爆炸的Cloudflare Status" style="zoom:25%;" /><p>不过还有一部分企业网站幸免于难，比如<a href="https://csgo.com/">CSGO国际官网</a>，可能是Enterprise有着不同线路？毕竟ChatGPT挂掉的也只是人机验证部分。这么算来，粗略估算的话，世界上有<strong>五分之一</strong>的网站应该都受到了影响——从DNS到静态页面托管，再到反向代理。不愧是你，Cloudflare。</p><hr><p>在两个小时后，22:50，官方终于发消息称修复完毕。<a href="https://t.me/vps_xhq/766">VPS信号旗播报</a>也给到了<span style="color:#FBAE40;">Level B</span>的重要等级。只能说小老弟还得多练，想达到你谷哥<a href="https://t.me/vps_xhq/161">以前</a>的<span style="color:#DA304C;">Level A</span>还有很长的路呢。</p><hr><p>我想到了《球状闪电》。</p><p><em><strong>“摧毁芯片的宏聚变可以使地球这块大硬盘被格式化，越先进的国家受到的打击就越大。而在向信息时代的恢复过程中，将出现一个不确定的全新的世界格局。”</strong></em></p><p>倘若真有一日，互联网全部瘫痪——或是更严重，如同《全频段阻塞干扰》那样——人类的生活会怎么样？<strong>是于废墟中携手重建往日的信息时代，还是借混乱之时重建各自渴望的世界格局？</strong></p><hr><p>一觉醒来，Cloudflare也发了<a href="https://blog.cloudflare.com/18-november-2025-outage/">官方声明</a>，解释本次故障原因：</p><blockquote><p>故障是由于工程师更改了一个数据库系统的权限所引发的。该设置会导致数据库向 Bot 管理系统所使用的“特征文件（feature file）”中输出多重条目，进而导致该特征文件的大小翻了一番。随后，有问题的特征文件被分发到了网络中的所有机器上。</p><p>网络中的设备软件对特征文件的大小设定了上限，而翻倍后的文件超过了这一限制，导致软件崩溃。</p></blockquote><p>Cloudflare 一度怀疑这是由超大规模 DDoS 攻击引起的，但很快锁定了核心问题，成功阻止了体积异常的特征文件进一步传播。将其替换为该文件的早期版本后核心流量基本恢复正常流转。但随着流量重新涌入，Cloudflare 最终耗费了数小时来缓解网络各部分增加的负载。</p><p>果然是工程师的误操作导致的，唉草台班子 ^__^。不知道工程师是不是被拉去祭天了？这每秒损失可不是挖断国防光缆能比的。</p>]]></content>
    
    
    <summary type="html">写于2025.11.18，纪念 Cloudflare 发生的大规模故障。</summary>
    
    
    
    <category term="随笔" scheme="https://blog.esing.dev/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="Cloudflare" scheme="https://blog.esing.dev/tags/Cloudflare/"/>
    
    <category term="代理" scheme="https://blog.esing.dev/tags/%E4%BB%A3%E7%90%86/"/>
    
    <category term="Workers" scheme="https://blog.esing.dev/tags/Workers/"/>
    
  </entry>
  
  <entry>
    <title>更适合Powershell体质的ln</title>
    <link href="https://blog.esing.dev/2025/11/17/powershell-ln/"/>
    <id>https://blog.esing.dev/2025/11/17/powershell-ln/</id>
    <published>2025-11-17T06:13:32.000Z</published>
    <updated>2025-11-17T06:22:14.360Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>在<a href="/2025/10/20/powershell-grep/" title="更适合Powershell体质的grep">更适合Powershell体质的grep</a>中重定义了<code>grep</code>。Linux中的<code>ln</code>命令也非常好用，创建软链接，可以省下很多需要复用的文件空间。</p><p>没想到Powershell中没办法使用cmd的<code>mklink</code>，自带的创建软连接命令比我命还长。自己写一个脚本重定向！</p><h2 id="代码">代码</h2><p>因为不能执行cmd命令，只能使用Powershell函数，因此新建一个<code>ln.psm1</code>模块，并保存到<code>C:\Users\UserName\Documents\PowerShell\Modules\ln</code>，在Powershell初始化时导入即可。</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ln</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$d</span>,      <span class="comment"># -d: 强制目录链接</span></span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$h</span>,      <span class="comment"># -h: 显示帮助</span></span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$target</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$link</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ======== 彩色帮助 ========</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$h</span> <span class="operator">-or</span> <span class="operator">-not</span> <span class="variable">$target</span> <span class="operator">-or</span> <span class="operator">-not</span> <span class="variable">$link</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span>  <span class="comment"># 空行</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;ln: create symbolic link &quot;</span> <span class="literal">-ForegroundColor</span> Cyan <span class="literal">-NoNewline</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;(PowerShell version)&quot;</span> <span class="literal">-ForegroundColor</span> DarkGray</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Usage:&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  ln [-d] &lt;target&gt; &lt;link&gt;&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Options:&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  -d        create directory symbolic link&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  -h        display this help&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Examples:&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  ln C:\real\file.txt C:\link\file.txt&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  ln C:\realDir C:\linkDir&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  ln -d C:\realDir C:\linkDir&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ======== 参数检查 ========</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="variable">$target</span>)) &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;ln: target &#x27;<span class="variable">$target</span>&#x27; not found&quot;</span> <span class="literal">-ForegroundColor</span> Red</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ======== 设置类型（SymbolicLink）========</span></span><br><span class="line">    <span class="variable">$itemType</span> = <span class="string">&quot;SymbolicLink&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ======== 创建符号链接 ========</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">New-Item</span> <span class="literal">-ItemType</span> <span class="variable">$itemType</span> <span class="literal">-Path</span> <span class="variable">$link</span> <span class="literal">-Target</span> <span class="variable">$target</span> | <span class="built_in">Out-Null</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;ln: created symbolic link &quot;</span> <span class="literal">-ForegroundColor</span> Cyan <span class="literal">-NoNewline</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&#x27;<span class="variable">$link</span>&#x27;&quot;</span> <span class="literal">-ForegroundColor</span> Green <span class="literal">-NoNewline</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot; → &quot;</span> <span class="literal">-ForegroundColor</span> DarkGray <span class="literal">-NoNewline</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&#x27;<span class="variable">$target</span>&#x27;&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;ln: failed to create link: <span class="variable">$</span>(<span class="variable">$_</span>.Exception.Message)&quot;</span> <span class="literal">-ForegroundColor</span> Red</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后在Powershell里执行<code>$PROFILE</code>即可看到配置文件位置，一般在<code>C:\Users\UserName\Documents\PowerShell\Microsoft.PowerShell_profile.ps1</code>。</p><p>在末尾加上<code>Import-Module ln</code>即可。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;在&lt;a href=&quot;/2025/10/20/powershell-grep/&quot; title=&quot;更适合Powershell体质的grep&quot;&gt;更适合Power</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Powershell" scheme="https://blog.esing.dev/tags/Powershell/"/>
    
  </entry>
  
  <entry>
    <title>降低腾讯ACE反作弊扫盘优先级并提升游戏性能</title>
    <link href="https://blog.esing.dev/2025/11/15/fuckoff-aceguard/"/>
    <id>https://blog.esing.dev/2025/11/15/fuckoff-aceguard/</id>
    <published>2025-11-15T12:53:32.000Z</published>
    <updated>2025-11-15T12:56:53.818Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>打大乱斗动不动就卡，太烦了。这B反作弊跟小蓝熊坐一桌去。</p><h2 id="注册表修改">注册表修改</h2><p>参考：<a href="https://www.bilibili.com/video/av115529217998860">解决英雄联盟LOL卡顿掉帧问题很多方法都没用的试下这个 - 哔哩哔哩</a></p><p>新建一个注册表文件<code>1.reg</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\DeltaForceClient-Win64-Shipping.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000003</span><br><span class="line">&quot;IoPriority&quot;=dword:00000003</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\League of Legends.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000003</span><br><span class="line">&quot;IoPriority&quot;=dword:00000003</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\LeagueClient.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000003</span><br><span class="line">&quot;IoPriority&quot;=dword:00000003</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\ACE-Tray.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000001</span><br><span class="line">&quot;IoPriority&quot;=dword:00000001</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\SGuard64.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000001</span><br><span class="line">&quot;IoPriority&quot;=dword:00000001</span><br></pre></td></tr></table></figure><p>然后双击导入即可。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;打大乱斗动不动就卡，太烦了。这B反作弊跟小蓝熊坐一桌去。&lt;/p&gt;
&lt;h2 id=&quot;注册表修改&quot;&gt;注册表修改&lt;/h2&gt;
&lt;p&gt;参考：&lt;a href=&quot;htt</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
  </entry>
  
  <entry>
    <title>学银在线解除粘贴限制</title>
    <link href="https://blog.esing.dev/2025/11/12/fuckoff-xueyinonline/"/>
    <id>https://blog.esing.dev/2025/11/12/fuckoff-xueyinonline/</id>
    <published>2025-11-12T11:41:03.000Z</published>
    <updated>2025-11-12T12:27:28.779Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><div class="note primary flat"><p>懒得看的直接跳转<a href="#%E8%84%9A%E6%9C%AC%E6%BA%90%E7%A0%81">脚本源码</a></p></div><p><strong>AI开课还要布置作业，你无敌了。我寻思这课不是考察吗？</strong></p><p>学银在线提交作业界面甚至无法粘贴，会提示“只能录入不能粘贴！”</p><p>什么垃圾玩意？看我干不干你就完事了。</p><h2 id="破解">破解</h2><h3 id="定位代码-修改">定位代码&amp;修改</h3><p>这种禁止粘贴100%是JS+前端拦截。直接进控制台搜源代码，定位到：</p><img src="https://webp.esing.dev/img/image-20251112200416938_251112_2004_AQoQ.png" alt="监听函数" style="zoom:80%;" /><p>然后直接写脚本替换：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         学银在线允许粘贴</span></span><br><span class="line"><span class="comment">// @namespace    https://blog.esing.dev/</span></span><br><span class="line"><span class="comment">// @version      0.7.2.1</span></span><br><span class="line"><span class="comment">// @description  移除学银在线的编辑器限制，允许粘贴</span></span><br><span class="line"><span class="comment">// @match        https://mooc1.xueyinonline.com/mooc-ans/*</span></span><br><span class="line"><span class="comment">// @run-at       document-end</span></span><br><span class="line"><span class="comment">// @grant        unsafeWindow</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">overrideEditorPaste</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> unsafeWindow.<span class="property">editorPaste</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                unsafeWindow.<span class="property">editorPaste</span> = <span class="keyword">function</span>(<span class="params">o, html</span>) &#123;</span><br><span class="line">                    <span class="comment">// 不清空 html.html，让编辑器正常插入粘贴内容</span></span><br><span class="line">                    <span class="comment">// 也不再弹“只能录入不能粘贴！”</span></span><br><span class="line">                    <span class="comment">// 一般返回 true/不返回都可以，看编辑器实现习惯</span></span><br><span class="line">                    <span class="comment">// 这里返回 true，表示允许粘贴</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[Tampermonkey] editorPaste overridden, paste is now allowed.&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[Tampermonkey] Failed to override editorPaste:&#x27;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 尝试覆盖一次</span></span><br><span class="line">    <span class="title function_">overrideEditorPaste</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 有些站点会晚一点才定义 editorPaste，这里每隔 1 秒再尝试一下</span></span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">overrideEditorPaste</span>()) &#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(timer); <span class="comment">// 覆盖成功后就不用再重复尝试了</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>塞进油猴测试。</p><p>没有效果？那继续。</p><h3 id="分析输入框代码">分析输入框代码</h3><p>继续检查元素，定位到输入框代码。检查一下可以发现，这里有个奇怪的script：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;stem_answer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;eidtDiv&quot;</span> <span class="attr">style</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;edui-default&quot;</span> <span class="attr">style</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;answer1919810&quot;</span> <span class="attr">name</span>=<span class="string">&quot;answer1919810&quot;</span> <span class="attr">_initadjustheight</span>=<span class="string">&quot;36&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 72px; display: none&quot;</span>&gt;</span>FUCKOFF<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> wordNum = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (wordNum == <span class="string">&quot;&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                wordNum = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> wordMinNum = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (wordMinNum == <span class="string">&quot;&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                wordMinNum = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> qtype = <span class="string">&quot;4&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// var wordCount = false;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// if (qtype == 4) &#123;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// wordCount = true;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">UEDITOR_CONFIG</span>.<span class="property">initialFrameHeight</span> = <span class="number">150</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> wordCount = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="built_in">parseInt</span>(wordNum) == <span class="number">0</span> &amp;&amp; <span class="built_in">parseInt</span>(wordMinNum) == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                wordCount = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">UEDITOR_CONFIG</span>.<span class="property">wordCount</span> = wordCount;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">UEDITOR_CONFIG</span>.<span class="property">wordCountTimer</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// window.UEDITOR_CONFIG.maximumWords = wordNum;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// window.UEDITOR_CONFIG.minimumWords = wordMinNum;</span></span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            &lt;!-- 编辑器定义代码 --&gt;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> editor1 = <span class="variable constant_">UE</span>.<span class="title function_">getEditor</span>(<span class="string">&quot;answer1919810&quot;</span>, &#123; <span class="attr">pasteplain</span>: <span class="literal">true</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="property">options</span>.<span class="property">maximumWords</span> = wordNum;</span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="property">options</span>.<span class="property">minimumWords</span> = wordMinNum;</span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="title function_">addListener</span>(<span class="string">&quot;blur&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> count = <span class="variable constant_">UE</span>.<span class="title function_">getEditor</span>(<span class="string">&quot;answer1919810&quot;</span>).<span class="title function_">pureWordCount</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> max = <span class="built_in">parseInt</span>(<span class="variable constant_">UE</span>.<span class="title function_">getEditor</span>(<span class="string">&quot;answer1919810&quot;</span>).<span class="property">options</span>.<span class="property">maximumWords</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> min = <span class="built_in">parseInt</span>(<span class="variable constant_">UE</span>.<span class="title function_">getEditor</span>(<span class="string">&quot;answer1919810&quot;</span>).<span class="property">options</span>.<span class="property">minimumWords</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borblue&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borred&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((max &gt; <span class="number">0</span> &amp;&amp; count &gt; max) || (min &gt; <span class="number">0</span> &amp;&amp; min &gt; count)) &#123;</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borblue&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">addClass</span>(<span class="string">&quot;borred&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borblue&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borred&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="title function_">addListener</span>(<span class="string">&quot;focus&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">addClass</span>(<span class="string">&quot;borblue&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borred&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            &lt;!-- 粘贴许可相关 --&gt;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> allowPaste = <span class="string">&quot;1&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="built_in">parseInt</span>(allowPaste) == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                editor1.<span class="title function_">addListener</span>(<span class="string">&quot;beforepaste&quot;</span>, editorPaste);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            &lt;!-- 一个奇怪的监听器 --&gt;</span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="title function_">addListener</span>(<span class="string">&quot;contentChange&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">loadEditorAnswerd</span>(<span class="number">1919810</span>, <span class="number">4</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">answerContentChange</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            &lt;!-- 应该就是你了 --&gt;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">UEDITOR_CONFIG</span>.<span class="property">wordCount</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可知：这个编辑器是百度的<strong>UEditor</strong>，且在<code>beforepaste</code>事件上面挂了<code>editorPaste</code>这个回调函数。因此，真正要干掉的是所有的<code>UEditor</code>上面挂的<code>beforepaste</code>监视器。</p><h3 id="修改脚本">修改脚本</h3><p>把UEditor上面挂的<code>beforepaste</code>监视器拿掉即可。注意看函数上面有个<code>addListener(&quot;beforepaste&quot;, editorPaste)</code>，这是挂上去的代码。那我<code>removeListener</code>你不炸了吗？</p><p>直接把需求告诉AI让它修改就行了。AI太好用了你们知道吗</p><h3 id="脚本源码">脚本源码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         学银在线允许粘贴</span></span><br><span class="line"><span class="comment">// @namespace    https://blog.esing.dev/</span></span><br><span class="line"><span class="comment">// @version      0.7.2.1</span></span><br><span class="line"><span class="comment">// @description  移除学银在线的编辑器限制，允许粘贴</span></span><br><span class="line"><span class="comment">// @match        https://mooc1.xueyinonline.com/mooc-ans/*</span></span><br><span class="line"><span class="comment">// @run-at       document-end</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 尝试对所有 UEditor 实例移除 beforepaste 的 editorPaste 监听</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">unlockPaste</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// UEditor 全局对象一般叫 UE</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">UE</span> || !<span class="variable constant_">UE</span>.<span class="property">instants</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> done = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="variable constant_">UE</span>.<span class="property">instants</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(<span class="variable constant_">UE</span>.<span class="property">instants</span>, key)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">const</span> ed = <span class="variable constant_">UE</span>.<span class="property">instants</span>[key];</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 如果全局有 editorPaste 函数，并且这个编辑器有 removeListener 方法</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span>.<span class="property">editorPaste</span> === <span class="string">&quot;function&quot;</span> &amp;&amp; ed.<span class="property">removeListener</span>) &#123;</span><br><span class="line">                    ed.<span class="title function_">removeListener</span>(<span class="string">&quot;beforepaste&quot;</span>, <span class="variable language_">window</span>.<span class="property">editorPaste</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Userscript] removed beforepaste listener from editor:&quot;</span>, key);</span><br><span class="line">                    done = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;[Userscript] removeListener error:&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> done;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初次尝试</span></span><br><span class="line">    <span class="title function_">unlockPaste</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 有时候编辑器是异步初始化的，这里轮询几次，确保挂到实例上之后再移除</span></span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">unlockPaste</span>()) &#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;paste-unlock-indicator&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">        div.<span class="property">id</span> = <span class="string">&quot;paste-unlock-indicator&quot;</span>;</span><br><span class="line">        div.<span class="property">textContent</span> = <span class="string">&quot;粘贴已解锁😋&quot;</span>;</span><br><span class="line">        div.<span class="property">style</span>.<span class="property">cssText</span> =</span><br><span class="line">            <span class="string">&quot;position:fixed;bottom:10px;right:10px;padding:4px 8px;font-size:12px;background:#4caf50;color:#fff;z-index:99999;border-radius:4px;opacity:0.7;&quot;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>收工。</p>]]></content>
    
    
    <summary type="html">防君子、不防小人也。</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="JavaScript" scheme="https://blog.esing.dev/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>GTKWave修改字体大小</title>
    <link href="https://blog.esing.dev/2025/11/10/gtkwave-fontsize/"/>
    <id>https://blog.esing.dev/2025/11/10/gtkwave-fontsize/</id>
    <published>2025-11-10T12:47:01.000Z</published>
    <updated>2025-11-11T09:49:22.808Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>目前看波形依旧没有什么现代化的软件，还是得用GTKWave。这玩意本来是给Linux用的，Windows上的界面看起来很奇怪。而且字体太小了，眼睛受不了。如何修改字体和字体大小呢？</p><h2 id="配置文件与启动参数">配置文件与启动参数</h2><p>参考官方文档：<a href="https://gtkwave.sourceforge.net/gtkwave.pdf">GTKWave 3.3 Wave Analyzer User's Guide</a></p><p>编辑用户文件夹下的<code>.gtkwaverc</code>文件（不存在就新建一个）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use_big_fonts 8        //字体字号</span><br><span class="line">highlight_wavewindow 1 //高亮被选择的信号波形</span><br><span class="line">// color_grid feeeed   // 高亮信号颜色</span><br><span class="line">fill_waveform 1        //高值填充</span><br><span class="line">disable_mouseover 0    //鼠标可查看波形</span><br><span class="line">hier_max_level 5       //显示信号归属层级的最大值</span><br><span class="line">left_justify_sigs 1    //信号左对齐</span><br></pre></td></tr></table></figure><p>之后用参数启动：</p><p><code> gtkwave -r path/to/config/.gtkwaverc your_vcdfile</code>即可。</p><p>其实也可以修改字体：</p><p><code>fontname_signals XXX</code>即可。但是显示很奇怪。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;目前看波形依旧没有什么现代化的软件，还是得用GTKWave。这玩意本来是给Linux用的，Windows上的界面看起来很奇怪。而且字体太小了，眼睛受不了。</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：第六篇</title>
    <link href="https://blog.esing.dev/2025/11/08/vd-p6/"/>
    <id>https://blog.esing.dev/2025/11/08/vd-p6/</id>
    <published>2025-11-08T15:22:28.000Z</published>
    <updated>2025-11-10T03:53:43.556Z</updated>
    
    <content type="html"><![CDATA[<div class="note info flat"><p>应付一下应试。</p></div><h2 id="缩写">缩写</h2><ul><li><strong>PLA</strong>: Programmable Logic Array</li><li><strong>PAL</strong>: Programmable Array Logic</li><li><strong>PLD</strong>: Programmable Logic Device</li><li><strong>ROM</strong>: Read-Only Memory</li><li><strong>RAM</strong>: Random Access Memory</li><li><strong>ALU</strong>: Arithmetic Logic Unit</li><li><strong>IEEE</strong>: Institute of Electrical and Electronics Engineers</li><li><strong>VHDL</strong>: VHSIC Hardware Description Language</li><li><strong>CMOS</strong>: Complementary Metal Oxide Semiconductor</li><li><strong>FPGA</strong>: Field-Programmable Gate Array</li><li><strong>RISC</strong>: Reduced Instruction Set Computer</li><li><strong>CISC</strong>: Complex Instruction Set Computer</li><li><strong>DSA</strong>: Domain Specific Architecture</li><li><strong>SoC</strong>: System on Chip</li><li><strong>FP</strong>: Float Point</li><li><strong>ISA</strong>: Instruction Set Architecture</li><li><strong>RTC</strong>: Real-Time Clock</li><li><strong>SPI</strong>: Serial Peripheral Interface</li><li><strong>PMC</strong>: Power Management Controller</li><li><strong>DMA</strong>: Direct Memory Access</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info flat&quot;&gt;&lt;p&gt;应付一下应试。&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;缩写&quot;&gt;缩写&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PLA&lt;/strong&gt;:</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>One Last Kiss 风格图片生成</title>
    <link href="https://blog.esing.dev/2025/10/31/onelastkiss-image/"/>
    <id>https://blog.esing.dev/2025/10/31/onelastkiss-image/</id>
    <published>2025-10-31T10:57:56.000Z</published>
    <updated>2025-10-31T11:16:30.695Z</updated>
    
    <content type="html"><![CDATA[    <div id="aplayer-ANgRERXS" class="aplayer aplayer-tag-marker meting-tag-marker"         data-id="1824020871" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#ff80ac" data-volume="0.3" data-loop="none"    ></div><h2 id="前言">前言</h2><p>在Github上闲逛时看到了这个库：<a href="https://github.com/itorr/one-last-image">「One Last Image」卢浮宫生成器 - itorr/one-last-image</a></p><p>在线试了一下，效果很不错，可惜导出的图片都被重采样到1080P了，于是拉源码自己修改了一版，可以开启高清模式，并随意调整水印位置：</p><p><img src="https://webp.esing.dev/img/image-20251031190219051_251031_1902_tsQn.png" alt="修改版"></p><p>地址在<a href="https://louvre.esing.dev/">louvre.esing.dev</a>。</p><p>效果还行：</p><p><img src="https://opic.esing.dev/img/louvre_251031_1910_J7A1.webp" alt="效果图，原图为p112423002"></p>]]></content>
    
    
    <summary type="html">「　第一次去卢浮宫 并无什么特别的感觉&lt;br&gt;　　因为独属于我的蒙娜丽莎 我早已遇见　」</summary>
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="二次元" scheme="https://blog.esing.dev/tags/%E4%BA%8C%E6%AC%A1%E5%85%83/"/>
    
    <category term="EVA" scheme="https://blog.esing.dev/tags/EVA/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：第五篇</title>
    <link href="https://blog.esing.dev/2025/10/29/vd-p5/"/>
    <id>https://blog.esing.dev/2025/10/29/vd-p5/</id>
    <published>2025-10-29T08:46:50.000Z</published>
    <updated>2025-11-04T04:56:47.097Z</updated>
    
    <content type="html"><![CDATA[<div class="note info flat"><p>这一章不考，至少往年题没有考过。</p></div><h2 id="SoC总线">SoC总线</h2><ul><li>总线提供了系统中<strong>各个设备之间</strong>一种<strong>互连</strong>的<strong>访问共享硬件</strong>机制</li><li>在数字系统中，总线<strong>承担数据传输任务</strong>，如处理器和存储器之间的数据传输</li><li>总线的传输能力由总线的<strong>带宽</strong>和<strong>工作频率</strong>决定</li><li>总线的设计通常要考虑4个因素：<strong>总线宽度、时钟频率、仲裁机制和传输类型</strong></li></ul><p>常见的总线有：</p><ul><li>AMBA：ARM公司定义的总线体系，广泛用于嵌入式SoC，包括 AHB、APB、AXI 等多个子协议</li><li>OCP：开放式核心接口协议，模块化设计，适合IP核集成</li><li>Wishbone：由OpenCores定义的开源SoC总线，简单易用，适合教学或FPGA设计</li><li>Avalon：原Altera公司定义的片上总线协议</li></ul><h3 id="AMBA">AMBA</h3><img src="https://webp.esing.dev/img/image-20251029172831688_251029_1728_zyBZ.png" alt="AMBA-AHB系统" style="zoom: 33%;" /><br><img src="https://webp.esing.dev/img/image-20251029172845655_251029_1728_fIGf.png" alt="AMBA-AXI系统" style="zoom: 67%;" /><h2 id="常见IP">常见IP</h2><p>SoC中的常见IP包括：中断控制器、实时时钟、SPI、定时器、看门狗等。</p><p>一个完整的 SoC 通常包含如下模块（IP）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">┌──────────────────────────┐</span><br><span class="line">│        CPU / DSP         │   ← 控制/计算IP</span><br><span class="line">├──────────────────────────┤</span><br><span class="line">│   Cache / MMU / Memory   │   ← 存储IP</span><br><span class="line">├──────────────────────────┤</span><br><span class="line">│   AXI / AHB Interconnect │   ← 片上总线IP</span><br><span class="line">├──────────────────────────┤</span><br><span class="line">│ UART | SPI | I²C | GPIO  │   ← 外设IP</span><br><span class="line">├──────────────────────────┤</span><br><span class="line">│     DMA / Timer / WDT    │   ← 控制类IP</span><br><span class="line">├──────────────────────────┤</span><br><span class="line">│  USB / PCIe / Ethernet   │   ← 通信接口IP</span><br><span class="line">├──────────────────────────┤</span><br><span class="line">│   Security / Crypto / PM │   ← 安全与电源管理IP</span><br><span class="line">└──────────────────────────┘</span><br></pre></td></tr></table></figure><h3 id="中断控制器">中断控制器</h3><p>中断控制器（Interrupt Controller）是 SoC中用于管理和分发中断请求（IRQ）的关键模块，直接影响系统的<strong>实时性</strong>和<strong>响应能力</strong>。</p><ul><li>RISC-V：CLIN、PLIC</li><li>ARM：NVIC、GIC</li><li>x86：APIC</li></ul><h3 id="实时时钟-RTC">实时时钟 RTC</h3><p>RTC（Real-Time Clock，实时时钟）是SoC中用于提供精确时间和日历功能的独立模块，即使在系统断电时也能持续运行（通常依靠备用电池供电）。RTC拥有报警功能，当达到所需的日期或时间时，可以用来触发中断（唤醒）。</p><h3 id="SPI">SPI</h3><p>SPI（Serial Peripheral Interface，串行外设接口）允许与外围设备的全双工同步串行通信。</p><img src="https://pic.esing.dev/img/OIP_251029_1744_9Mi4.qDQZR6LGNmkKAxd41-dJkQHaFP" alt="SPI总线示意图" style="zoom: 50%;" /><h3 id="定时器与看门狗">定时器与看门狗</h3><p>Timer（定时器）和Watchdog（看门狗）是两种关键的外设模块，分别用于时间管理和系统可靠性保障。它们都基于<strong>计时原理</strong>，但用途完全不同：</p><ul><li>定时器用来“<strong>计时与触发事件</strong>”；</li><li>看门狗用来“<strong>监控系统运行是否卡死</strong>”。</li></ul><h3 id="PMC">PMC</h3><p>PMC（Power Management Controller） 是SoC中负责电源管理、功耗控制、时钟分配和系统唤醒的核心模块，直接影响芯片的能效比和续航能力。主要通过电源管理、时钟管理、软件管理等方式来达到控制功耗的目的。</p><table><thead><tr><th style="text-align:left">模式</th><th style="text-align:left">功耗</th><th style="text-align:left">唤醒延迟</th><th style="text-align:left">典型应用</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Active</strong></td><td style="text-align:left">高</td><td style="text-align:left">无</td><td style="text-align:left">CPU全速运行任务。</td></tr><tr><td style="text-align:left"><strong>Idle</strong></td><td style="text-align:left">中</td><td style="text-align:left">微秒级</td><td style="text-align:left">等待中断（如手机待机）。</td></tr><tr><td style="text-align:left"><strong>Standby</strong></td><td style="text-align:left">低</td><td style="text-align:left">毫秒级</td><td style="text-align:left">仅保留SRAM和RTC（如IoT设备）。</td></tr><tr><td style="text-align:left"><strong>Off</strong></td><td style="text-align:left">极低</td><td style="text-align:left">秒级</td><td style="text-align:left">完全断电，需硬件复位唤醒。</td></tr></tbody></table><h3 id="DMAC">DMAC</h3><p><s>AMD反插</s></p><p>DMAC（Direct Memory Access Controller） 是SoC中用于在不占用CPU资源的情况下，实现外设与内存（或内存与内存）之间高速数据传输的硬件模块。它显著提升系统效率，尤其适用于大数据量、实时性要求高的场景（如音视频处理、网络通信）。</p><p>DMAC一般包括如下模块：</p><ul><li>通道控制器：每个通道独立配置源地址、目标地址、传输长度等参数</li><li>仲裁器：管理多个通道的优先级（固定优先级或轮询）</li><li>数据FIFO：缓冲数据，解决源/目标设备速度不匹配问题</li><li>寄存器组：存储控制参数（如传输模式、中断使能）</li><li>总线接口：连接系统总线（如AXI、AHB），访问内存和外设</li></ul><h2 id="中断与异常">中断与异常</h2><p>中断机制和异常机制即在中断和异常发生时，处理器将暂停当前正在执行的程序，转而执行中断和异常处理程序，返回时处理器恢复之前被执行的程序。对于处理器而言，中断和异常的处理机制基本上一样，因此合称广义异常。</p><p>异常可分为两类：</p><ul><li>同步异常：原因可以精确定位到某一条执行指令，由<strong>当前正在执行的指令本身</strong>直接引起的异常。</li><li>异步异常：每次发生时指令的PC可能不一样，例如中断便是一种异步异常<ul><li>精确异步异常：在响应异常后的处理器状态能够<strong>精确反映</strong>为某一条指令的边界</li><li>非精确异步异常：在响应异常后的处理器状态无法精确反映为某一条指令的边界</li></ul></li></ul><pre class="mermaid">flowchart TD    A[正常执行: <br/>PC 指向当前指令] --> B{是否发生<br/>异常/中断?}    B -- 否 --> A    %% 进入异常    B -- 是 --> C[硬件捕获异常]    C --> D[保存现场到 CSR]    D -->|mepc ← 触发时的 PC<br/>mcause ← 异常原因<br/>mtval ← 异常相关值（可选）<br/>mstatus ← 更新 MIE→MPIE、切换特权级| E    E --> F[PC ← mtvec（陷入入口）]    F --> G[开始执行<br/>异常/中断处理程序]    %% 处理过程    G --> H{处理完成<br/>并准备返回?}    H -- 否 --> G    %% 退出异常（机器模式）    H -- 是 --> I[执行 MRET 指令]    I --> J[硬件恢复状态]    J -->|PC ← mepc<br/>mstatus ← 恢复 MPIE→MIE 等| K[返回到<br/>被中断/异常的程序]    K --> A</pre><h2 id="蜂鸟E203的中断处理">蜂鸟E203的中断处理</h2><p>E203在处理器顶层接口中有4根中断输入信号，分别是软件中断、计时器中断、外部中断和调试中断。CLINT模块产生一根软件中断信号和一根计时器中断信号，通给蜂鸟E203处理器；PLIC模块接入多个外部中断源，将其仲裁后生成一根外部中断信号，通给蜂鸟E203处理器。SoC层面的调试模块生成一根调试中断，通给蜂鸟E203处理器核。所有的中断信号均由E203的<strong>交付模块</strong>进行处理。</p><h3 id="CLINT">CLINT</h3><p>CLINT（Core Local Interrupts Controller，核心本地中断控制器）是一个存储器地址映射的模块，挂载在蜂鸟E203 BIU上，用于产生<strong>软件中断</strong>和<strong>定时器中断</strong>。CLINT计时器根据低速输入节拍信号（来自电源常开域）进行计时，上电后默认一直计数，可通过蜂鸟E203自定义CSR寄存器<code>mcounterstop</code>来关闭。</p><h3 id="PLIC">PLIC</h3><p>PLIC（Platform Level Interrupt Controller，平台级中断控制器）是一个存储器地址映射的模块，挂载在蜂鸟E203 BIU上，专门用来管理<strong>外部中断源</strong>，并将它们统一分发到处理器。</p><h3 id="异常处理实现">异常处理实现</h3><p>蜂鸟E203交付模块对中断和异常的处理：</p><ul><li>优先级：长指令造成的异步异常 &gt; 中断造成的异步异常 &gt; ALU造成的同步异常</li><li>异常一旦发生，便会<strong>冲刷流水线</strong>，重新从新的PC地址开始取指令</li><li><code>mret</code>指令会触发处理器退出异常模式，被<strong>当作一种跳转指令</strong>来执行，跳转PC为<code>mepc</code>寄存器值</li><li>对于同步异常，<code>mepc</code>寄存器更新为当前<strong>正在交付指令</strong>的PC值</li><li>对于精确异步异常（中断），<code>mepc</code>寄存器更新为<strong>下一条待交付指令</strong>的PC值</li><li>对于非精确异步异常（长指令），<code>mepc</code>寄存器更新为<strong>发生异常指令</strong>的PC值</li></ul><h2 id="蜂鸟E203的调试机制">蜂鸟E203的调试机制</h2><p>处理器对于运行于其上的软件程序提供调试能力是至关重要的。调试机制是个非常复杂的软硬件协作机制，软硬件的实现难度很大。对于处理器的调试功能而言，常用的两种是“交互式调试”和“追踪调试”：</p><ul><li>交互式调试（Interactive Debug）是最常见的调试功能。调试器软件（如GDB）能够直接对处理器取得控制权，进而对其以一种交互方式进行调试，缺点是对处理器的运行具有打扰性。</li><li>追踪调试（Trace Debug）只跟踪记录处理器核执行过的所有程序指令，而不会打断干扰处理器的执行过程。相比交互式调试，实现难度更大，硬件开销也更大。</li></ul><h3 id="调试资源">调试资源</h3><p>E203中已有 DTM（Debug Transport Module）将JTAG标准接口转换成为内部的调试总线（Debug Bus），主要是使用状态机对JTAG协议进行解析。由于DTM模块处于JTAG时钟域，与调试总线要访问的调试模块不属于同一个时钟域，因此需要被同步。</p><p>此外，还有调试模块（Debug Module），实现了RISC-V调试文档“0.11版本”中定义的若干寄存器、Debug-ROM和Debug-RAM。这些资源既可以被调试总线访问到，也可以被系统存储总线访问到：</p><ul><li>Debug-ROM包含了处理器进入调试模式下需要执行的异常处理程序；</li><li>Debug-RAM主要在运行Debug-ROM中固定异常处理程序时作为数据段使用，用于存放一些临时数据和中间数据。</li></ul><h3 id="调试流程">调试流程</h3><p>调试机制指令的实现：</p><ul><li>ebreak：触发处理器进入异常模式（调试模式）<ul><li>调试中断一旦被接收，便会冲刷流水线，处理器PC跳转到<code>0x800</code>地址</li><li>CSR寄存器dpc的值更新为当前正在执行的指令PC</li><li>CSR寄存器dcsr的<code>cause</code>域值更新为引发进入调试模式的触发原因</li></ul></li><li>dret：触发处理器退出异常模式（调试模式）<ul><li>被当作一种跳转指令来执行，跳转PC为CSR寄存器dpc的值</li><li>将dcsr寄存器中的<code>cause</code>域清除</li></ul></li></ul><h2 id="未来：超越摩尔定律">未来：超越摩尔定律</h2><p>DSA（Domain-Specific Architecture，领域专用架构）方面：</p><ul><li>使用专用内存以最大限度地减少数据移动</li><li>将资源投入到更多的运算单元或更大的内存中</li><li>使用与域匹配的最简单的并行形式</li><li>将数据大小和类型减少到域所需的最简单程度</li><li>使用域特定的编程语言</li></ul><div class="note primary flat"><p>什么是“域特定的编程语言”？即DSL（Domain-Specific Language，领域专用语言）。比如前两年的<a href="https://www.modular.com/mojo">Mojo</a>和<a href="https://www.taichi-lang.org/">Taichi</a>都算是Python细化的DSL。</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info flat&quot;&gt;&lt;p&gt;这一章不考，至少往年题没有考过。&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;SoC总线&quot;&gt;SoC总线&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;总线提供了系</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>LaTeX代码开启连字等特性</title>
    <link href="https://blog.esing.dev/2025/10/23/latex-ligature/"/>
    <id>https://blog.esing.dev/2025/10/23/latex-ligature/</id>
    <published>2025-10-23T11:27:57.000Z</published>
    <updated>2025-10-23T14:53:20.925Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>在 <a href="/2024/11/19/latex-code-highlight/" title="LaTeX插入代码并设置高亮">LaTeX插入代码并设置高亮</a>中，使用<code>minted</code>和<code>listings</code> 为代码块添加了高亮。但许多等宽字体都包含连字（Ligature）特性，可以增强代码的可读性，视觉效果更好。那如何在代码块里也开启连字特性呢？</p><div class="note primary flat"><p>这里安利<a href="https://github.com/subframe7536/maple-font">Maple Mono</a>字体，对中文显示极其友好，完美的中英文2:1比例，还支持Nerd Font。我已经将所有等宽字体都换成<code>Maple Mono Normal NF CN</code>了。</p></div><h2 id="修改样式">修改样式</h2><p>首先要确保使用了<code>fontspec</code>宏包：<code>\RequirePackage&#123;fontspec&#125;</code></p><p>接着指定等宽字体，并添加：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">\setmonofont[</span><br><span class="line">    AutoFakeBold=true,</span><br><span class="line">    ItalicFont=MapleItalic,     % 指定斜体字体</span><br><span class="line">    Contextuals = Alternate,    % 开启连字</span><br><span class="line">    Ligatures = Common,         % liga</span><br><span class="line">    CharacterVariant=&#123;1,62,63&#125;, % cv特性</span><br><span class="line">    StylisticSet=&#123;3,11&#125;,        % ss特性</span><br><span class="line">    Extension = .ttf,</span><br><span class="line">    Path=fonts/</span><br><span class="line">]&#123;Maple&#125;</span><br></pre></td></tr></table></figure><p>随后重新编译就可以了！</p><p>经过测试，<code>verbatim</code>环境下一切正常，<code>listings</code>环境下仅有部分连字生效，原因不明。</p><img src="https://webp.esing.dev/img/image-20251023214343776_251023_2143_caYa.png" alt="verbatim环境" style="zoom:50%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;在 &lt;a href=&quot;/2024/11/19/latex-code-highlight/&quot; title=&quot;LaTeX插入代码并设置高亮&quot;&gt;LaTeX插入代</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="LaTeX" scheme="https://blog.esing.dev/tags/LaTeX/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：第四篇</title>
    <link href="https://blog.esing.dev/2025/10/21/vd-p4/"/>
    <id>https://blog.esing.dev/2025/10/21/vd-p4/</id>
    <published>2025-10-21T01:49:28.000Z</published>
    <updated>2025-11-07T02:27:00.310Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Cache">Cache</h2><p>可参考 <a href="/2024/06/12/coae-p6/" title="计算机原理与嵌入式系统笔记：第六篇">计算机原理与嵌入式系统笔记：第六篇</a></p><h3 id="直写与回写">直写与回写</h3><p>Write-Through（直写） 和 Write-Back （回写）是两种 Cache 写策略，用来决定当 CPU 写数据时，数据如何更新到主存的。</p><ul><li>当 CPU 对 cache 写数据时，同时也把数据写入主存，称为直写：<ul><li>数据一致性好（cache 和 主存内容始终同步）</li><li>对系统可靠性高</li><li>简单易实现</li><li><strong>写操作慢，写操作频繁时会增加总线带宽占用</strong></li></ul></li><li>当 CPU 写 cache 时，只更新 cache 中的数据，不立即写入主存，只有当该 cache block 被替换时，才将其写回主存，称为回写：<ul><li>写操作快，节省总线带宽</li><li><strong>数据一致性较差</strong></li><li><strong>实现复杂，需要 dirty 位标记</strong></li><li><strong>系统崩溃时可能丢失尚未写回的数据</strong></li></ul></li></ul><p>写缓冲区可以解决直写写内存慢、回写替换时大量写回的问题，因此均需要写缓冲区。</p><h3 id="性能例子">性能例子</h3><p>假设：</p><ul><li>I-Cache命中缺失率2%</li><li>D-Cahce命中缺失率4%</li><li>未命中惩罚为100周期</li><li>基础CPI为2</li><li>数据存取类指令占总共的36%</li></ul><p>则可计算每次指令的缺失周期数：</p><ul><li>I-Cache: 0.02 x 100 = 2</li><li>D-Cache: 0.36 x 0.04 x 100 = 1.44</li><li>实际CPI为 2 + 2 + 1.44 = 5.44</li></ul><h3 id="平均访问时间">平均访问时间</h3><p>AMAT（Average Memory Access Time，平均内存访问时间）用于衡量 CPU 访问内存系统的平均时间性能。</p><p>如果命中时间是 1ns，未命中率 5%，未命中惩罚 20ns，则 AMAT = 1 + 0.05×20 = 2ns。</p><h3 id="一致性">一致性</h3><p>Cache 一致性是指在多核或多处理器系统中，多个缓存副本之间的数据保持一致的特性或机制。它保证无论处理器在哪个缓存中读取数据，得到的都是最新的、正确的值。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># Core 0</span><br><span class="line">    la   t0, x</span><br><span class="line">    li   t1, 1</span><br><span class="line">    sw   t1, 0(t0)            # x = 1</span><br><span class="line"></span><br><span class="line">    fence w, w                # 确保之前的写（x）对外可见后，后续写才对外可见</span><br><span class="line">    la   t2, flag</span><br><span class="line">    sw   t1, 0(t2)            # flag = 1（作为发布动作）</span><br><span class="line">==============================================================================</span><br><span class="line"># Core 1</span><br><span class="line">spin:</span><br><span class="line">    la   t2, flag</span><br><span class="line">    lw   t3, 0(t2)</span><br><span class="line">    beqz t3, spin             # 等 flag = 1</span><br><span class="line"></span><br><span class="line">    fence r, rw               # 获取屏障：确保之后的读不会“越过”对 flag 的读取</span><br><span class="line">    la   t0, x</span><br><span class="line">    lw   t4, 0(t0)            # 现在能可靠读到 x = 1</span><br></pre></td></tr></table></figure><h2 id="并行计算：冲刺♿冲">并行计算：冲刺♿冲</h2><p>我们想要连接多台计算机以获得更高的性能，有以下几种办法：</p><ul><li>任务级（进程级）并行：独立作业的高吞吐量</li><li>并行处理程序：在多个处理器上运行单个程序</li><li>多核微处理器：有多个处理器（内核）的芯片</li></ul><p>参考之前的Amdahl定律：</p><ul><li>单处理器：Time = (10 + 100) × t<sub>add</sub></li><li>10处理器：Time = 10 x t<sub>add</sub> + 100/10 x t<sub>add</sub> = 20 x t<sub>add</sub><ul><li>Speedup = 110/20 = 5.5 (55% of potential)</li></ul></li><li>100处理器：Time = 10 x t<sub>add</sub> + 100/100 x t<sub>add</sub> = 11 x t<sub>add</sub><ul><li>Speedup = 110/11 = 10 (10% of potential)</li></ul></li></ul><p>对于大矩阵来说，加速效果更明显。</p><h3 id="强可扩展性与弱可扩展性">强可扩展性与弱可扩展性</h3><p>测试时<strong>问题规模是否随处理器数变化</strong>是区分可扩展性强弱的依据。</p><ul><li>当<strong>问题规模固定不变</strong>时，随着处理器数量增加，程序的<strong>加速比（Speedup）</strong> 仍能保持较高，这种能力称为<strong>强可扩展性</strong>。</li><li>当<strong>每个处理器的工作量保持不变</strong>（即问题规模随处理器数线性增长）时，程序的性能（例如运行时间）仍能保持近似不变，这种能力称为<strong>弱可扩展性</strong>。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Cache&quot;&gt;Cache&lt;/h2&gt;
&lt;p&gt;可参考 &lt;a href=&quot;/2024/06/12/coae-p6/&quot; title=&quot;计算机原理与嵌入式系统笔记：第六篇&quot;&gt;计算机原理与嵌入式系</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>更适合Powershell体质的grep</title>
    <link href="https://blog.esing.dev/2025/10/20/powershell-grep/"/>
    <id>https://blog.esing.dev/2025/10/20/powershell-grep/</id>
    <published>2025-10-20T02:16:02.000Z</published>
    <updated>2025-11-17T06:15:53.757Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>Powershell下筛选字符串有<code>findstr</code>指令。但我用<code>grep</code>习惯了，一时半会不想改<s>主要是findstr字太多了</s></p><p>所以自己写一个脚本来模拟<code>grep</code>功能。</p><h2 id="代码">代码</h2><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"></span><br><span class="line">:: 检查参数</span><br><span class="line"><span class="keyword">if</span> &quot;%~<span class="number">1</span>&quot;==&quot;&quot; (</span><br><span class="line">    <span class="built_in">echo</span> 用法: grep 搜索词</span><br><span class="line">    <span class="built_in">echo</span> 示例: command | grep 搜索词</span><br><span class="line">    <span class="keyword">exit</span> /b <span class="number">1</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">:: 搜索词是第一个参数</span><br><span class="line"><span class="built_in">set</span> &quot;searchterm=%~<span class="number">1</span>&quot;</span><br><span class="line"></span><br><span class="line">:: 处理标准输入并搜索</span><br><span class="line"><span class="keyword">for</span> /f &quot;usebackq tokens=*&quot; <span class="variable">%%a</span> <span class="keyword">in</span> (`<span class="built_in">findstr</span> /i /L /C:&quot;<span class="variable">%searchterm%</span>&quot; <span class="number">2</span>^&gt;<span class="built_in">nul</span>`) <span class="keyword">do</span> (</span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">%%a</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">endlocal</span></span><br><span class="line"><span class="keyword">exit</span> /b <span class="number">0</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;Powershell下筛选字符串有&lt;code&gt;findstr&lt;/code&gt;指令。但我用&lt;code&gt;grep&lt;/code&gt;习惯了，一时半会不想改&lt;s&gt;主要是</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Powershell" scheme="https://blog.esing.dev/tags/Powershell/"/>
    
  </entry>
  
  <entry>
    <title>HDLBits刷题之旅鼠冲冲冲</title>
    <link href="https://blog.esing.dev/2025/10/07/hdlbits-lemmings4/"/>
    <id>https://blog.esing.dev/2025/10/07/hdlbits-lemmings4/</id>
    <published>2025-10-07T11:57:39.000Z</published>
    <updated>2025-10-07T15:24:15.092Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><p><a href="https://zh.wikipedia.org/wiki/%E7%99%BE%E6%88%B0%E5%B0%8F%E6%97%85%E9%BC%A0">百战小旅鼠</a>1991年由DMA Design（今rockstar north，蓝R）开发。</p><p>旅鼠会左右走，还会挖洞。如果下落太久了还会摔得四分五裂<s>坠机了</s></p><h2 id="思路">思路</h2><p>七个状态：左右、下落左右、向下挖时原本朝向左右，以及四分五裂。</p><h2 id="代码">代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span>  clk,</span><br><span class="line">    <span class="keyword">input</span>  areset,      <span class="comment">// Freshly brainwashed Lemmings walk left.</span></span><br><span class="line">    <span class="keyword">input</span>  bump_left,</span><br><span class="line">    <span class="keyword">input</span>  bump_right,</span><br><span class="line">    <span class="keyword">input</span>  ground,</span><br><span class="line">    <span class="keyword">input</span>  dig,</span><br><span class="line">    <span class="keyword">output</span> walk_left,</span><br><span class="line">    <span class="keyword">output</span> walk_right,</span><br><span class="line">    <span class="keyword">output</span> aaah,</span><br><span class="line">    <span class="keyword">output</span> digging</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">parameter</span> LEFT = <span class="number">0</span>, RIGHT = <span class="number">1</span>, FALLING_LEFT = <span class="number">2</span>, FALLING_RIGHT = <span class="number">3</span>, DIGGING_LEFT = <span class="number">4</span>,</span><br><span class="line">        DIGGING_RIGHT = <span class="number">5</span>, SPLAT = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>] state, next_state;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] count, next_count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">        next_count = count;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> (state)</span><br><span class="line"></span><br><span class="line">            LEFT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (!ground) <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_LEFT;</span><br><span class="line">                    next_count = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (dig) next_state = DIGGING_LEFT;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (bump_left) next_state = RIGHT;</span><br><span class="line">                <span class="keyword">else</span> next_state = LEFT;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            RIGHT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (!ground) <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_RIGHT;</span><br><span class="line">                    next_count = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (dig) next_state = DIGGING_RIGHT;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (bump_right) next_state = LEFT;</span><br><span class="line">                <span class="keyword">else</span> next_state = RIGHT;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            FALLING_LEFT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground) <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (count &gt;= <span class="number">20</span>) <span class="keyword">begin</span></span><br><span class="line">                        next_state = SPLAT;</span><br><span class="line">                        next_count = count;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                        next_state = LEFT;</span><br><span class="line">                        next_count = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_LEFT;</span><br><span class="line">                    next_count = count + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            FALLING_RIGHT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground) <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (count &gt;= <span class="number">20</span>) <span class="keyword">begin</span></span><br><span class="line">                        next_state = SPLAT;</span><br><span class="line">                        next_count = count;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                        next_state = RIGHT;</span><br><span class="line">                        next_count = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_RIGHT;</span><br><span class="line">                    next_count = count + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            DIGGING_LEFT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground) next_state = DIGGING_LEFT;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_LEFT;</span><br><span class="line">                    next_count = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            DIGGING_RIGHT: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (ground) next_state = DIGGING_RIGHT;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    next_state = FALLING_RIGHT;</span><br><span class="line">                    next_count = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            SPLAT: next_state = SPLAT;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>: next_state = LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk, <span class="keyword">posedge</span> areset) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (areset) <span class="keyword">begin</span></span><br><span class="line">            state &lt;= LEFT;</span><br><span class="line">            count &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            state &lt;= next_state;</span><br><span class="line">            count &lt;= next_count;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// assign aaah       = (state == FALLING_LEFT) || (state == FALLING_RIGHT);</span></span><br><span class="line">    <span class="comment">// assign digging    = (state == DIGGING_LEFT) || (state == DIGGING_RIGHT);</span></span><br><span class="line">    <span class="comment">// assign walk_left  = (state == LEFT);</span></span><br><span class="line">    <span class="comment">// assign walk_right = (state == RIGHT);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> &#123;aaah, digging, walk_left, walk_right&#125; = (state == SPLAT) ?</span><br><span class="line">        <span class="number">4&#x27;b0000</span> : &#123;&#123;(state == FALLING_LEFT) || (state == FALLING_RIGHT)&#125;,</span><br><span class="line">                   &#123;(state == DIGGING_LEFT) || (state == DIGGING_RIGHT)&#125;,</span><br><span class="line">                   &#123;(state == LEFT)&#125;, &#123;(state == RIGHT)&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="排查错误">排查错误</h2><p>一开始未设置<code>next_count</code>，直接给<code>count</code>赋值，会报错：Can't resolve multiple constant drivers for net &quot;count[4]&quot;。因此，需要像状态切换那样，设置一个新的<code>next_count</code>。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;前言&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E7%99%BE%E6%88%B0%E5%B0%8F%E6%97%85%E</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="HDLBits" scheme="https://blog.esing.dev/tags/HDLBits/"/>
    
  </entry>
  
  <entry>
    <title>HDLBits刷题之生命游戏</title>
    <link href="https://blog.esing.dev/2025/10/05/hdlbits-conwaylife/"/>
    <id>https://blog.esing.dev/2025/10/05/hdlbits-conwaylife/</id>
    <published>2025-10-05T04:44:18.000Z</published>
    <updated>2025-10-05T10:14:09.164Z</updated>
    
    <content type="html"><![CDATA[<div class="note info flat"><p>纪念<a href="https://zh.wikipedia.org/wiki/%E7%B4%84%E7%BF%B0%C2%B7%E4%BD%95%E9%A0%93%C2%B7%E5%BA%B7%E5%A8%81">约翰·霍顿·康威</a>，他因新冠于2020年4月11日逝世，享年82岁。</p></div><h2 id="前言">前言</h2><p><a href="https://hdlbits.01xz.net/wiki/Conwaylife">Conwaylife - HDLBits</a></p><p>康威的生命游戏在科学美国人上刊登过，小时候还看到过，印象很深。</p><p>简单来说，就是对一个矩阵进行轮次变换，对每个元素的变换规则如下：</p><ul><li>0-1 个邻居：单元格变为 0</li><li>2 个邻居：单元格状态不变</li><li>3 个邻居：单元格变为 1</li><li>4 个及以上邻居：单元格变为 0</li></ul><p>要注意的是矩阵四周是“连续”的，即首尾相接。可以理解成桌面壁纸的平铺。</p><h2 id="思路">思路</h2><p>连续的意思就是说边界处会发生“跳变”。那我整一个四周大一圈的矩阵把它包进去就可以了。</p><p>然后在每个时钟沿进行判断，再赋新的值给寄存器即可。</p><h2 id="代码">代码</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> top_module (</span><br><span class="line">    <span class="keyword">input</span>              clk,</span><br><span class="line">    <span class="keyword">input</span>              load,</span><br><span class="line">    <span class="keyword">input</span>      [<span class="number">255</span>:<span class="number">0</span>] data,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">255</span>:<span class="number">0</span>] q</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">18</span>*<span class="number">18</span>-<span class="number">1</span>:<span class="number">0</span>] temp;</span><br><span class="line">    <span class="keyword">wire</span> [    <span class="number">255</span>:<span class="number">0</span>] out_temp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 区分对待</span></span><br><span class="line">    <span class="keyword">assign</span> temp[<span class="number">17</span>:<span class="number">0</span>]          = &#123;q[<span class="number">240</span>], q[<span class="number">255</span>:<span class="number">240</span>], q[<span class="number">255</span>]&#125;;</span><br><span class="line">    <span class="keyword">assign</span> temp[<span class="number">18</span>*<span class="number">18</span>-<span class="number">1</span>:<span class="number">18</span>*<span class="number">17</span>] = &#123;q[<span class="number">0</span>], q[<span class="number">15</span>:<span class="number">0</span>], q[<span class="number">15</span>]&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">genvar</span> i;</span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; <span class="number">17</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span> : origin_mat</span><br><span class="line">            <span class="keyword">assign</span> temp[<span class="number">18</span>*(i+<span class="number">1</span>)-<span class="number">1</span>:<span class="number">18</span>*i] = &#123;q[<span class="number">16</span>*(i-<span class="number">1</span>)], q[<span class="number">16</span>*i-<span class="number">1</span>:<span class="number">16</span>*(i-<span class="number">1</span>)], q[<span class="number">16</span>*i-<span class="number">1</span>]&#125;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">genvar</span> j, k;</span><br><span class="line">    <span class="comment">// verilog_format: off</span></span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">16</span>; j = j + <span class="number">1</span>) <span class="keyword">begin</span> : temp_row</span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k &lt; <span class="number">16</span>; k = k + <span class="number">1</span>) <span class="keyword">begin</span> : temp_col</span><br><span class="line">                <span class="keyword">localparam</span> <span class="keyword">integer</span> idx = <span class="number">18</span> * (j + <span class="number">1</span>) + k + <span class="number">1</span>;</span><br><span class="line">                <span class="comment">// 保存最多为 8 的邻居和，4 位足矣</span></span><br><span class="line">                <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] nbr_sum;</span><br><span class="line">                <span class="keyword">wire</span> loc_inst;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">assign</span> nbr_sum =</span><br><span class="line">                    temp[idx-<span class="number">1</span>]   + temp[idx+<span class="number">1</span>] +</span><br><span class="line">                    temp[idx-<span class="number">18</span>]  + temp[idx+<span class="number">18</span>] +</span><br><span class="line">                    temp[idx-<span class="number">18</span>-<span class="number">1</span>]+ temp[idx-<span class="number">18</span>+<span class="number">1</span>] +</span><br><span class="line">                    temp[idx+<span class="number">18</span>-<span class="number">1</span>]+ temp[idx+<span class="number">18</span>+<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">assign</span> loc_inst = (nbr_sum &lt;  <span class="number">2</span>)  ? <span class="number">1&#x27;b0</span> :</span><br><span class="line">                                  (nbr_sum == <span class="number">2</span>) ? temp[idx] :</span><br><span class="line">                                  (nbr_sum == <span class="number">3</span>) ? <span class="number">1&#x27;b1</span> :</span><br><span class="line">                                  <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">assign</span> out_temp[<span class="number">16</span>*j + k] = loc_inst;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (load) <span class="keyword">begin</span></span><br><span class="line">            q &lt;= data;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            q &lt;= out_temp;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="改进">改进</h2><p><a href="https://blog.csdn.net/m0_74101820/article/details/145619118">HDLbits: verilog实现Conwaylife二维元胞自动机 - CSDN</a>简化了数组的表示，采用二维数组：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不包含testbench</span></span><br><span class="line"><span class="keyword">module</span> top_module(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> load,</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">255</span>:<span class="number">0</span>] data,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">255</span>:<span class="number">0</span>] q ); </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        q = <span class="number">256&#x27;h0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//填充为18*18</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">17</span>:<span class="number">0</span>] q_t [<span class="number">17</span>:<span class="number">0</span>]; <span class="comment">//填充后的q_table;</span></span><br><span class="line">    <span class="keyword">genvar</span> i;</span><br><span class="line">    <span class="keyword">generate</span> <span class="comment">//利用循环将q_t的每一行依次填充</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">16</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span>: assign_value</span><br><span class="line">            <span class="keyword">assign</span> q_t[i+<span class="number">1</span>][<span class="number">17</span>:<span class="number">0</span>] = &#123;q[i*<span class="number">16</span>], q[i*<span class="number">16</span>+:<span class="number">16</span>], q[i*<span class="number">16</span>+<span class="number">15</span>]&#125;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">//q_t 18*18 的第一行q_t[0]和最后一行q_t[17]单独赋值，由于这两行相当于原矩阵颠倒了后的值</span></span><br><span class="line">        <span class="keyword">assign</span> q_t[<span class="number">0</span>][<span class="number">17</span>:<span class="number">0</span>] = &#123;q[<span class="number">15</span>*<span class="number">16</span>], q[<span class="number">15</span>*<span class="number">16</span>+:<span class="number">16</span>], q[<span class="number">15</span>*<span class="number">16</span>+<span class="number">15</span>]&#125;;</span><br><span class="line">        <span class="keyword">assign</span> q_t[<span class="number">17</span>][<span class="number">17</span>:<span class="number">0</span>] = &#123;q[<span class="number">0</span>], q[<span class="number">0</span>*<span class="number">16</span>+:<span class="number">16</span>], q[<span class="number">0</span>*<span class="number">16</span>+<span class="number">15</span>]&#125;;</span><br><span class="line">    <span class="keyword">endgenerate</span> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//判断数量,</span></span><br><span class="line">    <span class="keyword">wire</span>[<span class="number">3</span>:<span class="number">0</span>] q_cnt[<span class="number">15</span>:<span class="number">0</span>][<span class="number">15</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">255</span>:<span class="number">0</span>] q_temp;</span><br><span class="line">    <span class="keyword">genvar</span> j,k;</span><br><span class="line">    <span class="keyword">generate</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j&lt;<span class="number">16</span>; j=j+<span class="number">1</span>) <span class="keyword">begin</span>:loop_out</span><br><span class="line">            <span class="keyword">for</span> (k = <span class="number">0</span>; k&lt;<span class="number">16</span>; k=k+<span class="number">1</span>) <span class="keyword">begin</span>:loop_in</span><br><span class="line">                <span class="comment">//依次计算每个位置的邻居数量q_cnt</span></span><br><span class="line">                <span class="keyword">assign</span> q_cnt[j][k] = q_t[j+<span class="number">1</span>][k] + q_t[j+<span class="number">1</span>][k+<span class="number">2</span>] + q_t[j][k] + q_t[j][k+<span class="number">2</span>] + q_t[j][k+<span class="number">1</span>] + q_t[j+<span class="number">2</span>][k] + q_t[j+<span class="number">2</span>][k+<span class="number">2</span>] + q_t[j+<span class="number">2</span>][k+<span class="number">1</span>];</span><br><span class="line">                <span class="comment">//利用三目运算符判断数量，决定下一时刻该位置的q值</span></span><br><span class="line">                <span class="keyword">assign</span> q_temp[j*<span class="number">16</span>+k] = (q_cnt[j][k]==<span class="number">4&#x27;d3</span>)? <span class="number">1&#x27;b1</span>: </span><br><span class="line">                                                            ((q_cnt[j][k]==<span class="number">4&#x27;b0010</span>)? q[j*<span class="number">16</span>+k] :</span><br><span class="line">                                                                                    <span class="number">1&#x27;b0</span>);</span><br><span class="line">            <span class="keyword">end</span> </span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endgenerate</span> </span><br><span class="line"> </span><br><span class="line">    <span class="comment">//上升沿赋值</span></span><br><span class="line">    <span class="keyword">integer</span> m;</span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (load) <span class="keyword">begin</span></span><br><span class="line">            q&lt;=data;</span><br><span class="line">        <span class="keyword">end</span> </span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            q&lt;=q_temp;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info flat&quot;&gt;&lt;p&gt;纪念&lt;a href=&quot;https://zh.wikipedia.org/wiki/%E7%B4%84%E7%BF%B0%C2%B7%E4%</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="HDLBits" scheme="https://blog.esing.dev/tags/HDLBits/"/>
    
  </entry>
  
  <entry>
    <title>雨落长安</title>
    <link href="https://blog.esing.dev/2025/09/29/rainy-changan/"/>
    <id>https://blog.esing.dev/2025/09/29/rainy-changan/</id>
    <published>2025-09-29T09:20:31.000Z</published>
    <updated>2025-10-31T18:46:09.033Z</updated>
    
    <content type="html"><![CDATA[<p><strong>九月的西安，不是在下雨，就是即将要下雨。</strong></p><p>骗你的，其实十月也一样。</p><p>仍记得四年前刚来到西安——这是身为南方人的我，第一次来到真正意义上的北方。尽管从纬度上来看，老家连云港和西安差不多，但一个沿海一个内陆，气候差异还是蛮大的。八月来到学校的时候正是万里无云的好天气——灼热的阳光直晒几乎要将人烤焦。如果说南京是南方特有的“蒸笼热”，那西安便是北方的“直射热”。毕竟，树荫底下，仍存留一丝清凉。若有微风拂面，更是惬意。不走在太阳下，便还是很凉快的。</p><p>八月都这么热，九月想必也是一样的吧？可惜，想错了。</p><p>刚步入九月，开学后便是连绵不断的雨、雨、雨。雨并不大，但很让人恼火——哪怕是小雨，你也没有办法骑车在外，更不用说稍微密集一点的毛毛雨了，它会迅速打湿衣服外层。与雨一同而来的，是冷空气群。气温一度降低到十几度，出门甚至都要穿上羽绒服。极大的温差也容易让人感冒。有趣的是，这雨似乎真和集体活动有关——不论是开学典礼，还是校内举办的露天演唱会，亦或者运动会，前几天还一直是阴天，只要到了活动当天，必定会开始下雨。是活动没选好时间，还是天公作美呢？</p><hr><p>记得大一的国庆就没出去玩，因为雨连绵不断。大二的国庆，与室友一起去看了兵马俑，但即使是下雨也阻挡不住热情的游客，展馆内几乎摩肩接踵。大三的国庆，则是待在宿舍，写了整整一星期的 <a href="/2024/07/19/bwyeink-drive-development/" title="记一次无技术手册开发墨水屏驱动的过程">墨水屏驱动</a>。大四，则是忙着考研，一直在宿舍复习。现在想想，国庆似乎就没有出去玩过。毕竟，阴沉沉的天、冷冰冰的雨，换谁来都不会愿意待在室外。</p><hr><p>2025年的国庆，又是连绵不断的雨。好不容易找了不下雨的一天，去看望看望二战考研的室友，一起吃顿饭、聊聊天。虽然雨停了，可天气依旧是阴沉沉的。即使是这种不算好的天气，回民街周围依旧是人来人往——旅游城市是这样的。</p><hr><p>这连绵不断下了将近两个月的雨，终于在十月底落幕了。清晨拉开窗帘，食堂的玻璃外墙反射的阳光，让我不由得愣了一下。接下来便是将积累的衣服一股脑甩进洗衣机里——再去走廊上见缝插针挂上衣服。毕竟，雨一停，大家都要晒衣物了。阴干的衣服总有种发霉的味道，急需阳光的附魔，染上“太阳的味道”。这似乎是紫外线与纤维表面的有机物进行反应，产生一种清爽而又干净的味道。理科还真是不浪漫呢。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;九月的西安，不是在下雨，就是即将要下雨。&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;骗你的，其实十月也一样。&lt;/p&gt;
&lt;p&gt;仍记得四年前刚来到西安——这是身为南方人的我，第一次来到真正意义</summary>
      
    
    
    
    <category term="随笔" scheme="https://blog.esing.dev/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="杂谈" scheme="https://blog.esing.dev/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：第三篇</title>
    <link href="https://blog.esing.dev/2025/09/28/vd-p3/"/>
    <id>https://blog.esing.dev/2025/09/28/vd-p3/</id>
    <published>2025-09-28T02:48:34.000Z</published>
    <updated>2025-11-09T03:43:54.095Z</updated>
    
    <content type="html"><![CDATA[<h2 id="RISC-V简介">RISC-V简介</h2><p>也可以看一下 <a href="/2024/04/20/dsd-p12/" title="数字系统设计复习笔记：第十二篇">数字系统设计复习笔记：第十二篇</a></p><h3 id="寄存器">寄存器</h3><p>RV32/64I指令集定义了32个32/64位的通用整数寄存器x0～x31，其中x0固定用于存放数据0；寄存器位数决定了其可以访问的地址空间大小。</p><table><thead><tr><th>寄存器</th><th>别名</th><th>常见用途</th></tr></thead><tbody><tr><td><code>x1</code></td><td><code>ra</code></td><td><strong>返回地址 (Return Address)</strong>：<code>jal</code> 指令自动将返回地址存入此处。</td></tr><tr><td><code>x2</code></td><td><code>sp</code></td><td><strong>栈指针 (Stack Pointer)</strong>：指向当前栈顶。</td></tr><tr><td><code>x3</code></td><td><code>gp</code></td><td><strong>全局指针 (Global Pointer)</strong>：指向 2048 字节的小数据区（<code>.sdata</code>），用于高效访问小全局变量。</td></tr><tr><td><code>x4</code></td><td><code>tp</code></td><td><strong>线程指针 (Thread Pointer)</strong>：用于线程本地存储（TLS）。</td></tr><tr><td><code>x5</code></td><td><code>t0</code></td><td><strong>临时寄存器 (Temporary)</strong>：调用者保存（caller-saved）。</td></tr><tr><td><code>x6</code>–<code>x7</code></td><td><code>t1</code>, <code>t2</code></td><td>额外的临时寄存器。</td></tr><tr><td><code>x8</code></td><td><code>s0</code> / <code>fp</code></td><td><strong>保存寄存器 / 帧指针</strong>：被调用者保存（callee-saved）。也可用作帧指针。</td></tr><tr><td><code>x9</code></td><td><code>s1</code></td><td>保存寄存器。</td></tr><tr><td><code>x10</code>–<code>x17</code></td><td><code>a0</code>–<code>a7</code></td><td><strong>函数参数和返回值</strong>：传递前 8 个参数；<code>a0</code>/<code>a1</code> 也用于返回值。</td></tr><tr><td><code>x18</code>–<code>x27</code></td><td><code>s2</code>–<code>s11</code></td><td><strong>保存寄存器</strong>：被调用者保存，适合存放局部变量。</td></tr><tr><td><code>x28</code>–<code>x31</code></td><td><code>t3</code>–<code>t6</code></td><td>临时寄存器。</td></tr></tbody></table><h3 id="指令组成">指令组成</h3><p>也可以看一下 <a href="/2025/04/07/riscvcod-intro/" title="从零开始学RISCV：序篇">从零开始学RISCV：序篇</a></p><h2 id="单周期RISC-V处理器的数据通路">单周期RISC-V处理器的数据通路</h2><h3 id="I-Type-LOAD">I-Type (LOAD)</h3><p><code>lw</code>的指令格式为I-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:20]    [19:15]    [14:12]    [11:7]    [6:0]</span><br><span class="line">imm        rs1        funct3     rd        op</span><br><span class="line">12bits     5bits      3bits      5bits     7bits</span><br></pre></td></tr></table></figure><p>首先从<u>指令内存</u>中取指，根据<code>op</code>决定是<code>lw</code>指令，随后从指令中拆分出寄存器地址<code>rs1</code>并从<u>寄存器堆</u>中读取对应地址的值，再将立即数<code>imm</code>从12位补全到32位，接着将两个值送进ALU进行运算。运算完成后，将结果输入<u>数据内存</u>，读取对应地址数据值，再将数据值传回<u>寄存器堆</u>，写入目标寄存器<code>rd</code>，最后决定下一个指令的地址为<code>PC+4</code>，送回<u>PC寄存器</u>。</p><img src="https://webp.esing.dev/img/image-20250928165620259_250928_1656_YRpN.png" alt="lw单周期数据通路" style="zoom: 67%;" /><h3 id="S-Type">S-Type</h3><p><code>sw</code>的指令格式为S-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:25]    [24:20]    [19:15]    [14:12]    [11:7]    [6:0]</span><br><span class="line">imm[11:5]  rs2        rs1        funct3     imm[4:0]  op</span><br><span class="line">6bits      5bits      5bits      3bits      5bits     7bits</span><br></pre></td></tr></table></figure><p>首先从<u>指令内存</u>中取指，根据<code>op</code>决定是<code>sw</code>指令，随后从指令中拆分出寄存器地址<code>rs1</code>并从<u>寄存器堆</u>中读取对应地址的值，再将立即数<code>imm</code>从12位补全到32位，接着将两个值送进ALU进行运算。运算完成后，将结果输入<u>数据内存</u>，以选择目标地址，再将数据值从<u>寄存器堆</u>传入<u>数据内存</u>，最后决定下一个指令的地址为<code>PC+4</code>，送回<u>PC寄存器</u>。</p><img src="https://webp.esing.dev/img/image-20250928175757718_250928_1757_Zf1h.png" alt="sw单周期数据通路" style="zoom: 67%;" /><h3 id="R-Type">R-Type</h3><p><code>or</code>的指令格式为R-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:25]    [24:20]    [19:15]    [14:12]    [11:7]    [6:0]</span><br><span class="line">funct7     rs2        rs1        funct3     rd        op</span><br><span class="line">6bits      5bits      5bits      3bits      5bits     7bits</span><br></pre></td></tr></table></figure><p>首先从<u>指令内存</u>中取指，根据<code>op</code>只能决定是R-Type指令，具体为什么指令还需要读取<code>funct7</code>和<code>funct3</code>进行判断。判断为<code>or</code>后，从指令中拆分出寄存器地址<code>rs1</code>与<code>rs2</code>，并从<u>寄存器堆</u>中读取对应地址的值，不经过立即数拓展，直接送入<u>ALU</u>进行比较，随后将数据值传回<u>寄存器堆</u>，写入目标寄存器<code>rd</code>，最后决定下一个指令的地址为<code>PC+4</code>，送回<u>PC寄存器</u>。</p><img src="https://webp.esing.dev/img/image-20250928183326295_250928_1833_xlwm.png" alt="or单周期数据通路" style="zoom: 67%;" /><h3 id="B-Type">B-Type</h3><p><code>beq</code>的指令格式为B-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:25]        [24:20]    [19:15]    [14:12]    [11:7]        [6:0]</span><br><span class="line">imm[12, 10:5]  rs2        rs1        funct3     imm[4:1, 11]  op</span><br><span class="line">6bits          5bits      5bits      3bits      5bits         7bits</span><br></pre></td></tr></table></figure><p>首先从指令内存中取指，根据<code>op</code>决定为B-Type，随后从指令中拆分出寄存器地址<code>rs1</code>与<code>rs2</code>，并从<u>寄存器堆</u>中读取对应地址的值，接着将两个值送进ALU进行运算，结果为14-14=0。运算完成后，将CPSR的Z设置为1。同时，立即数扩展产生-12，与PC相加，得到新的PC地址，并送入PC选择器以便随后使用。</p><div class="note info flat"><p>这里为什么是-12？</p><p><code>0xFFA</code>为<code>1111_1111_1010</code>，负数补码为取反加一，因此是<code>0000_0000_0101(2)+1(2)=0110(2)=6(10)</code>。所以<code>0xFFA</code>为-6。又因为要低位拓展为0，即算术左移，相当于乘以2，所以最终的立即数为-12。</p><p>注意这里的立即数是<code>imm[12:1]</code>，低位还需要补0。最终为13位立即数，表达式为：<br><code>{20{Instr[31]}, Instr[7], Instr[30:25], Instr[11:8], 1'b0}</code></p></div><img src="https://webp.esing.dev/img/image-20251014225812729_251014_2258_CvjQ.png" alt="beq单周期数据通路" style="zoom:60%;" /><h3 id="控制信号生成">控制信号生成</h3><p>单周期处理器的控制单元基于<code>op</code>、<code>funct3</code>和 <code>funct7</code>设计控制信号。RV32I 指令集只使用<code>funct7</code>的第 5 位。</p><img src="https://webp.esing.dev/img/image-20251014235722929_251014_2357_hnTB.png" alt="控制信号生成的高层与底层结构图" style="zoom: 50%;" /><h3 id="增强的I-Type指令支持">增强的I-Type指令支持</h3><p>对于<code>addi</code>指令，其同样为I-Type，但是仅靠先前的通路无法执行，因其控制信号与<code>lw</code>不同。<code>ImmSrc</code>依旧为00，<code>ALUSrc</code>为1，代表使用立即数扩展后的结果。但<code>ResultSrc</code>为0，代表直接使用ALU的计算结果而不从数据寄存器取值。</p><img src="https://webp.esing.dev/img/image-20251015105925057_251015_1059_TE5F.png" alt="addi单周期数据通路以及控制信号" style="zoom: 60%;" /><h3 id="J-Type">J-Type</h3><p><code>jal</code>的指令格式为J-Type：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[31:11]                   [11:7]        [6:0]</span><br><span class="line">imm[20, 10:1, 11, 19:12]  rd            op</span><br><span class="line">20bits                    5bits         7bits</span><br></pre></td></tr></table></figure><p>首先从<u>指令内存</u>中取指，根据<code>op</code>决定为J-Type，随后从指令中拆分出寄存器地址<code>rd</code>，并将<code>pc+4</code>写入<u>寄存器堆</u>，再将立即数<code>imm</code>从21位补全到32位，和<code>pc</code>一起送入<u>ALU</u>进行运算，求得新的地址值，最后传回<u>PC寄存器</u>。</p><div class="note warning flat"><p>I/S-Type的立即数均为12位，B-Type的立即数为13位，J-Type最长，为21位！</p><p>和B-Type类似，J-Type同样需要低位补0（乘以2）。</p></div><img src="https://webp.esing.dev/img/image-20251015110657612_251015_1106_opzy.png" alt="jal单周期数据通路以及控制信号" style="zoom:60%;" /><h3 id="执行时间">执行时间</h3><p>对于单周期处理器来说，周期时间受限于关键路径，即执行时间最长的路径。通常，路径中的瓶颈在内存存取、ALU和寄存器堆读写中。</p><img id="table" src="https://webp.esing.dev/img/image-20251015111222002_251015_1112_zf5L.png" alt="各组件执行任务所需时间" style="zoom:50%;" /><p>对于所有指令操作，<code>lw</code>是执行最长的。可将时间简化为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mrow><msub><mi mathvariant="normal">c</mi><mo lspace="0em" rspace="0em">−</mo></msub><mi mathvariant="normal">s</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi></mrow></msub><mo>=</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">p</mi><mi mathvariant="normal">c</mi><msub><mi mathvariant="normal">q</mi><mo lspace="0em" rspace="0em">−</mo></msub><mi mathvariant="normal">P</mi><mi mathvariant="normal">C</mi></mrow></msub><mo>+</mo><mn>2</mn><msub><mi>t</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">m</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">d</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">A</mi><mi mathvariant="normal">L</mi><mi mathvariant="normal">U</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">x</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mrow><mi mathvariant="normal">R</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">p</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{\mathrm{c_{-}single}}=t_{\mathrm{pcq_{-}PC}}+2t_{\mathrm{mem}}+t_{\mathrm{RFread}}+t_{\mathrm{ALU}}+t_{\mathrm{mux}}+t_{\mathrm{RFsetup}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9751em;vertical-align:-0.2918em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span><span class="mord mathrm mtight">single</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2918em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9068em;vertical-align:-0.2918em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">pc</span><span class="mord mtight"><span class="mord mathrm mtight">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2737em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">−</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2025em;"><span></span></span></span></span></span></span><span class="mord mathrm mtight">PC</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2918em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">mem</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">RFread</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">ALU</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">mux</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">RFsetup</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><h2 id="多周期RISC-V处理器">多周期RISC-V处理器</h2><p>单周期处理器有 3 个明显的缺点。首先，使用两个独立的内存分别存储指令和数据，而大多数处理器只有一个内存用于存储指令和数据；其次，需要足够长的时钟周期支持最慢的指令<code>lw</code>, 尽管大多数指令可能更快；最后，用了 3 个加法器（1 个在 ALU 中，2 个用于实现 PC 逻辑），而加法器是相对昂贵的电路，尤其是需要快速时价格更高。</p><p>对于多周期处理器，使用组合内存，既存储指令也存储数据。这样，可以在一个周期读取指令而在另一个周期读取或写入数据。</p><img src="https://webp.esing.dev/img/image-20251021092607468_251021_0926_V9Wk.png" alt="多周期处理器结构，注意有一个用于存储旧PC的寄存器" style="zoom:50%;" /><h2 id="流水线RISC-V处理器">流水线RISC-V处理器</h2><p>这应该是处理器的最终形态了：用流水线来增加吞吐量。</p><p>参考 <a href="/2024/06/16/coae-p10/" title="计算机原理与嵌入式系统笔记：第十篇">计算机原理与嵌入式系统笔记：第十篇</a></p><p><img src="https://webp.esing.dev/img/image-20251025005741517_251025_0057_IzT8.png" alt="带控制器的流水线处理器"></p><h3 id="性能计算">性能计算</h3><div class="note danger flat"><p>必考。了解如何计算，以及哪些指令需要阻塞。</p></div><p>我们假定：</p><ul><li>40% 的load指令被下一条指令使用；</li><li>50% 的分支指令预测错误；</li><li>不停滞时Load CPI = 1, 停滞时为2；</li><li>不停滞时Branch CPI = 1,停滞时为3；</li></ul><p>对于平均Load CPI，计算为 <code>1x0.6 + 2x0.4=1.4</code>；分支CPI同理，可求得为2。</p><p>对于 SPECINT2000 benchmark 测评程序：</p><ul><li>25% loads</li><li>10% stores</li><li>11% branches</li><li>2% jumps</li><li>52% R-type/I-type ALU</li></ul><p>我们认为Jump指令的CPI为3，是因为前两个周期(IF/ID)正常执行，但还需要一周期的气泡。</p><p>因此，可求得平均CPI为 <code>0.25x1.4 + 0.1x1 + 0.11x2 + 0.02x3 + 0.52x1 = 1.25</code>。</p><h3 id="执行时间-2">执行时间</h3><p>参考上面的<a href="#table">表格</a>，计算关键路径：</p><img src="https://webp.esing.dev/img/image-20251025010402054_251025_0104_IGyY.png" alt="流水线处理器关键路径" style="zoom: 50%;" /><p>可列出流水线周期表达式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>T</mi><mrow><mi>c</mi><mi mathvariant="normal">_</mi><mi>p</mi><mi>i</mi><mi>p</mi><mi>e</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>=</mo><msub><mi>t</mi><mrow><mi>p</mi><mi>c</mi><mi>q</mi></mrow></msub><mo>+</mo><mn>4</mn><msub><mi>t</mi><mtext>mux</mtext></msub><mo>+</mo><msub><mi>t</mi><mtext>ALU</mtext></msub><mo>+</mo><msub><mi>t</mi><mrow><mi>A</mi><mi>N</mi><mi>D</mi><mo>−</mo><mi>O</mi><mi>R</mi></mrow></msub><mo>+</mo><msub><mi>t</mi><mtext>setup</mtext></msub></mrow><annotation encoding="application/x-tex">T_{c\_pipelined} = t_{pcq} + 4t_\text{mux} + t_\text{ALU} + t_{AND-OR} + t_\text{setup}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0503em;vertical-align:-0.367em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mtight" style="margin-right:0.02778em;">_</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.367em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7944em;vertical-align:-0.15em;"></span><span class="mord">4</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">mux</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">ALU</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8234em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.00773em;">OR</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">setup</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>求得流水线的周期为350ps。因此，执行1000亿条指令的程序，在求得CPI为1.25的状况下，总消耗时间为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>100</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>9</mn></msup><mo>×</mo><mn>1.25</mn><mo>×</mo><mo stretchy="false">(</mo><mn>350</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>12</mn></msup><mo stretchy="false">)</mo><mo>=</mo><mn>44</mn><mtext> </mtext><mi>s</mi></mrow><annotation encoding="application/x-tex">100\times10^9\times1.25\times(350\times10^{12})=44\ s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">100</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9474em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">9</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1.25</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">350</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">44</span><span class="mspace"> </span><span class="mord mathnormal">s</span></span></span></span></span></p><table><thead><tr><th>处理器</th><th>执行时间</th><th>加速比</th></tr></thead><tbody><tr><td>单周期</td><td>75s</td><td>1</td></tr><tr><td>多周期</td><td>155s</td><td>0.5</td></tr><tr><td>流水线</td><td>44s</td><td>1.7</td></tr></tbody></table><h2 id="先进微架构">先进微架构</h2><ul><li><strong>超标量（Superscalar）架构</strong>：在一个时钟周期内发射多条指令（例如 Intel Core、AMD Zen 系列）。</li><li><strong>深度流水线（Deep Pipeline）</strong>：将指令执行分解为更多阶段（例如 Intel NetBurst 曾达到 31 级流水线）。</li><li><strong>动态流水线调整</strong>：现代架构（如 Apple M1、AMD Zen 4）可根据功耗和负载动态调整流水线深度。</li><li><strong>乱序执行（Out-of-Order Execution）</strong>：打破程序的指令顺序约束，动态调度以最大化执行单元利用率。</li><li><strong>寄存器重命名（Register Renaming）</strong>：避免伪依赖（false dependency），提升并行度。</li><li><strong>混合架构（Hybrid Architecture）</strong>：如 Intel Alder Lake 的 Performance Core 与 Efficiency Core。</li><li><strong>多线程（Multithreading）</strong>：如 Intel 的 Hyper-Threading（超线程）技术</li></ul><h3 id="超标量">超标量</h3><p>超标量内部含有多条数据通路，可以同时执行多条指令。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/image-20251105163349437_251105_1633_Jcq4.png","alt":"无数据依赖关系的超标量"},{"url":"https://pic.esing.dev/img/image-20251105163322093_251105_1633_Cc1H.png","alt":"带数据依赖关系的超标量"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>对于两路超标量，理想的IPC（Instruction Per Cycle，每周期执行指令数，为CPI的倒数）为2；对于上面带数据依赖的程序，实际的IPC为<code>6 / 5 = 1.2</code>，因实际周期时间从5到9，为5个周期。注意<code>lw</code>指令后必定阻塞一拍。</p><h3 id="乱序发射">乱序发射</h3><p>乱序提前检测多条指令并尽快发送无依赖的指令。只要保证依赖关系满足，可以产生预期效果，就可以不按照程序编写的顺序发送指令。</p><div class="gallery">    <div class="fj-gallery  data" data-rowHeight="220" data-limit="10">    <span class="gallery-data">[{"url":"https://pic.esing.dev/img/image-20251105163249143_251105_1632_bez1.png","alt":"带依赖关系的乱序执行"}]</span>    </div>    <button class="gallery-load-more"><span>加载更多</span><i class="fa-solid fa-arrow-down"></i></button>    </div><p>对于上面带依赖关系的乱序执行，其IPC为<code>6 / 4 = 1.5</code>。</p><h3 id="SIMD">SIMD</h3><p>SIMD（Single Instruction Multiple Data，单指令多数据）可以显著增加数据的并行度，如将8个8位元素相加。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;RISC-V简介&quot;&gt;RISC-V简介&lt;/h2&gt;
&lt;p&gt;也可以看一下 &lt;a href=&quot;/2024/04/20/dsd-p12/&quot; title=&quot;数字系统设计复习笔记：第十二篇&quot;&gt;数字系</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>隐秘参数APP使用ADB打印更多信息</title>
    <link href="https://blog.esing.dev/2025/09/21/hiddenprobe-adb/"/>
    <id>https://blog.esing.dev/2025/09/21/hiddenprobe-adb/</id>
    <published>2025-09-21T12:41:33.000Z</published>
    <updated>2025-09-23T05:58:42.912Z</updated>
    
    <content type="html"><![CDATA[<p>最近在用“隐秘参数”这款APP查看手机信息。软件内有提示说无法获取的信息要用ADB命令，奈何软件太久没更新，帮助链接已经失效了。</p><p>上网查询了一下，要在CMD里运行下面命令（Powershell执行时会报错，不知道为啥）：</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FOR</span> /F &quot;tokens=<span class="number">2</span> delims=:&quot; %p <span class="keyword">IN</span> (&#x27;adb shell pm <span class="built_in">path</span> com.x1y9.probe&#x27;) <span class="keyword">do</span> adb shell CLASSPATH=%p app_process / com.x1y9.app.MainActivity</span><br></pre></td></tr></table></figure><p>额外的参数就会被打印到终端了。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近在用“隐秘参数”这款APP查看手机信息。软件内有提示说无法获取的信息要用ADB命令，奈何软件太久没更新，帮助链接已经失效了。&lt;/p&gt;
&lt;p&gt;上网查询了一下，要在CMD里运行下面命令（Powe</summary>
      
    
    
    
    <category term="技术分享" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="ADB" scheme="https://blog.esing.dev/tags/ADB/"/>
    
    <category term="隐秘参数" scheme="https://blog.esing.dev/tags/%E9%9A%90%E7%A7%98%E5%8F%82%E6%95%B0/"/>
    
  </entry>
  
  <entry>
    <title>超大规模集成电路设计笔记：第二篇</title>
    <link href="https://blog.esing.dev/2025/09/17/vd-p2/"/>
    <id>https://blog.esing.dev/2025/09/17/vd-p2/</id>
    <published>2025-09-17T12:00:34.000Z</published>
    <updated>2025-11-09T03:45:41.365Z</updated>
    
    <content type="html"><![CDATA[<h2 id="浮点数">浮点数</h2><h3 id="浮点数标准">浮点数标准</h3><p>IEEE标准754-1985定义了浮点数的<strong>存储格式、运算规则、舍入方式以及特殊值的处理</strong>（如无穷大、NaN等）。其核心思想是用科学计数法的形式来表示实数：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mi>R</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>s</mi></msup><mo>×</mo><mi>M</mi><mo>×</mo><msup><mn>2</mn><mi>E</mi></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mi>s</mi></msup><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>F</mi><mo stretchy="false">)</mo><mo>×</mo><msup><mn>2</mn><mi>E</mi></msup></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}R &amp;= (-1)^s \times M \times 2^E \\  &amp;= (-1)^s \times (1+F) \times 2^E\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.1027em;vertical-align:-1.3013em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8013em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span></span></span><span style="top:-2.3587em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3013em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8013em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span></span></span></span></span></span></span><span style="top:-2.3587em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord">−</span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.3013em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>其中：</p><ul><li>s为符号位；</li><li>M为尾数，即有效数字部分，在1-2之间；</li><li>F为小数部分，在0-1之间；</li><li>E为指数，表示以 2 为底的幂次。</li></ul><p>IEEE 754 定义了多种精度格式，最常用的是单精度浮点数与双精度浮点数：</p><ul><li><strong>单精度浮点数 总共 32 位（4 字节）</strong><ul><li>1 位符号位</li><li>8 位指数（偏移量为 127）</li><li>23 位尾数（实际精度为 24 位，因为有隐含的前导1）</li></ul></li><li><strong>双精度浮点数 总共 64 位（8 字节）</strong><ul><li>1 位符号位</li><li>11 位指数（偏移量为 1023）</li><li>52 位尾数（实际 53 位精度）</li></ul></li></ul><p>不论是单精度还是双精度，指数中的000….0和111…1都保留未使用。</p><div class="note info flat"><p>什么是“隐含首位 (implicit leading bit)”？</p><p>在标准化的浮点数表示中（非零数），尾数总是被表示成<code>1.2345x2^{E}</code>，二进制中<strong>标准化保证了最高位总是1</strong>，因此这个1不用显式存储。这节省了 1 位空间，但这位仍然<strong>参与计算</strong>，因此尾数的实际精度比存储多 1 位。</p></div><p>此外，IEEE 754 还定义了许多特殊情况：</p><table><thead><tr><th>情况</th><th>指数部分</th><th>尾数部分</th><th>含义</th></tr></thead><tbody><tr><td>正常数</td><td>非全0非全1</td><td>任意</td><td>正规浮点数</td></tr><tr><td>零</td><td rowspan="2">全为0</td><td>全为0</td><td>+0 或 -0（符号位决定）</td></tr><tr><td>非规约数（Denormal/Subnormal）</td><td>非全0</td><td>表示非常接近0的数，扩展下溢范围</td></tr><tr><td>无穷大（Infinity）</td><td rowspan="2">全为1</td><td>全为0</td><td>如 1.0/0.0 → +∞</td></tr><tr><td>NaN（Not a Number）</td><td>非全0</td><td>非法操作结果，如 0/0、√(-1)</td></tr></tbody></table><h3 id="相对精度">相对精度</h3><p>在浮点数表示中，<strong>相对精度是近似恒定的</strong>（在同一个指数区间内），这是浮点数优于定点数的关键之一。恒定的相对精度让浮点数系统在数值计算中具有 <strong>“比例一致性”</strong> ：乘法、除法、指数放缩不会影响数值的精度层次，在算法分析时，也可以假设“每一步计算误差 ≈ ε × 结果”。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>F</mi><mi>N</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>23</mn><mo>×</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>10</mn></msub><mn>2</mn><mo>≈</mo><mn>23</mn><mo>×</mo><mn>0.3</mn><mo>≈</mo><mn>6</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>D</mi><mi>N</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>52</mn><mo>×</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>10</mn></msub><mn>2</mn><mo>≈</mo><mn>52</mn><mo>×</mo><mn>0.3</mn><mo>≈</mo><mn>16</mn></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}F_N &amp;= 23 \times \log_{10}2 \approx 23 \times 0.3 \approx 6 \\D_N &amp;= 52 \times \log_{10}2 \approx 52 \times 0.3 \approx 16\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.75em;"><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">23</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">23</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">0.3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">6</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">52</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">10</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">52</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">0.3</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">16</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><h3 id="浮点加法">浮点加法</h3><p>计算分四步走：</p><ol><li>对齐数字：按较小的指数移动数字</li><li>整数及尾数相加</li><li>规格化结果并检查是否上溢或下溢</li><li>若有必要，进位并再次规格化</li></ol><p>首先考虑4位的十进制：9.999 × 10<sup>1</sup> + 1.610 × 10<sup>–1</sup> = ?</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">9</span><span class="variable">.999</span>  × <span class="number">10</span>^<span class="number">1</span> + <span class="number">1</span><span class="variable">.610</span> × <span class="number">10</span>^&#123;–<span class="number">1</span>&#125;</span><br><span class="line">=  <span class="number">9</span><span class="variable">.999</span>  × <span class="number">10</span>^<span class="number">1</span> + <span class="number">0</span><span class="variable">.016</span> × <span class="number">10</span>^<span class="number">1</span>  <span class="comment">// 对齐</span></span><br><span class="line">= <span class="number">10</span><span class="variable">.015</span>  × <span class="number">10</span>^<span class="number">1</span>                 <span class="comment">// 整数与尾数相加</span></span><br><span class="line">=  <span class="number">1</span><span class="variable">.0015</span> × <span class="number">10</span>^<span class="number">2</span>                 <span class="comment">// 规格化结果</span></span><br><span class="line">=  <span class="number">1</span><span class="variable">.002</span>  × <span class="number">10</span>^<span class="number">2</span>                 <span class="comment">// 进位并再次规格化</span></span><br></pre></td></tr></table></figure><p>随后考虑4位的二进制：1.000<sub>2</sub> × 2<sup>–1</sup> + –1.110<sub>2</sub> × 2<sup>–2</sup> (0.5 + –0.4375) = ？</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125; + –<span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">2</span>&#125; <span class="comment">// (0.5 + –0.4375)</span></span><br><span class="line">= <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125; + –<span class="number">0</span><span class="variable">.111</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125; <span class="comment">// 对齐</span></span><br><span class="line">= <span class="number">0</span><span class="variable">.001</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125;                      <span class="comment">// 整数与尾数相加</span></span><br><span class="line">= <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;-<span class="number">4</span>&#125;                      <span class="comment">// 规格化，未溢出</span></span><br><span class="line">= <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;-<span class="number">4</span>&#125; = <span class="number">0</span><span class="variable">.0625</span>             <span class="comment">// 无需进位与规格化</span></span><br></pre></td></tr></table></figure><h4 id="硬件实现">硬件实现</h4><p>显然，与整数加法器相比，浮点加法器的硬件结构要复杂得多。考虑到其复杂性，在一个时钟周期内完成会花费太长时间，因此通常设计为需要几个周期才能完成计算。常用流水线来实现。</p><img src="https://webp.esing.dev/img/image-20250917225620166_250917_2256_8Hqr.png" alt="浮点加法器硬件结构图" style="zoom: 33%;" /><h3 id="浮点乘法">浮点乘法</h3><p>与加法相比，浮点数乘法计算分五步走：</p><ol><li>把指数相加</li><li>整数及尾数相乘</li><li>规格化结果并检查是否上溢或下溢</li><li>若有必要，进位并再次规格化</li><li><strong>确定符号位</strong></li></ol><p>首先考虑4位的十进制：1.110 × 10<sup>10</sup> × 9.200 × 10<sup>–5</sup> = ?</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="number">1</span><span class="variable">.110</span>  × <span class="number">10</span>^<span class="number">10</span> × <span class="number">9</span><span class="variable">.200</span> × <span class="number">10</span>^&#123;–<span class="number">5</span>&#125;</span><br><span class="line">=  <span class="number">1</span><span class="variable">.110</span>  × <span class="number">9</span><span class="variable">.200</span> × <span class="number">10</span>^(<span class="number">10</span> - <span class="number">5</span>)  <span class="comment">// 指数相加</span></span><br><span class="line">= <span class="number">10</span><span class="variable">.212</span>  × <span class="number">10</span>^<span class="number">5</span>                 <span class="comment">// 整数与尾数相乘</span></span><br><span class="line">=  <span class="number">1</span><span class="variable">.0212</span> × <span class="number">10</span>^<span class="number">6</span>                 <span class="comment">// 规格化结果</span></span><br><span class="line">=  <span class="number">1</span><span class="variable">.021</span>  × <span class="number">10</span>^<span class="number">6</span>                 <span class="comment">// 进位并再次规格化</span></span><br><span class="line">= +<span class="number">1</span><span class="variable">.021</span>  × <span class="number">10</span>^<span class="number">6</span>                 <span class="comment">// 确定符号位</span></span><br></pre></td></tr></table></figure><p>随后考虑4位的二进制：1.000<sub>2</sub> × 2<sup>–1</sup> × –1.110<sub>2</sub> × 2<sup>–2</sup> (0.5 × –0.4375) = ？</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">1</span>&#125; × –<span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;–<span class="number">2</span>&#125; (<span class="number">0</span><span class="variable">.5</span> × –<span class="number">0</span><span class="variable">.4375</span>)</span><br><span class="line">Unbiased: –<span class="number">1</span> + –<span class="number">2</span> = –<span class="number">3</span>              <span class="comment">// 把指数相加</span></span><br><span class="line">Biased: (–<span class="number">1</span> + <span class="number">127</span>) + (–<span class="number">2</span> + <span class="number">127</span>)</span><br><span class="line">         = –<span class="number">3</span> + <span class="number">254</span> – <span class="number">127</span> </span><br><span class="line">         = –<span class="number">3</span> + <span class="number">127</span></span><br><span class="line"> =  <span class="number">1</span><span class="variable">.000</span>(<span class="number">2</span>)  × <span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>)            <span class="comment">// 整数与尾数相乘</span></span><br><span class="line"> =  <span class="number">1</span><span class="variable">.1102</span>(<span class="number">2</span>) × <span class="number">2</span>^&#123;-<span class="number">3</span>&#125;</span><br><span class="line"> =  <span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>)  × <span class="number">2</span>^&#123;–<span class="number">3</span>&#125;              <span class="comment">// 规格化，未溢出</span></span><br><span class="line"> =  <span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>)  × <span class="number">2</span>^&#123;–<span class="number">3</span>&#125;              <span class="comment">// 无需进位与规格化</span></span><br><span class="line"> = -<span class="number">1</span><span class="variable">.110</span>(<span class="number">2</span>)  × <span class="number">2</span>^&#123;–<span class="number">3</span>&#125; = –<span class="number">0</span><span class="variable">.21875</span>   <span class="comment">// 确定符号位</span></span><br></pre></td></tr></table></figure><h2 id="有限状态机">有限状态机</h2><a href="/2024/04/19/dsd-p7/" title="数字系统设计复习笔记：第七篇">数字系统设计复习笔记：第七篇</a><h2 id="时序">时序</h2><div class="note danger flat"><p>必考。重点看时钟偏斜和触发器时序要求。</p></div><p><s>给我干哪来了，这还是VLSI设计吗</s></p><a href="/2024/10/04/dcmos-p5/" title="数字CMOS集成电路复习笔记：第五篇">数字CMOS集成电路复习笔记：第五篇</a><ul><li>传输延时：输入端信号开始变化到输出端信号<strong>稳定下来</strong>所需要的时间</li><li>污染延时：输入端信号开始变化到输出端信号<strong>开始变化</strong>所需要的时间</li><li>建立时间：上升沿到来<strong>前</strong>，输入端数据需要<strong>保持稳定</strong>的最小时间</li><li>保持时间：上升沿到来<strong>后</strong>，输入端数据需要<strong>保持稳定</strong>的最小时间</li></ul><img src="https://webp.esing.dev/img/image-20250919134935882_250919_1349_0011.png" alt="简单的时序分析例子" style="zoom: 33%;" /><h3 id="同步与异步">同步与异步</h3><ul><li>如果所有的状态转换被限制在精确的时间点上周期性地发生，这些时间点由一个被称为时钟的特殊信号决定，那么这个（子）电路被称为<strong>同步运行</strong> ；</li><li>当一个（子）电路中的部分或全部存储元素被允许独立于全局而改变它们的状态时，该电路就被称作<strong>异步运行</strong> 。</li></ul><h3 id="设计原则">设计原则</h3><p><strong>同步时序设计的第一个指导原则：</strong></p><ul><li>异步复位信号（何时进入启动状态）</li><li>时钟信号（何时从一个状态进入下一个状态）</li><li>信息信号（进入什么状态，产生什么输出）</li></ul><p>这三类的信号不能混合处理。</p><p>二进制组合逻辑操作（即除反相器和缓冲器以外的逻辑门）需要被严格限制在信息信号中。此外，时钟和非同步复位由扇出树专门分配。</p><p><strong>同步时序设计的第二个指导原则：</strong></p><p>使<strong>时钟周期足够长</strong>，以确保在下一个有效的时钟边沿指示寄存器（和其他存储设备）接受新的数据之前，所有的瞬态效应都已经消失了。</p><h3 id="错误示例">错误示例</h3><img src="https://webp.esing.dev/img/image-20250921123000462_250921_1230_wqK2.png" alt="该电路把与门直连到时钟线上去，可能门控信号会产生毛刺" style="zoom:33%;" /><div class="note warning flat"><p>临时增加的异步操作通常在VLSI中是不安全并且低效的！</p></div><h2 id="功率和能耗">功率和能耗</h2><a href="/2024/09/05/dcmos-p3/" title="数字CMOS集成电路复习笔记：第三篇">数字CMOS集成电路复习笔记：第三篇</a><h3 id="动态功耗与活动因子">动态功耗与活动因子</h3><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>P</mi><mrow><mi mathvariant="normal">s</mi><mi mathvariant="normal">w</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">h</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">g</mi></mrow></msub><mo>=</mo><mi>α</mi><mi>C</mi><msub><mi>V</mi><mrow><mi>D</mi><mi>D</mi></mrow></msub><msup><mrow></mrow><mn>2</mn></msup><mi>f</mi></mrow><annotation encoding="application/x-tex">P_{\mathrm{switching}}=\alpha CV_{DD}{}^2f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight" style="margin-right:0.01389em;">switching</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0585em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">DD</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord"></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span></span></p><p>活动因子指的是电路中信号实际翻转的概率，就是翻转概率。对于完全随机的数据，P为0.5。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mover accent="true"><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="true">‾</mo></mover><mo>=</mo><mn>1</mn><mo>−</mo><msub><mi>P</mi><mi>i</mi></msub><mspace linebreak="newline"></mspace><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mover accent="true"><msub><mi>P</mi><mi>i</mi></msub><mo stretchy="true">‾</mo></mover><mo>∗</mo><msub><mi>P</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\overline{P_i} = 1-P_i \\a_i = \overline{P_i} * P_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0333em;vertical-align:-0.15em;"></span><span class="mord overline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0333em;vertical-align:-0.15em;"></span><span class="mord overline"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8833em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.8033em;"><span class="pstrut" style="height:3em;"></span><span class="overline-line" style="border-bottom-width:0.04em;"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>通过ANDs和ORs传播的数据具有较低的活动系数，根据设计而变化。通常可以估算为a约为0.1。对于时钟，a=1；对于每周期切换一次的信号，a=1/2。</p><img src="https://webp.esing.dev/img/image-20250923114714569_250923_1147_Ex03.png" alt="逻辑门的开关概率" style="zoom:50%;" /><img src="https://webp.esing.dev/img/image-20251109101654931_251109_1017_N4tS.png" alt="活动因子计算" style="zoom:50%;" />$$(1-{0.5}^2)^2=0.75^2=0.5625$$<h3 id="动态功率计算示例">动态功率计算示例</h3><img src="https://webp.esing.dev/img/image-20251102115411023_251102_1154_aE6q.png" alt="动态功率计算示例" style="zoom:50%;" /><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right" columnspacing="0em 1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>C</mi><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">c</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mn>50</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mn>12</mn><mi>λ</mi><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mn>0.025</mn><mtext> </mtext><mi>μ</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">/</mi><mi>λ</mi><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mn>1.8</mn><mtext> </mtext><mi>f</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">/</mi><mi>μ</mi><mi mathvariant="normal">m</mi><mo fence="true">)</mo></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>=</mo><mn>27</mn><mtext> </mtext><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">F</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>C</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">m</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mn>950</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mn>4</mn><mi>λ</mi><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mn>0.025</mn><mtext> </mtext><mi>μ</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">/</mi><mi>λ</mi><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><mn>1.8</mn><mtext> </mtext><mi>f</mi><mi mathvariant="normal">F</mi><mi mathvariant="normal">/</mi><mi>μ</mi><mi mathvariant="normal">m</mi><mo fence="true">)</mo></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>=</mo><mn>171</mn><mtext> </mtext><mrow><mi mathvariant="normal">n</mi><mi mathvariant="normal">F</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><msub><mi>P</mi><mrow><mi mathvariant="normal">d</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">c</mi></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mn>0.1</mn><mtext> </mtext><msub><mi>C</mi><mrow><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">g</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">c</mi></mrow></msub><mo>+</mo><mn>0.02</mn><mtext> </mtext><msub><mi>C</mi><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">m</mi></mrow></msub><mo fence="true">]</mo></mrow><msup><mrow><mo fence="true">(</mo><mn>1.0</mn><mo fence="true">)</mo></mrow><mn>2</mn></msup><mrow><mo fence="true">(</mo><mn>1.0</mn><mtext> </mtext><mrow><mi mathvariant="normal">G</mi><mi mathvariant="normal">H</mi><mi mathvariant="normal">z</mi></mrow><mo fence="true">)</mo></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>=</mo><mn>6.1</mn><mtext> </mtext><mi mathvariant="normal">W</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}C_{\mathrm{logic}} &amp;= \left(50 \times 10^6\right) \left(12 \lambda \right) \left(0.025 \, \mu\mathrm{m}/\lambda \right) \left(1.8 \ f\mathrm{F}/\mu\mathrm{m} \right) &amp;= 27 \, \mathrm{nF}\\C_{\mathrm{mem}} &amp;= \left(950 \times 10^6\right) \left(4 \lambda \right) \left(0.025 \, \mu\mathrm{m}/\lambda \right) \left(1.8 \ f\mathrm{F}/\mu\mathrm{m} \right) &amp;= 171 \, \mathrm{nF}\\P_{\mathrm{dynamic}} &amp;= \left[0.1 \, C_{\mathrm{logic}} + 0.02 \, C_{\mathrm{mem}} \right] \left(1.0 \right)^2 \left(1.0 \ \mathrm{GHz} \right) &amp;= 6.1 \, \mathrm{W}\\\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.6622em;vertical-align:-2.0811em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5811em;"><span style="top:-4.717em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">logic</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.1929em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">mem</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.5789em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">dynamic</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0811em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5811em;"><span style="top:-4.717em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">50</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">12</span><span class="mord mathnormal">λ</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">0.025</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">μ</span><span class="mord mathrm">m</span><span class="mord">/</span><span class="mord mathnormal">λ</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">1.8</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathrm">F</span><span class="mord">/</span><span class="mord mathnormal">μ</span><span class="mord mathrm">m</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-3.1929em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mord">950</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">4</span><span class="mord mathnormal">λ</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">0.025</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">μ</span><span class="mord mathrm">m</span><span class="mord">/</span><span class="mord mathnormal">λ</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">1.8</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathrm">F</span><span class="mord">/</span><span class="mord mathnormal">μ</span><span class="mord mathrm">m</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span><span style="top:-1.5789em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord">0.1</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">logic</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">0.02</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathrm mtight">mem</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">1.0</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.954em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">1.0</span><span class="mspace"> </span><span class="mord"><span class="mord mathrm">GHz</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0811em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.5811em;"><span style="top:-4.717em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">27</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">nF</span></span></span></span><span style="top:-3.1929em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">171</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathrm">nF</span></span></span></span><span style="top:-1.5789em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">6.1</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm" style="margin-right:0.01389em;">W</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0811em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><h3 id="电源门控">电源门控</h3><p>当块处于空闲状态时，关闭其电源以节省漏电。可以使用虚拟VDD（VDDV），使用输出隔离门防止无效的逻辑电平进入下一个块。</p><h3 id="降低功耗的办法">降低功耗的办法</h3><p><strong>减少算法和架构层面的活动：</strong></p><p>在所有的设计层面上搜索不相关的开关活动并将其削减：</p><ul><li>大限度地减少整体计算工作。</li><li>放宽计算精度、音频/图片/视频质量、编码增益、响应时间等要求，以换取更好的能效。</li><li>限制灵活性以换取更好的能效。</li><li>删减或简化控制流和操作模式。</li><li>仔细优化所有字宽和存储容量。</li><li>最大化保持本地的数据交换，避免片外和片间通信。</li><li>避免空闲等待和轮询循环。</li><li>远离具有内存刷新周期的DRAM。</li></ul><p><strong>减少RTL和逻辑层面的活动：</strong></p><ul><li>尽可能使大型子电路的输入安静下来。</li><li>通过平衡延迟来避免强烈的毛刺。</li><li>考虑对有使能功能的寄存器进行时钟门控。</li></ul><p><strong>减少泄漏的技术：</strong></p><ul><li>尽可能少地使用低阈值MOSFET。</li><li>在时序松弛、斜坡时间和噪声余量允许的情况下，用低漏电单元代替标准单元。</li></ul><div class="note warning flat"><p>区分“能耗”和“功率”！</p><p>降低时钟速率可以降低功率，但是无法降低能耗，因能耗固定为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mn>2</mn></mfrac></mstyle><mi>C</mi><msup><msub><mi>V</mi><mrow><mi>D</mi><mi>D</mi></mrow></msub><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\dfrac{1}{2}C{V_{DD}}^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">DD</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8873em;"><span style="top:-3.1362em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span>！</p></div><h2 id="性能">性能</h2><h3 id="相对性能与CPI">相对性能与CPI</h3><p>引入相对性能：若A的CPU时间为B的x倍，则B相对A快x倍。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left right" columnspacing="0em 1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mtext>CPI</mtext></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">U</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">s</mi></mrow><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">U</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">U</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">s</mi></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>×</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi></mrow><mo>×</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">I</mi></mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mo>×</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mfrac><mrow><mrow><mi mathvariant="normal">I</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">s</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">n</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">t</mi></mrow><mo>×</mo><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">P</mi><mi mathvariant="normal">I</mi></mrow></mrow><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">R</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}\text{CPI} &amp;=  \frac{\mathrm{CPU\ Clock\ Cycles}}{\mathrm{Instruction\ Count}}\\ \\\mathrm{CPU\ Time}&amp;= \mathrm{CPU\ Clock\ Cycles}&amp;\times\mathrm{Clock\ Cycle\ Time}\\&amp;= \mathrm{Instruction\ Count}\times \mathrm{CPI}&amp;\times \mathrm{Clock\ Cycle\ Time}\\&amp;= \frac{\mathrm{Instruction\ Count}\times \mathrm{CPI}}{\mathrm{Clock\ Rate}}\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:9.2038em;vertical-align:-4.3519em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.8519em;"><span style="top:-6.8519em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord text"><span class="mord">CPI</span></span></span></span><span style="top:-5.0259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"></span></span><span style="top:-3.5259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">CPU</span><span class="mspace"> </span><span class="mord mathrm">Time</span></span></span></span><span style="top:-2.0259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"></span></span><span style="top:-0.0056em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.3519em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.8519em;"><span style="top:-6.8519em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Instruction</span><span class="mspace"> </span><span class="mord mathrm">Count</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">CPU</span><span class="mspace"> </span><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycles</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.5259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathrm">CPU</span><span class="mspace"> </span><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycles</span></span></span></span><span style="top:-2.0259em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathrm">Instruction</span><span class="mspace"> </span><span class="mord mathrm">Count</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathrm">CPI</span></span></span></span><span style="top:-0.0056em;"><span class="pstrut" style="height:3.3714em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Rate</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Instruction</span><span class="mspace"> </span><span class="mord mathrm">Count</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathrm">CPI</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:4.3519em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em;"></span><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9944em;"><span style="top:-3.1544em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">×</span><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycle</span><span class="mspace"> </span><span class="mord mathrm">Time</span></span></span></span><span style="top:-1.6544em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">×</span><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycle</span><span class="mspace"> </span><span class="mord mathrm">Time</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.0056em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>注意<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">C</mi><mi mathvariant="normal">y</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">e</mi><mtext> </mtext><mi mathvariant="normal">T</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">e</mi></mrow><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mn>1</mn><mrow><mi mathvariant="normal">C</mi><mi mathvariant="normal">l</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">k</mi><mtext> </mtext><mi mathvariant="normal">R</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\mathrm{Clock\ Cycle\ Time} = \dfrac{1}{\mathrm{Clock\ Rate}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Cycle</span><span class="mspace"> </span><span class="mord mathrm">Time</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">Clock</span><span class="mspace"> </span><span class="mord mathrm">Rate</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p><h3 id="性能也有上限：阿姆达尔定律">性能也有上限：阿姆达尔定律</h3><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">T</mi><mrow><mi mathvariant="normal">i</mi><mi mathvariant="normal">m</mi><mi mathvariant="normal">p</mi><mi mathvariant="normal">r</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">v</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub><mo>=</mo><mfrac><msub><mi mathvariant="normal">T</mi><mrow><mi mathvariant="normal">a</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub><mtext>improvement factor</mtext></mfrac><mo>+</mo><msub><mi mathvariant="normal">T</mi><mrow><mi mathvariant="normal">u</mi><mi mathvariant="normal">n</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">c</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\mathrm{T_{improved}}=\frac{\mathrm{T_{affected}}}{\text{improvement factor}}+\mathrm{T_{unaffected}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathrm">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">improved</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">improvement factor</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">affected</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathrm">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">unaffected</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>举个例子：乘法运算占据总运算100s中的80s，能否改进乘法模块，以至于把整个运算速度提高5倍?</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>20</mn><mo>=</mo><mfrac><mn>80</mn><mi>n</mi></mfrac><mo>+</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">20=\frac{80}{n}+20</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">20</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">80</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">20</span></span></span></span></span></p><p>显然是无解的。</p><h3 id="低功耗谬论：Low-Power-at-Idle">低功耗谬论：Low Power at Idle</h3><p>让系统在空闲时更省电并不等于整体能耗更低，节能的真正关键是完成工作所需的总能量（Energy to Complete a Task, ETC），而不是空闲时的功耗。<strong>因此，应当让CPU尽可能快地完成任务然后睡晕过去。</strong></p><h3 id="指标陷阱：MIPS-as-a-Performance-Metric">指标陷阱：MIPS as a Performance Metric</h3><p>为什么不能将MIPS（Million Instructions Per Second，百万条指令每秒）作为衡量计算机性能的标准？</p><p>MIPS（Million Instructions Per Second） 表示每秒执行的指令数量，计算公式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>MIPS</mtext><mo>=</mo><mfrac><mtext>Instruction Count</mtext><mrow><mtext>Execution Time</mtext><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow></mfrac><mo>=</mo><mfrac><mtext>Clock Rate</mtext><mrow><mtext>CPI</mtext><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>6</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{MIPS} = \frac{\text{Instruction Count}}{\text{Execution Time} \times 10^6} = \frac{\text{Clock Rate}}{\text{CPI} \times 10^6}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">MIPS</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Execution Time</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Instruction Count</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1408em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">CPI</span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">Clock Rate</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>因此，程序性能取决于 <strong>“指令数 × CPI”</strong>，MIPS 只与 CPI 有关，不反映程序实际工作量。同时，在一个CPU上，不同的程序的CPI是不同的。</p><p>举个例子：</p><ul><li>机器 A：CPI = 1，频率 = 1GHz → 1000 MIPS；</li><li>机器 B：CPI = 2，频率 = 2GHz → 1000 MIPS；</li><li>但机器 B 每条指令的执行时间更长（总时间也可能更慢）。</li></ul><p>再举一个例子：</p><ul><li>程序 X（优化版）执行 1000 条复杂指令完成任务；</li><li>程序 Y（低效版）执行 2000 条简单指令完成相同任务。</li><li>假设两台机器均为 1GHz，且CPI 相同，则程序 Y 的 MIPS 值更高。</li><li>但实际上，<strong>X 执行更快，性能更好</strong>！</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;浮点数&quot;&gt;浮点数&lt;/h2&gt;
&lt;h3 id=&quot;浮点数标准&quot;&gt;浮点数标准&lt;/h3&gt;
&lt;p&gt;IEEE标准754-1985定义了浮点数的&lt;strong&gt;存储格式、运算规则、舍入方式以及特殊值的</summary>
      
    
    
    
    <category term="学习" scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="学习" scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="复习" scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="数字系统设计" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
</feed>
