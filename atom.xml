<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Esingçš„å°ç«™</title>
  
  <subtitle>éšä¾¿å†™ç‚¹</subtitle>
  <link href="https://blog.esing.dev/atom.xml" rel="self"/>
  
  <link href="https://blog.esing.dev/"/>
  <updated>2025-12-23T03:50:36.835Z</updated>
  <id>https://blog.esing.dev/</id>
  
  <author>
    <name>Esing</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>TCPã€UDPä¸æ‹¥å¡æ§åˆ¶ç®—æ³•</title>
    <link href="https://blog.esing.dev/2025/12/22/tcp-congestion-control/"/>
    <id>https://blog.esing.dev/2025/12/22/tcp-congestion-control/</id>
    <published>2025-12-22T12:09:20.000Z</published>
    <updated>2025-12-23T03:50:36.835Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>åœ¨ <a href="/2025/12/18/windows-enable-bbr2/" title="Windows11å¼€å¯BBR2æ‹¥å¡æ§åˆ¶ç®—æ³•">Windows11å¼€å¯BBR2æ‹¥å¡æ§åˆ¶ç®—æ³•</a> ä¸­ï¼Œå°†Windowsçš„TCPæ‹¥å¡æ§åˆ¶ç®—æ³•ä»CUBICæ¢æˆäº†BBR2ã€‚TCP æ‹¥å¡æ§åˆ¶åˆ°åº•åœ¨æ§åˆ¶ä»€ä¹ˆï¼Ÿè¿™äº›ç®—æ³•æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</p><p>äº‹å®ä¸Šï¼ŒTCPä¸€ç›´åœ¨é—®è‡ªå·±ï¼šæˆ‘åº”è¯¥åŒæ—¶åœ¨ç½‘ç»œé‡Œâ€œæ”¾å¤šå°‘æ•°æ®â€æ‰ä¸ä¼šæŠŠè·¯å µæ­»ï¼Ÿä¸€ä¸ªåå«â€œæ‹¥å¡çª—å£â€ï¼ˆCongestion Windowï¼‰çš„å‚æ•°è¢«è®¾å®šï¼Œç”¨äºé™åˆ¶å‘é€ç«¯èƒ½å‘é€çš„æœ€å¤§æ•°æ®é‡ã€‚å¤§çš„cwndä¼šä½¿å¾—ååæ›´é«˜ï¼Œä½†ä¹Ÿæ›´å®¹æ˜“é€ æˆæ’é˜Ÿå’Œä¸¢åŒ…ï¼›æ›´å°çš„cwndåˆ™ä¼šä½¿å¾—å»¶è¿Ÿæ›´ä½ï¼Œä½†æ˜¯é“¾è·¯å¯èƒ½è·‘ä¸æ»¡ã€‚</p><p>æ‹¥å¡æ§åˆ¶ç®—æ³•çš„æœ¬è´¨ï¼Œå…¶å®å°±æ˜¯<strong>å¦‚ä½•åŠ¨æ€è°ƒæ•´cwnd</strong>ã€‚å¦‚æœçœ‹èµ·æ¥ç½‘ç»œå¾ˆç©ºï¼Œé‚£å°±å¢å¤§ä¸€äº›cwndï¼Œä½¿å¾—ååé‡æé«˜ï¼›ç½‘ç»œå¦‚æœå¤ªâ€œæ‹¥å µâ€ï¼Œé‚£å°±å‡å°ä¸€ç‚¹cwndï¼Œä½¿å¾—å»¶è¿Ÿé™ä½ä¸€ç‚¹ã€‚</p><h2 id="CUBICï¼šå¾ˆå¹³åº¸ï¼Œä¹Ÿå¾ˆç¨³">CUBICï¼šå¾ˆå¹³åº¸ï¼Œä¹Ÿå¾ˆç¨³</h2><p>CUBICåƒæ˜¯â€œå…ˆåŠ é€Ÿã€å†å‡é€Ÿã€å†åŠ é€Ÿâ€ï¼Œç›®æ ‡æ˜¯<strong>è®© cwnd åœ¨å¤§çª—å£åŒºé—´å¢é•¿æ›´å¿«</strong>ã€‚</p><p>CUBIC ç”¨ä¸€ä¸ªä¸‰æ¬¡å‡½æ•°æ¥æ§åˆ¶ cwnd å˜åŒ–ï¼š</p><ul><li>ä¸¢åŒ…åï¼Œcwnd ä¼šé™åˆ°æŸä¸ªå€¼</li><li>ç„¶åå¢é•¿ä¼šé€æ¸åŠ é€Ÿ</li><li>æ¥è¿‘ä¸Šä¸€æ¬¡å‘ç”Ÿä¸¢åŒ…æ—¶çš„çª—å£ï¼ˆWmaxï¼‰é™„è¿‘ï¼Œå¢é•¿ä¼šå˜æ…¢ï¼ˆæ›´è°¨æ…ï¼‰</li><li>è¶…è¿‡ Wmax åï¼Œå†åŠ é€Ÿæ¢æµ‹æ›´é«˜å¸¦å®½</li></ul><p>é‚£ä¹ˆä»£ä»·æ˜¯ä»€ä¹ˆå‘¢ï¼ŸCUBICæ˜¯Loss-Basedï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯å°†â€œä¸¢åŒ…â€ä½œä¸ºæœ€ä¸»è¦çš„æ‹¥å¡ä¿¡å·æ¥å¤„ç†ã€‚åœ¨æ²¡æœ‰ä¸¢åŒ…å‘ç”Ÿæ—¶ï¼Œä¼šé»˜è®¤è®¤ä¸ºç½‘ç»œè¿˜èƒ½æ‰¿å—æ›´å¤šæµé‡ï¼›ä¸€æ—¦å‡ºç°ä¸¢åŒ…ï¼Œå°±ä¼šé‡æ–°æ¢æµ‹å¢é•¿ã€‚å¦‚æœç½‘ç»œæœ‰æ·±ç¼“å†²ï¼Œå³æš‚å­˜æ•°æ®åŒ…çš„é˜Ÿåˆ—å®¹é‡ç‰¹åˆ«å¤§æ—¶ï¼Œå¯èƒ½æŠŠé˜Ÿåˆ—é¡¶å¾—å¾ˆé«˜ï¼Œå¯¼è‡´RTT ä¸Šå‡ï¼Œäº¤äº’ä½“éªŒå˜å·®ã€‚</p><h2 id="NewRenoï¼šè¾¹ç¼˜æ§åˆ¶ä¸è¯•æ¢">NewRenoï¼šè¾¹ç¼˜æ§åˆ¶ä¸è¯•æ¢</h2><p>Renoå®¶æ—çš„ç­–ç•¥éƒ½æ˜¯â€œè¯•æ¢ä¸å…‹åˆ¶â€ï¼š</p><ul><li>åŠ æ€§å¢ï¼ˆAdditive Increaseï¼‰ï¼šæ²¡çœ‹åˆ°æ‹¥å¡å°±æ…¢æ…¢æ¶¨</li><li>ä¹˜æ€§å‡ï¼ˆMultiplicative Decreaseï¼‰ï¼šä¸€æ—¦ä¸¢åŒ…å°±ç‹ ç‹ é™</li></ul><p>è¿™æ˜¯ä¸€ç§éå¸¸ç»å…¸ã€ç¨³å®šçš„æ§åˆ¶æ–¹å¼ï¼ˆAIMDï¼‰ï¼Œèƒ½åœ¨å…±äº«é“¾è·¯ä¸Šè‡ªåŠ¨å½¢æˆâ€œå…¬å¹³åˆ†é…â€ã€‚è€ŒNewRenoæœ€å¤§çš„ç‰¹ç‚¹ä¾¿åœ¨å…¶ New ä¸Šã€‚å½“ä¸€ä¸ªçª—å£é‡Œä¸¢äº†ä¸æ­¢ä¸€ä¸ªåŒ…ï¼ŒReno å¯èƒ½æ¢å¤æ•ˆç‡å¾ˆå·®ï¼Œè€Œ NewReno åˆ©ç”¨ partial ACKï¼ˆéƒ¨åˆ†ç¡®è®¤ï¼‰ ï¼Œå¯ä»¥æ›´å¥½åœ°æ¨æ–­â€œåé¢è¿˜æœ‰åŒ…ä¸¢äº†â€ï¼Œå‡å°‘è¶…æ—¶ä¸åå¤é™çª—ã€‚å› æ­¤ï¼Œä¸¢åŒ…å‘ç”Ÿåï¼Œæ¢å¤é˜¶æ®µæ›´èªæ˜ä¸€ç‚¹ï¼Œä½†æ•´ä½“ä»æ˜¯å…¸å‹çš„ Loss-Based æ§åˆ¶ã€‚å› æ­¤ï¼ŒNewRenoçš„ä¼˜ç‚¹æ˜¯å®ç°æˆç†Ÿã€è¡Œä¸ºå¯é¢„æµ‹ã€å…¼å®¹æ€§å¼ºï¼Œä½†é«˜å¸¦å®½ä¸é«˜æ—¶å»¶ç¯å¢ƒä¸‹ï¼Œå¸¦å®½åˆ©ç”¨ç‡å®¹æ˜“ä¸Šä¸å»ã€‚</p><h2 id="BBRv2ï¼šçŒœæ‹³ä¸å¦‚ç†æ€§åˆ†æ">BBRv2ï¼šçŒœæ‹³ä¸å¦‚ç†æ€§åˆ†æ</h2><p>CUBIC/Reno å®¶æ—æœ‰ä¸ªå…±åŒç‚¹ï¼š<strong>æŠŠä¸¢åŒ…å½“æˆæ‹¥å¡ä¿¡å·</strong>ï¼Œä½†ä¸¢åŒ…ä¸æ€»æ˜¯æ‹¥å¡å¯¼è‡´çš„â€”â€”æ— çº¿å¹²æ‰°ã€é“¾è·¯è¯¯ç ä¹Ÿä¼šä¸¢ã€‚</p><p>BBRå®¶æ—æ¢äº†ä¸€ç§ç­–ç•¥ï¼šæ ¹æ®ä¸¢åŒ…æ¥ä¼°è®¡ä¸¢åŒ…ä¸å¯é ï¼Œç›´æ¥ä¼°è®¡â€œç“¶é¢ˆå¸¦å®½â€å’Œâ€œä¼ æ’­æ—¶å»¶â€ï¼Œç”¨æ¨¡å‹ç®—å‡ºåˆé€‚çš„å‘é€é€Ÿç‡æ›´ä¸ºå¯é ã€‚å®ƒä½¿ç”¨BtlBwï¼ˆç“¶é¢ˆå¸¦å®½ï¼‰å’ŒRTpropï¼ˆæœ€å°ä¼ æ’­ RTTï¼‰è¿›è¡Œä¼°ç®—ã€‚å¯¹äºBBRv1ï¼Œåœ¨éƒ¨åˆ†åœºæ™¯ä¼šä¸ Loss-Based æµå…±å­˜æ—¶å‡ºç°å…¬å¹³æ€§é—®é¢˜ã€‚BBRv2é’ˆå¯¹è¿™ä¸€ç‚¹è¿›è¡Œäº†æ”¹è¿›ï¼Œåœ¨â€œæ¨¡å‹é©±åŠ¨â€çš„åŸºç¡€ä¸Šï¼Œæ›´è®¤çœŸåœ°æŠŠloss/ECNä½œä¸ºæ‹¥å¡ä¿¡å·çº³å…¥æ§åˆ¶ï¼Œå˜å¾—æ›´æ¸©å’Œäº†ï¼ˆä¸Šé™ä¹Ÿæ²¡BBRv1é«˜ï¼‰ã€‚å¯è§ï¼ŒBBRv2æ˜¯å…¸å‹çš„ Model-Based æ§åˆ¶ã€‚</p><h2 id="æ²¡æœ‰æ‹¥å¡æ§åˆ¶çš„UDPï¼Ÿ">æ²¡æœ‰æ‹¥å¡æ§åˆ¶çš„UDPï¼Ÿ</h2><p>UDP ä¸æ˜¯â€œæ²¡æœ‰æ‹¥å¡æ§åˆ¶â€ï¼Œè€Œæ˜¯â€œåè®®å±‚ä¸è‡ªå¸¦æ‹¥å¡æ§åˆ¶â€ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>UDP çš„è®¾è®¡ç›®æ ‡å°±æ˜¯â€œç®€å•ã€æ— è¿æ¥ã€æ— çŠ¶æ€â€ ã€‚å®ƒåªåšå¾ˆå°‘çš„äº‹ï¼Œå¦‚ç«¯å£å¤ç”¨ã€ç®€å•æ ¡éªŒã€ç‹‚å‘åŒ…ç­‰ã€‚æ‹¥å¡æ§åˆ¶æœ¬è´¨æ˜¯æ§åˆ¶ç³»ç»Ÿï¼šè¦æµ‹é‡ã€è¦è®°å¿†ã€è¦è°ƒå‚ï¼Œ<strong>è€ŒUDPä¸å»ºç«‹è¿æ¥ã€ä¸ç»´æŠ¤å‘é€çª—å£ã€ä¸è¿½è¸ª ACK/RTTï¼Œä¹Ÿå°±æ²¡æœ‰ TCP é‚£å¥—â€œåé¦ˆå›è·¯â€æ¥æ¨æ–­æ‹¥å¡ã€åŠ¨æ€è°ƒé€Ÿã€‚</strong></p><p>æ­¤å¤–ï¼ŒUDPçš„åº”ç”¨åœºæ™¯å¤ªå¤šäº†ï¼šè§†é¢‘ã€å®æ—¶è¯­éŸ³ã€æ¸¸æˆâ€¦â€¦éƒ½ç”¨ä¸€ç§æ‹¥å¡æ§åˆ¶ä¼šå¾ˆéº»çƒ¦ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒUDP ä¸å¸¦æ‹¥å¡æ§åˆ¶ï¼Œæ˜¯ä¸ºäº†ä¿æŒåè®®æç®€å’Œé€šç”¨ï¼›çœŸæ­£éœ€è¦çš„æ‹¥å¡æ§åˆ¶ï¼Œè¢«æ”¾åˆ°äº† UDP ä¹‹ä¸Šçš„åè®®æˆ–åº”ç”¨å±‚æ¥å®ç°ã€‚æ¯”å¦‚HTTP3æ—¶ä»£çš„QUICï¼Œè™½ç„¶åº•å±‚æ˜¯ UDPï¼Œä½† QUIC è‡ªå·±å®ç°äº†è¿æ¥ç®¡ç†ã€å¯é æ€§ä¸æ‹¥å¡æ§åˆ¶ã€‚</p><div class="note primary flat"><p>å¦‚Hysteria2åè®®ï¼Œå®˜æ–¹å°†BBRåè®®é­”æ”¹åç§»æ¤åˆ°QUICä¸Šï¼Œä¼šæ ¹æ® RTT å˜åŒ–ä¼°ç®—ç“¶é¢ˆå¸¦å®½ï¼Œå¹¶åŠ¨æ€è°ƒæ•´é€Ÿç‡ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰è‡ªç ”çš„Brutalç®—æ³•ï¼Œæ ¸å¿ƒæ˜¯å›ºå®šé€Ÿç‡æ¨¡å‹ï¼šä¸¢åŒ…ã€RTT å˜å¤§ ä¸ä¼šåƒä¼ ç»Ÿç®—æ³•é‚£æ ·è‡ªåŠ¨é™é€Ÿï¼Œç”šè‡³åœ¨è¾¾ä¸åˆ°ç›®æ ‡é€Ÿç‡çš„æ—¶å€™ä¼šæ ¹æ®è®¡ç®—çš„ä¸¢åŒ…ç‡â€œè¡¥å¿â€å‘æ›´å¤šåŒ…ã€‚</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;a href=&quot;/2025/12/18/windows-enable-bbr2/&quot; title=&quot;Windows11å¼€å¯BBR2æ‹¥å¡æ§åˆ¶ç®—æ³•&quot;&gt;Wi</summary>
      
    
    
    
    <category term="éšç¬”" scheme="https://blog.esing.dev/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="TCP" scheme="https://blog.esing.dev/tags/TCP/"/>
    
    <category term="UDP" scheme="https://blog.esing.dev/tags/UDP/"/>
    
    <category term="BBR" scheme="https://blog.esing.dev/tags/BBR/"/>
    
  </entry>
  
  <entry>
    <title>è‡ªç”¨éŸ³ä¹éŸ³é‡å‡è¡¡è„šæœ¬</title>
    <link href="https://blog.esing.dev/2025/12/20/script-for-musicvolumebalancing/"/>
    <id>https://blog.esing.dev/2025/12/20/script-for-musicvolumebalancing/</id>
    <published>2025-12-20T03:30:27.000Z</published>
    <updated>2025-12-21T08:10:21.695Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>ä¸åŒæ­Œæ›²çš„éŸ³é‡å¤§å°ä¸åŒï¼Œå¦‚æœç›´æ¥å¯¼å…¥æ¸¸æˆåšè‡ªå®šä¹‰ç”µå°çš„è¯å¾ˆå®¹æ˜“å‡ºç°éŸ³ä¹æ—¶å¤§æ—¶å°çš„é—®é¢˜ã€‚å› æ­¤ï¼Œéœ€è¦å…ˆå°†éŸ³é‡å‡è¡¡ã€‚</p><h2 id="å‚»ç“œè„šæœ¬">å‚»ç“œè„šæœ¬</h2><p>éœ€è¦å®‰è£…å¥½<code>ffmpeg</code>ä¸”æ·»åŠ åˆ°<code>PATH</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">TARGET_I = -<span class="number">14</span></span><br><span class="line">TARGET_TP = -<span class="number">1.5</span></span><br><span class="line">TARGET_LRA = <span class="number">12</span></span><br><span class="line"></span><br><span class="line">FFMPEG = <span class="string">&quot;ffmpeg&quot;</span>  <span class="comment"># æˆ–å†™ &quot;ffmpeg.exe&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">cmd</span>):</span><br><span class="line">    <span class="comment"># âœ… å¼ºåˆ¶æŒ‰ UTF-8 è§£ç ï¼Œé¿å… GBK è§£ç ç‚¸è£‚</span></span><br><span class="line">    p = subprocess.run(</span><br><span class="line">        cmd,</span><br><span class="line">        stdout=subprocess.PIPE,</span><br><span class="line">        stderr=subprocess.PIPE,</span><br><span class="line">        text=<span class="literal">True</span>,</span><br><span class="line">        encoding=<span class="string">&quot;utf-8&quot;</span>,</span><br><span class="line">        errors=<span class="string">&quot;replace&quot;</span>,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> p.returncode, p.stdout, p.stderr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_loudnorm_json</span>(<span class="params">stderr_text: <span class="built_in">str</span></span>) -&gt; <span class="built_in">dict</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> stderr_text:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;ffmpeg æ²¡æœ‰è¿”å› stderr æ–‡æœ¬ï¼ˆå¯èƒ½è¢«è§£ç é”™è¯¯åæ‰äº†ï¼‰ã€‚&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># âœ… æ›´ç¨³ï¼šåªåŒ¹é…åŒ…å« &quot;input_i&quot; çš„é‚£æ®µ JSONï¼ˆé¿å…è¯¯åŒ¹é…åˆ«çš„èŠ±æ‹¬å·ï¼‰</span></span><br><span class="line">    m = re.search(<span class="string">r&#x27;(\&#123;\s*&quot;input_i&quot;[\s\S]*?\&#125;)&#x27;</span>, stderr_text)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> m:</span><br><span class="line">        <span class="comment"># æ–¹ä¾¿ä½ è°ƒè¯•ï¼šæŠŠ stderr çš„å°¾éƒ¨æ‰“å°å‡ºæ¥çœ‹çœ‹</span></span><br><span class="line">        tail = stderr_text[-<span class="number">2000</span>:]</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;æ²¡æ‰¾åˆ° loudnorm JSON è¾“å‡ºã€‚stderr å°¾éƒ¨å¦‚ä¸‹ï¼š\n<span class="subst">&#123;tail&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> json.loads(m.group(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">normalize_file</span>(<span class="params">inp: Path, outp: Path</span>):</span><br><span class="line">    outp.parent.mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pass 1: measure</span></span><br><span class="line">    cmd1 = [</span><br><span class="line">        FFMPEG, <span class="string">&quot;-hide_banner&quot;</span>, <span class="string">&quot;-nostats&quot;</span>, <span class="string">&quot;-y&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-i&quot;</span>, <span class="built_in">str</span>(inp),</span><br><span class="line">        <span class="string">&quot;-af&quot;</span>, <span class="string">f&quot;loudnorm=I=<span class="subst">&#123;TARGET_I&#125;</span>:TP=<span class="subst">&#123;TARGET_TP&#125;</span>:LRA=<span class="subst">&#123;TARGET_LRA&#125;</span>:print_format=json&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;null&quot;</span>, <span class="string">&quot;NUL&quot;</span></span><br><span class="line">    ]</span><br><span class="line">    rc, _, err = run(cmd1)</span><br><span class="line">    <span class="keyword">if</span> rc != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;Pass1 å¤±è´¥ï¼š<span class="subst">&#123;inp&#125;</span>\n<span class="subst">&#123;err&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    info = extract_loudnorm_json(err)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Pass 2: apply</span></span><br><span class="line">    cmd2 = [</span><br><span class="line">        FFMPEG, <span class="string">&quot;-hide_banner&quot;</span>, <span class="string">&quot;-nostats&quot;</span>, <span class="string">&quot;-y&quot;</span>,</span><br><span class="line">        <span class="string">&quot;-i&quot;</span>, <span class="built_in">str</span>(inp),</span><br><span class="line">        <span class="string">&quot;-af&quot;</span>,</span><br><span class="line">        (</span><br><span class="line">            <span class="string">&quot;loudnorm=I=&#123;I&#125;:TP=&#123;TP&#125;:LRA=&#123;LRA&#125;:&quot;</span></span><br><span class="line">            <span class="string">&quot;measured_I=&#123;mI&#125;:measured_TP=&#123;mTP&#125;:measured_LRA=&#123;mLRA&#125;:&quot;</span></span><br><span class="line">            <span class="string">&quot;measured_thresh=&#123;mTH&#125;:offset=&#123;off&#125;:linear=true&quot;</span></span><br><span class="line">        ).<span class="built_in">format</span>(</span><br><span class="line">            I=TARGET_I, TP=TARGET_TP, LRA=TARGET_LRA,</span><br><span class="line">            mI=info[<span class="string">&quot;input_i&quot;</span>], mTP=info[<span class="string">&quot;input_tp&quot;</span>], mLRA=info[<span class="string">&quot;input_lra&quot;</span>],</span><br><span class="line">            mTH=info[<span class="string">&quot;input_thresh&quot;</span>], off=info[<span class="string">&quot;target_offset&quot;</span>]</span><br><span class="line">        ),</span><br><span class="line">        <span class="string">&quot;-c:a&quot;</span>, <span class="string">&quot;libmp3lame&quot;</span>, <span class="string">&quot;-q:a&quot;</span>, <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="built_in">str</span>(outp)</span><br><span class="line">    ]</span><br><span class="line">    rc, _, err2 = run(cmd2)</span><br><span class="line">    <span class="keyword">if</span> rc != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;Pass2 å¤±è´¥ï¼š<span class="subst">&#123;inp&#125;</span>\n<span class="subst">&#123;err2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    in_dir = Path(<span class="string">&quot;MP3&quot;</span>)</span><br><span class="line">    out_dir = Path(<span class="string">&quot;test&quot;</span>)</span><br><span class="line"></span><br><span class="line">    mp3s = <span class="built_in">sorted</span>(in_dir.rglob(<span class="string">&quot;*.mp3&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> mp3s:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;æ²¡æ‰¾åˆ° mp3ï¼šè¯·æŠŠæ–‡ä»¶æ”¾åˆ° input_mp3/ ä¸‹ ğŸ™‚&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> f <span class="keyword">in</span> mp3s:</span><br><span class="line">        rel = f.relative_to(in_dir)</span><br><span class="line">        outp = out_dir / rel</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ğŸ”§ <span class="subst">&#123;rel&#125;</span>&quot;</span>)</span><br><span class="line">        normalize_file(f, outp)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;âœ… å®Œæˆï¼è¾“å‡ºåœ¨ï¼š<span class="subst">&#123;out_dir&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ä¸åŒæ­Œæ›²çš„éŸ³é‡å¤§å°ä¸åŒï¼Œå¦‚æœç›´æ¥å¯¼å…¥æ¸¸æˆåšè‡ªå®šä¹‰ç”µå°çš„è¯å¾ˆå®¹æ˜“å‡ºç°éŸ³ä¹æ—¶å¤§æ—¶å°çš„é—®é¢˜ã€‚å› æ­¤ï¼Œéœ€è¦å…ˆå°†éŸ³é‡å‡è¡¡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‚»ç“œè„šæœ¬&quot;&gt;å‚»ç“œè„š</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="HiFi" scheme="https://blog.esing.dev/tags/HiFi/"/>
    
    <category term="æ‚è°ˆ" scheme="https://blog.esing.dev/tags/%E6%9D%82%E8%B0%88/"/>
    
    <category term="GTA" scheme="https://blog.esing.dev/tags/GTA/"/>
    
  </entry>
  
  <entry>
    <title>Windows11å¼€å¯BBR2æ‹¥å¡æ§åˆ¶ç®—æ³•</title>
    <link href="https://blog.esing.dev/2025/12/18/windows-enable-bbr2/"/>
    <id>https://blog.esing.dev/2025/12/18/windows-enable-bbr2/</id>
    <published>2025-12-18T03:31:29.000Z</published>
    <updated>2025-12-23T02:12:17.447Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>ç¾¤é‡Œå¹æ°´æ—¶çœ‹åˆ°ç¾¤å‹è®¨è®ºç›¸åŒé…ç½®çš„Windowsç½‘é€Ÿå’ŒLinuxç½‘é€Ÿå“ªä¸ªæ›´å¿«ï¼Œå¾—å‡ºç»“è®ºæ˜¯Linuxè·èƒœï¼Œæ¯•ç«ŸLinuxçš„TCPæ‹¥å¡æ§åˆ¶ç®—æ³•æ›´å¥½ï¼Œé‡‡ç”¨çš„æ˜¯BBRç®—æ³•ï¼Œè€ŒWindowsä¸€ç›´æ˜¯è€å¤è‘£CUBICã€‚</p><p>ä¸è¿‡ï¼Œåœ¨Windows11 22H2ä¹‹åï¼Œä¹Ÿå¯ä»¥ä¸ºTCPå¼€å¯BBR2çš„æ‹¥å¡æ§åˆ¶ç®—æ³•äº†â€”â€”å°½ç®¡<strong>æœ‰ä¸€äº›å°å°çš„é—®é¢˜</strong>ã€‚</p><h2 id="å¼€å¯BBR2">å¼€å¯BBR2</h2><p>é¦–å…ˆæŸ¥çœ‹è‡ªå·±ç”µè„‘çš„é»˜è®¤æ§åˆ¶ç®—æ³•ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€â”€ î• PowerShell îˆµ False                         <span class="number">0</span>ms [<span class="number">21</span>:<span class="number">21</span>]</span><br><span class="line">â•°â”€î—¿ ~</span><br><span class="line">â¯ <span class="built_in">Get-NetTCPSetting</span> | <span class="built_in">Select</span> SettingName, CongestionProvider</span><br><span class="line"></span><br><span class="line">SettingName      CongestionProvider</span><br><span class="line"><span class="literal">-----------</span>      <span class="literal">------------------</span></span><br><span class="line">Automatic</span><br><span class="line">InternetCustom   CUBIC</span><br><span class="line">DatacenterCustom CUBIC</span><br><span class="line">Compat           NewReno</span><br><span class="line">Datacenter       CUBIC</span><br><span class="line">Internet         CUBIC</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°éƒ½æ˜¯CUBICï¼Œä¸­é—´è¿˜æ··äº†ä¸ªNewRenoã€‚è®°ä¸€ä¸‹é»˜è®¤å€¼ï¼Œåé¢è¿˜åŸéœ€è¦ç”¨ã€‚</p><p>å› ä¸ºWindowsçš„BBR2æœ‰æ¼æ´ï¼Œå°šæœªå®Œå–„å¯¹ç¯å›æ¥å£å¤§åˆ†æ®µï¼ˆLarge MTUï¼‰çš„å¤„ç†ï¼Œä¼šå¯¼è‡´æœ¬åœ° TCP æ¡æ‰‹æˆ–æ•°æ®æ”¶å‘å‡ºç°é˜»å¡æˆ–è¶…æ—¶ã€‚å› æ­¤ï¼Œè¦å…ˆå…³é—­ç¯å›æ¥å£å¤§åˆ†æ®µã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â•­â”€â”€ î• PowerShell îˆµ False                         <span class="number">436</span>ms [<span class="number">21</span>:<span class="number">21</span>]</span><br><span class="line">â•°â”€î—¿ ~</span><br><span class="line">â¯ netsh interface ip show global</span><br><span class="line">æŸ¥è¯¢æ´»åŠ¨çŠ¶æ€...</span><br><span class="line"></span><br><span class="line">å¸¸è§„å…¨å±€å‚æ•°</span><br><span class="line"><span class="literal">---------------------------------------------</span></span><br><span class="line">...</span><br><span class="line">ç¯å›å¤§ Mtu                  : enable</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªâ€œç¯å›å¤§MTUâ€æ˜¯<code>enable</code>ï¼Œéœ€è¦å…³é—­ã€‚æ˜¯<code>disable</code>ä¹Ÿæ‰§è¡Œä¸€éå‘½ä»¤ã€‚åœ¨ç®¡ç†å‘˜æ¨¡å¼çš„Powershellä¸­æ‰§è¡Œï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh int ipv4 <span class="built_in">set</span> global loopbacklargemtu=disable</span><br><span class="line">netsh int ipv6 <span class="built_in">set</span> global loopbacklargemtu=disable</span><br></pre></td></tr></table></figure><p>ç¡®ä¿å˜ä¸º<code>disable</code>å³å¯ã€‚</p><p>ä¹‹åï¼Œç®¡ç†å‘˜èº«ä»½ä¸‹æ‰§è¡ŒBBR2å¼€å¯ä»£ç ï¼Œå¹¶é‡å¯ç”µè„‘ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=InternetCustom   CongestionProvider=bbr2</span><br><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=DatacenterCustom CongestionProvider=bbr2</span><br><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=Compat           CongestionProvider=bbr2</span><br><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=Internet         CongestionProvider=bbr2</span><br><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=Datacenter       CongestionProvider=bbr2</span><br></pre></td></tr></table></figure><p>å³å¯å¼€å¯BBR2ã€‚</p><h2 id="å¤åŸ">å¤åŸ</h2><p>æ ¹æ®ä¸Šé¢çš„é»˜è®¤å€¼æ‰§è¡Œä»£ç å³å¯ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=InternetCustom   CongestionProvider=CUBIC</span><br><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=DatacenterCustom CongestionProvider=CUBIC</span><br><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=Compat           CongestionProvider=NewReno</span><br><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=Internet         CongestionProvider=CUBIC</span><br><span class="line">netsh int tcp <span class="built_in">set</span> supplemental Template=Datacenter       CongestionProvider=CUBIC</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ç¾¤é‡Œå¹æ°´æ—¶çœ‹åˆ°ç¾¤å‹è®¨è®ºç›¸åŒé…ç½®çš„Windowsç½‘é€Ÿå’ŒLinuxç½‘é€Ÿå“ªä¸ªæ›´å¿«ï¼Œå¾—å‡ºç»“è®ºæ˜¯Linuxè·èƒœï¼Œæ¯•ç«ŸLinuxçš„TCPæ‹¥å¡æ§åˆ¶ç®—æ³•æ›´å¥½ï¼Œé‡‡ç”¨çš„æ˜¯BB</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Windows" scheme="https://blog.esing.dev/tags/Windows/"/>
    
    <category term="TCP" scheme="https://blog.esing.dev/tags/TCP/"/>
    
    <category term="BBR" scheme="https://blog.esing.dev/tags/BBR/"/>
    
  </entry>
  
  <entry>
    <title>æœ€æ£’çš„VCDæ³¢å½¢æŸ¥çœ‹å™¨ï¼šSurfer</title>
    <link href="https://blog.esing.dev/2025/12/13/vcd-viewer-surfer/"/>
    <id>https://blog.esing.dev/2025/12/13/vcd-viewer-surfer/</id>
    <published>2025-12-12T17:11:00.000Z</published>
    <updated>2025-12-12T18:04:56.550Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><a href="/2025/11/10/gtkwave-fontsize/" title="GTKWaveä¿®æ”¹å­—ä½“å¤§å°">ä¹‹å‰</a> æŠ˜è…¾äº†åŠå¤©GTKWaveï¼Œè¿˜æ˜¯è°ƒä¸å¥½ã€‚é«˜åˆ†è¾¨ç‡å±å¹•çœ‹æ²¡æœ‰ä¼˜åŒ–ç¼©æ”¾çš„æ³¢å½¢ï¼Œçœ¼ç›éƒ½è¦çäº†ã€‚<p><img src="https://webp.esing.dev/img/image-20251211123703587_251211_1237_oVPZ.png" alt="æœ‰æ²¡æœ‰æ‡‚æˆ‘çš„è¶…ç»DPIçš„"></p><p>ç›´åˆ°ç¾¤å‹ç»™æˆ‘æ¨èäº†Surferã€‚å±…ç„¶è¿˜æœ‰åœ¨çº¿Demoï¼š<a href="https://surfer-project.gitlab.io/surfer">Surfer Online</a></p><h2 id="ä½¿ç”¨æ•ˆæœ">ä½¿ç”¨æ•ˆæœ</h2><p>å¯ä»¥çœ‹åˆ°ï¼Œç•Œé¢å­—ä½“å…¨éƒ¨é‡‡ç”¨ç­‰å®½å­—ä½“ï¼Œçœ‹ä¿¡å·ä¹Ÿæ›´åŠ æ–¹ä¾¿ï¼Œä¸ä¼šIIlIlIIlIlåˆ†ä¸æ¸…ã€‚</p><p><img src="https://webp.esing.dev/img/image-20251213013439039_251213_0134_lIRb.png" alt="ç°ä»£åŒ–çš„æŸ¥çœ‹ç•Œé¢"></p><p>ä½ ç”šè‡³å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œç”¨ç°æˆæä¾›çš„æŒ‡ä»¤é›†è§£ç å™¨ï¼Œäº¦æˆ–æ˜¯è‡ªå·±å†™ï¼Œä»è€Œè§£ææŒ‡ä»¤ç ï¼Œè¿™æ ·å­å°±ä¸ç”¨åœ¨å†…éƒ¨å¼•å‡ºASCIIï¼š</p><p><img src="https://webp.esing.dev/img/image-20251213014434957_251213_0144_Y69j.png" alt="è‡ªåŠ¨è§£ææŒ‡ä»¤ç ,RV32è°ƒè¯•å¼€å‘å¿…å¤‡"></p><p>è¿™ç©æ„ç”šè‡³è¿˜æœ‰VSCodeæ’ä»¶ï¼Œè™½ç„¶æ˜¯WASMç¼–è¯‘ç‰ˆã€‚</p><p>çœŸè¦æŒ‘å®ƒçš„ç¼ºç‚¹ï¼Œå¯èƒ½å°±ä¸€ä¸ªä¸æ”¯æŒæ¨¡æ‹Ÿæ³¢å½¢å§ã€‚<strong>è¿˜å¥½åšæ•°å­—æ–¹å‘çš„çœ‹ä¸åˆ°è¿™äº›ï¼Œå“ˆå“ˆã€‚</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;a href=&quot;/2025/11/10/gtkwave-fontsize/&quot; title=&quot;GTKWaveä¿®æ”¹å­—ä½“å¤§å°&quot;&gt;ä¹‹å‰&lt;/a&gt; æŠ˜è…¾äº†åŠå¤©GTKWav</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬åç¯‡</title>
    <link href="https://blog.esing.dev/2025/12/12/riscvcod-p10/"/>
    <id>https://blog.esing.dev/2025/12/12/riscvcod-p10/</id>
    <published>2025-12-12T02:50:50.000Z</published>
    <updated>2025-12-12T06:55:52.315Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è®©æˆ‘è®¿é—®ï¼">è®©æˆ‘è®¿é—®ï¼</h2><p>å¯¹äºL-Typeå’ŒS-Typeï¼Œæˆ‘ä»¬åªæ”¯æŒäº†<code>lw/sw</code>ï¼Œå®ƒä»¬çš„å…„å¼Ÿå§å¦¹<code>lb/lbu/lh/lhu/<b>sb</b>/sh</code>è¿˜æ²¡æ”¯æŒã€‚</p><p>æˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªæ¨¡å—ä¸“é—¨ç”¨æ¥å¤„ç†è¿™äº›éå­—èŠ‚å­˜å–ã€‚åœ¨å‰é¢IDçº§ä¼ å‡ºçš„<code>sl_type</code>ä¿¡å·ç»ˆäºèƒ½æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªå°æŠ€å·§ï¼šå®šä¹‰å­˜å–ç±»å‹æ—¶ï¼Œç”¨é«˜ä½æ¥åˆ†è¾¨æ˜¯è¯»è¿˜æ˜¯å†™ï¼Œå‰©ä¸‹çš„è¯»å†™ç±»å‹ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥åˆå¹¶ã€‚</p><h3 id="å­˜å–æ§åˆ¶æ¨¡å—-LoadStoreUnit-sv">å­˜å–æ§åˆ¶æ¨¡å— LoadStoreUnit.sv</h3><p>è€ƒè™‘åˆ°æ•°æ®çš„å­˜å–éƒ½åœ¨MEMçº§å®Œæˆï¼Œæˆ‘ä»¬éœ€è¦å°†æ¨¡å—æ”¾ç½®åœ¨MEMçº§ã€‚æˆ‘ä»¬è¦ä¼ å…¥æ¥è‡ªEXçº§çš„å¾…å­˜æ•°æ®ï¼Œå¯¹å…¶è¿›è¡Œé€‚å½“ç§»ä½ï¼Œå¥½å°†æ•°æ®å­˜æ”¾åˆ°åˆé€‚ä½ç½®ï¼Œå¹¶æ ¹æ®<code>dram_we</code>å’Œ<code>sl_type</code>æ¥å°†1ä½å†™ä½¿èƒ½<code>dram_we</code>è½¬æ¢ä¸º4ä½çš„æŒ‰ä½å†™ä½¿èƒ½<code>dram_we_strbe</code>ã€‚</p><p>å¯¹äºè¯»å‡ºçš„æ•°æ®ï¼Œè¿˜è¦åˆ¤æ–­æ˜¯æœ‰ç¬¦å·è¿˜æ˜¯æ— ç¬¦å·è¯»å–ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> LoadStoreUnit (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">3</span>:<span class="number">0</span>] sl_type,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] addr,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] load_data_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] load_data_o,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] store_data_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] store_data_o,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        dram_we,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">3</span>:<span class="number">0</span>] wstrb          <span class="comment">// æŒ‰ä½å†™ä½¿èƒ½</span></span><br><span class="line">);</span><br><span class="line">    <span class="comment">// [TODO] ä¸åŒçš„è®¿å­˜ç±»å‹å¤„ç†</span></span><br><span class="line">    <span class="keyword">logic</span> is_load, is_load_unsigned;</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        is_load          = (sl_type[<span class="number">3</span>] == <span class="number">1&#x27;b0</span>);</span><br><span class="line">        is_load_unsigned = (sl_type[<span class="number">2</span>] == <span class="number">1&#x27;b1</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// é»˜è®¤å€¼ï¼Œä¿è¯æ‰€æœ‰ç»„åˆè¾“å‡ºéƒ½æœ‰é©±åŠ¨ï¼Œé¿å…é”å­˜</span></span><br><span class="line">        wstrb        = <span class="number">4&#x27;b0000</span>;</span><br><span class="line">        load_data_o  = <span class="number">32&#x27;b0</span>;</span><br><span class="line">        store_data_o = <span class="number">32&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_load) <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// ä¸´æ—¶å˜é‡ï¼ˆä¹Ÿå¯ä»¥æ”¾åœ¨æ¨¡å—å±‚ï¼‰</span></span><br><span class="line">            <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] raw;</span><br><span class="line">            raw = <span class="number">32&#x27;b0</span>;</span><br><span class="line">            <span class="comment">// æå– rawï¼Œæ ¹æ® sl_type å’Œ addr åç§»</span></span><br><span class="line">            <span class="keyword">case</span> (sl_type[<span class="number">1</span>:<span class="number">0</span>])</span><br><span class="line">                <span class="number">2&#x27;b01</span>: <span class="keyword">begin</span>  <span class="comment">// byte</span></span><br><span class="line">                    <span class="comment">// å³ç§»åˆ°æœ€ä½ä½å†æ©ç </span></span><br><span class="line">                    raw = (load_data_i &gt;&gt; (addr[<span class="number">1</span>:<span class="number">0</span>] * <span class="number">8</span>)) &amp; <span class="number">32&#x27;h000000FF</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="number">2&#x27;b10</span>: <span class="keyword">begin</span>  <span class="comment">// half</span></span><br><span class="line">                    raw = (load_data_i &gt;&gt; (addr[<span class="number">1</span>] * <span class="number">16</span>)) &amp; <span class="number">32&#x27;h0000FFFF</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="number">2&#x27;b11</span>: <span class="keyword">begin</span>  <span class="comment">// word</span></span><br><span class="line">                    raw = load_data_i;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">default</span>: raw = <span class="number">32&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰©å±•</span></span><br><span class="line">            <span class="keyword">if</span> (is_load_unsigned) <span class="keyword">begin</span></span><br><span class="line">                load_data_o = raw;  <span class="comment">// é›¶æ‰©å±•</span></span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">case</span> (sl_type[<span class="number">1</span>:<span class="number">0</span>])</span><br><span class="line">                    <span class="number">2&#x27;b01</span>:   load_data_o = &#123;&#123;<span class="number">24</span>&#123;raw[<span class="number">7</span>]&#125;&#125;, raw[<span class="number">7</span>:<span class="number">0</span>]&#125;;  <span class="comment">// LB</span></span><br><span class="line">                    <span class="number">2&#x27;b10</span>:   load_data_o = &#123;&#123;<span class="number">16</span>&#123;raw[<span class="number">15</span>]&#125;&#125;, raw[<span class="number">15</span>:<span class="number">0</span>]&#125;;  <span class="comment">// LH</span></span><br><span class="line">                    <span class="number">2&#x27;b11</span>:   load_data_o = raw;  <span class="comment">// LW</span></span><br><span class="line">                    <span class="keyword">default</span>: load_data_o = <span class="number">32&#x27;b0</span>;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (dram_we) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">logic</span> [<span class="number">15</span>:<span class="number">0</span>] half_byte;</span><br><span class="line">            <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] shift;  <span class="comment">// ç§»ä½é‡ 0, 8, 16, 24</span></span><br><span class="line">            shift = <span class="number">4&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">unique</span> <span class="keyword">case</span> (sl_type[<span class="number">1</span>:<span class="number">0</span>])</span><br><span class="line">                <span class="number">2&#x27;b01</span>: <span class="keyword">begin</span>  <span class="comment">// SB</span></span><br><span class="line">                    <span class="keyword">logic</span> [<span class="number">7</span>:<span class="number">0</span>] byte_val;</span><br><span class="line"></span><br><span class="line">                    half_byte = store_data_i[<span class="number">7</span>:<span class="number">0</span>];  <span class="comment">// åªå…³å¿ƒæœ€ä½ 8 ä½</span></span><br><span class="line">                    shift     = &#123;addr[<span class="number">1</span>:<span class="number">0</span>], <span class="number">3&#x27;b000</span>&#125;;  <span class="comment">// addr[1:0] * 8</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// å†™ä½¿èƒ½</span></span><br><span class="line">                    <span class="keyword">unique</span> <span class="keyword">case</span> (addr[<span class="number">1</span>:<span class="number">0</span>])</span><br><span class="line">                        <span class="number">2&#x27;b00</span>:   wstrb = <span class="number">4&#x27;b0001</span>;</span><br><span class="line">                        <span class="number">2&#x27;b01</span>:   wstrb = <span class="number">4&#x27;b0010</span>;</span><br><span class="line">                        <span class="number">2&#x27;b10</span>:   wstrb = <span class="number">4&#x27;b0100</span>;</span><br><span class="line">                        <span class="number">2&#x27;b11</span>:   wstrb = <span class="number">4&#x27;b1000</span>;</span><br><span class="line">                        <span class="keyword">default</span>: wstrb = <span class="number">4&#x27;b0000</span>;</span><br><span class="line">                    <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æŠŠ byte_val æ”¾åˆ°å¯¹åº” byte lane</span></span><br><span class="line">                    store_data_o = (&#123;<span class="number">24&#x27;b0</span>, half_byte[<span class="number">7</span>:<span class="number">0</span>]&#125; &lt;&lt; shift);</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                <span class="number">2&#x27;b10</span>: <span class="keyword">begin</span>  <span class="comment">// SH</span></span><br><span class="line">                    <span class="keyword">logic</span> [<span class="number">15</span>:<span class="number">0</span>] half_val;</span><br><span class="line"></span><br><span class="line">                    half_byte = store_data_i[<span class="number">15</span>:<span class="number">0</span>];  <span class="comment">// åªå…³å¿ƒæœ€ä½ 16 ä½</span></span><br><span class="line">                    shift     = &#123;addr[<span class="number">1</span>], <span class="number">4&#x27;b0000</span>&#125;;  <span class="comment">// addr[1] ? 16 : 0</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// å†™ä½¿èƒ½</span></span><br><span class="line">                    <span class="keyword">unique</span> <span class="keyword">case</span> (addr[<span class="number">1</span>])</span><br><span class="line">                        <span class="number">1&#x27;b0</span>:    wstrb = <span class="number">4&#x27;b0011</span>;</span><br><span class="line">                        <span class="number">1&#x27;b1</span>:    wstrb = <span class="number">4&#x27;b1100</span>;</span><br><span class="line">                        <span class="keyword">default</span>: wstrb = <span class="number">4&#x27;b0000</span>;</span><br><span class="line">                    <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æŠŠ half_val æ”¾åˆ°ä½/é«˜ halfword</span></span><br><span class="line">                    store_data_o = (&#123;<span class="number">16&#x27;b0</span>, half_byte&#125; &lt;&lt; shift);</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                <span class="number">2&#x27;b11</span>: <span class="keyword">begin</span>  <span class="comment">// SW</span></span><br><span class="line">                    wstrb        = <span class="number">4&#x27;b1111</span>;</span><br><span class="line">                    store_data_o = store_data_i;  <span class="comment">// ç›´æ¥å†™æ•´ä¸ª word</span></span><br><span class="line">                    half_byte    = <span class="number">16&#x27;b0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">default</span>: <span class="keyword">begin</span></span><br><span class="line">                    wstrb        = <span class="number">4&#x27;b0000</span>;</span><br><span class="line">                    store_data_o = <span class="number">32&#x27;b0</span>;</span><br><span class="line">                    half_byte    = <span class="number">16&#x27;b0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// é load/é storeï¼šä¿æŒé»˜è®¤ wstrb=0, store_data_o å·²åˆå§‹åŒ–ä¸º 0</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] sl_type_ascii;</span><br><span class="line">    <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] select_bits;</span><br><span class="line">    <span class="keyword">assign</span> select_bits = addr[<span class="number">1</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (sl_type)</span><br><span class="line">            `MEM_LB:  sl_type_ascii = <span class="string">&quot;LB  &quot;</span>;</span><br><span class="line">            `MEM_LH:  sl_type_ascii = <span class="string">&quot;LH  &quot;</span>;</span><br><span class="line">            `MEM_LW:  sl_type_ascii = <span class="string">&quot;LW  &quot;</span>;</span><br><span class="line">            `MEM_LBU: sl_type_ascii = <span class="string">&quot;LBU &quot;</span>;</span><br><span class="line">            `MEM_LHU: sl_type_ascii = <span class="string">&quot;LHU &quot;</span>;</span><br><span class="line">            `MEM_SB:  sl_type_ascii = <span class="string">&quot;SB  &quot;</span>;</span><br><span class="line">            `MEM_SH:  sl_type_ascii = <span class="string">&quot;SH  &quot;</span>;</span><br><span class="line">            `MEM_SW:  sl_type_ascii = <span class="string">&quot;SW  &quot;</span>;</span><br><span class="line">            <span class="keyword">default</span>:  sl_type_ascii = <span class="string">&quot;UNKN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="meta">`<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹‹åæ›´æ–°é¡¶å±‚æ¨¡å—ï¼Œè¿œæ–¹çš„MUXä¹Ÿä¸è¦æ”¾è¿‡ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DRAMæ¨¡å—</span></span><br><span class="line"><span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] DRAM_output_data,DRAM_input_data;</span><br><span class="line"><span class="keyword">logic</span> [<span class="number">3</span>:<span class="number">0</span>] dram_we_MEM_strbe;</span><br><span class="line"><span class="keyword">logic</span> [<span class="number">3</span>:<span class="number">0</span>] wstrb;</span><br><span class="line">DRAM u_DRAM (</span><br><span class="line">    <span class="variable">.clk</span>(clk),</span><br><span class="line">    <span class="variable">.a</span>  (alu_result_MEM[<span class="number">17</span>:<span class="number">2</span>]),  <span class="comment">// å­—èŠ‚åœ°å€è½¬æ¢ä¸ºå­—åœ°å€ (é™¤ä»¥4)</span></span><br><span class="line">    <span class="variable">.spo</span>(DRAM_output_data),</span><br><span class="line">    <span class="variable">.we</span> (wstrb),</span><br><span class="line">    <span class="variable">.din</span>(DRAM_input_data)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹äºåŒæ­¥DRAMï¼Œæ•°æ®å°†åœ¨ä¸‹ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå¯ç”¨</span></span><br><span class="line"><span class="comment">// å°†æ•°æ®ä¼ é€’åˆ°WBçº§ï¼Œåœ¨WBçº§è¿›è¡Œé€‰æ‹©</span></span><br><span class="line"><span class="keyword">assign</span> rf_wd_MEM = rf_wd_MEM_PR2MUX;</span><br><span class="line"></span><br><span class="line"><span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] load_data_o; <span class="comment">// LSUè¾“å‡ºçš„æœ€ç»ˆåŠ è½½æ•°æ®</span></span><br><span class="line">LoadStoreUnit u_LoadStoreUnit(</span><br><span class="line">    <span class="variable">.sl_type</span>          (sl_type_MEM),</span><br><span class="line">    <span class="variable">.addr</span>             (alu_result_MEM),</span><br><span class="line">    <span class="variable">.load_data_i</span>      (DRAM_output_data),</span><br><span class="line">    <span class="variable">.load_data_o</span>      (load_data_o),</span><br><span class="line">    <span class="variable">.store_data_i</span>     (rf_rd2_MEM),</span><br><span class="line">    <span class="variable">.store_data_o</span>     (DRAM_input_data),</span><br><span class="line">    <span class="variable">.dram_we</span>          (dram_we_MEM),</span><br><span class="line">    <span class="variable">.wstrb</span>            (wstrb)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> rf_wd_WB = (wd_sel_WB == `WD_SEL_FROM_DRAM) ? load_data_o : rf_wd_WB_from_PR;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„<code>LoadStoreUnit</code>æ˜¯<strong>ç»„åˆé€»è¾‘æ¨¡å—</strong>ï¼Œå› æ­¤ï¼Œä¸ä¼šæ‰“ä¹±åŒæ­¥è¯»å†™çš„DRAMæ—¶åºã€‚è®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹çœ‹çœ‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">li  x1,0x12345678</span><br><span class="line"></span><br><span class="line">sw  x1,0(x0)</span><br><span class="line">lw  x2,0(x0)</span><br><span class="line">lw  x3,0(x0)</span><br><span class="line">lh  x4,4(x0)</span><br><span class="line">lhu x5,4(x0)</span><br><span class="line">lb  x6,0(x0)</span><br><span class="line">lhu x7,2(x0)</span><br></pre></td></tr></table></figure><p><img src="https://webp.esing.dev/img/image-20251212115844253_251212_1158_qMTV.png" alt="lwæŒ‡ä»¤è¯»å‡ºé”™è¯¯"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ¬åº”è¯¥æ‰§è¡Œ<code>lw</code>çš„æŒ‡ä»¤å´é”™è¯¯åœ°è¯»å‡ºäº†ä¸‹ä¸€æ¡çš„<code>lh</code>æŒ‡ä»¤ï¼Œè€Œæœ€åä¸€æ¡<code>lhu</code>ç›´æ¥æ¶ˆå¤±äº†ï¼è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ</p><p>çœ‹ä¸Šé¢çš„æ³¢å½¢å¯ä»¥çŸ¥é“ï¼Œç”¨äºæ§åˆ¶å­˜å…¥æ•°æ®çš„<code>sl_type</code>ææ—©äº†ä¸€æ‹åˆ°è¾¾ã€‚<strong>ç»„åˆé€»è¾‘ä¸ä¼šå½±å“æ—¶åºï¼Œå› æ­¤ï¼Œåº”å½“æ ¹æ®æ—¶åºæ¥è®¾è®¡ç»„åˆé€»è¾‘ã€‚<strong>æˆ‘ä»¬æ˜¯åœ¨MEMçº§è¯»å–å‡ºæ•°æ®å¹¶è¿›è¡Œå¤„ç†çš„ï¼Œä½†æ˜¯å†™å›é˜¶æ®µæ˜¯åœ¨WBçº§â€”â€”è¿™å¯¼è‡´æˆ‘ä»¬å†™å›æ—¶ä½¿ç”¨çš„ä»ç„¶æ˜¯MEMçº§çš„æ§åˆ¶ä¿¡å·ã€‚<code>DRAM_output_data</code>åœ¨ WB çº§å¯ç”¨æ—¶ï¼Œåº”å½“ä½¿ç”¨å’Œ DRAM è¯»å–è¯·æ±‚ç›¸å¯¹åº”çš„<code>sl_type</code>è¿›è¡Œå¤„ç†ï¼Œä½†å½“å‰ä»£ç ä¸­<code>LoadStoreUnit</code>ä½¿ç”¨çš„æ˜¯<code>sl_type_MEM</code>ï¼Œè€Œæ­¤æ—¶MEMçº§å¯èƒ½å·²ç»æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤äº†ã€‚æ¢å¥è¯è¯´ï¼Œ</strong>â€œå­˜â€ä¸â€œå–â€æ‰€åœ¨çš„æµæ°´çº§ä¸åŒï¼Œå¯¼è‡´â€œå­˜â€æ­£å¸¸ï¼Œâ€œå–â€å¼‚å¸¸</strong>ã€‚</p><p>æˆ‘ä»¬çš„<code>LoadStoreUnit</code>æ¨¡å—ä¹Ÿæˆäº†ç¬¬äºŒä¸ªè·¨æµæ°´çº§çš„æ¨¡å—ã€‚å¦‚ä½•ä¿®æ”¹å‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯ç›´æ¥å®ä¾‹åŒ–ä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·çš„æ¨¡å—ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [INFO] LoadStoreUnitæ¨¡å— - MEMçº§åªå¤„ç†Storeæ“ä½œ</span></span><br><span class="line"><span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] DRAM_input_data;  <span class="comment">// LSUå¤„ç†åæ•°æ®</span></span><br><span class="line"><span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] DRAM_output_data; <span class="comment">// LSUä»DRAMå¾—åˆ°çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">logic</span> [<span class="number">3</span>:<span class="number">0</span>] dram_we_MEM_strbe;</span><br><span class="line"><span class="comment">// MEMçº§LSUä»…ç”¨äºStoreå¤„ç†ï¼ŒLoadåœ¨WBçº§å¤„ç†</span></span><br><span class="line">LoadStoreUnit u_LoadStoreUnit_MEM(</span><br><span class="line">    <span class="variable">.sl_type</span>       (sl_type_MEM),</span><br><span class="line">    <span class="variable">.addr</span>          (alu_result_MEM),</span><br><span class="line">    <span class="variable">.load_data_i</span>   (<span class="number">32&#x27;b0</span>),        <span class="comment">// MEMçº§ä¸ä½¿ç”¨loadå¤„ç†</span></span><br><span class="line">    <span class="variable">.load_data_o</span>   (),             <span class="comment">// MEMçº§ä¸ä½¿ç”¨loadè¾“å‡º</span></span><br><span class="line">    <span class="variable">.store_data_i</span>  (rf_rd2_MEM),</span><br><span class="line">    <span class="variable">.store_data_o</span>  (DRAM_input_data),</span><br><span class="line">    <span class="variable">.dram_we</span>       (dram_we_MEM),</span><br><span class="line">    <span class="variable">.wstrb</span>         (dram_we_MEM_strbe)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// DRAMæ¨¡å—</span></span><br><span class="line">DRAM #(</span><br><span class="line">    <span class="variable">.ADDR_WIDTH</span>(<span class="number">15</span>)</span><br><span class="line">) u_DRAM (</span><br><span class="line">    <span class="variable">.clk</span>(clk),</span><br><span class="line">    <span class="variable">.a</span>  (alu_result_MEM[<span class="number">17</span>:<span class="number">2</span>]),  <span class="comment">// å­—èŠ‚åœ°å€è½¬æ¢ä¸ºå­—åœ°å€</span></span><br><span class="line">    <span class="variable">.spo</span>(DRAM_output_data),</span><br><span class="line">    <span class="comment">// .we (&#123;4&#123;dram_we_MEM&#125;&#125;),</span></span><br><span class="line">    <span class="variable">.we</span> (dram_we_MEM_strbe),</span><br><span class="line">    <span class="variable">.din</span>(DRAM_input_data)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// [INFO] WBçº§LoadStoreUnit - ä¸“é—¨å¤„ç†Loadæ“ä½œ</span></span><br><span class="line"><span class="comment">// ä½¿ç”¨WBçº§çš„sl_typeå’Œåœ°å€æ¥æ­£ç¡®å¤„ç†DRAMè¯»å–çš„æ•°æ®</span></span><br><span class="line"><span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] load_data_WB;</span><br><span class="line">LoadStoreUnit u_LoadStoreUnit_WB(</span><br><span class="line">    <span class="variable">.sl_type</span>       (sl_type_WB),</span><br><span class="line">    <span class="variable">.addr</span>          (alu_result_WB),</span><br><span class="line">    <span class="variable">.load_data_i</span>   (DRAM_output_data),  <span class="comment">// DRAMçš„spoåœ¨WBçº§ç¨³å®šå¯ç”¨</span></span><br><span class="line">    <span class="variable">.load_data_o</span>   (load_data_WB),</span><br><span class="line">    <span class="variable">.store_data_i</span>  (<span class="number">32&#x27;b0</span>),             <span class="comment">// WBçº§ä¸ä½¿ç”¨storeå¤„ç†</span></span><br><span class="line">    <span class="variable">.store_data_o</span>  (),</span><br><span class="line">    <span class="variable">.dram_we</span>       (<span class="number">1&#x27;b0</span>),              <span class="comment">// WBçº§ä¸å†™DRAM</span></span><br><span class="line">    <span class="variable">.wstrb</span>         ()</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼š</p><p><img src="https://webp.esing.dev/img/image-20251212135329430_251212_1353_cKJ6.png" alt="ä¿®æ”¹åçš„LSUæ­£å¸¸å·¥ä½œ"></p><h2 id="å…¨è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šè§£æ”¾åŒæ‰‹">å…¨è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šè§£æ”¾åŒæ‰‹</h2><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬çš„RV32I CPU ç®—æ˜¯å½»åº•å®Œæˆäº†ã€‚ä½†å³ä½¿æœ‰å‰é¢çš„æµ‹è¯•ï¼Œæˆ‘ä»¬ä»ä¸èƒ½ç¡®ä¿æˆ‘ä»¬çš„CPU<strong>ä¸‡æ— ä¸€å¤±</strong>ã€‚æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è¯æ˜å®ƒä¸€å®šæ˜¯ç¬¦åˆRV32Iæ ‡å‡†çš„CPUå‘¢ï¼Ÿæœ€å¥½çš„åŠæ³•ï¼Œè‡ªç„¶æ˜¯ä½¿ç”¨å½¢å¼åŒ–éªŒè¯ï¼Œä½†é‚£ä¸ªå¤ªçƒ¦äº†ï¼Œ<strong>è€Œä¸”æˆ‘ä¸ä¼š</strong>ã€‚ä½¿ç”¨å®˜æ–¹çš„æµ‹è¯•æ ·ä¾‹è¿›è¡Œæµ‹è¯•ç®—æ˜¯æœ€å®¹æ˜“çš„æ–¹æ³•äº†ã€‚riscv-software-srcè®¾ç½®äº†ä¸€ä¸ªæµ‹è¯•åº“ï¼Œä¸“é—¨ç”¨äºæµ‹è¯•å„ç§æ¶æ„çš„RV32 CPUæ˜¯å¦ç¬¦åˆæ ‡å‡†ï¼Œåœ¨<a href="https://github.com/riscv-software-src/riscv-tests">riscv-software-src/riscv-tests</a>ä¸‹ã€‚ä½¿ç”¨å®˜æ–¹å·¥å…·é“¾ç¼–è¯‘æ—¶ï¼Œå¿…é¡»å¸¦ä¸Š<code>_Zicsr</code>æ‰©å±•ï¼Œè¿™æ˜¯å› ä¸ºå…¶æµ‹è¯•æŒ‡ä»¤å’Œåˆå§‹åŒ–æŒ‡ä»¤ä¸­ç”¨åˆ°äº†<code>CSR</code>å¯„å­˜å™¨ï¼Œä¸è¿‡å³ä½¿ä¸æ”¯æŒä¹Ÿæ²¡å…³ç³»ã€‚</p><p>åœ¨æµ‹è¯•å‰ï¼Œè¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹DRAMã€‚<code>lw</code>æµ‹è¯•å­é›†ä¼šç›´æ¥ä»DRAMä¸­è¯»å–å€¼ï¼Œè€Œæˆ‘ä»¬é»˜è®¤æ˜¯å°†DRAMå…¨éƒ¨åˆå§‹åŒ–ä¸º<code>32'h00000000</code>ã€‚è€ƒè™‘åˆ°ä¹‹å‰å·²åœ¨IROMæ¨¡å—ä¸­æŒ‡å®šäº†å†…å­˜è¯»å–èŒƒå›´<code>$readmemh(testcase, rom_data, 0, (1 &lt;&lt; ADDR_WIDTH) - 1)</code>ï¼Œè¿™é‡Œåœ¨DRAMä¸­å¯ä¸æŒ‡å®šã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] ram_data[<span class="number">1</span> &lt;&lt; ADDR_WIDTH];</span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="keyword">string</span>  testcase;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ‰€æœ‰å†…å­˜ä¸º0</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">1</span> &lt;&lt; ADDR_WIDTH; i = i + <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">        ram_data[i] = <span class="number">32&#x27;h00000000</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰testcaseå‚æ•°ï¼Œä»hexæ–‡ä»¶åŠ è½½æ•°æ®æ®µ</span></span><br><span class="line">    <span class="comment">// hexæ–‡ä»¶æ˜¯å®Œæ•´çš„å†…å­˜é•œåƒï¼ŒæŒ‰å­—åœ°å€ç´¢å¼•</span></span><br><span class="line">    <span class="comment">// æ•°æ®æ®µä»0x2000å¼€å§‹ï¼Œå³hexæ–‡ä»¶çš„ç¬¬0x800è¡Œ(2048)</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">$value$plusargs</span>(<span class="string">&quot;TESTCASE=%s&quot;</span>, testcase)) <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// è¯»å–æ•´ä¸ªhexæ–‡ä»¶åˆ°DRAM</span></span><br><span class="line">        <span class="comment">// SystemVerilogçš„$readmemhä¼šè‡ªåŠ¨å¤„ç†åœ°å€æ˜ å°„</span></span><br><span class="line">        <span class="comment">// ä½†æ˜¯æœ€å¥½è¿˜æ˜¯æ‰‹åŠ¨æŒ‡å®šèŒƒå›´ä»¥é˜²ä¸‡ä¸€</span></span><br><span class="line">        <span class="built_in">$readmemh</span>(testcase, ram_data);</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;DRAM: Loaded memory image from %s&quot;</span>, testcase);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å†™ä¸ªç®€å•çš„Makefileè¿›è¡Œæµ‹è¯•ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://webp.esing.dev/img/image-20251212144050887_251212_1440_pe1l.png" alt="å®Œç¾çš„æµ‹è¯•ç»“æœ!"></p><h2 id="åè®°">åè®°</h2><p>æˆ‘ä»¬åšå®Œäº†å—ï¼Ÿåšå®Œäº†99%ã€‚</p><p>åé¢ï¼Œå¯èƒ½ä¼šé¦–å…ˆå®Œæˆ<code>Zicsr</code>æ‰©å±•ä¸<code>M</code>æ‰©å±•ï¼Œå†ä¹‹åä¼šå¾€è‡ªå·±çš„é¡¹ç›®ä¸Šé ï¼Œç ”ç©¶ä¸€ä¸‹æœ€æ–°çš„æ§åˆ¶æµåŠ å¯†æ‰©å±•<code>Zicfilp</code>å’Œ<code>Zicfiss</code>ã€‚<code>A</code>ã€<code>C</code>å’Œ<code>F</code>æ‰©å±•æš‚ä¸è€ƒè™‘ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è®©æˆ‘è®¿é—®ï¼&quot;&gt;è®©æˆ‘è®¿é—®ï¼&lt;/h2&gt;
&lt;p&gt;å¯¹äºL-Typeå’ŒS-Typeï¼Œæˆ‘ä»¬åªæ”¯æŒäº†&lt;code&gt;lw/sw&lt;/code&gt;ï¼Œå®ƒä»¬çš„å…„å¼Ÿå§å¦¹&lt;code&gt;lb/lbu/lh/lhu/&lt;b&gt;</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="åµŒå…¥å¼" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="è®¡ç®—æœºåŸç†" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬ä¹ç¯‡</title>
    <link href="https://blog.esing.dev/2025/12/11/riscvcod-p9/"/>
    <id>https://blog.esing.dev/2025/12/11/riscvcod-p9/</id>
    <published>2025-12-11T04:50:52.000Z</published>
    <updated>2025-12-12T07:10:58.517Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç»¼åˆå™¨è¯´å¥½ï¼Œé‚£æ‰æ˜¯çœŸå¥½">ç»¼åˆå™¨è¯´å¥½ï¼Œé‚£æ‰æ˜¯çœŸå¥½</h2><h3 id="æ¨¡å—ç»¼åˆ">æ¨¡å—ç»¼åˆ</h3><p>å†™å‡ºçš„HDLä»£ç éœ€è¦é€å…¥ç»¼åˆå™¨ä¸­ï¼Œç”Ÿæˆå®é™…çš„é—¨ç”µè·¯ã€‚ç»¼åˆå™¨ä¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æ¨æµ‹ä½ å†™çš„ä»£ç ï¼Œå¹¶å¸®ä½ è¿›è¡Œä¸€å®šçš„ä¼˜åŒ–ï¼Œæœ€ç»ˆç”Ÿæˆæ–‡ä»¶ã€‚</p><p>è¿™é‡Œé€‰æ‹©å¼€æºçš„<a href="https://github.com/YosysHQ/yosys">Yosys</a>è¿›è¡Œç»¼åˆã€‚å®˜æ–¹æ²¡æœ‰å‘å¸ƒé€‚ç”¨äºWindowsçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†æ˜¯Pythonçš„WASMåº“æœ‰ï¼Œè™½ç„¶æ˜¯ç»™WebAssemblyç¯å¢ƒå‡†å¤‡çš„ï¼Œéœ€è¦ç”µè„‘ä¸Šæœ‰<code>wasmtime</code>æ‰è¡Œã€‚ç¼–å†™ä¸€ä¸ªç»¼åˆè„šæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># è¯»å–æ‰€æœ‰æ¨¡å—ï¼ˆä¸éœ€è¦ -formalï¼‰</span><br><span class="line">read_slang ./user/src/include/defines.svh</span><br><span class="line"></span><br><span class="line">read_slang ./user/src/PC.sv</span><br><span class="line">read_slang ./user/src/IROM.sv</span><br><span class="line"></span><br><span class="line">read_slang ./user/src/PR_IF_ID.sv</span><br><span class="line"></span><br><span class="line">read_slang ./user/src/Decoder.sv</span><br><span class="line">read_slang ./user/src/imm_extender.sv</span><br><span class="line">read_slang ./user/src/RegisterF.sv</span><br><span class="line"></span><br><span class="line">read_slang ./user/src/PR_ID_EX.sv</span><br><span class="line"></span><br><span class="line">read_slang ./user/src/ALU.sv</span><br><span class="line">read_slang ./user/src/NextPC_Generator.sv</span><br><span class="line"></span><br><span class="line">read_slang ./user/src/PR_EX_MEM.sv</span><br><span class="line">read_slang ./user/src/DRAM.sv</span><br><span class="line">read_slang ./user/src/LoadStoreUnit.sv</span><br><span class="line"></span><br><span class="line">read_slang ./user/src/PR_MEM_WB.sv</span><br><span class="line"></span><br><span class="line">read_slang ./user/src/HazardUnit.sv</span><br><span class="line"></span><br><span class="line">read_slang ./user/src/CPU_TOP.sv</span><br><span class="line"></span><br><span class="line"># read_slang ./user/sim/tb_CPU_TOP.sv</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># æŒ‡å®šé¡¶å±‚æ¨¡å—ï¼Œå¹¶åšåŸºç¡€å¤„ç†</span><br><span class="line">prep -top CPU_TOP</span><br><span class="line"># prep -top CPU_TOP -rdff              # æ­¤å¤„ä¸èƒ½å°†è§¦å‘å™¨åˆå¹¶åˆ°å†…å­˜è¯»ç«¯å£</span><br><span class="line"># prep -top tb_CPU_TOP -flatten</span><br><span class="line"></span><br><span class="line"># å†™å‡º JSON</span><br><span class="line">write_json ./prj/netlist/CPU_TOP.json</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹‹åè¿è¡Œ<code>wasmtime --dir . .\yosys.wasm --.\prj\netlist\CPU_TOP.ys</code>å³å¯å¼€å§‹ç»¼åˆã€‚æ‰€æœ‰çš„æ¨¡å—ï¼ˆä¸å«IROMï¼‰ç»¼åˆç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">=== design hierarchy ===</span><br><span class="line"></span><br><span class="line">        +----------Count including submodules.</span><br><span class="line">        | </span><br><span class="line">      236 CPU_TOP</span><br><span class="line">       29 ALU</span><br><span class="line">        4 DRAM</span><br><span class="line">       49 Decoder</span><br><span class="line">       44 HazardUnit</span><br><span class="line">       15 NextPC_Generator</span><br><span class="line">        4 PC</span><br><span class="line">        9 PR_EX_MEM</span><br><span class="line">       36 PR_ID_EX</span><br><span class="line">       12 PR_IF_ID</span><br><span class="line">        5 PR_MEM_WB</span><br><span class="line">        9 RegisterF</span><br><span class="line">       11 imm_extender</span><br><span class="line"></span><br><span class="line">        +----------Count including submodules.</span><br><span class="line">        | </span><br><span class="line">      416 wires</span><br><span class="line">     4302 wire bits</span><br><span class="line">      262 public wires</span><br><span class="line">     3205 public wire bits</span><br><span class="line">      170 ports</span><br><span class="line">     2027 port bits</span><br><span class="line">        - memories</span><br><span class="line">        - memory bits</span><br><span class="line">        - processes</span><br><span class="line">      236 cells</span><br><span class="line">        3   $add</span><br><span class="line">       37   $aldff</span><br><span class="line">        1   $and</span><br><span class="line">       55   $eq</span><br><span class="line">        1   $ge</span><br><span class="line">       22   $logic_and</span><br><span class="line">        6   $logic_not</span><br><span class="line">       12   $logic_or</span><br><span class="line">        2   $lt</span><br><span class="line">        2   $mem_v2</span><br><span class="line">       59   $mux</span><br><span class="line">        4   $not</span><br><span class="line">        1   $or</span><br><span class="line">       11   $pmux</span><br><span class="line">        5   $reduce_bool</span><br><span class="line">       10   $reduce_or</span><br><span class="line">        1   $shl</span><br><span class="line">        1   $shr</span><br><span class="line">        1   $sshr</span><br><span class="line">        1   $sub</span><br><span class="line">        1   $xor</span><br><span class="line">       12 submodules</span><br><span class="line">        1   ALU</span><br><span class="line">        1   DRAM</span><br><span class="line">        1   Decoder</span><br><span class="line">        1   HazardUnit</span><br><span class="line">        1   NextPC_Generator</span><br><span class="line">        1   PC</span><br><span class="line">        1   PR_EX_MEM</span><br><span class="line">        1   PR_ID_EX</span><br><span class="line">        1   PR_IF_ID</span><br><span class="line">        1   PR_MEM_WB</span><br><span class="line">        1   RegisterF</span><br><span class="line">        1   imm_extender</span><br></pre></td></tr></table></figure><h3 id="åŒæ­¥è¯»ã€å¼‚æ­¥è¯»">åŒæ­¥è¯»ã€å¼‚æ­¥è¯»</h3><p>å¯¹äºå‰é¢çš„DRAMï¼Œæˆ‘ä»¬ä¹Ÿç”¨Yosysç»¼åˆä¸€ä¸‹ã€‚è¿™é‡Œå°†å¼‚æ­¥ä¸åŒæ­¥DRAMçš„ç»¼åˆç»“æœæ”¾åœ¨ä¸€èµ·ï¼Œå·¦è¾¹ä¸ºå¼‚æ­¥ï¼Œå³è¾¹ä¸ºåŒæ­¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">=== DRAM ===</span><br><span class="line"></span><br><span class="line">        +----------Local Count, excluding submodules.</span><br><span class="line">        | Default                      SDRAM</span><br><span class="line">        | ---------                    ---------</span><br><span class="line">        8 wires                        8 wires</span><br><span class="line">      147 wire bits                  147 wire bits</span><br><span class="line">        5 public wires                 5 public wires</span><br><span class="line">       82 public wire bits            82 public wire bits</span><br><span class="line">        5 ports                        5 ports</span><br><span class="line">       82 port bits                   82 port bits</span><br><span class="line">        4 cells                        4 cells</span><br><span class="line">                                       1   $dff</span><br><span class="line">        1   $mem_v2                    1   $mem_v2</span><br><span class="line">        3   $mux                       2   $mux</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒåŒºåˆ«æ˜¯ä¸€ä¸ªMUXå’Œä¸€ä¸ªDFFã€‚</p><p>Yosyså¾ˆèªæ˜ï¼Œä½†æ˜¯<strong>Xilinxå¾ˆå‚»é€¼</strong>ï¼Œå°±ä¸è¿™ä¹ˆæƒ³äº†ã€‚å¯¹äºå‰é¢çš„â€œåŒæ­¥å†™å¼‚æ­¥è¯»â€DRAMï¼ŒXilinx Vivadoä¼šæŠŠå®ƒç»¼åˆä¸º<strong>å…­ä¸‡ä¸ªDFFç»„æˆçš„é˜µåˆ—</strong>ï¼š</p><p><img src="https://webp.esing.dev/img/image-20251211173426779_251211_1734_YmAO.png" alt="Iã€€ã€€SYNTHESISã€€ã€€65,536ã€€ã€€DFFsã€€ã€€!!!"></p><p>Utilizationé‡Œåˆ™æ˜¯ä½œä¸ºLUTRAMå‡ºç°ï¼š</p><p><img src="https://webp.esing.dev/img/image-20251212150821514_251212_1508_ADar.png" alt="çœ‹è¿™ä¸€å¤§å †LUTRAM èƒ½å¿ä½ä¸ç¬‘çš„éƒ½æ˜¯ç¥äººäº†"></p><p>ç»¼åˆåçš„ä¼°è®¡åŠŸè€—ç›´æ¥æ‹‰åˆ°15wäº†ï¼Œå¾ˆéš¾ç»·å¾—ä½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»ä¿®æ”¹ä¸ºâ€œåŒæ­¥å†™åŒæ­¥è¯»â€çš„DRAMâ€”â€”è¿™åœ¨å·¥ä¸šç”Ÿäº§ä¸Šä¹Ÿæ˜¯è§„èŒƒã€‚ä¸è®ºæ˜¯Xilinxè¿˜æ˜¯å…¶ä»–å‚å•†ï¼Œå…¶FPGAéœ€è¦ä½¿ç”¨çš„BlockRAM IPæ ¸éƒ½æ˜¯åŒæ­¥è¯»å†™çš„ï¼Œæœ‰çš„ç”šè‡³éœ€è¦ä¸¤æ‹ã€‚</p><h2 id="DRAMé­”æ”¹">DRAMé­”æ”¹</h2><p>æˆ‘ä»¬å¿…é¡»ç«‹å³é©¬ä¸Šä½¿ç”¨SDRAMã€‚</p><h3 id="æ—¶åºé—®é¢˜">æ—¶åºé—®é¢˜</h3><p>æˆ‘ä»¬åªéœ€è¦æ”¹åŠ¨ä¸€è¡Œå³å¯ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥å†™</span></span><br><span class="line"><span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (we) <span class="keyword">begin</span></span><br><span class="line">        ram_data[a] &lt;= din;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    spo &lt;= ram_data[a];  <span class="comment">// åŒæ­¥è¯»</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ç„¶åæµ‹è¯•ä¸€ä¸‹ç®€å•çš„S-Typeå’ŒL-Typeã€‚ä¸å‡ºæ„å¤–çš„è¯ï¼Œå°±ä¼šå‡ºæ„å¤–ï¼š</p><p><img src="https://webp.esing.dev/img/image-20251211154229805_251211_1542_A3if.png" alt="SLå¤§æ³•åï¼"></p><p>é—®é¢˜å‡ºåœ¨<code>wd_sel_MEM</code>ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å…¶å€¼ä¸º1ï¼ˆé€‰æ‹©DRAMè¾“å‡ºæ•°æ®ï¼‰æ—¶ï¼ŒSDRAMå‹æ ¹å°±æ²¡å‡†å¤‡å¥½æ•°æ®ã€‚è¿™æ˜¯å› ä¸ºåŒæ­¥å†™æ—¶æ•°æ®åœ¨count=5æ—¶è¢«å†™å…¥ï¼Œå¼‚æ­¥è¯»å¯ä»¥åœ¨æ•°å€¼å˜åŒ–çš„é‚£ä¸€åˆ»å°±å¼€å§‹è·Ÿéšè¾“å‡ºï¼Œä½†åŒæ­¥è¯»åªæœ‰åœ¨æ—¶é’Ÿæ²¿åˆ°æ¥æ—¶ï¼ˆcount=6ï¼‰æ‰èƒ½è¯»å‡ºæ•°æ®ï¼Œè€Œè¿™æ—¶å€™<code>wd_sel_MEM</code>å·²ç»å˜ä¸º0ï¼Œé€‰æ‹©<code>rf_wd</code>çš„æ•°æ®äº†ã€‚</p><p>æ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬éœ€è¦è®©<code>wd_sel_MEM</code>æ‰“ä¸€æ‹ã€‚æœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯è®©å®ƒç©¿è¿‡æœ€åä¸€çº§æµæ°´çº¿å¯„å­˜å™¨ï¼Œåœ¨MEM/WBçº§çš„å¯„å­˜å™¨å†…è¢«æ‰“ä¸€æ‹ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬çš„<code>rf_wd</code>æ•°æ®ä¹Ÿéœ€è¦è¢«æ‰“ä¸€æ‹ã€‚</p><p>è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬ä»SDRAMå–çš„æ•°æ®è¦ä¸è¦é€è¿›MEM/WBçº§æµæ°´çº¿å¯„å­˜å™¨ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä¸éœ€è¦ã€‚åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬çš„é—®é¢˜å°±æ˜¯SDRAMçš„æ•°æ®åœ¨ä¸Šå‡æ²¿æ‰è¢«å†™å…¥è¯»å–ï¼ŒåŒæ­¥è¯»å–çš„æ•°æ®ç›¸å¯¹åŸæ¥å¼‚æ­¥è¯»å–çš„æ—¶å€™<strong>å·²ç»è¢«æ‰“äº†ä¸€æ‹</strong>äº†ã€‚</p><h3 id="EX-MEMçº§æµæ°´çº¿å¯„å­˜å™¨ä¿®æ”¹">EX/MEMçº§æµæ°´çº¿å¯„å­˜å™¨ä¿®æ”¹</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel_mem_i,</span><br><span class="line"><span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel_wb_o,</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">        wd_sel_wb_o      &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        wd_sel_wb_o      &lt;= wd_sel_mem_i;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="DRAMæ•°æ®é€‰æ‹©MUX">DRAMæ•°æ®é€‰æ‹©MUX</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›å†™æ•°æ®æ¥æºé€‰æ‹©MUX</span></span><br><span class="line"><span class="comment">// å¯¹äºåŒæ­¥DRAM DRAMçš„spoå·²ç»æ˜¯å¯„å­˜å™¨è¾“å‡º åœ¨WBçº§ç›´æ¥ä½¿ç”¨ä»¥é¿å…å¤šä½™å»¶è¿Ÿ</span></span><br><span class="line"><span class="comment">// DRAM_output_dataåœ¨æ•´ä¸ªWBå‘¨æœŸå†…ä¿æŒç¨³å®š å¯ä»¥å®‰å…¨åœ°è¢«å¯„å­˜å™¨å †é‡‡æ ·</span></span><br><span class="line"><span class="keyword">assign</span> rf_wd_WB = (wd_sel_WB == `WD_SEL_FROM_DRAM) ? DRAM_output_data : rf_wd_WB_from_PR;</span><br></pre></td></tr></table></figure><p>å†æ¬¡æµ‹è¯•ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚</p><h3 id="å†æ¬¡ç»¼åˆ">å†æ¬¡ç»¼åˆ</h3><p>åœ¨Vivadoä¸­è¿›è¡Œç»¼åˆã€‚å¯ä»¥çœ‹åˆ°ï¼Œç»“æœå¾ˆå®Œç¾ï¼š</p><p><img src="https://webp.esing.dev/img/image-20251211173249551_251211_1732_ZRKE.png" alt="è¢«æ­£ç¡®è¯†åˆ«æˆRAMçš„SDRAM"></p><p>åœ¨Utilizationé‡Œå¯ä»¥çœ‹åˆ°ï¼ŒBRAMè¢«å ç”¨äº†ä¸€éƒ¨åˆ†ï¼Œè¯´æ˜æˆ‘ä»¬çš„åŒæ­¥è¯»å†™DRAMè¢«ç»¼åˆä¸ºBRAMï¼Œä¸å ç”¨åŸå…ˆçš„LUTRAMäº†ã€‚</p><p><img src="https://webp.esing.dev/img/image-20251212145918732_251212_1459_IVzg.png" alt="æ­£ç¡®ç»¼åˆä¸ºBRAMçš„SDRAM"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç»¼åˆå™¨è¯´å¥½ï¼Œé‚£æ‰æ˜¯çœŸå¥½&quot;&gt;ç»¼åˆå™¨è¯´å¥½ï¼Œé‚£æ‰æ˜¯çœŸå¥½&lt;/h2&gt;
&lt;h3 id=&quot;æ¨¡å—ç»¼åˆ&quot;&gt;æ¨¡å—ç»¼åˆ&lt;/h3&gt;
&lt;p&gt;å†™å‡ºçš„HDLä»£ç éœ€è¦é€å…¥ç»¼åˆå™¨ä¸­ï¼Œç”Ÿæˆå®é™…çš„é—¨ç”µè·¯ã€‚ç»¼åˆå™¨ä¼šåœ¨è¿™ä¸ªè¿‡ç¨‹</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="åµŒå…¥å¼" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="è®¡ç®—æœºåŸç†" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬å…«ç¯‡</title>
    <link href="https://blog.esing.dev/2025/12/11/riscvcod-p8/"/>
    <id>https://blog.esing.dev/2025/12/11/riscvcod-p8/</id>
    <published>2025-12-11T01:00:00.000Z</published>
    <updated>2025-12-11T10:41:42.148Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰é€’ï¼šå¿«äººä¸€æ­¥">å‰é€’ï¼šå¿«äººä¸€æ­¥</h2><h3 id="æ¿€çƒˆçš„æ–—äº‰">æ¿€çƒˆçš„æ–—äº‰</h3><p>æˆ‘ä»¬åšå®Œäº†å—ï¼Ÿè¿˜æ²¡å®Œã€‚</p><p>åœ¨ <a href="/2025/12/10/riscvcod-p7/" title="ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬ä¸ƒç¯‡">ä¹‹å‰</a> çš„æµ‹è¯•é‡Œï¼Œç¨‹åºæ²¡æœ‰ä»»ä½•æ•°æ®å†’é™©â€”â€”åœ¨å®é™…è¿è¡Œä¸­è¿™å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚æˆ‘ä»¬ç®€å•ä¿®æ”¹ä¸€ç‚¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">addi x1,x0,1</span><br><span class="line">addi x2,x0,2</span><br><span class="line">addi x3,x0,3</span><br><span class="line">addi x4,x0,4</span><br><span class="line">addi x1,x0,7</span><br><span class="line">addi x2,x0,21</span><br><span class="line">add  x7,x1,x2 # åŠ å…¥æ•°æ®å†’é™©</span><br></pre></td></tr></table></figure><p>ç„¶åè¿è¡Œã€‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæˆ‘ä»¬æœŸæœ›çœ‹åˆ°<code>x7</code>è¾“å‡ºçš„æ˜¯<code>x1</code>å’Œ<code>x2</code>å˜åŒ–åç›¸åŠ çš„å€¼ï¼Œåº”å½“ä¸º<code>28</code>ã€‚ä½†æ˜¯è®¡ç®—ç»“æœè¾“å‡ºäº†é”™è¯¯çš„3ï¼</p><p><img src="https://webp.esing.dev/img/image-20251211084904808_251211_0849_RBUY.png" alt="æ•°æ®å†’é™©å¯¼è‡´çš„é”™è¯¯è¾“å‡º"></p><p>è¿™å°±æ˜¯æœ€ç»å…¸çš„â€œæ•°æ®å†’é™©â€ã€‚æˆ‘ä»¬çœ‹çœ‹å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   x1   x2    x7      IF          ID          EX          MEM         WB</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">1   1    2     x      x1=7</span><br><span class="line">2   1    2     x      x2=21       x1=7</span><br><span class="line">3   1    2     x      x7=x1+x2    x2=21       x1=7</span><br><span class="line">4   1    2     x                  x7=x1+x2[R] x2=21       x1=7</span><br><span class="line">5   7    2     x                              x7=x1+x2    x2=21       x1=7 [W]</span><br><span class="line">6   7    21    x                                          x7=x1+x2    x2=21[W]</span><br><span class="line">7   7    21    3                                                      x7=3 [W]</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æµæ°´çº¿ç¤ºæ„å›¾ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºå†™å›åœ¨WBçº§æ‰è¢«å®Œæˆï¼Œå¯¼è‡´ç¬¬ä¸‰æ¡æŒ‡ä»¤åœ¨IDçº§å–åˆ°äº†æ—§çš„å€¼ã€‚ç›´åˆ°ç¬¬å…­ä¸ªå‘¨æœŸç»“æŸï¼Œæºå¯„å­˜å™¨çš„å€¼æ‰æ›´æ–°å®Œæ¯•ã€‚</p><h3 id="ç©ºæ³¡ä¸é˜»å¡">ç©ºæ³¡ä¸é˜»å¡</h3><p>ä¸ºäº†ä¸è®©è®¡ç®—å–åˆ°é”™è¯¯çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç­‰ã€‚æ—¶é—´ï¼Œä¼šç»™å‡ºç­”æ¡ˆã€‚åœ¨å‰é¢çš„è®¡ç®—è¿˜æ²¡å®Œæˆæ—¶ï¼Œè®©è¯‘ç çº§ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ä»å¯„å­˜å™¨å †ä¸­è¯»å–æ­£ç¡®çš„å€¼å°±è¡Œã€‚æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼šå¦‚æœä¸¤æ¡æŒ‡ä»¤ä¹‹é—´å­˜åœ¨æ•°æ®å…³è”ï¼Œåˆ™ç»™å‡ºä¸€ä¸ªä¿¡å·ï¼Œä¹‹åIFçº§çš„ç¨‹åºè®¡æ•°å™¨æ ¹æ®ä¿¡å·æ¥å†³å®šæ˜¯å¦åœæ­¢ã€ID/EXçº§æµæ°´çº¿å¯„å­˜å™¨æ ¹æ®ä¿¡å·è¿›è¡Œå†²åˆ·ã€‚</p><p>ä»ä¸Šé¢çš„ä¾‹å­å¯çŸ¥ï¼Œåªè¦é—´éš”ä¸è¶…è¿‡ä¸‰æ¡çš„æŒ‡ä»¤ï¼Œéƒ½æœ‰ç€æ•°æ®å†’é™©çš„å¯èƒ½ã€‚å› æ­¤ï¼Œåˆ¤æ–­ä¸€ä¸‹å³å¯ã€‚è®°å¾—åˆ¤æ–­ä¸€ä¸‹å†™å…¥çš„ç›®æ ‡æ˜¯å¦ä¸º0ï¼Œ<strong>æ¯•ç«Ÿ0è¢«å¡äº†å¤šå°‘ä¸œè¥¿ä¹Ÿä¸ä¼šå­ä¸€å£°</strong>ã€‚ä¹‹åï¼Œå†å®šä¹‰ä¸€ä¸ªåˆ¤æ–­ä¿¡å·ï¼Œç”¨äºæ§åˆ¶å†²åˆ·ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">// é—´éš”ä¸€çº§æµæ°´çº¿ åˆ¤æ–­ä¸‹å†™å…¥çš„ä¸ä¸ºx0å³å¯</span></span><br><span class="line">    RAW_1_rD1 = (wR_EX ==  rR1_ID) &amp;&amp;  rf_we_EX &amp;&amp; rs1_used_ID &amp;&amp; (wR_EX != <span class="number">5&#x27;b0</span>);</span><br><span class="line">    RAW_1_rD2 = (wR_EX ==  rR2_ID) &amp;&amp;  rf_we_EX &amp;&amp; rs2_used_ID &amp;&amp; (wR_EX != <span class="number">5&#x27;b0</span>);</span><br><span class="line">    <span class="comment">// é—´éš”ä¸¤çº§æµæ°´çº¿</span></span><br><span class="line">    RAW_2_rD1 = (wR_MEM == rR1_ID) &amp;&amp; rf_we_MEM &amp;&amp; rs1_used_ID &amp;&amp; (wR_MEM != <span class="number">5&#x27;b0</span>);</span><br><span class="line">    RAW_2_rD2 = (wR_MEM == rR2_ID) &amp;&amp; rf_we_MEM &amp;&amp; rs2_used_ID &amp;&amp; (wR_MEM != <span class="number">5&#x27;b0</span>);</span><br><span class="line">    <span class="comment">// é—´éš”ä¸‰çº§æµæ°´çº¿</span></span><br><span class="line">    RAW_3_rD1 = (wR_WB ==  rR1_ID) &amp;&amp;  rf_we_WB &amp;&amp; rs1_used_ID &amp;&amp; (wR_WB != <span class="number">5&#x27;b0</span>);</span><br><span class="line">    RAW_3_rD2 = (wR_WB ==  rR2_ID) &amp;&amp;  rf_we_WB &amp;&amp; rs2_used_ID &amp;&amp; (wR_WB != <span class="number">5&#x27;b0</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">// å†²åˆ·ä¿¡å·ç”Ÿæˆ</span></span><br><span class="line"><span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">    RAW_flush_ID = RAW_1_rD1 || RAW_2_rD1 || RAW_3_rD1</span><br><span class="line">                || RAW_1_rD2 || RAW_2_rD2 || RAW_3_rD2;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ¥åˆ°CPUé¡¶å±‚æ¨¡å—çš„å¯¹åº”ä½ç½®ã€‚æµ‹è¯•ä¸€ä¸‹ï¼</p><p><img src="https://webp.esing.dev/img/image-20251211092606018_251211_0926_7eXs.png" alt="æµæ°´çº¿åœé¡¿å¾—å‡ºæ­£ç¡®ç»“æœ"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œæµæ°´çº¿è¢«åœé¡¿äº†å¾ˆä¹…ï¼Œä½†æ˜¯è‡³å°‘ç»“æœå‡ºæ¥äº†ã€‚</p><h3 id="ä¸å…¶åœæ»ä¸å‰ï¼Œä¸å¦‚å¤§æ­¥å‘å‰">ä¸å…¶åœæ»ä¸å‰ï¼Œä¸å¦‚å¤§æ­¥å‘å‰</h3><p>æµæ°´çº¿åœé¡¿ç¡®å®èƒ½è§£å†³æ•°æ®å†’é™©çš„é—®é¢˜ï¼Œä½†æ˜¯<strong>æ•ˆç‡å¤ªä½äº†</strong>ã€‚æˆ‘ä»¬ç›´æ¥æŠŠEXçº§ç®—å‡ºæ¥çš„ç»“æœé€åˆ°å‰é¢ä¸€çº§ç”¨å°±æ˜¯äº†ã€‚ä¸Šé¢çš„ä¿¡å·æ”¹ä¸ªåå­—å°±å¯ä»¥æ‹¿æ¥ç”¨äº†ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰é€’æ•°æ®é€‰æ‹©</span></span><br><span class="line"><span class="comment">// ä¼˜å…ˆçº§ï¼šEX &gt; MEM &gt; WB</span></span><br><span class="line"><span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">    <span class="comment">// æºæ“ä½œæ•°1å‰é€’æ•°æ®é€‰æ‹©</span></span><br><span class="line">    <span class="keyword">if</span> (RAW_1_rD1)      fwd_rD1_ID = rf_wd_EX;  <span class="comment">// æ¥è‡ªEXçº§</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (RAW_2_rD1) fwd_rD1_ID = rf_wd_MEM; <span class="comment">// æ¥è‡ªMEMçº§</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (RAW_3_rD1) fwd_rD1_ID = rf_wd_WB;  <span class="comment">// æ¥è‡ªWBçº§</span></span><br><span class="line">    <span class="keyword">else</span>                fwd_rD1_ID = <span class="number">32&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æºæ“ä½œæ•°2å‰é€’æ•°æ®é€‰æ‹©</span></span><br><span class="line">    <span class="keyword">if</span> (RAW_1_rD2)      fwd_rD2_ID = rf_wd_EX;  <span class="comment">// æ¥è‡ªEXçº§</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (RAW_2_rD2) fwd_rD2_ID = rf_wd_MEM; <span class="comment">// æ¥è‡ªMEMçº§</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (RAW_3_rD2) fwd_rD2_ID = rf_wd_WB;  <span class="comment">// æ¥è‡ªWBçº§</span></span><br><span class="line">    <span class="keyword">else</span>                fwd_rD2_ID = <span class="number">32&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ¥å…¥å‰é€’ä½¿èƒ½åˆ°ID/EXçº§æµæ°´çº¿å¯„å­˜å™¨ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰é€’ä¿¡å·ä¸æ•°æ®</span></span><br><span class="line"><span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD1_forwarded, rD2_forwarded;</span><br><span class="line"><span class="comment">// è€ƒè™‘äº†å‰é€’å°±ä¸éœ€è¦å†²åˆ·äº†</span></span><br><span class="line"><span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">    rD1_forwarded = fwd_rD1e_ID ? fwd_rD1_ID : rD1_i;</span><br><span class="line">    rD2_forwarded = fwd_rD2e_ID ? fwd_rD2_ID : rD2_i;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯„å­˜å™¨å †æ•°æ®</span></span><br><span class="line"><span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">        rD1_o &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">        rD2_o &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        rD1_o &lt;= rD1_forwarded;</span><br><span class="line">        rD2_o &lt;= rD2_forwarded;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>å†æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°æå‰äº†ä¸‰ä¸ªå‘¨æœŸä¾¿ç®—å‡ºäº†ç»“æœï¼Œè¿™ä¸ªå»¶æ—¶åˆšå¥½å¯¹åº”ä¸Šé¢ç®—å‡ºçš„æ•°æ®ç›¸å…³æ€§é—´éš”ã€‚æ³¢å½¢å›¾ä¸Š<code>x7</code>ç´§æ¥ç€<code>x2</code>çš„å˜åŒ–ï¼Œå’Œé¢„æœŸçš„ä¸€æ ·ï¼</p><p><img src="https://webp.esing.dev/img/image-20251211095427035_251211_0954_H54D.png" alt="åŠ å…¥æ•°æ®å‰é€’åçš„æ­£ç¡®ç»“æœ"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">   x1   x2    x7      IF          ID          EX          MEM         WB</span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">1   1    2     x      x1=7</span><br><span class="line">2   1    2     x      x2=21       x1=7</span><br><span class="line">3   1    2     x      x7=x1+x2    x2=21       x1=7</span><br><span class="line">4   7[F] 21[F] x                  x7=x1+x2[F] x2=21       x1=7</span><br><span class="line">5   7    2     x                              x7=x1+x2    x2=21       x1=7 [W]</span><br><span class="line">6   7    21    x                                          x7=x1+x2    x2=21[W]</span><br><span class="line">7   7    21    28                                                     x7=28[W]</span><br></pre></td></tr></table></figure><h3 id="Load-Useå†’é™©">Load-Useå†’é™©</h3><p>é™¤äº†å¸¸è§çš„ä¾èµ–å†’é™©ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç§â€œå–æ•°-ä½¿ç”¨â€å‹å†’é™©ã€‚æˆ‘ä»¬ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">addi x1,x0,1</span><br><span class="line">addi x2,x0,2</span><br><span class="line">add  x3,x1,x2</span><br><span class="line">sw   x3,0(x0)</span><br><span class="line">lw   x4,0(x0)</span><br><span class="line">addi x5,x4,1 # Load-Use å†’é™©</span><br><span class="line">addi x6,x0,6</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæœ¬åº”å½“è®¡ç®—å‡º4çš„<code>x5</code>ç°åœ¨åªæ˜¯1ã€‚</p><p><img src="https://webp.esing.dev/img/image-20251211104058363_251211_1040_nM7O.png" alt="å–æ•°-ä½¿ç”¨å†’é™©å¯¼è‡´çš„é”™è¯¯è¾“å‡º"></p><p>åŸå› æ˜¯è¦å…ˆä»DRAMä¸­è¯»å‡ºå€¼å­˜å…¥å¯„å­˜å™¨ï¼Œä¹‹åå†è¯»å–å¯„å­˜å™¨å€¼è¿›è¡Œè®¡ç®—ï¼Œä½†è¯»å‡ºçš„å€¼åœ¨é€åˆ°å¯„å­˜å™¨ä¹‹å‰å°±éœ€è¦è¢«ä½¿ç”¨ï¼Œæ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬ä¹Ÿå¯ä»¥åŠ å…¥å‰é€’ã€‚</p><p>å¯ä»¥å—ï¼Ÿ</p><p>L-TypeæŒ‡ä»¤åœ¨æµæ°´çº¿ä¸­è¦ç»è¿‡MEMçº§æ‰èƒ½å¾—åˆ°ä»DRAMè¿”å›çš„æ•°æ®ï¼Œè€Œæ™®é€šçš„å‰é€’æ˜¯æŠŠ EX çº§äº§ç”Ÿçš„ ALU ç»“æœç›´æ¥é€ç»™åç»­æŒ‡ä»¤çš„ EX é˜¶æ®µä½¿ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œ<strong>L-Typeçš„æ•°æ®åœ¨ EX ä¹‹åã€MEM ä¹‹åæ‰å¯ç”¨</strong>ã€‚å•é å¸¸è§„ çš„EX2EX è½¬å‘æ˜¯æ— æ³•æ¶ˆé™¤çš„ã€‚</p><p>é‚£æˆ‘ä»¬åŠ ä¸€ä¸ªMEM2EXçº§çš„å‰é€’è·¯å¾„ä¸å°±è¡Œäº†ï¼Ÿæƒ³æ³•æ˜¯å¥½çš„ï¼Œä½†æ˜¯æµæ°´çº¿æ‰§è¡Œåäº†ï¼š</p><ul><li>L-Typeçš„æ•°æ®å¾€å¾€åœ¨ MEM çº§çš„æœ«æœŸæ‰å¯ç”¨ï¼ˆè¿™é‡Œæ˜¯MUXä¹‹åè¾“å‡ºçš„ç»“æœï¼‰ï¼Œè€Œ EX çš„æ“ä½œæ•°é€šå¸¸åœ¨è¯¥å‘¨æœŸæ—©æœŸå°±è¦ç”¨åˆ°ï¼Œä¼šå‡ºç°æ—¶åºé”™è¯¯ï¼›</li><li>æ’å…¥ä¸€ä¸ªæ°”æ³¡æ›´ä¸ºç®€å•ï¼Œä¹Ÿæ›´å®¹æ˜“æ§åˆ¶æµæ°´çº¿æµåŠ¨ã€‚</li></ul><p>é‚£ç›´æ¥æ’æ°”æ³¡å°±è¡Œäº†ï¼Œä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿ</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Load_use å†’é™©åˆ¤æ–­</span></span><br><span class="line"><span class="keyword">logic</span> load_use_hazard;</span><br><span class="line"><span class="keyword">assign</span> load_use_hazard = (wd_sel_EX == `WD_SEL_FROM_DRAM) &amp;&amp; (RAW_1_rD1 || RAW_1_rD2);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµæ°´çº¿å†²åˆ·ä¸åœé¡¿</span></span><br><span class="line"><span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">    keep_pc     = load_use_hazard ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    stall_IF_ID = load_use_hazard ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    flush_ID_EX = load_use_hazard ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><img src="https://webp.esing.dev/img/image-20251211104952833_251211_1049_DgaD.png" alt="åœé¡¿ä¸€çº§æµæ°´çº¿åå¾—å‡ºæ­£ç¡®ç»“æœ"></p><div class="note info flat"><p>äº‹å®ä¸Šï¼Œå¯¹äºLoad-Useç±»å†’é™©ï¼Œæœ€æ ‡å‡†çš„åšæ³•å°±æ˜¯æ’å…¥ç©ºæ³¡ã€‚è¿™ä¹Ÿæ˜¯å‡ ä¹æ•™ç§‘ä¹¦ä¸­éƒ½æåŠçš„æ–¹æ³•ã€‚</p></div><h3 id="åˆ†æ”¯è·³è½¬ï¼šJumpin">åˆ†æ”¯è·³è½¬ï¼šJumpin'</h3>    <div id="aplayer-vbpECIgp" class="aplayer aplayer-tag-marker meting-tag-marker"         data-id="1347247827" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#ff80ac" data-volume="0.3" data-loop="none"    ></div><p>B-Typeç±»æŒ‡ä»¤å‹æ ¹ä¸éœ€è¦å†™å¯„å­˜å™¨ï¼Œåªæ˜¯åœ¨EXçº§è®¡ç®—å‡ºæ˜¯å¦è·³è½¬åæ›´æ–°PCå€¼ã€‚æˆ‘ä»¬åœ¨ <a href="/2025/12/09/riscvcod-p6/" title="ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬å…­ç¯‡">æ‰§è¡Œçº§</a> å·²ç»å†™å¥½äº†ä¸‹ä¸€PCè®¡ç®—æ¨¡å—ï¼Œå…¶ä¸­<code>take_branch</code>è¾“å‡ºå°±æ˜¯æ˜¯å¦è·³è½¬ã€‚åœ¨è·³è½¬æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è®©ç¨‹åºè®¡æ•°å™¨çš„ä¸‹ä¸€PCå–åˆ°è·³è½¬ç›®æ ‡åœ°å€ï¼Œå¹¶å†²åˆ·IF/IDçº§çš„æµæ°´çº¿å¯„å­˜å™¨ã€‚ä¸ºäº†åˆ†åˆ«ä»¥åæ¥å…¥åˆ†æ”¯è·³è½¬é¢„æµ‹æ¨¡å—ï¼Œæˆ‘ä»¬é¢„ç•™ä¸€ä¸ªè¾“å…¥ç«¯å£ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">logic</span> branch_predicted_result;</span><br><span class="line"><span class="comment">// æ­¤å¤„è®¾ç½®ä¸ºé™æ€ä¸é¢„æµ‹ å› æ­¤è·å–EXçº§çš„è·³è½¬ç»“æœ</span></span><br><span class="line"><span class="comment">// assign branch_predicted_result = branch_predicted_i;</span></span><br><span class="line"><span class="keyword">assign</span> branch_predicted_result = take_branch_NextPC;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æµæ°´çº¿å†²åˆ·ä¸åœé¡¿</span></span><br><span class="line"><span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">    keep_pc     = load_use_hazard ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    stall_IF_ID = load_use_hazard ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    flush_IF_ID = branch_predicted_result ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    flush_ID_EX = (branch_predicted_result || load_use_hazard) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>ç„¶åå†™ä¸ªç®€å•çš„åˆ†æ”¯è·³è½¬æµ‹è¯•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">addi x1, x0, 5   # x1 = 5</span><br><span class="line">addi x2, x0, 5   # x2 = 5</span><br><span class="line">addi x3, x0, 0   # x3 = 0</span><br><span class="line"></span><br><span class="line">beq  x1, x2, 8   # è·³è½¬åˆ°PC+8ï¼ˆè·³è¿‡ä¸‹ä¸€æ¡ï¼‰ï¼Œx1==x2æ—¶è·³è½¬</span><br><span class="line">addi x3, x3, 1   # æœªè·³è½¬æ—¶æ‰§è¡Œï¼ˆåº”è¢«è·³è¿‡ï¼‰</span><br><span class="line"></span><br><span class="line">addi x4, x0, 10  # x4 = 10</span><br><span class="line"></span><br><span class="line">addi x5, x0, 7</span><br><span class="line">bne  x1, x5, 8   # è·³è½¬åˆ°PC+8ï¼ˆè·³è¿‡ä¸‹ä¸€æ¡ï¼‰ï¼Œx1!=x5æ—¶è·³è½¬</span><br><span class="line">addi x4, x4, 1   # æœªè·³è½¬æ—¶æ‰§è¡Œï¼ˆåº”è¢«è·³è¿‡ï¼‰</span><br><span class="line"></span><br><span class="line">addi x6, x0, 3</span><br><span class="line">blt  x6, x1, 8   # è·³è½¬åˆ°PC+8ï¼ˆè·³è¿‡ä¸‹ä¸€æ¡ï¼‰ï¼Œx6&lt;x1æ—¶è·³è½¬</span><br><span class="line">addi x4, x4, 2   # æœªè·³è½¬æ—¶æ‰§è¡Œï¼ˆåº”è¢«è·³è¿‡ï¼‰</span><br><span class="line"></span><br><span class="line">addi x7, x0, 5</span><br><span class="line">bge  x1, x7, 8   # è·³è½¬åˆ°PC+8ï¼ˆè·³è¿‡ä¸‹ä¸€æ¡ï¼‰ï¼Œx1&gt;=x7æ—¶è·³è½¬</span><br><span class="line">addi x4, x4, 3   # æœªè·³è½¬æ—¶æ‰§è¡Œï¼ˆåº”è¢«è·³è¿‡ï¼‰</span><br><span class="line"></span><br><span class="line">addi x8, x0, 100 # è·³è½¬åæ‰§è¡Œ</span><br><span class="line"></span><br><span class="line"># æœ€ç»ˆå¯„å­˜å™¨å€¼ä¸ºï¼š</span><br><span class="line"># x3 = 0 (æœªæ‰§è¡Œä»»ä½•åŠ 1æ“ä½œ)</span><br><span class="line"># x4 = 10 (æœªæ‰§è¡Œä»»ä½•åŠ 1æˆ–åŠ 2æˆ–åŠ 3æ“ä½œ)</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼š</p><p><img src="https://webp.esing.dev/img/image-20251211111927124_251211_1119_kPCt.png" alt="åˆ†æ”¯è·³è½¬æ­£ç¡®æ‰§è¡Œ"></p><p>å¯ä»¥çœ‹åˆ°ç¨‹åºè®¡æ•°å™¨æ¥å—äº†<code>branch_op</code>ä¿¡å·å¹¶æ­£ç¡®é€‰æ‹©äº†åˆ†æ”¯è·³è½¬ç»“æœã€‚</p><p>ä¸ºä»€ä¹ˆ<code>x3</code>å˜ä¸º0åï¼Œè¿‡äº†å››ä¸ªå‘¨æœŸï¼Œ<code>x4</code>æ‰å˜ä¸º10ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç›´æ¥é˜»å¡æµæ°´çº¿ï¼Œ<code>x3</code>çš„å€¼å¯ä»¥é€šè¿‡æ—è·¯æå‰é€è¿‡å»ï¼Œä½†æ˜¯åªæœ‰åœ¨<code>beq</code>æ‰§è¡Œå®Œæ¯•åæ‰èƒ½å¾—çŸ¥æ˜¯å¦è·³è½¬ã€‚è·³è½¬ç›®æ ‡çš„æŒ‡ä»¤<code>addi x4</code>åœ¨<code>beq</code>æŒ‡ä»¤ EX çº§ç»“æŸåçš„ä¸‹ä¸€å‘¨æœŸæ‰è¿›å…¥IFçº§ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">   x3  x4      IF          ID          EX          MEM         WB</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">1   x   x      addi  0</span><br><span class="line">2   x   x      beq        addi  0</span><br><span class="line">3   x   x      addi  1    beq          addi  0</span><br><span class="line">4   x   x      addi  1    !==é˜»å¡!==   beq         addi  0</span><br><span class="line">5   0   x      addi 10    &lt;==========å¾—å‡ºç»“æœ=|                addi  0  -|</span><br><span class="line">6   0   x                 addi 10                                        |</span><br><span class="line">7   0   x                              addi 10                           |- å››ä¸ªå‘¨æœŸ</span><br><span class="line">8   0   x                                          addi 10               |</span><br><span class="line">9   0   10                                                     addi 10  -|</span><br></pre></td></tr></table></figure><h2 id="æ•°æ®å†’é™©æ§åˆ¶æ¨¡å—-HazardUnit-sv">æ•°æ®å†’é™©æ§åˆ¶æ¨¡å— HazardUnit.sv</h2><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> HazardUnit (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// LOADæŒ‡ä»¤åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel_EX,</span><br><span class="line">    <span class="comment">// å¯„å­˜å™¨ä½¿ç”¨ä¿¡å·</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rs1_used_ID,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rs2_used_ID,</span><br><span class="line">    <span class="comment">// IDçº§æºå¯„å­˜å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] rR1_ID,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] rR2_ID,</span><br><span class="line">    <span class="comment">// EXçº§ç›®çš„å¯„å­˜å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wR_EX,</span><br><span class="line">    <span class="comment">// MEMçº§ç›®çš„å¯„å­˜å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wR_MEM,</span><br><span class="line">    <span class="comment">// WBçº§ç›®çš„å¯„å­˜å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wR_WB,</span><br><span class="line">    <span class="comment">// å†™å…¥æ•°æ®ä½¿èƒ½</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rf_we_EX,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rf_we_MEM,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rf_we_WB,</span><br><span class="line">    <span class="comment">// å†™å…¥æ•°æ®</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rf_wd_EX,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rf_wd_MEM,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rf_wd_WB,</span><br><span class="line">    <span class="comment">// é¢„ç•™çš„åˆ†æ”¯é¢„æµ‹ç»“æœ</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        branch_predicted_i,</span><br><span class="line">    <span class="comment">// PCä¿æŒä¿¡å·</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        keep_pc,</span><br><span class="line">    <span class="comment">// IF/IDåœé¡¿ä¿¡å·</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        stall_IF_ID,</span><br><span class="line">    <span class="comment">// IF/IDå†²åˆ·ä¿¡å·</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        flush_IF_ID,</span><br><span class="line">    <span class="comment">// ID/EXå†²åˆ·ä¿¡å·</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        flush_ID_EX,</span><br><span class="line">    <span class="comment">// å‰é€’ä½¿èƒ½</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        fwd_rD1e_ID,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        fwd_rD2e_ID,</span><br><span class="line">    <span class="comment">// å‰é€’æ•°æ®</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] fwd_rD1_ID,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] fwd_rD2_ID</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// RAW å†’é™©åˆ¤æ–­</span></span><br><span class="line">    <span class="comment">// verilog_format: off</span></span><br><span class="line">    <span class="keyword">logic</span> RAW_1_rD1, RAW_1_rD2;</span><br><span class="line">    <span class="keyword">logic</span> RAW_2_rD1, RAW_2_rD2;</span><br><span class="line">    <span class="keyword">logic</span> RAW_3_rD1, RAW_3_rD2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// é—´éš”ä¸€çº§æµæ°´çº¿ åˆ¤æ–­ä¸‹å†™å…¥çš„ä¸ä¸ºx0å³å¯</span></span><br><span class="line">        RAW_1_rD1 = (wR_EX ==  rR1_ID) &amp;&amp;  rf_we_EX &amp;&amp; rs1_used_ID &amp;&amp; (wR_EX != <span class="number">5&#x27;b0</span>);</span><br><span class="line">        RAW_1_rD2 = (wR_EX ==  rR2_ID) &amp;&amp;  rf_we_EX &amp;&amp; rs2_used_ID &amp;&amp; (wR_EX != <span class="number">5&#x27;b0</span>);</span><br><span class="line">        <span class="comment">// é—´éš”ä¸¤çº§æµæ°´çº¿</span></span><br><span class="line">        RAW_2_rD1 = (wR_MEM == rR1_ID) &amp;&amp; rf_we_MEM &amp;&amp; rs1_used_ID &amp;&amp; (wR_MEM != <span class="number">5&#x27;b0</span>);</span><br><span class="line">        RAW_2_rD2 = (wR_MEM == rR2_ID) &amp;&amp; rf_we_MEM &amp;&amp; rs2_used_ID &amp;&amp; (wR_MEM != <span class="number">5&#x27;b0</span>);</span><br><span class="line">        <span class="comment">// é—´éš”ä¸‰çº§æµæ°´çº¿</span></span><br><span class="line">        RAW_3_rD1 = (wR_WB ==  rR1_ID) &amp;&amp;  rf_we_WB &amp;&amp; rs1_used_ID &amp;&amp; (wR_WB != <span class="number">5&#x27;b0</span>);</span><br><span class="line">        RAW_3_rD2 = (wR_WB ==  rR2_ID) &amp;&amp;  rf_we_WB &amp;&amp; rs2_used_ID &amp;&amp; (wR_WB != <span class="number">5&#x27;b0</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰é€’ä½¿èƒ½ä¿¡å·ç”Ÿæˆ</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        fwd_rD1e_ID = RAW_1_rD1 || RAW_2_rD1 || RAW_3_rD1;</span><br><span class="line">        fwd_rD2e_ID = RAW_1_rD2 || RAW_2_rD2 || RAW_3_rD2;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‰é€’æ•°æ®é€‰æ‹©</span></span><br><span class="line">    <span class="comment">// ä¼˜å…ˆçº§ï¼šEX &gt; MEM &gt; WB</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// case-true è¯­å¥</span></span><br><span class="line">        <span class="comment">// æºæ“ä½œæ•°1å‰é€’æ•°æ®é€‰æ‹©</span></span><br><span class="line">        <span class="keyword">case</span> (<span class="number">1&#x27;b1</span>)</span><br><span class="line">            RAW_1_rD1: fwd_rD1_ID = rf_wd_EX;  <span class="comment">// æ¥è‡ªEXçº§</span></span><br><span class="line">            RAW_2_rD1: fwd_rD1_ID = rf_wd_MEM; <span class="comment">// æ¥è‡ªMEMçº§</span></span><br><span class="line">            RAW_3_rD1: fwd_rD1_ID = rf_wd_WB;</span><br><span class="line">            <span class="keyword">default</span>:   fwd_rD1_ID = <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">        <span class="comment">// æºæ“ä½œæ•°2å‰é€’æ•°æ®é€‰æ‹©</span></span><br><span class="line">        <span class="keyword">case</span> (<span class="number">1&#x27;b1</span>)</span><br><span class="line">            RAW_1_rD2: fwd_rD2_ID = rf_wd_EX;  <span class="comment">// æ¥è‡ªEXçº§</span></span><br><span class="line">            RAW_2_rD2: fwd_rD2_ID = rf_wd_MEM; <span class="comment">// æ¥è‡ªMEMçº§</span></span><br><span class="line">            RAW_3_rD2: fwd_rD2_ID = rf_wd_WB;</span><br><span class="line">            <span class="keyword">default</span>:   fwd_rD2_ID = <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// verilog_format: on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load_use å†’é™©åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">logic</span> load_use_hazard;</span><br><span class="line">    <span class="keyword">assign</span> load_use_hazard = (wd_sel_EX == `WD_SEL_FROM_DRAM) &amp;&amp; (RAW_1_rD1 || RAW_1_rD2);</span><br><span class="line">    <span class="comment">// assign load_use_hazard = 1&#x27;b0;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// [TODO] é™æ€åˆ†æ”¯é¢„æµ‹</span></span><br><span class="line">    <span class="comment">// [TODO] åŠ¨æ€åˆ†æ”¯é¢„æµ‹</span></span><br><span class="line">    <span class="keyword">logic</span> branch_predicted_result;</span><br><span class="line">    <span class="comment">// æ­¤å¤„è®¾ç½®ä¸ºé™æ€ä¸é¢„æµ‹ å› æ­¤è·å–EXçº§çš„è·³è½¬ç»“æœ</span></span><br><span class="line">    <span class="keyword">assign</span> branch_predicted_result = branch_predicted_i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµæ°´çº¿å†²åˆ·ä¸åœé¡¿</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        keep_pc     = load_use_hazard                              ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">        stall_IF_ID = load_use_hazard                              ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">        flush_IF_ID = branch_predicted_result                      ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">        flush_ID_EX = (branch_predicted_result || load_use_hazard) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¤æ‚æµ‹è¯•">å¤æ‚æµ‹è¯•</h2><p>åˆ°æ­¤ï¼Œæˆ‘ä»¬çš„CPUå·²ç»å®Œæˆ70%äº†ã€‚è¿è¡Œä¸€äº›å¤æ‚çš„æ±‡ç¼–ç¨‹åºï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œæ˜¯ä¸ä¼šæœ‰é—®é¢˜çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line"># ========================================</span><br><span class="line"># RV32I Complete Test Suite (No Pseudo Instructions)</span><br><span class="line"># Testing all RV32I instructions without misaligned access</span><br><span class="line"># ========================================</span><br><span class="line"></span><br><span class="line">    .text</span><br><span class="line">    .globl _start</span><br><span class="line"></span><br><span class="line">_start:</span><br><span class="line"># ========================================</span><br><span class="line"># 1. Test ADDI - Add Immediate</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x1, x0, 100                   # x1 = 0 + 100 = 100 (0x64)</span><br><span class="line">    addi   x2, x0, 200                   # x2 = 0 + 200 = 200 (0xC8)</span><br><span class="line">    addi   x3, x1, 50                    # x3 = 100 + 50 = 150 (0x96)</span><br><span class="line">    addi   x4, x0, -10                   # x4 = 0 + (-10) = -10 (0xFFFFFFF6)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 2. Test ADD - Add Register</span><br><span class="line"># ========================================</span><br><span class="line">    add    x5, x1, x2                    # x5 = 100 + 200 = 300 (0x12C)</span><br><span class="line">    add    x6, x3, x4                    # x6 = 150 + (-10) = 140 (0x8C)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 3. Test SUB - Subtract</span><br><span class="line"># ========================================</span><br><span class="line">    sub    x7, x2, x1                    # x7 = 200 - 100 = 100 (0x64)</span><br><span class="line">    sub    x8, x1, x2                    # x8 = 100 - 200 = -100 (0xFFFFFF9C)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 4. Test SLTI - Set Less Than Immediate (Signed)</span><br><span class="line"># ========================================</span><br><span class="line">    slti   x9, x1, 101                   # x9 = (100 &lt; 101) = 1</span><br><span class="line">    slti   x10, x1, 99                   # x10 = (100 &lt; 99) = 0</span><br><span class="line">    slti   x11, x4, 0                    # x11 = (-10 &lt; 0) = 1</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 5. Test SLTIU - Set Less Than Immediate (Unsigned)</span><br><span class="line"># ========================================</span><br><span class="line">    sltiu  x12, x1, 101                  # x12 = (100 &lt; 101) = 1</span><br><span class="line">    sltiu  x13, x4, 10                   # x13 = (0xFFFFFFF6 &lt; 10) = 0 (unsigned compare)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 6. Test SLT - Set Less Than (Signed)</span><br><span class="line"># ========================================</span><br><span class="line">    slt    x14, x1, x2                   # x14 = (100 &lt; 200) = 1</span><br><span class="line">    slt    x15, x2, x1                   # x15 = (200 &lt; 100) = 0</span><br><span class="line">    slt    x16, x4, x1                   # x16 = (-10 &lt; 100) = 1</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 7. Test SLTU - Set Less Than (Unsigned)</span><br><span class="line"># ========================================</span><br><span class="line">    sltu   x17, x1, x2                   # x17 = (100 &lt; 200) = 1</span><br><span class="line">    sltu   x18, x4, x1                   # x18 = (0xFFFFFFF6 &lt; 100) = 0 (unsigned)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 8. Test Logical Operations - ANDI, ORI, XORI</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x19, x0, 255                  # x19 = 255 (0xFF)</span><br><span class="line">    andi   x20, x19, 15                  # x20 = 255 &amp; 15 = 15 (0x0F)</span><br><span class="line">    ori    x21, x20, 240                 # x21 = 15 | 240 = 255 (0xFF)</span><br><span class="line">    xori   x22, x21, 170                 # x22 = 255 ^ 170 = 85 (0x55)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 9. Test Logical Operations - AND, OR, XOR</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x23, x0, 60                   # x23 = 60 (0x3C = 0b00111100)</span><br><span class="line">    addi   x24, x0, 51                   # x24 = 51 (0x33 = 0b00110011)</span><br><span class="line">    and    x25, x23, x24                 # x25 = 60 &amp; 51 = 48 (0x30)</span><br><span class="line">    or     x26, x23, x24                 # x26 = 60 | 51 = 63 (0x3F)</span><br><span class="line">    xor    x27, x23, x24                 # x27 = 60 ^ 51 = 15 (0x0F)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 10. Test Shift Operations - SLLI, SRLI, SRAI</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x28, x0, 8                    # x28 = 8 (0x08)</span><br><span class="line">    slli   x29, x28, 2                   # x29 = 8 &lt;&lt; 2 = 32 (0x20)</span><br><span class="line">    srli   x30, x29, 1                   # x30 = 32 &gt;&gt; 1 = 16 (0x10)</span><br><span class="line">    addi   x31, x0, -8                   # x31 = -8 (0xFFFFFFF8)</span><br><span class="line">    srai   x1, x31, 1                    # x1 = -8 &gt;&gt; 1 = -4 (0xFFFFFFFC, arithmetic shift)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 11. Test Shift Operations - SLL, SRL, SRA</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x2, x0, 16                    # x2 = 16</span><br><span class="line">    addi   x3, x0, 2                     # x3 = 2 (shift amount)</span><br><span class="line">    sll    x4, x2, x3                    # x4 = 16 &lt;&lt; 2 = 64 (0x40)</span><br><span class="line">    srl    x5, x4, x3                    # x5 = 64 &gt;&gt; 2 = 16 (0x10)</span><br><span class="line">    addi   x6, x0, -16                   # x6 = -16 (0xFFFFFFF0)</span><br><span class="line">    sra    x7, x6, x3                    # x7 = -16 &gt;&gt; 2 = -4 (0xFFFFFFFC)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 12. Test LUI - Load Upper Immediate</span><br><span class="line"># ========================================</span><br><span class="line">    lui    x8, 0x12345                   # x8 = 0x12345000</span><br><span class="line">    lui    x9, 0xFFFFF                   # x9 = 0xFFFFF000</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 13. Test AUIPC - Add Upper Immediate to PC</span><br><span class="line"># ========================================</span><br><span class="line">    auipc  x10, 0                        # x10 = current PC + 0</span><br><span class="line">    auipc  x11, 1                        # x11 = current PC + 0x1000</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 14. Test Memory Operations - Store and Load</span><br><span class="line"># Setup memory base address</span><br><span class="line"># ========================================</span><br><span class="line">    lui    x12, 0x10000                  # x12 = 0x10000000 (memory base)</span><br><span class="line"></span><br><span class="line"># Store values</span><br><span class="line">    lui    x15, 0xABCDE                  # x15 = 0xABCDE000</span><br><span class="line">    addi   x15, x15, 0x789               # x15 = 0xABCDE789</span><br><span class="line">    sw     x15, 8(x12)                   # Store word: mem[0x10000008] = 0xABCDE789</span><br><span class="line"></span><br><span class="line"># Load values</span><br><span class="line"></span><br><span class="line">    lw     x26, 8(x12)                   # x26 = 0xABCDE789</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 15. Test Branch Instructions - BEQ</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x27, x0, 10                   # x27 = 10</span><br><span class="line">    addi   x28, x0, 10                   # x28 = 10</span><br><span class="line">    beq    x27, x28, branch_eq_taken     # Should branch (10 == 10)</span><br><span class="line">    addi   x29, x0, 99                   # x29 = 99 (SHOULD NOT EXECUTE)</span><br><span class="line"></span><br><span class="line">branch_eq_taken:</span><br><span class="line">    addi   x29, x0, 1                    # x29 = 1 (branch taken marker)</span><br><span class="line"></span><br><span class="line">    addi   x27, x0, 10                   # x27 = 10</span><br><span class="line">    addi   x28, x0, 20                   # x28 = 20</span><br><span class="line">    beq    x27, x28, branch_eq_not_taken # Should not branch</span><br><span class="line">    addi   x30, x0, 1                    # x30 = 1 (not taken marker)</span><br><span class="line"></span><br><span class="line">branch_eq_not_taken:</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 16. Test Branch Instructions - BNE</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x1, x0, 5                     # x1 = 5</span><br><span class="line">    addi   x2, x0, 10                    # x2 = 10</span><br><span class="line">    bne    x1, x2, branch_ne_taken       # Should branch (5 != 10)</span><br><span class="line">    addi   x3, x0, 99                    # x3 = 99 (SHOULD NOT EXECUTE)</span><br><span class="line"></span><br><span class="line">branch_ne_taken:</span><br><span class="line">    addi   x3, x0, 1                     # x3 = 1 (branch taken marker)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 17. Test Branch Instructions - BLT (Signed)</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x4, x0, 5                     # x4 = 5</span><br><span class="line">    addi   x5, x0, 10                    # x5 = 10</span><br><span class="line">    blt    x4, x5, branch_lt_taken       # Should branch (5 &lt; 10)</span><br><span class="line">    addi   x6, x0, 99                    # x6 = 99 (SHOULD NOT EXECUTE)</span><br><span class="line"></span><br><span class="line">branch_lt_taken:</span><br><span class="line">    addi   x6, x0, 1                     # x6 = 1 (branch taken marker)</span><br><span class="line"></span><br><span class="line">    addi   x7, x0, -5                    # x7 = -5</span><br><span class="line">    addi   x8, x0, 3                     # x8 = 3</span><br><span class="line">    blt    x7, x8, branch_lt_neg_taken   # Should branch (-5 &lt; 3)</span><br><span class="line">    addi   x9, x0, 99                    # x9 = 99 (SHOULD NOT EXECUTE)</span><br><span class="line"></span><br><span class="line">branch_lt_neg_taken:</span><br><span class="line">    addi   x9, x0, 1                     # x9 = 1 (branch taken marker)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 18. Test Branch Instructions - BGE (Signed)</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x10, x0, 10                   # x10 = 10</span><br><span class="line">    addi   x11, x0, 5                    # x11 = 5</span><br><span class="line">    bge    x10, x11, branch_ge_taken     # Should branch (10 &gt;= 5)</span><br><span class="line">    addi   x12, x0, 99                   # x12 = 99 (SHOULD NOT EXECUTE)</span><br><span class="line"></span><br><span class="line">branch_ge_taken:</span><br><span class="line">    addi   x12, x0, 1                    # x12 = 1 (branch taken marker)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 19. Test Branch Instructions - BLTU (Unsigned)</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x13, x0, 5                    # x13 = 5</span><br><span class="line">    addi   x14, x0, 10                   # x14 = 10</span><br><span class="line">    bltu   x13, x14, branch_ltu_taken    # Should branch (5 &lt; 10 unsigned)</span><br><span class="line">    addi   x15, x0, 99                   # x15 = 99 (SHOULD NOT EXECUTE)</span><br><span class="line"></span><br><span class="line">branch_ltu_taken:</span><br><span class="line">    addi   x15, x0, 1                    # x15 = 1 (branch taken marker)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 20. Test Branch Instructions - BGEU (Unsigned)</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x16, x0, 10                   # x16 = 10</span><br><span class="line">    addi   x17, x0, 5                    # x17 = 5</span><br><span class="line">    bgeu   x16, x17, branch_geu_taken    # Should branch (10 &gt;= 5 unsigned)</span><br><span class="line">    addi   x18, x0, 99                   # x18 = 99 (SHOULD NOT EXECUTE)</span><br><span class="line"></span><br><span class="line">branch_geu_taken:</span><br><span class="line">    addi   x18, x0, 1                    # x18 = 1 (branch taken marker)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 21. Test JAL - Jump and Link</span><br><span class="line"># ========================================</span><br><span class="line">    jal    x19, jal_target               # x19 = return address, jump to jal_target</span><br><span class="line">    addi   x20, x0, 99                   # x20 = 99 (SHOULD NOT EXECUTE)</span><br><span class="line"></span><br><span class="line">jal_target:</span><br><span class="line">    addi   x20, x0, 1                    # x20 = 1 (jump successful)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 22. Test JALR - Jump and Link Register</span><br><span class="line"># ========================================</span><br><span class="line">    auipc  x21, 0                        # x21 = current PC</span><br><span class="line">    addi   x21, x21, 16                  # x21 = PC + 16 (target address)</span><br><span class="line">    jalr   x22, x21, 0                   # x22 = return address, jump to x21</span><br><span class="line">    addi   x23, x0, 99                   # x23 = 99 (SHOULD NOT EXECUTE)</span><br><span class="line"></span><br><span class="line">jalr_target:</span><br><span class="line">    addi   x23, x0, 1                    # x23 = 1 (jump successful)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 23. Test Complex Data Dependencies</span><br><span class="line"># ========================================</span><br><span class="line">    addi   x24, x0, 1                    # x24 = 1</span><br><span class="line">    addi   x24, x24, 2                   # x24 = 3</span><br><span class="line">    addi   x24, x24, 3                   # x24 = 6</span><br><span class="line">    addi   x24, x24, 4                   # x24 = 10</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 24. Test Edge Cases</span><br><span class="line"># ========================================</span><br><span class="line"># Maximum positive immediate</span><br><span class="line">    addi   x25, x0, 2047                 # x25 = 2047 (0x7FF, max 12-bit signed)</span><br><span class="line"></span><br><span class="line"># Maximum negative immediate</span><br><span class="line">    addi   x26, x0, -2048                # x26 = -2048 (0xFFFFF800)</span><br><span class="line"></span><br><span class="line"># Overflow test</span><br><span class="line">    lui    x27, 0x7FFFF                  # x27 = 0x7FFFF000</span><br><span class="line">    addi   x27, x27, 0x7FF               # x27 = 0x7FFFF7FF (near max positive)</span><br><span class="line">    addi   x28, x0, 1                    # x28 = 1</span><br><span class="line">    add    x29, x27, x28                 # x29 = overflow result</span><br><span class="line"></span><br><span class="line"># Zero register test</span><br><span class="line">    addi   x0, x0, 100                   # x0 should remain 0</span><br><span class="line">    add    x30, x0, x0                   # x30 = 0</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># 25. Final Test - Load/Store with Computed Address</span><br><span class="line"># ========================================</span><br><span class="line">    lui    x31, 0x10000                  # x31 = 0x10000000</span><br><span class="line">    addi   x1, x0, 100                   # x1 = 100 (offset)</span><br><span class="line">    add    x2, x31, x1                   # x2 = 0x10000000 + 100</span><br><span class="line">    addi   x3, x0, 0x55A                 # x3 = 0x55AA</span><br><span class="line">    sw     x3, 0(x2)                     # Store at computed address</span><br><span class="line">    lw     x4, 0(x2)                     # x4 = 0x55AA (load back)</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># End of Test - Infinite Loop</span><br><span class="line"># ========================================</span><br><span class="line">end_loop:</span><br><span class="line">    beq    x0, x0, end_loop              # Infinite loop</span><br><span class="line"></span><br><span class="line"># ========================================</span><br><span class="line"># Expected Register Values After Test:</span><br><span class="line"># ========================================</span><br><span class="line"># x0 = 0x00000000 (always zero)</span><br><span class="line"># x1 = 100 (0x64)</span><br><span class="line"># x2 = 0x10000064</span><br><span class="line"># x3 = 0x000055AA</span><br><span class="line"># x4 = 0x000055AA</span><br><span class="line"># x5 = 16 (0x10)</span><br><span class="line"># x6 = -16 (0xFFFFFFF0)</span><br><span class="line"># x7 = -4 (0xFFFFFFFC)</span><br><span class="line"># x8 = 0x12345000</span><br><span class="line"># x9 = 0xFFFFF000</span><br><span class="line"># x10 = PC value at AUIPC</span><br><span class="line"># x11 = PC value + 0x1000</span><br><span class="line"># x12 = 0x10000000</span><br><span class="line"># x13 = 127 (0x7F)</span><br><span class="line"># x14 = 0x1234</span><br><span class="line"># x15 = 1 (branch marker)</span><br><span class="line"># x16 = 10</span><br><span class="line"># x17 = 5</span><br><span class="line"># x18 = 1 (branch marker)</span><br><span class="line"># x19 = return address from JAL</span><br><span class="line"># x20 = 1</span><br><span class="line"># x21 = target address</span><br><span class="line"># x22 = return address from JALR</span><br><span class="line"># x23 = 1</span><br><span class="line"># x24 = 10</span><br><span class="line"># x25 = 2047 (0x7FF)</span><br><span class="line"># x26 = -2048 (0xFFFFF800)</span><br><span class="line"># x27 = 0x7FFFF7FF</span><br><span class="line"># x28 = 1</span><br><span class="line"># x29 = 0x7FFFF800 (overflow wrapped)</span><br><span class="line"># x30 = 0</span><br><span class="line"># x31 = 0x10000000</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ•ˆæœéå¸¸å¥½ï¼</p><p><img src="https://webp.esing.dev/img/image-20251211123703587_251211_1237_oVPZ.png" alt="å®Œæ•´æµ‹è¯•"></p><p>ä¸ºä»€ä¹ˆæ‰å®Œæˆ70%ï¼Ÿé‚£æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰æ”¯æŒ<code>lb/lh</code>å’Œ<code>sb/sh</code>ä¸€ç±»æŒ‡ä»¤ã€‚åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ª<strong>å†å²é—ç•™é—®é¢˜</strong>éœ€è¦å»è§£å†³ï¼Œé‚£å°±æ˜¯<strong>æ— æ³•è¢«ç»¼åˆçš„åŒæ­¥å†™å¼‚æ­¥è¯»DRAM</strong>â€¦â€¦</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰é€’ï¼šå¿«äººä¸€æ­¥&quot;&gt;å‰é€’ï¼šå¿«äººä¸€æ­¥&lt;/h2&gt;
&lt;h3 id=&quot;æ¿€çƒˆçš„æ–—äº‰&quot;&gt;æ¿€çƒˆçš„æ–—äº‰&lt;/h3&gt;
&lt;p&gt;æˆ‘ä»¬åšå®Œäº†å—ï¼Ÿè¿˜æ²¡å®Œã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ &lt;a href=&quot;/2025/12/10</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="åµŒå…¥å¼" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="è®¡ç®—æœºåŸç†" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬ä¸ƒç¯‡</title>
    <link href="https://blog.esing.dev/2025/12/10/riscvcod-p7/"/>
    <id>https://blog.esing.dev/2025/12/10/riscvcod-p7/</id>
    <published>2025-12-10T13:00:00.000Z</published>
    <updated>2025-12-11T10:37:58.994Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è®¿å­˜-MEMçº§-è®¾è®¡">è®¿å­˜ MEMçº§ è®¾è®¡</h2><p>è®¿å­˜è®¿å­˜ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è¦å»è®¿é—®å†…å­˜ã€‚è¿™ä¸ªå†…å­˜æ˜¯â€œæ•°æ®å†…å­˜â€ï¼Œå› ä¸ºæˆ‘ä»¬å†™çš„CPUé‡‡ç”¨çš„æ˜¯<strong>å“ˆä½›æ¶æ„</strong>ï¼ŒæŒ‡ä»¤å†…å­˜å’Œæ•°æ®å†…å­˜åˆ†ç¦»ã€‚</p><h3 id="æ•°æ®å†…å­˜-DRAM-sv">æ•°æ®å†…å­˜ DRAM.sv</h3><p>é¦–å…ˆç™»åœºçš„æ˜¯æ•°æ®å†…å­˜ã€‚éå¸¸ç®€å•ï¼Œå®ä¾‹åŒ–ä¸€å †RDFFå³å¯ã€‚ä¸ºä»€ä¹ˆæ˜¯RDFFï¼Ÿä¸ºäº†ä¾¿äºæµ‹éªŒ<s>äº¤ä½œä¸š</s>ï¼Œæˆ‘ä»¬<strong>æš‚æ—¶</strong>æŠŠDRAMå†™æˆ <strong>â€œåŒæ­¥å†™ã€å¼‚æ­¥è¯»â€</strong> çš„ã€‚</p><div class="note danger flat"><p>å‡ ä¹æ‰€æœ‰å‚å•†éƒ½ä¸æ”¯æŒâ€œåŒæ­¥å†™ã€å¼‚æ­¥è¯»â€çš„DRAMï¼Œç»¼åˆå™¨ä¹Ÿæ— æ³•å°†å…¶ç»¼åˆä¸ºDRAMã€‚å¯¹äºXilinxçš„IPæ ¸ï¼Œå…¶BRAMæ˜¯åŒæ­¥è¯»å†™çš„ï¼Œæœ‰çš„ç”šè‡³éœ€è¦ä¸¤æ‹ã€‚</p></div><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// DRAM è¡Œä¸ºæ¨¡å‹ - ç”¨äºä»¿çœŸ</span></span><br><span class="line"><span class="comment">// æ›¿ä»£ Xilinx IP æ ¸</span></span><br><span class="line"><span class="comment">// [HACK] Vivadoæ— æ³•ç»¼åˆå¼‚æ­¥è¯»çš„RAM</span></span><br><span class="line"><span class="keyword">module</span> DRAM (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,  <span class="comment">// æ—¶é’Ÿ</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">15</span>:<span class="number">0</span>] a,    <span class="comment">// åœ°å€è¾“å…¥ (16ä½ = 64K words)</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] spo,  <span class="comment">// æ•°æ®è¾“å‡º</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        we,   <span class="comment">// å†™ä½¿èƒ½</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] din   <span class="comment">// æ•°æ®è¾“å…¥</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°æ®å­˜å‚¨å™¨ - 16K x 32bit</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] ram_data[<span class="number">65536</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">integer</span>             i;</span><br><span class="line">        <span class="keyword">reg</span>     [<span class="number">256</span>*<span class="number">8</span>-<span class="number">1</span>:<span class="number">0</span>] ram_file;  <span class="comment">// å­—ç¬¦ä¸²ç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">65536</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            ram_data[i] = <span class="number">32&#x27;h00000000</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            rom_file =</span><br><span class="line">            <span class="comment">// &quot;user/data/hex/sw_lw.hex&quot;</span></span><br><span class="line">            <span class="string">&quot;user/data/hex/addi.hex&quot;</span></span><br><span class="line">            ;</span><br><span class="line">            <span class="built_in">$readmemh</span>(rom_file, rom_data, <span class="number">0</span>, <span class="number">16383</span>);</span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;IROM: Loaded instructions from %s&quot;</span>, rom_file);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™æ“ä½œ (åŒæ­¥)</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (we) <span class="keyword">begin</span></span><br><span class="line">            ram_data[a] &lt;= din;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// [HACK] å¼‚æ­¥è¯»</span></span><br><span class="line">    <span class="comment">// assign spo = ram_data[a];</span></span><br><span class="line">    <span class="comment">// ç¡®ä¿åœ¨å†™æ“ä½œæ—¶è¯»å‡ºæœªçŸ¥å€¼</span></span><br><span class="line">    <span class="keyword">assign</span> spo = we ? &#x27;x : ram_data[a];</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="DRAMæ•°æ®é€‰æ‹©MUX">DRAMæ•°æ®é€‰æ‹©MUX</h3><p>æ¥è‡ªEXçº§çš„æ•°æ®åªæœ‰æ¥è‡ªIDçº§çš„<code>rD2</code>ã€‚ä¹Ÿä¸å®¹æ˜“äº†ï¼Œä¸€è·¯èµ°åˆ°è¿™é‡Œã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›å†™æ•°æ®æ¥æº2é€‰æ‹©MUX</span></span><br><span class="line"><span class="comment">// é€‰æ‹©æ˜¯å¦ä¸ºDRAMæ•°æ®</span></span><br><span class="line"><span class="comment">// å¯¹äºåŒæ­¥DRAM å°†MUXæ”¾åˆ°WBçº§</span></span><br><span class="line"><span class="keyword">assign</span> rf_wd_MEM = (wd_sel_MEM == `WD_SEL_FROM_DRAM) ? DRAM_output_data : rf_wd_MEM_PR2MUX;</span><br></pre></td></tr></table></figure><h3 id="MEM-WBçº§-æµæ°´çº¿å¯„å­˜å™¨-PR-MEM-WB-sv">MEM/WBçº§ æµæ°´çº¿å¯„å­˜å™¨ PR_MEM_WB.sv</h3><p>å·²ç»åˆ°æœ€åä¸€çº§äº†ï¼Œä¿¡å·ä¹Ÿè¢«åˆ†æµçš„å·®ä¸å¤šäº†ã€‚</p><p>æˆ‘ä»¬éœ€è¦å°†L-Typeéœ€è¦çš„å¯„å­˜å™¨å†™å…¥æ•°æ®<code>rf_wd</code>ä¼ å…¥WBçº§ï¼Œå‡†å¤‡å†™å›ï¼›ä¸ä¹‹ä¸€èµ·è¿›å…¥çš„è¿˜æœ‰å¯„å­˜å™¨å †å†™ä½¿èƒ½ä¿¡å·<code>rf_we</code>ï¼Œå’Œå†™å…¥ç›®æ ‡å¯„å­˜å™¨åœ°å€<code>wr</code>ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PR_MEM_WB (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// å¯„å­˜å™¨å †å†™ä½¿èƒ½</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rf_we_mem_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rf_we_wb_o,</span><br><span class="line">    <span class="comment">// å†™å›å¯„å­˜å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wr_mem_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wr_wb_o,</span><br><span class="line">    <span class="comment">// å†™å›æ•°æ®</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] wd_mem_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] wd_wb_o</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            rf_we_wb_o       &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            wr_wb_o          &lt;= <span class="number">5&#x27;b0</span>;</span><br><span class="line">            wd_wb_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            rf_we_wb_o       &lt;= rf_we_mem_i;</span><br><span class="line">            wr_wb_o          &lt;= wr_mem_i;</span><br><span class="line">            wd_wb_o          &lt;= wd_mem_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å†™å›-WBçº§-è®¾è®¡">å†™å› WBçº§ è®¾è®¡</h2><p>WBçº§å…¶å®æ ¹æœ¬ä¸ç”¨å»è®¾è®¡â€”â€”å› ä¸ºè¿™ä¸€çº§æ ¹æœ¬æ²¡å†…å®¹ï¼Œåªéœ€è¦å°†è¦å†™å›çš„æ•°æ®é€å…¥å¯„å­˜å™¨å †å³å¯ã€‚</p><h2 id="é¡¶å±‚æ¨¡å—å°è£…-CPU-TOP-sv">é¡¶å±‚æ¨¡å—å°è£… CPU_TOP.sv</h2><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰çš„æµæ°´çº¿ã€‚æ¥ç€ï¼Œå°±æ˜¯æŠŠå®ƒä»¬æ‹¼åœ¨ä¸€èµ·äº†ã€‚</p><p>æˆ‘ä»¬å°è£…åçš„CPUåº”å½“æœ‰IROMæ¥å£ï¼Œè¾“å‡ºåœ°å€ã€å–å›æŒ‡ä»¤ã€‚æ­¤å¤–ï¼Œè¿˜è¦æœ‰æ—¶é’Ÿè¾“å…¥å’Œä½ç”µå¹³æœ‰æ•ˆçš„å¤ä½ä¿¡å·ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> CPU_TOP (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// æ¥è‡ªæŒ‡ä»¤å­˜å‚¨å™¨IROMçš„æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instr,</span><br><span class="line">    <span class="comment">// è¾“å‡ºç»™æŒ‡ä»¤å­˜å‚¨å™¨IROMçš„åœ°å€</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œå®é™…ä¸Šæ˜¯PCçš„é«˜14ä½</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">13</span>:<span class="number">0</span>] pc</span><br><span class="line">);</span><br></pre></td></tr></table></figure><div class="note info flat"><p>å› ä¸ºæŒ‡ä»¤å­˜å‚¨å™¨ä»¥â€œå­—â€ï¼ˆwordï¼‰ä¸ºå•ä½å¯»å€ï¼Œä¸”æ·±åº¦ä¸€èˆ¬ä¸º2<sup>14</sup>ï¼Œå¯¹äºæ™®é€šRISCVæŒ‡ä»¤æ¥è¯´å äº†4å­—èŠ‚ï¼Œä¸”ä½ä¸¤ä½æ’ä¸º0ï¼ˆå¿…é¡»4å­—èŠ‚å¯¹é½ï¼‰ï¼Œæ‰€ä»¥å–é«˜14ä½å³å¯ã€‚</p></div><p>æˆ‘ä»¬ä»IFçº§æ‹¿çš„æŒ‡ä»¤ï¼Œç›´æ¥å–é«˜14ä½ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> pc = pc_IF[<span class="number">15</span>:<span class="number">2</span>];</span><br></pre></td></tr></table></figure><p>ä¹‹åå¯¹äºå„çº§æ¨¡å—ï¼Œè¿çº¿è¿èµ·æ¥å³å¯ã€‚æ¯”è¾ƒå¥½çš„ä¹ æƒ¯æ˜¯å°†ä¿¡å·æ‰€å¤„çš„çº§åšåç§°ç»“å°¾ã€‚</p><h2 id="ä»¿çœŸæµ‹è¯•ï¼">ä»¿çœŸæµ‹è¯•ï¼</h2><p>è™½ç„¶æˆ‘ä»¬å†™çš„æ˜¯SystemVerilogï¼Œä½†æ˜¯iverilogè¿˜æ˜¯æ”¯æŒä¸€äº›ç‰¹æ€§çš„â€”â€”æˆ–è€…è¯´ï¼Œæœ‰warningæœ‰sorryä½†æ˜¯å·¥ä½œæ­£å¸¸ã€‚èƒ½è·‘å°±ç®—è¯­æ³•æ”¯æŒï¼Œä¸è¿‡å®é™…è¿è¡Œæ•ˆæœè‚¯å®šæ˜¯ä¸å¦‚verilatorçš„ã€‚</p><p>é¦–å…ˆè¦å†™ä¸€ä¸ªé¡¶å±‚æ¨¡å—ï¼ŒåŠ å…¥ä¸€äº›æ¿€åŠ±ä¿¡å·ï¼Œå¹¶å¼•å‡ºå¯„å­˜å™¨è¿çº¿ï¼Œä¾¿äºè§‚å¯Ÿï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;../src/CPU_TOP.sv&quot;</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> DEBUG </span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> REG_FILE u_CPU_TOP.u_registerf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> tb_CPU_TOP;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ—¶é’Ÿå’Œå¤ä½ä¿¡å·</span></span><br><span class="line">    <span class="keyword">logic</span>        clk;</span><br><span class="line">    <span class="keyword">logic</span>        rst_n;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// IROM ä¿¡å·</span></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">13</span>:<span class="number">0</span>] irom_addr;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] irom_data;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ– IROM (æŒ‡ä»¤å­˜å‚¨å™¨)</span></span><br><span class="line">    IROM u_IROM (</span><br><span class="line">        <span class="variable">.a</span>  (irom_addr),</span><br><span class="line">        <span class="variable">.spo</span>(irom_data)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ– CPU_TOP</span></span><br><span class="line">    CPU_TOP u_CPU_TOP (</span><br><span class="line">        <span class="variable">.clk</span>  (clk),</span><br><span class="line">        <span class="variable">.rst_n</span>(rst_n),</span><br><span class="line">        <span class="variable">.instr</span>(irom_data),</span><br><span class="line">        <span class="variable">.pc</span>   (irom_addr)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// verilog_format: off</span></span><br><span class="line"><span class="comment">// å¯„å­˜å™¨å †ç›‘æ§ä¿¡å·</span></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] x0, x1, <span class="comment">// ...</span></span><br><span class="line">    x31;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        x0  = `REG_FILE<span class="variable">.rf_in</span>[<span class="number">0</span>];</span><br><span class="line">        x1  = `REG_FILE<span class="variable">.rf_in</span>[<span class="number">1</span>];</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">        x31 = `REG_FILE<span class="variable">.rf_in</span>[<span class="number">31</span>];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// verilog_format: on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ—¶é’Ÿç”Ÿæˆ (100MHz, å‘¨æœŸ 10ns)</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        clk = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">forever</span> #<span class="number">5</span> clk = ~clk;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤ä½å’Œæµ‹è¯•æ§åˆ¶</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="comment">// æ³¢å½¢æ–‡ä»¶è®¾ç½®</span></span><br><span class="line"><span class="meta">`<span class="keyword">ifdef</span> VCD_FILEPATH</span></span><br><span class="line">        <span class="built_in">$dumpfile</span>(`VCD_FILEPATH);</span><br><span class="line"><span class="meta">`<span class="keyword">else</span></span></span><br><span class="line">        <span class="built_in">$dumpfile</span>(<span class="string">&quot;wave.vcd&quot;</span>);</span><br><span class="line"><span class="meta">`<span class="keyword">endif</span></span></span><br><span class="line">        <span class="built_in">$dumpvars</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–ä¿¡å·</span></span><br><span class="line">        rst_n = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¤ä½ CPU</span></span><br><span class="line">        #<span class="number">5</span>;  <span class="comment">// ä¿æŒå¤ä½ 25ns</span></span><br><span class="line">        rst_n = <span class="number">1</span>;</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;CPU Reset Released at time %0t&quot;</span>, <span class="built_in">$time</span>);</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿è¡Œä¸€æ®µæ—¶é—´è®© CPU æ‰§è¡ŒæŒ‡ä»¤</span></span><br><span class="line">        #<span class="number">2000</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;Simulation finished at time %0t&quot;</span>, <span class="built_in">$time</span>);</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å°å¯„å­˜å™¨å †çŠ¶æ€</span></span><br><span class="line">        print_register_file();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">$finish</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘æ§å…³é”®ä¿¡å·</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;Time\t| PC\t| Instruction\t| Stage&quot;</span>);</span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">forever</span> <span class="keyword">begin</span></span><br><span class="line">            @(<span class="keyword">posedge</span> clk);</span><br><span class="line">            <span class="keyword">if</span> (rst_n) <span class="keyword">begin</span></span><br><span class="line">                <span class="comment">// IF çº§</span></span><br><span class="line">                <span class="keyword">if</span> (u_CPU_TOP<span class="variable">.valid_IF</span>)</span><br><span class="line">                    <span class="built_in">$display</span>(<span class="string">&quot;%0t\t| %h\t| %h\t| IF&quot;</span>, <span class="built_in">$time</span>, u_CPU_TOP<span class="variable">.pc_IF</span>, u_CPU_TOP<span class="variable">.instr_IF</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ID çº§</span></span><br><span class="line">                <span class="keyword">if</span> (u_CPU_TOP<span class="variable">.valid_ID</span> &amp;&amp; u_CPU_TOP<span class="variable">.instr_ID</span> != <span class="number">32&#x27;h00000013</span>)  <span class="comment">// è·³è¿‡ NOP</span></span><br><span class="line">                    <span class="built_in">$display</span>(<span class="string">&quot;%0t\t| %h\t| %h\t| ID&quot;</span>, <span class="built_in">$time</span>, u_CPU_TOP<span class="variable">.pc_ID</span>, u_CPU_TOP<span class="variable">.instr_ID</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// EX çº§</span></span><br><span class="line">                <span class="keyword">if</span> (u_CPU_TOP<span class="variable">.valid_EX</span>)</span><br><span class="line">                    <span class="built_in">$display</span>(</span><br><span class="line">                        <span class="string">&quot;%0t\t| %h\t| --------\t| EX \t (ALU=0x%h)&quot;</span>,</span><br><span class="line">                        <span class="built_in">$time</span>,</span><br><span class="line">                        u_CPU_TOP<span class="variable">.pc_EX</span>,</span><br><span class="line">                        u_CPU_TOP<span class="variable">.alu_result_EX</span></span><br><span class="line">                    );</span><br><span class="line"></span><br><span class="line">                <span class="comment">// MEM çº§</span></span><br><span class="line">                <span class="keyword">if</span> (u_CPU_TOP<span class="variable">.dram_we_MEM</span>) <span class="keyword">begin</span></span><br><span class="line">                    <span class="built_in">$display</span>(<span class="string">&quot;%0t\t| 0x%4h &lt;| 0x%h\t|[MEM W]&quot;</span>, <span class="built_in">$time</span>,</span><br><span class="line">                             u_CPU_TOP<span class="variable">.alu_result_MEM</span>[<span class="number">17</span>:<span class="number">2</span>], u_CPU_TOP<span class="variable">.rf_rd2_MEM</span>);</span><br><span class="line">                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (u_CPU_TOP<span class="variable">.wd_sel_MEM</span>)</span><br><span class="line">                        <span class="built_in">$display</span>(</span><br><span class="line">                            <span class="string">&quot;%0t\t| 0x%4h |&gt; 0x%h\t|[MEM R]&quot;</span>,</span><br><span class="line">                            <span class="built_in">$time</span>,</span><br><span class="line">                            u_CPU_TOP<span class="variable">.alu_result_MEM</span>[<span class="number">17</span>:<span class="number">2</span>],</span><br><span class="line">                            u_CPU_TOP<span class="variable">.DRAM_output_data</span></span><br><span class="line">                        );</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘æ§å¯„å­˜å™¨å†™å›æ“ä½œ</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">forever</span> <span class="keyword">begin</span></span><br><span class="line">            @(<span class="keyword">posedge</span> clk);</span><br><span class="line">            <span class="keyword">if</span> (rst_n &amp;&amp; u_CPU_TOP<span class="variable">.rf_we_WB</span> &amp;&amp; u_CPU_TOP<span class="variable">.wR_WB</span> != <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                <span class="built_in">$display</span>(<span class="string">&quot;%0t\t|  x%-2d   &lt;= 0x%h \t|[WB]&quot;</span>, <span class="built_in">$time</span>, u_CPU_TOP<span class="variable">.wR_WB</span>,</span><br><span class="line">                         u_CPU_TOP<span class="variable">.rf_wd_WB</span>);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°å¯„å­˜å™¨å †å†…å®¹çš„ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">task</span> <span class="keyword">automatic</span> print_register_file();</span><br><span class="line">        <span class="keyword">integer</span> i;</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;\n========================================&quot;</span>);</span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;Register File Contents:&quot;</span>);</span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;========================================&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (u_CPU_TOP<span class="variable">.u_registerf</span><span class="variable">.rf_in</span>[i] != <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                    <span class="built_in">$display</span>(<span class="string">&quot;x%0d\t= 0x%h\t(%0d)&quot;</span>, i, u_CPU_TOP<span class="variable">.u_registerf</span><span class="variable">.rf_in</span>[i],</span><br><span class="line">                             <span class="built_in">$signed</span>(u_CPU_TOP<span class="variable">.u_registerf</span><span class="variable">.rf_in</span>[i]));</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;========================================\n&quot;</span>);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endtask</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¶…æ—¶ä¿æŠ¤</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        #<span class="number">5000</span>;  <span class="comment">// 50us è¶…æ—¶</span></span><br><span class="line">        <span class="built_in">$display</span>(<span class="string">&quot;ERROR: Simulation timeout!&quot;</span>);</span><br><span class="line">        <span class="built_in">$finish</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–°å»ºä¸€ä¸ªæ—¶é’Ÿ ä¸ºclkçš„ä¸¤å€å‘¨æœŸ ä¾¿äºè§‚å¯Ÿ</span></span><br><span class="line">    <span class="keyword">logic</span>        slow_clk;</span><br><span class="line">    <span class="keyword">int</span> <span class="keyword">unsigned</span> count;</span><br><span class="line">    <span class="keyword">initial</span> slow_clk = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        slow_clk &lt;= ~slow_clk;</span><br><span class="line">        count    &lt;= count + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¹‹åç”¨iverilogç¼–è¯‘ä¸ä»¿çœŸï¼Œå¹¶ä½¿ç”¨GTKWaveçœ‹æ³¢å½¢ã€‚è¿™ä¹ˆå¤šå¹´è¿‡å»äº†ï¼Œè¿˜æ˜¯æ²¡æœ‰ä¸€ä¸ªç°ä»£åŒ–çš„æ³¢å½¢æŸ¥çœ‹å™¨å—ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iverilog -g2012 -Wall -I ./user/src -I ./user/src/include -o tb_CPU_TOP.vvp</span><br><span class="line">vvp tb_CPU_TOP.vvp</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç”¨å®˜æ–¹çš„riscvå·¥å…·é“¾è¿›è¡Œç¼–è¯‘ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªPythonæ–‡ä»¶æ‰‹åŠ¨å°†æ±‡ç¼–æ–‡ä»¶è½¬æ¢æˆæœºå™¨ç ã€‚çœ‹ä¸ªäººå–œå¥½ã€‚</p><p>å†™ä¸€ä¸ªç®€å•çš„åŠ æ³•æµ‹è¯•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">addi x1,x0,1</span><br><span class="line">addi x2,x0,2</span><br><span class="line">addi x3,x0,3</span><br><span class="line">addi x4,x0,4</span><br><span class="line">addi x5,x0,5</span><br><span class="line">addi x6,x0,6</span><br><span class="line">add  x7,x1,x2</span><br></pre></td></tr></table></figure><p>è½¬æ¢æˆäºŒè¿›åˆ¶ï¼Œåº”è¯¥æ˜¯è¿™æ ·ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">00100093</span><br><span class="line">00200113</span><br><span class="line">00300193</span><br><span class="line">00400213</span><br><span class="line">00500293</span><br><span class="line">00600313</span><br><span class="line">002083b3</span><br></pre></td></tr></table></figure><div class="note warning flat"><p><code>objdump</code>è½¬æ¢å‡ºçš„<code>.verilog</code>æ–‡ä»¶ï¼Œæ˜¯æŒ‰ç…§å†…å­˜å°ç«¯å¯¹é½çš„æ ¼å¼å†™çš„ï¼è€Œ<code>elf2hex</code>åˆ™æ˜¯å°†ä¸€ä¸ªæŒ‡ä»¤å­—å½“æˆä¸€ä¸ªæ•´ä½“è¾“å‡ºï¼Œä¸ºå¤§ç«¯å¯¹é½ã€‚å®é™…å†™å…¥é€»è¾‘è¿˜æ˜¯æŒ‰ç…§å¤§ç«¯ï¼Œåªæ˜¯å­˜å‚¨æ ¼å¼è¢«è®¤ä¸ºæ˜¯å°ç«¯ã€‚</p></div><p>ç„¶åè¿è¡Œã€‚</p><p><img src="https://webp.esing.dev/img/image-20251211083638641_251211_0836_VrZp.png" alt="éå¸¸ç®€å•çš„åŠ æ³•"></p><p>å¯ä»¥çœ‹åˆ°ç»“æœéå¸¸å®Œç¾ã€‚æˆ‘ä»¬æˆåŠŸäº† ^_^</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è®¿å­˜-MEMçº§-è®¾è®¡&quot;&gt;è®¿å­˜ MEMçº§ è®¾è®¡&lt;/h2&gt;
&lt;p&gt;è®¿å­˜è®¿å­˜ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è¦å»è®¿é—®å†…å­˜ã€‚è¿™ä¸ªå†…å­˜æ˜¯â€œæ•°æ®å†…å­˜â€ï¼Œå› ä¸ºæˆ‘ä»¬å†™çš„CPUé‡‡ç”¨çš„æ˜¯&lt;strong&gt;å“ˆä½›æ¶æ„&lt;/str</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="åµŒå…¥å¼" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="è®¡ç®—æœºåŸç†" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬å…­ç¯‡</title>
    <link href="https://blog.esing.dev/2025/12/09/riscvcod-p6/"/>
    <id>https://blog.esing.dev/2025/12/09/riscvcod-p6/</id>
    <published>2025-12-09T14:19:27.000Z</published>
    <updated>2025-12-10T13:36:31.084Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æ‰§è¡Œ-EXçº§-è®¾è®¡">æ‰§è¡Œ EXçº§ è®¾è®¡</h2><p>EXçº§ä»¥è´Ÿè´£æ ¸å¿ƒè¿ç®—åŠŸèƒ½çš„<strong>ALU</strong>è‘—ç§°ã€‚å¯ä»¥è¯´ï¼Œå®ƒæ˜¯CPUçš„çµé­‚ã€‚æ¥ä¸€äººä¸€å¥ALUç‰›é€¼æ¥ã€‚</p><h3 id="ç®—æ•°é€»è¾‘å•å…ƒ-ALU-sv">ç®—æ•°é€»è¾‘å•å…ƒ ALU.sv</h3><p>ALUéœ€è¦å®Œæˆä¸€ç³»åˆ—R-Typeã€I-TypeæŒ‡ä»¤çš„è¿ç®—ã€‚å¯¹äºL-Typeå’ŒS-Typeï¼Œå®ƒä»¬çš„å¤„ç†é€»è¾‘å…¶å®å·®ä¸å¤šï¼Œéƒ½æ˜¯ç›¸åŠ â€”â€”è¿™æ ·æ‰èƒ½è®©ALUè¾“å‡ºåŸºåœ°å€å’Œåç§»é‡ä¹‹å’Œï¼Œç®—å‡ºç›®æ ‡åœ°å€ã€‚</p><p>åŒæ ·åœ°ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ‰“å°çš„æ–¹å¼æ¥å¢å¼ºå¯è¯»æ€§ï¼Œä¼˜åŒ–Debugä½“éªŒï¼Œå¹¶æ›´å¥½çš„çœ‹åˆ°æŒ‡ä»¤åœ¨æµæ°´çº¿ä¸­çš„æµåŠ¨ã€‚åŒæ ·ä½¿ç”¨<code>DEBUG</code>å®è¿›è¡ŒåŒ…è£…ï¼Œåœ¨ç»™ç»¼åˆå™¨ç”Ÿæˆæœ€ç»ˆç”µè·¯å‰å–æ¶ˆå®å®šä¹‰å³å¯ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> ALU (</span><br><span class="line">    <span class="comment">// æ“ä½œç </span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] alu_op,</span><br><span class="line">    <span class="comment">// æ“ä½œæ•°</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src1,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src2,</span><br><span class="line">    <span class="comment">// æ¥è‡ªID/EXçº§çš„ç«‹å³æ•°</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm,</span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ“ä½œæ•°é€‰æ‹© 0: src2 1: imm</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        alu_src2_sel,</span><br><span class="line">    <span class="comment">// ç»“æœè¾“å‡º</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] alu_result,</span><br><span class="line">    <span class="comment">// æ ‡å¿—ä½è¾“å‡º</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        zero,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        sign,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        alu_unsigned</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src2_inner;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> src2_inner = (alu_src2_sel) ? imm : src2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿ç®—æ“ä½œ</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : alu_operation</span><br><span class="line">        <span class="keyword">case</span> (alu_op)</span><br><span class="line">            <span class="comment">// åŸºç¡€è¿ç®—</span></span><br><span class="line">            `ALU_ADD:   alu_result = src1 + src2_inner;</span><br><span class="line">            `ALU_SUB:   alu_result = src1 - src2_inner;  <span class="comment">// src1 + (~src2 + 1)</span></span><br><span class="line">            `ALU_OR:    alu_result = src1 | src2_inner;</span><br><span class="line">            `ALU_AND:   alu_result = src1 &amp; src2_inner;</span><br><span class="line">            `ALU_XOR:   alu_result = src1 ^ src2_inner;</span><br><span class="line">            `ALU_SLL:   alu_result = src1 &lt;&lt; src2_inner[<span class="number">4</span>:<span class="number">0</span>];</span><br><span class="line">            `ALU_SRL:   alu_result = src1 &gt;&gt; src2_inner[<span class="number">4</span>:<span class="number">0</span>];</span><br><span class="line">            <span class="comment">// å¿…é¡»æ˜¾å¼å£°æ˜src1ä¸ºæœ‰ç¬¦å·æ•°</span></span><br><span class="line">            `ALU_SRA:   alu_result = <span class="built_in">$signed</span>(src1) &gt;&gt;&gt; src2_inner[<span class="number">4</span>:<span class="number">0</span>];</span><br><span class="line">            `ALU_SLT:   alu_result = (<span class="built_in">$signed</span>(src1) &lt; <span class="built_in">$signed</span>(src2_inner)) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">            `ALU_SLTU:  alu_result = (src1 &lt; src2_inner) ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">            `ALU_RIGHT: alu_result = src2_inner;  <span class="comment">// ç”¨äºAUIPCæŒ‡ä»¤</span></span><br><span class="line">            <span class="comment">// L-Type</span></span><br><span class="line">            `ALU_LW:    alu_result = src1 + src2_inner;  <span class="comment">// åœ°å€è®¡ç®—</span></span><br><span class="line">            <span class="comment">// [TODO] éå¯¹é½è®¿å­˜</span></span><br><span class="line">            <span class="comment">//S-Type</span></span><br><span class="line">            `ALU_SW:    alu_result = src1 + src2_inner;  <span class="comment">// åœ°å€è®¡ç®—</span></span><br><span class="line">            <span class="keyword">default</span>:    alu_result = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Load/StoreæŒ‡ä»¤ä½¿ç”¨çš„åœ°å€è®¡ç®—ä¸æ”¾åœ¨ALUå†…</span></span><br><span class="line">    <span class="comment">// æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å— LoadStoreUnit</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ‡å¿—ä½è¾“å‡º</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        zero         = (alu_result == <span class="number">32&#x27;b0</span>);</span><br><span class="line">        sign         = alu_result[<span class="number">31</span>];</span><br><span class="line">        alu_unsigned = (src1 &lt; src2_inner);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">    <span class="comment">// æ–¹ä¾¿è°ƒè¯•çš„ ASCII æŒ‡ä»¤è¾“å‡º</span></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">64</span>-<span class="number">1</span>:<span class="number">0</span>] aluop_ascii;</span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : aluop_ascii_output</span><br><span class="line">        <span class="keyword">case</span> (alu_op)</span><br><span class="line">            `ALU_ADD:   aluop_ascii = <span class="string">&quot;AADD&quot;</span>;</span><br><span class="line">            `ALU_SUB:   aluop_ascii = <span class="string">&quot;ASUB&quot;</span>;</span><br><span class="line">            `ALU_OR:    aluop_ascii = <span class="string">&quot;AOR&quot;</span>;</span><br><span class="line">            `ALU_AND:   aluop_ascii = <span class="string">&quot;AAND&quot;</span>;</span><br><span class="line">            `ALU_XOR:   aluop_ascii = <span class="string">&quot;AXOR&quot;</span>;</span><br><span class="line">            `ALU_SLL:   aluop_ascii = <span class="string">&quot;ASLL&quot;</span>;</span><br><span class="line">            `ALU_SRL:   aluop_ascii = <span class="string">&quot;ASRL&quot;</span>;</span><br><span class="line">            `ALU_SRA:   aluop_ascii = <span class="string">&quot;ASRA&quot;</span>;</span><br><span class="line">            `ALU_SLT:   aluop_ascii = <span class="string">&quot;ASLT&quot;</span>;</span><br><span class="line">            `ALU_SLTU:  aluop_ascii = <span class="string">&quot;ASLTU&quot;</span>;</span><br><span class="line">            `ALU_RIGHT: aluop_ascii = <span class="string">&quot;ARGHT&quot;</span>;</span><br><span class="line">            `ALU_LW:    aluop_ascii = <span class="string">&quot;ALW&quot;</span>;</span><br><span class="line">            `ALU_SW:    aluop_ascii = <span class="string">&quot;ASW&quot;</span>;</span><br><span class="line">            <span class="keyword">default</span>:    aluop_ascii = <span class="string">&quot;ANOP&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="meta">`<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯¹äºè®¸å¤šCPUï¼Œä¼šå°†ALUè¿ç®—çš„æºæ“ä½œæ•°é€‰æ‹©åˆ—ä¸ºä¸€ä¸ªå•ç‹¬çš„äºŒé€‰ä¸€MUXã€‚è¿™é‡Œç›´æ¥åˆå¹¶åœ¨ALUå†…ï¼š</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> ALU (</span><br><span class="line">    <span class="comment">// æ“ä½œæ•°</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src1,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src2,</span><br><span class="line">    <span class="comment">// æ¥è‡ªID/EXçº§çš„ç«‹å³æ•°</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm,</span><br><span class="line">    <span class="comment">// ç¬¬äºŒæ“ä½œæ•°é€‰æ‹© 0: src2 1: imm</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        alu_src2_sel,</span><br><span class="line">    ...</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] src2_inner;</span><br><span class="line">    <span class="keyword">assign</span> src2_inner = (alu_src2_sel) ? imm : src2;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‚£ä¸ºä»€ä¹ˆåé¢çš„MUXä¸åˆå¹¶å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†çœ‹èµ·æ¥æ›´æ–¹ä¾¿ã€‚</p><h3 id="å›å†™æ•°æ®æ¥æºé€‰æ‹©MUX">å›å†™æ•°æ®æ¥æºé€‰æ‹©MUX</h3><p>è¿™ä¸€å—å®é™…ä¸Šæ²¡æœ‰å†™æˆä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ï¼Œè€Œæ˜¯æœ€ç»ˆè¦é›†æˆåœ¨å°è£…å¥½çš„CPUæ¨¡å—å†…ã€‚æƒ³å•ç‹¬å†™ä¸€ä¸ªä¹Ÿè¡Œï¼Œåæ­£æœ€ç»ˆä¼šè¢«ç»¼åˆæˆä¸€ä¸ªå¤šé€‰ä¸€MUXã€‚</p><p>æˆ‘ä»¬éœ€è¦é€‰æ‹©å“ªäº›æ•°æ®ï¼Ÿçœ‹ä¹‹å‰çš„ <a href="/2025/12/08/riscvcod-p5/" title="ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬äº”ç¯‡">è¯‘ç çº§è®¾è®¡</a> ï¼Œçœ‹<code>Decoder.sv</code>è¾“å‡ºçš„é€‰æ‹©ä¿¡å·<code>wd_sel</code>å¯¹åº”å“ªäº›æŒ‡ä»¤ï¼š</p><ul><li>R-Typeå’ŒI-TypeæŒ‡ä»¤çš„å†™å›æ•°æ®æ¥æºäºALUï¼›</li><li>B-TypeæŒ‡ä»¤ä¸éœ€è¦é€‰æ‹©å›å†™æ•°æ®ï¼Œä½†ä¹Ÿå¾—ç»™ä¸ªé»˜è®¤å€¼ï¼›</li><li><code>jal</code>å’Œ<code>jalr</code>ä¸¤ä¸ªæ˜¯è·³è½¬æŒ‡ä»¤ï¼Œéœ€è¦é€‰æ‹©<code>pc+4</code>ä½œä¸ºæ•°æ®å†™å…¥å¯„å­˜å™¨ï¼›</li><li><code>lui</code>å’Œ<code>auipc</code>è¿™ä¸¤ä¸ªå¾ˆç‰¹æ®Šï¼Œæ˜¯ç«‹å³æ•°æ‰©å±•ï¼Œå› æ­¤ä½¿ç”¨æ‰©å±•åä»IDçº§ä¼ å…¥çš„æ•°æ®ï¼›</li><li>L-Typeéœ€è¦ä»DRAMä¸­è¯»å–æ•°æ®ï¼Œå› æ­¤éœ€è¦åœ¨MEMçº§é€‰æ‹©ï¼›</li><li>ä¸åº”è¯¥æœ‰å…¶ä½™æƒ…å†µï¼Œè¿™é‡Œå†™ä¸º<code>unique case</code>å¯ä»¥ä¸å†™<code>default</code>ã€‚ä¸è¿‡è¡¥ä¸€ä¸ªæœ€å¥½ã€‚</li></ul><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å›å†™æ•°æ®æ¥æºé€‰æ‹©MUX</span></span><br><span class="line"><span class="comment">// åœ¨EXçº§å®Œæˆé€‰æ‹©ä»¥å‡å°‘æµæ°´çº¿å¯„å­˜å™¨å®½åº¦</span></span><br><span class="line"><span class="comment">// æ³¨æ„ load æŒ‡ä»¤çš„æ•°æ®åœ¨ MEM çº§æ‰å¯ç”¨ å› æ­¤ä¸å¯èƒ½é€‰æ‹© DRAM ä½œä¸ºå›å†™æ•°æ®æ¥æº</span></span><br><span class="line"><span class="keyword">always_comb</span> <span class="keyword">begin</span> : wd_EX_MUX</span><br><span class="line">    <span class="keyword">case</span> (wd_sel_EX)</span><br><span class="line">        `WD_SEL_FROM_ALU:  rf_wd_EX = alu_result_EX;</span><br><span class="line">        <span class="comment">// `WD_SEL_FROM_DRAMåœ¨MEMçº§å¤„ç†</span></span><br><span class="line">        `WD_SEL_FROM_PC4:  rf_wd_EX = pc4_EX;</span><br><span class="line">        <span class="comment">// å¦‚æœå›å†™çš„æ˜¯ç«‹å³æ•°æ‰©å±•å€¼ åˆ™éœ€è¦åˆ¤æ–­æ˜¯å¦ä¸ºAUIPCæŒ‡ä»¤</span></span><br><span class="line">        `WD_SEL_FROM_IEXT: rf_wd_EX = (is_auipc_EX) ? branch_target_EX : imm_EX;</span><br><span class="line">        <span class="keyword">default</span>:           rf_wd_EX = <span class="number">32&#x27;b0</span>;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="ä¸‹ä¸€PCè®¡ç®—æ¨¡å—-NextPC-Generator-sv">ä¸‹ä¸€PCè®¡ç®—æ¨¡å— NextPC_Generator.sv</h3><p>æˆ‘ä»¬çš„æŒ‡ä»¤æ‰§è¡Œå®Œæ€ä¹ˆåŠï¼Ÿå–ä¸‹ä¸€ä¸ªã€‚é‚£ä¸‹ä¸€ä¸ªä»å“ªé‡Œå–å‘¢ï¼Ÿ</p><p>ä¸æ˜¯æ‰€æœ‰çš„æŒ‡ä»¤åœ°å€éƒ½æ˜¯+4+4å˜åŒ–ã€‚å¯¹äºåˆ†æ”¯è·³è½¬æŒ‡ä»¤ç­‰ï¼Œæˆ‘ä»¬åœ¨è¿ç®—å¹¶æ¯”è¾ƒåï¼Œè¦æ ¹æ®ç»“æœæ¥è¿›è¡Œè·³è½¬ï¼Œè€Œè¿ç®—å®Œæˆçš„æœ€æ—©æ—¶é—´ä¾¿æ˜¯EXçº§ã€‚æ­¤å¤–ï¼Œåœ¨EXä½œæ¯”è¾ƒè¿˜èƒ½åˆ©ç”¨å‰å‘æ•°æ®é€šè·¯æ¥åŠ å¿«è¿ç®—ï¼Œè¿™æ˜¯å¥½çš„ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“ï¼Œåœ¨EXçº§æ‰§è¡Œçš„æŒ‡ä»¤æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯åˆ†æ”¯ï¼Œè¿˜æ˜¯è·³è½¬ï¼Œæˆ–è€…æ ¹æœ¬ä¸ç”¨å»åˆ»æ„å˜åŒ–<code>pc</code>ï¼Ÿæˆ‘ä»¬è¿˜éœ€è¦è·å–è·³è½¬çš„ç›®æ ‡åœ°å€ï¼Œå¯¹äº<code>jalr</code>è¿˜è¦è¿›è¡Œç›¸åº”çš„è®¡ç®—ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> NextPC_Generator (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        is_branch_instr,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">2</span>:<span class="number">0</span>] branch_type,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] jump_type,</span><br><span class="line">    <span class="comment">// ALUè®¡ç®—ç»“æœè¾“å…¥</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] alu_result,</span><br><span class="line">    <span class="comment">// PCåŠ ç«‹å³æ•°è¾“å…¥</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] branch_target_i,</span><br><span class="line">    <span class="comment">// ALUæ ‡å¿—ä½è¾“å…¥</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        alu_zero,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        alu_sign,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        alu_unsigned,</span><br><span class="line">    <span class="comment">// PCæ§åˆ¶è¾“å‡º</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        take_branch,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] branch_target_NextPC</span><br><span class="line"></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (jump_type)        take_branch = <span class="number">1&#x27;b1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (is_branch_instr) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">unique</span> <span class="keyword">case</span> (branch_type)</span><br><span class="line">                `BRANCH_BEQ:  take_branch = alu_zero;</span><br><span class="line">                `BRANCH_BNE:  take_branch = ~alu_zero;</span><br><span class="line">                `BRANCH_BLT:  take_branch = alu_sign;</span><br><span class="line">                `BRANCH_BGE:  take_branch = ~alu_sign;</span><br><span class="line">                `BRANCH_BLTU: take_branch = alu_unsigned;</span><br><span class="line">                `BRANCH_BGEU: take_branch = ~alu_unsigned;</span><br><span class="line">                <span class="keyword">default</span>:      take_branch = <span class="number">1&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span>              take_branch = <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// JALR éœ€è¦å°†æœ€ä½ä½ç½®0</span></span><br><span class="line">    <span class="keyword">assign</span> branch_target_NextPC = (jump_type == `JUMP_JALR) ?</span><br><span class="line">                                  &#123;alu_result[<span class="number">31</span>:<span class="number">1</span>], <span class="number">1&#x27;b0</span>&#125; : branch_target_i;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="note warning flat"><p>è¦æ³¨æ„ï¼š<code>jalr</code>æŒ‡ä»¤è¦å°†<strong>æœ€ä½ä½å½’é›¶</strong>ã€‚</p><p>å› RISCâ€‘V è¦æ±‚æ‰€æœ‰æŒ‡ä»¤åœ°å€è‡³å°‘è¦å¯¹é½åˆ° 16 ä½ï¼ˆåŠå­—ï¼Œ2 å­—èŠ‚ï¼‰ï¼Œè€Œ<code>jalr</code>æ˜¯å¯„å­˜å™¨é—´æ¥è·³è½¬ï¼Œ<code>rs1 + imm</code>çš„å€¼å¯èƒ½æ˜¯å¥‡æ•°ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨å°†ä½ä½ç½®ä¸º0ã€‚</p></div><h2 id="EX-MEMçº§-æµæ°´çº¿å¯„å­˜å™¨-PR-EX-MEM-sv">EX/MEMçº§ æµæ°´çº¿å¯„å­˜å™¨ PR_EX_MEM.sv</h2><p>å¯¹äºEXå‘MEMçº§è¿›å‘ï¼Œæˆ‘ä»¬éœ€è¦ä¼ é€’æ¥è‡ªMUXçš„å›å†™æ•°æ®<code>wd</code>ï¼Œä»¥åŠDRAMçš„å†™ä½¿èƒ½ä¿¡å·<code>dram_we</code>ã€‚MEMçº§çš„å›å†™æ•°æ®æ¥æºMUXæ§åˆ¶ä¿¡å·<code>wd_sel</code>å’ŒEXçº§çš„æ˜¯ä¸€ä¸ªï¼Œç›´æ¥å¤ç”¨å³å¯ã€‚æ­¤å¤–ï¼ŒALUçš„è®¡ç®—ç»“æœä¹Ÿä¸èƒ½å¿½ç•¥ï¼Œå› ä¸ºå¯¹äºL-TypeæŒ‡ä»¤ï¼Œéœ€è¦ä½œä¸ºåœ°å€ä¼ å…¥MEMçº§ã€‚æ¥è‡ªID/EXçº§çš„<code>rD2</code>æ•°æ®ä¹Ÿéœ€è¦ä¼ å…¥ï¼Œä½œä¸ºDRAMçš„å†™å…¥æ•°æ®ã€‚æ­¤å¤–ï¼Œå¯¹äºS-TypeæŒ‡ä»¤ï¼Œå¯„å­˜å™¨å †å†™ä½¿èƒ½ä¿¡å·<code>wr</code>ä¹Ÿéœ€è¦ç»§ç»­ä¼ é€’ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PR_EX_MEM (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// EXçº§è¾“å…¥</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_ex_i,</span><br><span class="line">    <span class="comment">// EXçº§è¾“å‡º ç»™MEMçº§è¾“å…¥</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_mem_o,</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æŒ‡ä»¤æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        instr_valid_ex_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        instr_valid_mem_o,</span><br><span class="line">    <span class="comment">// å†™ä½¿èƒ½</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        dram_we_ex_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        dram_we_mem_o,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rf_we_ex_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rf_we_mem_o,</span><br><span class="line">    <span class="comment">// å†™å›æ•°æ®æ¥æº</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel_ex_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel_mem_o,</span><br><span class="line">    <span class="comment">// å†™å›å¯„å­˜å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wr_ex_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wr_mem_o,</span><br><span class="line">    <span class="comment">// ALUè®¡ç®—ç»“æœ</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] alu_result_ex_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] alu_result_mem_o,</span><br><span class="line">    <span class="comment">// MUXæ•°æ® æ§åˆ¶å†™å›æ•°æ®æ¥æº</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] wd_ex_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] wd_mem_o,</span><br><span class="line">    <span class="comment">// å›å†™æ•°æ® æ¥è‡ªID/EXçº§</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD2_ex_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD2_mem_o</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            pc_mem_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_valid_mem_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            dram_we_mem_o     &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            rf_we_mem_o       &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            wd_sel_mem_o      &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">            alu_result_mem_o  &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            wd_mem_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            rD2_mem_o         &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            pc_mem_o          &lt;= pc_ex_i;</span><br><span class="line">            instr_valid_mem_o &lt;= instr_valid_ex_i;</span><br><span class="line">            dram_we_mem_o     &lt;= dram_we_ex_i;</span><br><span class="line">            rf_we_mem_o       &lt;= rf_we_ex_i;</span><br><span class="line">            wd_sel_mem_o      &lt;= wd_sel_ex_i;</span><br><span class="line">            alu_result_mem_o  &lt;= alu_result_ex_i;</span><br><span class="line">            wd_mem_o          &lt;= wd_ex_i;</span><br><span class="line">            rD2_mem_o         &lt;= rD2_ex_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™å›å¯„å­˜å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            wr_mem_o &lt;= <span class="number">5&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            wr_mem_o &lt;= wr_ex_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†™åˆ°è¿™é‡Œï¼Œå·²ç»å®Œæˆ30%äº†ï¼Œå¯å–œå¯è´ºï¼</p><p>ä¸ºä»€ä¹ˆå·²ç»å†™äº†ä¸‰çº§ï¼Œæ‰å®Œæˆ30%ï¼Ÿ</p><p><strong>å› ä¸ºå¤§çš„åœ¨åé¢å‘¢ã€‚</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æ‰§è¡Œ-EXçº§-è®¾è®¡&quot;&gt;æ‰§è¡Œ EXçº§ è®¾è®¡&lt;/h2&gt;
&lt;p&gt;EXçº§ä»¥è´Ÿè´£æ ¸å¿ƒè¿ç®—åŠŸèƒ½çš„&lt;strong&gt;ALU&lt;/strong&gt;è‘—ç§°ã€‚å¯ä»¥è¯´ï¼Œå®ƒæ˜¯CPUçš„çµé­‚ã€‚æ¥ä¸€äººä¸€å¥ALUç‰›é€¼æ¥ã€‚&lt;/</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="åµŒå…¥å¼" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="è®¡ç®—æœºåŸç†" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬äº”ç¯‡</title>
    <link href="https://blog.esing.dev/2025/12/08/riscvcod-p5/"/>
    <id>https://blog.esing.dev/2025/12/08/riscvcod-p5/</id>
    <published>2025-12-08T12:16:34.000Z</published>
    <updated>2025-12-10T13:36:23.535Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è¯‘ç -IDçº§-è®¾è®¡">è¯‘ç  IDçº§ è®¾è®¡</h2><p>æåˆ°è¯‘ç çº§ï¼Œé‚£å°±å¾—æ˜¯è¯‘ç å™¨å•Šã€‚çº¯ç»„åˆé€»è¾‘ï¼ŒåŒ…ä½ å†™åˆ°çˆ½ã€‚</p><p>è¯‘ç çº§è¿˜æœ‰ä»€ä¹ˆï¼Ÿç«‹å³æ•°ç§»ä½ä¹Ÿéœ€è¦æ”¾åœ¨IDçº§ï¼Œä»¥å‡è½»EXçº§çš„å‹åŠ›ã€‚</p><h3 id="æŒ‡ä»¤è¯‘ç å™¨-Decoder-sv">æŒ‡ä»¤è¯‘ç å™¨ Decoder.sv</h3><p>æŒ‡ä»¤è¯‘ç å™¨ä¸º<strong>ç»„åˆé€»è¾‘æ¨¡å—</strong>ã€‚æˆ‘ä»¬éœ€è¦å“ªäº›ä¿¡å·ï¼Ÿ</p><p>é¦–å…ˆè¦æŠŠ31ä½çš„æŒ‡ä»¤åˆ†ç±»ï¼šæ˜¯RIBJSUçš„å“ªä¸€ç§ï¼Ÿä¹‹åï¼Œè¦æ ¹æ®åˆ†ç±»ï¼Œå°†å¯„å­˜å™¨åœ°å€æ‹†åˆ†å‡ºæ¥ï¼Œå‡†å¤‡é€è¿›åŒä¸€çº§çš„å¯„å­˜å™¨å †æ¥è¯»å–æ•°æ®ï¼›è¦æå–æŒ‡ä»¤çš„<code>funct3</code>å’Œ<code>funct7</code>ï¼Œä»¥ä¾¿åœ¨EXçº§å‘Šè¯‰ALUâ€œé•¿çš„åƒçš„æŒ‡ä»¤å¦‚ä½•åŒºåˆ†â€ï¼›è¦æ ¹æ®æŒ‡ä»¤ç±»å‹ï¼ŒåŒºåˆ†è·³è½¬ç±»å‹å’Œè¯»å–/å†™å…¥ç±»å‹ï¼Œç»™åé¢çš„æµæ°´çº§è¿›è¡Œå¤„ç†ï¼›è¿˜è¦ç”Ÿæˆå¯¹åº”ä½çš„å¯„å­˜å™¨è¯»ä¿¡å·ï¼Œå’Œåˆ†æ”¯æŒ‡ä»¤åˆ¤æ–­ä¿¡å·ï¼Œä¸ºåé¢å¤„ç†æ•°æ®å†’é™©å‡†å¤‡â€¦â€¦è¦å¹²çš„äº‹æƒ…çœŸä¸å°‘ã€‚</p><p>ä¸€æ­¥ä¸€æ­¥å…¨å†™ä¸Šå³å¯ã€‚æ¨èä½¿ç”¨å®å®šä¹‰ï¼Œå¤§å¹…åº¦æå‡å¯è¯»æ€§ã€‚</p><p>åœ¨æ¨¡å—å†…ä½¿ç”¨``ifdef DEBUG`é…åˆä¸ŠASCIIå­—ç¬¦è¿›è¡ŒDebugæ˜¯å¦ä¸€ä¸ªå°æŠ€å·§ã€‚åœ¨ç»¼åˆæ—¶å–æ¶ˆå®å®šä¹‰å³å¯ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> Decoder (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instr,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] alu_op,</span><br><span class="line">    <span class="comment">// ALU ç¬¬ä¸€æ“ä½œæ•°æ¥æº</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        is_auipc,</span><br><span class="line">    <span class="comment">// ALU ç¬¬äºŒæ“ä½œæ•°æ¥æº</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        alu_src,</span><br><span class="line">    <span class="comment">// å†™ä½¿èƒ½</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        dram_we,          <span class="comment">// é«˜ç”µå¹³ä¸ºå†™ä½¿èƒ½ ä½ç”µå¹³ä¸ºè¯»</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rf_we,</span><br><span class="line">    <span class="comment">// å†™å›æ•°æ®æ¥æº</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel,</span><br><span class="line">    <span class="comment">// åˆ†æ”¯ç›¸å…³</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        is_branch_instr,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">2</span>:<span class="number">0</span>] branch_type,</span><br><span class="line">    <span class="comment">// è·³è½¬ç›¸å…³</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] jump_type,</span><br><span class="line">    <span class="comment">// æ•°æ®è¯»å–ç±»å‹</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">3</span>:<span class="number">0</span>] sl_type,</span><br><span class="line">    <span class="comment">// æºå¯„å­˜å™¨æ˜¯å¦åœ¨ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rs1_used,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rs2_used</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æå–æŒ‡ä»¤å­—æ®µ</span></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] opcode;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">2</span>:<span class="number">0</span>] funct3;</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] funct7;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        opcode = instr[<span class="number">6</span>:<span class="number">0</span>];</span><br><span class="line">        funct3 = instr[<span class="number">14</span>:<span class="number">12</span>];</span><br><span class="line">        funct7 = instr[<span class="number">31</span>:<span class="number">25</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·³è½¬ç±»å‹åˆ¤æ–­</span></span><br><span class="line">    <span class="comment">// assign jump_type = (opcode == `OPCODE_JAL) ?</span></span><br><span class="line">    <span class="comment">//     `JUMP_JAL : (opcode == `OPCODE_JALR) ? `JUMP_JALR : `JUMP_NOP;</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_JAL:  jump_type = `JUMP_JAL;</span><br><span class="line">            `OPCODE_JALR: jump_type = `JUMP_JALR;</span><br><span class="line">            <span class="keyword">default</span>:      jump_type = `JUMP_NOP;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æºå¯„å­˜å™¨è¯»å–åˆ¤æ–­</span></span><br><span class="line">    <span class="comment">// åå‘åˆ¤æ–­ç®€åŒ–é€»è¾‘ è®°å¾—å»é™¤ERROR</span></span><br><span class="line">    <span class="comment">// rs1ï¼šé™¤äº† LUI/AUIPC/JAL ä¹‹å¤–éƒ½ç”¨åˆ°</span></span><br><span class="line">    <span class="keyword">assign</span> rs1_used = ~((opcode == `OPCODE_LUI) || (opcode == `OPCODE_AUIPC) ||</span><br><span class="line">                        (opcode == `OPCODE_JAL) || (opcode == `OPCODE_ZERO));</span><br><span class="line">    <span class="comment">// // rs2ï¼šåªæœ‰ R-type / B-type / S-type ç”¨åˆ°</span></span><br><span class="line">    <span class="keyword">assign</span> rs2_used = (opcode == `OPCODE_RTYPE) || (opcode == `OPCODE_BTYPE) ||</span><br><span class="line">        (opcode == `OPCODE_STYPE);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// [HACK] Icarus Verilog ä¸æ”¯æŒ inside è¯­æ³•ç³– :(</span></span><br><span class="line">    <span class="comment">// assign rs1_used = !(opcode inside &#123;</span></span><br><span class="line">    <span class="comment">//     `OPCODE_LUI,</span></span><br><span class="line">    <span class="comment">//     `OPCODE_AUIPC,</span></span><br><span class="line">    <span class="comment">//     `OPCODE_JAL</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// assign rs2_used = (opcode inside &#123;</span></span><br><span class="line">    <span class="comment">//     `OPCODE_RTYPE,</span></span><br><span class="line">    <span class="comment">//     `OPCODE_BTYPE,</span></span><br><span class="line">    <span class="comment">//     `OPCODE_STYPE</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†æ”¯ç±»å‹åˆ¤æ–­</span></span><br><span class="line">    <span class="comment">// çœ‹funct3å†³å®šå…·ä½“çš„åˆ†æ”¯ç±»å‹</span></span><br><span class="line">    <span class="comment">// assign is_branch_instr = (opcode == `OPCODE_BTYPE);</span></span><br><span class="line">    <span class="comment">// assign branch_type = funct3;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALU ç¬¬ä¸€æ“ä½œæ•°æ¥æº</span></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸º AUIPC æŒ‡ä»¤å³å¯</span></span><br><span class="line">    <span class="keyword">assign</span> is_auipc = (opcode == `OPCODE_AUIPC);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALU ç¬¬äºŒæ“ä½œæ•°æ¥æº</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : alu_src_selection</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_RTYPE,</span><br><span class="line">            `OPCODE_BTYPE:  alu_src = `ALUSRC_RS2;  <span class="comment">// æ¥è‡ªå¯„å­˜å™¨ rs2</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_ITYPE,</span><br><span class="line">            `OPCODE_LTYPE,</span><br><span class="line">            `OPCODE_STYPE,</span><br><span class="line">            `OPCODE_AUIPC,</span><br><span class="line">            `OPCODE_JALR:</span><br><span class="line">                            alu_src = `ALUSRC_IMM;  <span class="comment">// æ¥è‡ªç«‹å³æ•°</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:        alu_src = `ALUSRC_RS2;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å›å†™æ•°æ®æ¥æºé€‰æ‹©</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : wb_source_selection</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_RTYPE,</span><br><span class="line">            `OPCODE_ITYPE:  wd_sel = `WD_SEL_FROM_ALU;</span><br><span class="line"></span><br><span class="line">            `OPCODE_LTYPE:  wd_sel = `WD_SEL_FROM_DRAM;</span><br><span class="line"></span><br><span class="line">            `OPCODE_JAL,</span><br><span class="line">            `OPCODE_JALR:   wd_sel = `WD_SEL_FROM_PC4;</span><br><span class="line"></span><br><span class="line">            `OPCODE_LUI,</span><br><span class="line">            `OPCODE_AUIPC:  wd_sel = `WD_SEL_FROM_IEXT;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:        wd_sel = <span class="number">2&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯„å­˜å™¨å †å†™ä½¿èƒ½</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : rf_write_enable</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_RTYPE,</span><br><span class="line">            `OPCODE_ITYPE,</span><br><span class="line">            `OPCODE_LTYPE,</span><br><span class="line">            `OPCODE_LUI,</span><br><span class="line">            `OPCODE_AUIPC,</span><br><span class="line">            `OPCODE_JAL,</span><br><span class="line">            `OPCODE_JALR:   rf_we = <span class="number">1&#x27;b1</span>;</span><br><span class="line"></span><br><span class="line">            `OPCODE_BTYPE,</span><br><span class="line">            `OPCODE_STYPE:  rf_we = <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:        rf_we = <span class="number">1&#x27;b0</span>;  <span class="comment">// è€ƒè™‘å¼‚å¸¸æƒ…å†µ é»˜è®¤ä¸å†™</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°æ®å­˜å‚¨å™¨å†™ä½¿èƒ½</span></span><br><span class="line">    <span class="keyword">assign</span> dram_we = (opcode == `OPCODE_STYPE) ? <span class="number">1&#x27;b1</span> : <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALU æ“ä½œç ç”Ÿæˆ</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : ALUOp_selection</span><br><span class="line">        <span class="comment">// é»˜è®¤å€¼</span></span><br><span class="line">        alu_op          = `ALU_NOP;</span><br><span class="line">        branch_type     = `BRANCH_NOP;</span><br><span class="line">        is_branch_instr = <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line"></span><br><span class="line">            `OPCODE_RTYPE, `OPCODE_ITYPE: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_ADD_SUB_MUL:</span><br><span class="line">                    <span class="comment">// ä½¿ç”¨ case-true ç»“æ„</span></span><br><span class="line">                        <span class="keyword">case</span> (<span class="number">1&#x27;b1</span>)</span><br><span class="line">                            (opcode == `OPCODE_RTYPE) &amp;&amp;        <span class="comment">// R-Type SUB</span></span><br><span class="line">                            (funct7 == `FUNCT7_SUB):</span><br><span class="line">                                            alu_op = `ALU_SUB;</span><br><span class="line"></span><br><span class="line">                            (opcode == `OPCODE_RTYPE):          <span class="comment">// R-Type å…¶å®ƒï¼ˆé»˜è®¤ä¸º ADDï¼‰</span></span><br><span class="line">                                            alu_op = `ALU_ADD;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">default</span>:                            <span class="comment">// é R-typeï¼ˆåŒæ ·é»˜è®¤ ADDï¼‰</span></span><br><span class="line">                                            alu_op = `ALU_ADD;</span><br><span class="line">                        <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">                    `FUNCT3_SLL_MULH:       alu_op = `ALU_SLL;</span><br><span class="line">                    `FUNCT3_SLT_MULHSU:     alu_op = `ALU_SLT;</span><br><span class="line">                    `FUNCT3_SLTU_MULHU:     alu_op = `ALU_SLTU;</span><br><span class="line">                    `FUNCT3_XOR_DIV:        alu_op = `ALU_XOR;</span><br><span class="line">                    `FUNCT3_SRL_SRA_DIVU:   alu_op = (funct7 == `FUNCT7_SRA) ?</span><br><span class="line">                                                     `ALU_SRA : `ALU_SRL;</span><br><span class="line">                    `FUNCT3_OR_REM:         alu_op = `ALU_OR;</span><br><span class="line">                    `FUNCT3_AND_REMU:       alu_op = `ALU_AND;</span><br><span class="line">                    <span class="keyword">default</span>:                alu_op = `ALU_NOP;  <span class="comment">// é»˜è®¤ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_BTYPE: <span class="keyword">begin</span></span><br><span class="line">                alu_op = (funct3 == `FUNCT3_BLTU || funct3 == `FUNCT3_BGEU) ? `ALU_SLTU :</span><br><span class="line">                    `ALU_SUB;  <span class="comment">// ç”¨äºæ¯”è¾ƒæ˜¯å¦ä¸ºæœ‰ç¬¦å·/æ— ç¬¦å·</span></span><br><span class="line">                <span class="comment">// åˆ¤æ–­åˆ†æ”¯ç±»å‹</span></span><br><span class="line">                <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_BEQ:  branch_type = `BRANCH_BEQ;</span><br><span class="line">                    `FUNCT3_BNE:  branch_type = `BRANCH_BNE;</span><br><span class="line">                    `FUNCT3_BLT:  branch_type = `BRANCH_BLT;</span><br><span class="line">                    `FUNCT3_BGE:  branch_type = `BRANCH_BGE;</span><br><span class="line">                    `FUNCT3_BLTU: branch_type = `BRANCH_BLTU;</span><br><span class="line">                    `FUNCT3_BGEU: branch_type = `BRANCH_BGEU;</span><br><span class="line">                    <span class="keyword">default</span>:      branch_type = `BRANCH_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line">                is_branch_instr = <span class="number">1&#x27;b1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_JAL,</span><br><span class="line">            `OPCODE_LUI:            alu_op = `ALU_RIGHT;  <span class="comment">// ç‰¹æ®ŠæŒ‡ä»¤</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_JALR,</span><br><span class="line">            `OPCODE_AUIPC:          alu_op = `ALU_ADD;</span><br><span class="line"></span><br><span class="line">            `OPCODE_LTYPE: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_LB:     alu_op = `ALU_LB;</span><br><span class="line">                    `FUNCT3_LBU:    alu_op = `ALU_LBU;</span><br><span class="line">                    `FUNCT3_LH:     alu_op = `ALU_LH;</span><br><span class="line">                    `FUNCT3_LHU:    alu_op = `ALU_LHU;</span><br><span class="line">                    `FUNCT3_LW:     alu_op = `ALU_LW;</span><br><span class="line">                    <span class="keyword">default</span>:        alu_op = `ALU_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_STYPE: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_SB:     alu_op = `ALU_SB;</span><br><span class="line">                    `FUNCT3_SH:     alu_op = `ALU_SH;</span><br><span class="line">                    `FUNCT3_SW:     alu_op = `ALU_SW;</span><br><span class="line">                    <span class="keyword">default</span>:        alu_op = `ALU_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>:                alu_op = `ALU_NOP;  <span class="comment">// é»˜è®¤åŠ æ³•</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°æ®å­˜å–ç±»å‹åˆ¤æ–­</span></span><br><span class="line">    <span class="comment">// verilog_format:off</span></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : sl_selection</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_LTYPE: <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_LB:     sl_type = `MEM_LB;</span><br><span class="line">                    `FUNCT3_LBU:    sl_type = `MEM_LBU;</span><br><span class="line">                    `FUNCT3_LH:     sl_type = `MEM_LH;</span><br><span class="line">                    `FUNCT3_LHU:    sl_type = `MEM_LHU;</span><br><span class="line">                    `FUNCT3_LW:     sl_type = `MEM_LW;</span><br><span class="line">                    <span class="keyword">default</span>:        sl_type = `MEM_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            `OPCODE_STYPE:<span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">case</span> (funct3)</span><br><span class="line">                    `FUNCT3_SB:     sl_type = `MEM_SB;</span><br><span class="line">                    `FUNCT3_SH:     sl_type = `MEM_SH;</span><br><span class="line">                    `FUNCT3_SW:     sl_type = `MEM_SW;</span><br><span class="line">                    <span class="keyword">default</span>:        sl_type = `MEM_NOP;</span><br><span class="line">                <span class="keyword">endcase</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">default</span>:                sl_type = `MEM_NOP;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯è§†åŒ–è¾“å‡ºåˆ¤æ–­</span></span><br><span class="line">    <span class="comment">//verilog_format:off</span></span><br><span class="line"><span class="meta">`<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">  <span class="comment">// æ–¹ä¾¿è°ƒè¯•çš„ ASCII æŒ‡ä»¤è¾“å‡º</span></span><br><span class="line">  <span class="keyword">logic</span> [<span class="number">256</span>-<span class="number">1</span>:<span class="number">0</span>] instr_ascii;</span><br><span class="line">  <span class="keyword">logic</span> [<span class="number">256</span>-<span class="number">1</span>:<span class="number">0</span>] branch_type_ascii;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">always_comb</span> <span class="keyword">begin</span> : ascii_output</span><br><span class="line">    <span class="keyword">unique</span> <span class="keyword">case</span> (branch_type)</span><br><span class="line">      `BRANCH_NOP:        branch_type_ascii = <span class="string">&quot;BRANCH_NOP&quot;</span>;</span><br><span class="line">      `BRANCH_BEQ:        branch_type_ascii = <span class="string">&quot;BRANCH_BEQ&quot;</span>;</span><br><span class="line">      `BRANCH_BNE:        branch_type_ascii = <span class="string">&quot;BRANCH_BNE&quot;</span>;</span><br><span class="line">      `BRANCH_BLT:        branch_type_ascii = <span class="string">&quot;BRANCH_BLT&quot;</span>;</span><br><span class="line">      `BRANCH_BGE:        branch_type_ascii = <span class="string">&quot;BRANCH_BGE&quot;</span>;</span><br><span class="line">      `BRANCH_BLTU:       branch_type_ascii = <span class="string">&quot;BRANCH_BLTU&quot;</span>;</span><br><span class="line">      `BRANCH_BGEU:       branch_type_ascii = <span class="string">&quot;BRANCH_BGEU&quot;</span>;</span><br><span class="line">      `BRANCH_JALR:       branch_type_ascii = <span class="string">&quot;BRANCH_JALR&quot;</span>;</span><br><span class="line">      <span class="keyword">default</span>:            branch_type_ascii = <span class="string">&quot;BRANCH_UNKNOWN&quot;</span>;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰å…·ä½“ä¸º32æ¡åŸºæœ¬æŒ‡ä»¤çš„å“ªä¸€æ¡</span></span><br><span class="line">    <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">      `OPCODE_LUI:              instr_ascii = <span class="string">&quot;LUI&quot;</span>;</span><br><span class="line">      `OPCODE_AUIPC:            instr_ascii = <span class="string">&quot;AUIPC&quot;</span>;</span><br><span class="line">      `OPCODE_JAL:              instr_ascii = <span class="string">&quot;JAL&quot;</span>;</span><br><span class="line">      `OPCODE_JALR:             instr_ascii = <span class="string">&quot;JALR&quot;</span>;</span><br><span class="line"></span><br><span class="line">      `OPCODE_BTYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_BEQ:          instr_ascii = <span class="string">&quot;BEQ&quot;</span>;</span><br><span class="line">          `FUNCT3_BNE:          instr_ascii = <span class="string">&quot;BNE&quot;</span>;</span><br><span class="line">          `FUNCT3_BLT:          instr_ascii = <span class="string">&quot;BLT&quot;</span>;</span><br><span class="line">          `FUNCT3_BGE:          instr_ascii = <span class="string">&quot;BGE&quot;</span>;</span><br><span class="line">          `FUNCT3_BLTU:         instr_ascii = <span class="string">&quot;BLTU&quot;</span>;</span><br><span class="line">          `FUNCT3_BGEU:         instr_ascii = <span class="string">&quot;BGEU&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;B_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      `OPCODE_LTYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_LB:           instr_ascii = <span class="string">&quot;LB&quot;</span>;</span><br><span class="line">          `FUNCT3_LH:           instr_ascii = <span class="string">&quot;LH&quot;</span>;</span><br><span class="line">          `FUNCT3_LW:           instr_ascii = <span class="string">&quot;LW&quot;</span>;</span><br><span class="line">          `FUNCT3_LBU:          instr_ascii = <span class="string">&quot;LBU&quot;</span>;</span><br><span class="line">          `FUNCT3_LHU:          instr_ascii = <span class="string">&quot;LHU&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;L_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      `OPCODE_STYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_SB:           instr_ascii = <span class="string">&quot;SB&quot;</span>;</span><br><span class="line">          `FUNCT3_SH:           instr_ascii = <span class="string">&quot;SH&quot;</span>;</span><br><span class="line">          `FUNCT3_SW:           instr_ascii = <span class="string">&quot;SW&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;S_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      `OPCODE_ITYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_ADD_SUB_MUL:  instr_ascii = <span class="string">&quot;ADDI&quot;</span>;</span><br><span class="line">          `FUNCT3_SLL_MULH:     instr_ascii = <span class="string">&quot;SLLI&quot;</span>;</span><br><span class="line">          `FUNCT3_SLT_MULHSU:   instr_ascii = <span class="string">&quot;SLTI&quot;</span>;</span><br><span class="line">          `FUNCT3_SLTU_MULHU:   instr_ascii = <span class="string">&quot;SLTIU&quot;</span>;</span><br><span class="line">          `FUNCT3_XOR_DIV:      instr_ascii = <span class="string">&quot;XORI&quot;</span>;</span><br><span class="line">          `FUNCT3_SRL_SRA_DIVU: instr_ascii = (funct7 == `FUNCT7_SRAI) ? <span class="string">&quot;SRAI&quot;</span> : <span class="string">&quot;SRLI&quot;</span>;</span><br><span class="line">          `FUNCT3_OR_REM:       instr_ascii = <span class="string">&quot;ORI&quot;</span>;</span><br><span class="line">          `FUNCT3_AND_REMU:     instr_ascii = <span class="string">&quot;ANDI&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;I_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      `OPCODE_RTYPE: <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (funct3)</span><br><span class="line">          `FUNCT3_ADD_SUB_MUL: <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (funct7 == `FUNCT7_SUB)</span><br><span class="line">                                instr_ascii = <span class="string">&quot;SUB&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (funct7 == `FUNCT7_ADD)</span><br><span class="line">                                instr_ascii = <span class="string">&quot;ADD&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span>                instr_ascii = <span class="string">&quot;R_UNKNOWN&quot;</span>;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          `FUNCT3_SLL_MULH:     instr_ascii = <span class="string">&quot;SLL&quot;</span>;</span><br><span class="line">          `FUNCT3_SLT_MULHSU:   instr_ascii = <span class="string">&quot;SLT&quot;</span>;</span><br><span class="line">          `FUNCT3_SLTU_MULHU:   instr_ascii = <span class="string">&quot;SLTU&quot;</span>;</span><br><span class="line">          `FUNCT3_XOR_DIV:      instr_ascii = <span class="string">&quot;XOR&quot;</span>;</span><br><span class="line">          `FUNCT3_SRL_SRA_DIVU: <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (funct7 == `FUNCT7_SRA)</span><br><span class="line">                                instr_ascii = <span class="string">&quot;SRA&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (funct7 == `FUNCT7_SRL)</span><br><span class="line">                                instr_ascii = <span class="string">&quot;SRL&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span>                instr_ascii = <span class="string">&quot;R_UNKNOWN&quot;</span>;</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          `FUNCT3_OR_REM:       instr_ascii = <span class="string">&quot;OR&quot;</span>;</span><br><span class="line">          `FUNCT3_AND_REMU:     instr_ascii = <span class="string">&quot;AND&quot;</span>;</span><br><span class="line">          <span class="keyword">default</span>:              instr_ascii = <span class="string">&quot;R_UNKNOWN&quot;</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">default</span>:                  instr_ascii = <span class="string">&quot;ERROR&quot;</span>;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="meta">`<span class="keyword">endif</span></span></span><br><span class="line">    <span class="comment">// verilog_format:on</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ç«‹å³æ•°æ‰©å±•æ¨¡å—-imm-extener-sv">ç«‹å³æ•°æ‰©å±•æ¨¡å— imm_extener.sv</h3><p>ç«‹å³æ•°æ‰©å±•æ¨¡å—ä¹Ÿæ˜¯<strong>ç»„åˆé€»è¾‘æ¨¡å—</strong>ã€‚ä¸éœ€è¦æ¥å—è¯‘ç å™¨ä¼ å‡ºçš„ä¿¡å·ï¼Œè€Œæ˜¯å’Œè¯‘ç å™¨å¹¶è¡Œå·¥ä½œï¼ŒåŒæ ·æ¥å—32ä½æŒ‡ä»¤<code>instr</code>åè¿›è¡Œåˆ†ç±»å¤„ç†ã€‚å½“ç„¶å¯ä»¥å†™åœ¨<code>Decoder.v</code>ï¼Œä½†æ˜¯é‚£æ ·å­æœ‰ç‚¹ä¹±ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> imm_extender (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instr,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm_out</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">6</span>:<span class="number">0</span>] opcode;</span><br><span class="line">    <span class="keyword">assign</span> opcode = instr[<span class="number">6</span>:<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span> : imm_classifier</span><br><span class="line">        <span class="keyword">unique</span> <span class="keyword">case</span> (opcode)</span><br><span class="line">            `OPCODE_ITYPE, `OPCODE_LTYPE, `OPCODE_JALR: <span class="keyword">begin</span>  <span class="comment">// I-type</span></span><br><span class="line">                <span class="comment">// å…ˆè¾“å‡ºç«‹å³æ•°</span></span><br><span class="line">                <span class="comment">// ä¹‹åå†æ ¹æ® instr[30] åŒºåˆ† SLLI/SRLIå’ŒSRAI</span></span><br><span class="line">                imm_out = &#123;&#123;<span class="number">20</span>&#123;instr[<span class="number">31</span>]&#125;&#125;, instr[<span class="number">31</span>:<span class="number">20</span>]&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            `OPCODE_BTYPE: <span class="keyword">begin</span>  <span class="comment">// B-type</span></span><br><span class="line">                imm_out = &#123;&#123;<span class="number">20</span>&#123;instr[<span class="number">31</span>]&#125;&#125;, instr[<span class="number">7</span>], instr[<span class="number">30</span>:<span class="number">25</span>], instr[<span class="number">11</span>:<span class="number">8</span>], <span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            `OPCODE_JAL: <span class="keyword">begin</span>  <span class="comment">// J-type</span></span><br><span class="line">                imm_out = &#123;&#123;<span class="number">12</span>&#123;instr[<span class="number">31</span>]&#125;&#125;, instr[<span class="number">19</span>:<span class="number">12</span>], instr[<span class="number">20</span>], instr[<span class="number">30</span>:<span class="number">21</span>], <span class="number">1&#x27;b0</span>&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            `OPCODE_STYPE: <span class="keyword">begin</span>  <span class="comment">// S-type</span></span><br><span class="line">                imm_out = &#123;&#123;<span class="number">20</span>&#123;instr[<span class="number">31</span>]&#125;&#125;, instr[<span class="number">31</span>:<span class="number">25</span>], instr[<span class="number">11</span>:<span class="number">7</span>]&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            `OPCODE_AUIPC, `OPCODE_LUI: <span class="keyword">begin</span>  <span class="comment">// U-type</span></span><br><span class="line">                imm_out = &#123;instr[<span class="number">31</span>:<span class="number">12</span>], <span class="number">12&#x27;b0</span>&#125;;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">begin</span></span><br><span class="line">                imm_out = <span class="number">32&#x27;b0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œä½ ä¹Ÿå®Œå…¨å¯ä»¥åªä¼ é€’PCç„¶åå†EXçº§è¿›è¡Œç§»ä½ï¼Œæˆ–è€…å¹²è„†åˆå¹¶è¿›ALUã€‚ä½†æ˜¯ï¼Œæµæ°´çº¿å»¶è¿Ÿæœ€å¤§çš„ä¸€çº§å¾€å¾€å°±æ˜¯EXçº§ï¼Œåº”å½“å°½å¯èƒ½åœ°å‡è½»å…¶è´Ÿæ‹…ã€‚æ‰€ä»¥ï¼Œå°†ç§»ä½å™¨å¾€å‰ç§»ã€æœªæ¥çš„å­˜å–å•å…ƒå¾€åç§»ã€‚</p><h2 id="ID-EXçº§-æµæ°´çº¿å¯„å­˜å™¨-PR-ID-EX-sv">ID/EXçº§ æµæ°´çº¿å¯„å­˜å™¨ PR_ID_EX.sv</h2><p>ç»ˆäºï¼Œè¦è¿›å…¥ä¸‹ä¸€é˜¶æ®µäº†ã€‚ID/EXçº§çš„æµæ°´çº¿å¯„å­˜å™¨å¯è°“æ˜¯ç›¸å½“é‡è¦ï¼Œé‡è¦æ€§ä»…æ¬¡äºEX/MEMçº§ï¼Œå› ä¸ºè¿™ä¸€çº§ä¸­è½¬äº†å„ç±»æ•°æ®ä»¥åŠåœ°å€â€”â€”è¿˜æœ‰æœªæ¥çš„æ•°æ®å‰é€’å…¥å£ã€‚</p><p>æˆ‘ä»¬è¦æ¥æ”¶è¯‘ç å™¨ä¼ å‡ºçš„å„ç§æ§åˆ¶ä¿¡å·ï¼ŒåŒ…æ‹¬ALUçš„æ“ä½œæ•°æ¥æº<code>is_auipc</code>å’Œ<code>alu_src</code>ã€‚æ ¹æ®è¯‘ç å™¨åˆ¤æ–­ï¼Œå¯¹äºS-TypeæŒ‡ä»¤ï¼Œåœ¨MEMçº§è¿˜éœ€è¦å†™å…¥DRAMï¼Œå› æ­¤è¿˜æœ‰å†™ä½¿èƒ½<code>dram_we</code>ï¼Œæˆ–è€…æ˜¯å¯„å­˜å™¨å†™ä½¿èƒ½<code>rf_we</code>ã€‚</p><p>è¿˜æœ‰ä»€ä¹ˆï¼Ÿåˆ«å¿˜äº†åˆ¤æ–­æŒ‡ä»¤å­˜å–ç±»å‹çš„<code>sl_type</code>ï¼Œåé¢éœ€è¦åœ¨MEMçº§ç”¨åˆ°ã€‚</p><div class="note warning flat"><p>å³ä½¿RISC-Vä¸å¼ºåˆ¶è¦æ±‚æ”¯æŒéå¯¹é½è®¿å­˜ï¼Œ<code>lb/lh</code>ç­‰æŒ‡ä»¤ä¹Ÿå¿…é¡»æ”¯æŒï¼</p></div><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> PR_ID_EX (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// æµæ°´çº¿æ§åˆ¶ä¿¡å·</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        flush,</span><br><span class="line">    <span class="comment">// IDçº§è¾“å…¥</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_id_i,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_id_i,</span><br><span class="line">    <span class="comment">// input  logic [31:0] instr_id_i,</span></span><br><span class="line">    <span class="comment">// IDçº§è¾“å‡º ç»™EXçº§è¾“å…¥</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_ex_o,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_ex_o,</span><br><span class="line">    <span class="comment">// output logic [31:0] instr_ex_o,</span></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æŒ‡ä»¤æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">    <span class="comment">// æµæ°´çº¿å†²åˆ·æ—¶éœ€è¦å°†æŒ‡ä»¤ç½®ä¸ºæ— æ•ˆ</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        instr_valid_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        instr_valid_ex_o,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯„å­˜å™¨å †ç¬¬ä¸€å¯„å­˜å™¨æ•°æ®</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD1_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD1_o,</span><br><span class="line">    <span class="comment">// å¯„å­˜å™¨å †ç¬¬äºŒå¯„å­˜å™¨æ•°æ®</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD2_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] rD2_o,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALUOp</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] alu_op_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] alu_op_ex_o,</span><br><span class="line">    <span class="comment">// ALUç¬¬ä¸€æ“ä½œæ•°æ¥æº åˆ¤æ–­AUIPC</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        is_auipc_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        is_auipc_ex_o,</span><br><span class="line">    <span class="comment">// ALUç¬¬äºŒæ“ä½œæ•°æ¥æº</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        alu_src2_sel_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        alu_src2_sel_ex_o,</span><br><span class="line">    <span class="comment">// å†™ä½¿èƒ½</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        dram_we_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        dram_we_ex_o,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rf_we_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        rf_we_ex_o,</span><br><span class="line">    <span class="comment">// å†™å›æ•°æ®æ¥æº</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] wd_sel_ex_o,</span><br><span class="line">    <span class="comment">// å†™å›å¯„å­˜å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wr_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">4</span>:<span class="number">0</span>] wr_ex_o,</span><br><span class="line">    <span class="comment">// åˆ†æ”¯è·³è½¬</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        is_branch_instr_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        is_branch_instr_ex_o,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">2</span>:<span class="number">0</span>] branch_type_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">2</span>:<span class="number">0</span>] branch_type_ex_o,</span><br><span class="line">    <span class="comment">// è·³è½¬ç›¸å…³</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] jump_type_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">1</span>:<span class="number">0</span>] jump_type_ex_o,</span><br><span class="line">    <span class="comment">// è¯»å–ç±»å‹</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [ <span class="number">3</span>:<span class="number">0</span>] sl_type_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [ <span class="number">3</span>:<span class="number">0</span>] sl_type_ex_o,</span><br><span class="line">    <span class="comment">// ç«‹å³æ•°</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] imm_ex_o,</span><br><span class="line">    <span class="comment">// PCè·³è½¬æ—¶åœ°å€</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_jump_id_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_jump_ex_o</span><br><span class="line">);</span><br><span class="line">    <span class="keyword">always_ff</span>@(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯„å­˜å™¨å †æ•°æ®</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            rD1_o &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            rD2_o &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> b</span><br><span class="line">            rD1_o &lt;= rD1_i;</span><br><span class="line">            rD2_o &lt;= rD2_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†æ”¯è·³è½¬ç›¸å…³</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            is_branch_instr_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            branch_type_ex_o     &lt;= <span class="number">3&#x27;b0</span>;</span><br><span class="line">            jump_type_ex_o       &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush) <span class="keyword">begin</span></span><br><span class="line">            is_branch_instr_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            branch_type_ex_o     &lt;= <span class="number">3&#x27;b0</span>;</span><br><span class="line">            jump_type_ex_o       &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            is_branch_instr_ex_o &lt;= is_branch_instr_id_i;</span><br><span class="line">            branch_type_ex_o     &lt;= branch_type_id_i;</span><br><span class="line">            jump_type_ex_o       &lt;= jump_type_id_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ALUOpç›¸å…³</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            alu_op_ex_o       &lt;= <span class="number">4&#x27;b0</span>;</span><br><span class="line">            is_auipc_ex_o     &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            alu_src2_sel_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            dram_we_ex_o      &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            sl_type_ex_o      &lt;= <span class="number">3&#x27;b0</span>;</span><br><span class="line">            imm_ex_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush) <span class="keyword">begin</span></span><br><span class="line">            alu_op_ex_o       &lt;= <span class="number">4&#x27;b0</span>;</span><br><span class="line">            is_auipc_ex_o     &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            alu_src2_sel_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            dram_we_ex_o      &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            sl_type_ex_o      &lt;= sl_type_id_i;</span><br><span class="line">            imm_ex_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            alu_op_ex_o       &lt;= alu_op_id_i;</span><br><span class="line">            is_auipc_ex_o     &lt;= is_auipc_id_i;</span><br><span class="line">            alu_src2_sel_ex_o &lt;= alu_src2_sel_id_i;</span><br><span class="line">            dram_we_ex_o      &lt;= dram_we_id_i;</span><br><span class="line">            sl_type_ex_o      &lt;= sl_type_id_i;</span><br><span class="line">            imm_ex_o          &lt;= imm_id_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™å›æ¥æº</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            pc_ex_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            pc4_ex_o         &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_valid_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">            rf_we_ex_o       &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            wd_sel_ex_o      &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">            pc_jump_ex_o     &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush &amp;&amp; pc_id_i) <span class="keyword">begin</span>  <span class="comment">// ç¡®ä¿ä¸æ˜¯å› ä¸ºæµæ°´çº¿æš‚åœå¼•èµ·çš„å†²åˆ·</span></span><br><span class="line">            pc_ex_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            pc4_ex_o         &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_valid_ex_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">            rf_we_ex_o       &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">            wd_sel_ex_o      &lt;= <span class="number">2&#x27;b0</span>;</span><br><span class="line">            pc_jump_ex_o     &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            pc_ex_o          &lt;= pc_id_i;</span><br><span class="line">            pc4_ex_o         &lt;= pc4_id_i;</span><br><span class="line">            instr_valid_ex_o &lt;= instr_valid_id_i;</span><br><span class="line"></span><br><span class="line">            rf_we_ex_o       &lt;= rf_we_id_i;</span><br><span class="line">            wd_sel_ex_o      &lt;= wd_sel_id_i;</span><br><span class="line">            pc_jump_ex_o     &lt;= pc_jump_id_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™å›å¯„å­˜å™¨åœ°å€</span></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            wr_ex_o &lt;= <span class="number">5&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush) <span class="keyword">begin</span></span><br><span class="line">            wr_ex_o &lt;= <span class="number">5&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            wr_ex_o &lt;= wr_id_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒIDçº§ä¹Ÿæ„å»ºå®Œæˆäº†ã€‚åé¢çš„ï¼Œå°±æ˜¯å¤æ‚çš„è®¡ç®—ã€ç–¯ç‹‚çš„å‰é€’ã€å‰åˆ—çš„<s>æ•°æ®</s>æ–—äº‰äº†ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è¯‘ç -IDçº§-è®¾è®¡&quot;&gt;è¯‘ç  IDçº§ è®¾è®¡&lt;/h2&gt;
&lt;p&gt;æåˆ°è¯‘ç çº§ï¼Œé‚£å°±å¾—æ˜¯è¯‘ç å™¨å•Šã€‚çº¯ç»„åˆé€»è¾‘ï¼ŒåŒ…ä½ å†™åˆ°çˆ½ã€‚&lt;/p&gt;
&lt;p&gt;è¯‘ç çº§è¿˜æœ‰ä»€ä¹ˆï¼Ÿç«‹å³æ•°ç§»ä½ä¹Ÿéœ€è¦æ”¾åœ¨IDçº§ï¼Œä»¥å‡è½»EXçº§</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="åµŒå…¥å¼" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="è®¡ç®—æœºåŸç†" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>ä»é›¶å¼€å§‹å­¦RISCï¼šç¬¬å››ç¯‡</title>
    <link href="https://blog.esing.dev/2025/12/05/riscvcod-p4/"/>
    <id>https://blog.esing.dev/2025/12/05/riscvcod-p4/</id>
    <published>2025-12-05T15:02:05.000Z</published>
    <updated>2025-12-10T13:36:19.405Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»é›¶æ„å»ºå‰çš„å‡†å¤‡">ä»é›¶æ„å»ºå‰çš„å‡†å¤‡</h2><h3 id="è®¾è®¡æ€è·¯">è®¾è®¡æ€è·¯</h3><p>ç†è®ºçŸ¥è¯†å·²ç»å‡†å¤‡å¥½äº†ï¼Œæ¥ä¸‹æ¥è¯¥å¼€å§‹å®è·µäº†ã€‚</p><p>å¦‚ä½•ä»é›¶å¼€å§‹å†™ä¸€ä¸ªCPUï¼Ÿ</p><p>é¦–å…ˆè¦æ˜ç¡®ISAæ¶æ„ï¼šæˆ‘ä»¬éœ€è¦æ”¯æŒå“ªäº›æŒ‡ä»¤ï¼ŸRV32çš„æ‹“å±•å¾ˆå¤šå¾ˆå¤šï¼Œæ¯”å¦‚<code>MIAFD</code>ç­‰ç­‰ã€‚æˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªâ€œç²¾ç®€ç‰ˆâ€çš„<code>RV32I</code>æŒ‡ä»¤é›†CPUâ€”â€”è¿é‡Œé¢çš„<code>ecall</code>å’Œ<code>ebreak</code>éƒ½ä¸å®ç°ã€‚åªè¦æ»¡è¶³åŸºç¡€çš„38æ¡ï¼ˆç”šè‡³åªæ”¯æŒ<code>lw/sw</code>ï¼Œä¸è€ƒè™‘éå¯¹é½è®¿å­˜ï¼‰ï¼Œå°±èƒ½è¿è¡Œ80%çš„Cè¯­è¨€ç¨‹åºã€‚è‡³äº<code>Zicsr</code>æ‰©å±•å’Œ<code>M</code>æ‰©å±•ç­‰ï¼Œåœ¨æ„å»ºå®Œæ¯•åå†è€ƒè™‘ã€‚</p><p>ç„¶åï¼Œæ˜¯å¾®æ¶æ„è®¾è®¡ï¼šæ˜¯åšå•å‘¨æœŸè¿˜æ˜¯å¤šå‘¨æœŸï¼Œäº¦æˆ–è€…æµæ°´çº¿ï¼Ÿæ˜¯åšé¡ºåºè¿˜æ˜¯ä¹±åºï¼Ÿå•å‘å°„è¿˜æ˜¯å¤šå‘å°„ï¼Ÿé¥­è¦ä¸€å£å£åƒï¼Œæ­¥å­è¿ˆå¤ªå¤§äº†å®¹æ˜“æ‰¯ç€è›‹ã€‚å› æ­¤ï¼Œåšä¸€ä¸ªç»å…¸çš„äº”çº§æµæ°´çº¿ã€é¡ºåºå•å‘å°„çš„CPUå³å¯ã€‚</p><p>ç„¶åï¼Œä¿æŒä¸€ä¸ªæ¸…é†’çš„å¤´è„‘ã€‚å³ä½¿æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„<code>RV32I</code>CPUï¼Œä¹Ÿéœ€è¦ä¸ä¸‹äº10ä¸ªæ¨¡å—ã€‚æ‰€æœ‰çš„ä»£ç åŠ èµ·æ¥å¯èƒ½è¿3000è¡Œéƒ½ä¸åˆ°ï¼Œä½†æ˜¯å…¶ä¸­çš„è¿çº¿æ— æ¯”å¤æ‚ã€‚å¦‚æœä¸åœ¨å†™ä¹‹å‰å°±æƒ³å¥½ï¼Œå¾ˆå®¹æ˜“è«åå…¶å¦™åœ°ä¸¢æ‰ä¸€æ¡è¿çº¿ã€ä¸€ä¸ªç«¯å£ï¼Œç„¶åçœ‹æ³¢å½¢debugåŠå¤©ã€‚</p><p>æ—¶åˆ»è¦è®°ä½ï¼šåˆ‡ä¸å¯â€œåªè§æ ‘æœ¨ã€ä¸è§æ£®æ—â€â€”â€”ä¸å»ºè®®ä¸€ä¸ªä¸€ä¸ªæ¨¡å—å†™ï¼Œè€Œæ˜¯åˆ›å»ºå¥½æ–‡ä»¶åé—®è‡ªå·±ï¼š</p><ul><li>è¿™ä¸ªæ¨¡å—çš„åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>è¿™ä¸ªæ¨¡å—æ˜¯ç»„åˆé€»è¾‘ç”µè·¯è¿˜æ˜¯æ—¶åºé€»è¾‘ç”µè·¯ï¼Ÿ</li><li>è¿™ä¸ªæ¨¡å—éœ€è¦å“ªäº›æ§åˆ¶ä¿¡å·ï¼Ÿ</li><li>è¿™ä¸ªæ¨¡å—éœ€è¦è¾“å‡ºä»€ä¹ˆæ•°æ®ï¼Ÿè¾“å‡ºç»™è°ï¼Ÿ</li></ul><p>è¾¹è€ƒè™‘è¿™äº›é—®é¢˜è¾¹åˆ›å»ºæ–‡ä»¶ï¼Œç„¶åï¼Œç±»ä¼¼å‚è€ƒä¹¦ä¸Šçš„æŒ‡å¯¼ï¼Œæ„å»ºæ•°æ®é€šè·¯ã€‚å¯ä»¥ä¸å†™å‡ºæ¥ï¼Œä½†è¦æƒ³æ¸…æ¥šï¼Œå“ªäº›æ•°æ®ä¼šåœ¨å¯„å­˜å™¨ä¹‹é—´æµåŠ¨ï¼Œå¹¶è¢«ä¼ é€’åˆ°ä¸‹ä¸€çº§æµæ°´çº¿ã€‚ç­‰æ¯ä¸ªæ–‡ä»¶çš„å¤§ä½“æ¡†æ¶æ­å»ºå®Œæ¯•ï¼Œå†ä»æ˜“åˆ°éš¾ã€ä»ç»„åˆé€»è¾‘åˆ°æ—¶åºé€»è¾‘å®Œæˆã€‚ä¸€çº§ä¸€çº§æµæ°´çº¿å‘å‰æ¨è¿›ï¼Œå†™å®ŒæŸä¸€çº§åç»§ç»­å®Œæˆä¸¤çº§ä¹‹é—´çš„æµæ°´çº¿å¯„å­˜å™¨è®¾è®¡ã€‚</p><h3 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h3><p><a href="https://github.com/xuanhao44/HITSZ-miniRVCPU">xuanhao44 - HITSZ-miniRVCPU</a></p><h3 id="å¼€å‘ç¯å¢ƒ">å¼€å‘ç¯å¢ƒ</h3><p>å‚è€ƒ <a href="/2024/01/18/vscode-verilog-setup/" title="VSCodeé…ç½®Verilogå¼€å‘ç¯å¢ƒ">VSCodeé…ç½®Verilogå¼€å‘ç¯å¢ƒ</a> å³å¯ã€‚</p><div class="note primary flat"><p>è¿™é‡Œå®‰åˆ©ä¸€ä¸‹ä¸€ä¸ªè¶…çº§æ£’çš„çš„VSCodeæ’ä»¶ï¼š<a href="https://marketplace.visualstudio.com/items?itemName=sterben.fpga-support">Digital IDE</a></p><p>å†…éƒ¨é›†æˆäº†ä¸€ä»¶æ¨¡å—æµ‹è¯•ã€ä»£ç é«˜äº®ä¸æ ¼å¼åŒ–ã€å¿«é€Ÿè·³è½¬ç­‰ã€‚è™½ç„¶ç”Ÿæˆæ¨¡å—å›¾çš„åŠŸèƒ½æœ‰äº›BUGï¼Œä½†æ˜¯ä¾æ—§éå¸¸å¼ºï¼Œç‘•ä¸æ©ç‘œï¼</p><p>ç°åœ¨å†™Verilogéƒ½ç”¨å®ƒäº†ã€‚ç»èµï¼</p></div><h2 id="å–æŒ‡-IFçº§-è®¾è®¡">å–æŒ‡ IFçº§ è®¾è®¡</h2><p>IFçº§å–å‡ºæŒ‡ä»¤ï¼Œå› æ­¤æ¨¡å—å¾ˆå°‘ï¼Œåªè¦å®ç°PCç¨‹åºè®¡æ•°å™¨å’ŒIROMå³å¯ã€‚</p><h3 id="ç¨‹åºè®¡æ•°å™¨-PC-sv">ç¨‹åºè®¡æ•°å™¨ PC.sv</h3><p>æ˜¾ç„¶ï¼Œç¨‹åºè®¡æ•°å™¨æ˜¯<strong>æ—¶åºé€»è¾‘æ¨¡å—</strong>ã€‚è¿™é‡Œå°†<code>PC+4</code>çš„è®¡ç®—ä¹Ÿåˆå¹¶åˆ°PCæ¨¡å—å†…ã€‚</p><p>ç¨‹åºè®¡æ•°å™¨è¦å¹²ä»€ä¹ˆï¼Ÿæ—¢è¦è®¡ç®—å‡ºä¸‹ä¸€æ—¶åˆ»çš„PCï¼Œè¿˜è¦è€ƒè™‘æ˜¯å¦å‘ç”Ÿåˆ†æ”¯è·³è½¬â€”â€”è¿™é‡Œè¦æ¥å—æ¥è‡ª<code>EX</code>çº§çš„è·³è½¬å‘ç”Ÿä¿¡å·ï¼Œå› ä¸ºB-Typeç±»æŒ‡ä»¤åˆ°<code>EX</code>çº§æ‰èƒ½å¾—å‡ºç»“æœã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> PC (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// æ˜¯å¦è¦æ‰“ä¸€æ‹ ä¿æŒPC </span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        keep_pc,</span><br><span class="line">    <span class="comment">// è¿›è¡Œåˆ†æ”¯è·³è½¬</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        branch_op,</span><br><span class="line">    <span class="comment">// åˆ†æ”¯è·³è½¬ç›®æ ‡åœ°å€</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] branch_target,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_if,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_if</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] npc;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        pc4_if = pc_if + <span class="number">4</span>;</span><br><span class="line">        npc    = branch_op ? branch_target : pc4_if;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n)       pc_if &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (keep_pc) pc_if &lt;= pc_if;</span><br><span class="line">        <span class="keyword">else</span>              pc_if &lt;= npc;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æŒ‡ä»¤å­˜å‚¨å™¨-IROM-sv">æŒ‡ä»¤å­˜å‚¨å™¨ IROM.sv</h3><p>IROMå³å­˜æ”¾ç¨‹åºä»£ç çš„Flashï¼Œåªè¯»ï¼Œä¸ä¾èµ–ä»»ä½•æ—¶é’Ÿä¿¡å·ï¼Œå› æ­¤æ˜¯<strong>ç»„åˆé€»è¾‘æ¨¡å—</strong>ã€‚é€šå¸¸æ¥è¯´ï¼ŒIROMï¼ˆæŒ‡ä»¤å­˜å‚¨å™¨ï¼‰ä¼šè¢«æ”¾åœ¨è¯‘ç çº§ï¼Œä½†ä¸è‡ªè¡Œå°è£…æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¼šç»™CPUæ¥å‡º<code>instr</code>å’Œ<code>pc</code>åˆ°å‚å•†çš„ IROM IPæ ¸ã€‚ä¸ºäº†æ–¹ä¾¿æ€è€ƒï¼Œæ­¤å¤„æ”¾åœ¨IFçº§å³å¯ã€‚ä¸ºäº†ä¾¿äºä»¿çœŸï¼Œè¿™é‡Œè‡ªå·±å®ç°ä¸€ä¸ªæ”¯æŒåŠ è½½hexæ–‡ä»¶çš„IROMã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// IROM è¡Œä¸ºæ¨¡å‹ - ç”¨äºä»¿çœŸ</span></span><br><span class="line"><span class="comment">// æ›¿ä»£ Xilinx IP æ ¸</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> IROM (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">wire</span> [<span class="number">13</span>:<span class="number">0</span>] a,   <span class="comment">// åœ°å€è¾“å…¥ (14ä½ = 16K words)</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span>  [<span class="number">31</span>:<span class="number">0</span>] spo  <span class="comment">// æ•°æ®è¾“å‡º</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‡ä»¤å­˜å‚¨å™¨ - 16K x 32bit</span></span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] rom_data[<span class="number">16384</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ–‡ä»¶åŠ è½½æŒ‡ä»¤</span></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">integer</span> i;</span><br><span class="line">        <span class="keyword">string</span>  rom_file;  <span class="comment">// å­—ç¬¦ä¸²ç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">16384</span>; i = i + <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// rom_data[i] = 32&#x27;h00000013;  // NOP</span></span><br><span class="line">            rom_data[i] = <span class="number">32&#x27;h0d000721</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°è¯•ä»æ–‡ä»¶åŠ è½½æŒ‡ä»¤</span></span><br><span class="line">        <span class="comment">// if ($value$plusargs(&quot;IROM=%s&quot;, rom_file)) begin</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">            rom_file =</span><br><span class="line">            <span class="comment">// &quot;user/data/hex/simple_test.hex&quot;</span></span><br><span class="line">            <span class="string">&quot;user/data/hex/jalr.hex&quot;</span></span><br><span class="line">            <span class="comment">// &quot;user/data/hex/myFirstTest.hex&quot;</span></span><br><span class="line">            <span class="comment">// &quot;user/data/hex/no_hazard.hex&quot;</span></span><br><span class="line">            <span class="comment">// &quot;user/data/hex/loaduse_test.hex&quot;</span></span><br><span class="line">            <span class="comment">// &quot;user/data/hex/hazard12.hex&quot;</span></span><br><span class="line">            ;</span><br><span class="line">            <span class="built_in">$readmemh</span>(rom_file, rom_data);</span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;IROM: Loaded instructions from %s&quot;</span>, rom_file);</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// å¦‚æœæ²¡æœ‰æŒ‡å®šæ–‡ä»¶,åŠ è½½é»˜è®¤çš„æµ‹è¯•ç¨‹åº</span></span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;IROM: Loading default test program&quot;</span>);</span><br><span class="line">            load_default_program();</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ•°æ® (ç»„åˆé€»è¾‘)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_comb</span> <span class="keyword">begin</span></span><br><span class="line">        spo = rom_data[a];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ è½½é»˜è®¤æµ‹è¯•ç¨‹åº</span></span><br><span class="line">    <span class="keyword">task</span> <span class="keyword">automatic</span> load_default_program;</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="comment">// æ›´å¤æ‚çš„æµ‹è¯•ç¨‹åº - æµ‹è¯•ç®—æœ¯ã€é€»è¾‘ã€ç§»ä½æŒ‡ä»¤å’Œæ•°æ®å†’é™©</span></span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;IROM: Default test program loaded&quot;</span>);</span><br><span class="line">            rom_data[<span class="number">0</span>] = <span class="number">32&#x27;h00500093</span>;  <span class="comment">// addi x1, x0, 5      x1 = 5</span></span><br><span class="line">            rom_data[<span class="number">1</span>] = <span class="number">32&#x27;h00300113</span>;  <span class="comment">// addi x2, x0, 3      x2 = 3</span></span><br><span class="line">            rom_data[<span class="number">2</span>] = <span class="number">32&#x27;h002081b3</span>;  <span class="comment">// add  x3, x1, x2     x3 = x1 + x2 = 8</span></span><br><span class="line">            rom_data[<span class="number">3</span>] = <span class="number">32&#x27;h40208233</span>;  <span class="comment">// sub  x4, x1, x2     x4 = x1 - x2 = 2</span></span><br><span class="line">            rom_data[<span class="number">4</span>] = <span class="number">32&#x27;h0020f2b3</span>;  <span class="comment">// and  x5, x1, x2     x5 = x1 &amp; x2 = 1</span></span><br><span class="line">            rom_data[<span class="number">5</span>] = <span class="number">32&#x27;h0020e333</span>;  <span class="comment">// or   x6, x1, x2     x6 = x1 | x2 = 7</span></span><br><span class="line">            rom_data[<span class="number">6</span>] = <span class="number">32&#x27;h002093b3</span>;  <span class="comment">// sll  x7, x1, x2     x7 = x1 &lt;&lt; x2 = 40</span></span><br><span class="line">            rom_data[<span class="number">7</span>] = <span class="number">32&#x27;h0020c433</span>;  <span class="comment">// xor  x8, x1, x2     x8 = x1 ^ x2 = 6</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">endtask</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>hexæ–‡ä»¶åŠ è½½æ–¹å¼å¯ä»¥é€‰æ‹©æ‰‹åŠ¨æŒ‡å®šè·¯å¾„ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ç¼–è¯‘æ—¶ä¼ å…¥ï¼Œåè€…é…åˆMakefileæ–‡ä»¶å¾ˆæ–¹ä¾¿ï¼Œä¸è¿‡æˆ‘é€‰æ‹©DIDEçš„ä¸€é”®ä»¿çœŸã€‚</p><h2 id="IF-IDçº§-æµæ°´çº¿å¯„å­˜å™¨-PR-IF-ID-sv">IF/IDçº§ æµæ°´çº¿å¯„å­˜å™¨ PR_IF_ID.sv</h2><p>ç»ˆäºåˆ°äº†ç¬¬ä¸€é“åï¼šä¸¤çº§ä¹‹é—´çš„æµæ°´çº¿å¯„å­˜å™¨ã€‚</p><p>æµæ°´çº¿å¯„å­˜å™¨èµ·åˆ°ä¸€ä¸ªæ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼Œåœ¨ä¸¤ä¸ªé˜¶æ®µä¹‹é—´ä¿å­˜æ•°æ®ï¼Œä½¿å¾—æŒ‡ä»¤å¯ä»¥è¿ç»­æ‰§è¡Œã€‚</p><p>éƒ½å¯„å­˜å™¨äº†ï¼Œé‚£è‚¯å®šæ˜¯<strong>æ—¶åºé€»è¾‘æ¨¡å—</strong>äº†ã€‚</p><p>æˆ‘ä»¬éœ€è¦å“ªäº›ä¿¡å·ï¼Ÿ</p><p>é¦–å…ˆæ˜¯<code>PC</code>å’Œ<code>PC+4</code>ï¼Œå…¶ä¸­<code>PC+4</code>å› ä¸ºåˆ†æ”¯è·³è½¬å’Œ<code>jal/jalr</code>æŒ‡ä»¤çš„éœ€æ±‚ï¼Œè¦ä¸€ç›´é€åˆ°<code>EX</code>çº§ã€‚æ¥ç€æ˜¯å½“å‰çš„æŒ‡ä»¤ï¼Œè¦é€å…¥ä¸‹ä¸€çº§çš„è¯‘ç å™¨ã€‚</p><p>è¿˜æœ‰ä»€ä¹ˆï¼Ÿæˆ‘ä»¬è‚¯å®šéœ€è¦å¤„ç†æµæ°´çº¿çš„ç«äº‰å†’é™©ï¼Œè€Œä¸èƒ½ç®€å•æ‰“ä¸€æ‹â€”â€”å°±ç®—æ‰“ä¸€æ‹ï¼Œä¹Ÿè¦æœ‰ç›¸åº”çš„æ§åˆ¶ä¿¡å·ã€‚å› æ­¤ï¼Œè¿˜éœ€è¦<code>flush</code>å’Œ<code>stall</code>è¿™ä¸¤ä¸ªæ§åˆ¶ä¿¡å·ï¼Œæ¥æ§åˆ¶IFçº§æ˜¯å¦å†²åˆ·ã€æ˜¯å¦åœé¡¿ã€‚</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;./<span class="keyword">include</span>/defines.svh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> PR_IF_ID (</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        clk,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        rst_n,</span><br><span class="line">    <span class="comment">// æµæ°´çº¿æ§åˆ¶ä¿¡å·</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        flush,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        stall,</span><br><span class="line">    <span class="comment">// IFçº§è¾“å…¥</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_if_i,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_if_i,</span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instr_if_i,</span><br><span class="line">    <span class="comment">// IFçº§è¾“å‡º ç»™IDçº§è¾“å…¥</span></span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc_id_o,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] pc4_id_o,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span> [<span class="number">31</span>:<span class="number">0</span>] instr_id_o,</span><br><span class="line">    <span class="comment">// åˆ¤æ–­æŒ‡ä»¤æ˜¯å¦æœ‰æ•ˆ</span></span><br><span class="line">    <span class="comment">// æµæ°´çº¿å†²åˆ·æ—¶éœ€è¦å°†æŒ‡ä»¤ç½®ä¸ºæ— æ•ˆ</span></span><br><span class="line">    <span class="keyword">input</span>  <span class="keyword">logic</span>        instr_valid_if_i,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">logic</span>        instr_valid_id_o</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">always_ff</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> rst_n) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (!rst_n) <span class="keyword">begin</span></span><br><span class="line">            pc_id_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            pc4_id_o         &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_id_o       &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_valid_id_o &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (flush) <span class="keyword">begin</span></span><br><span class="line">            pc_id_o          &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            pc4_id_o         &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_id_o       &lt;= <span class="number">32&#x27;b0</span>;</span><br><span class="line">            instr_valid_id_o &lt;= <span class="number">1&#x27;b0</span>;  <span class="comment">// å†²åˆ·æ—¶æŒ‡ä»¤æ— æ•ˆ</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (stall) <span class="keyword">begin</span></span><br><span class="line">            pc_id_o          &lt;= pc_id_o;</span><br><span class="line">            pc4_id_o         &lt;= pc4_id_o;</span><br><span class="line">            instr_id_o       &lt;= instr_id_o;</span><br><span class="line">            instr_valid_id_o &lt;= instr_valid_id_o;</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            pc_id_o          &lt;= pc_if_i;</span><br><span class="line">            pc4_id_o         &lt;= pc4_if_i;</span><br><span class="line">            instr_id_o       &lt;= instr_if_i;</span><br><span class="line">            instr_valid_id_o &lt;= instr_valid_if_i;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼ŒIFçº§å®Œæ¯•ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä»é›¶æ„å»ºå‰çš„å‡†å¤‡&quot;&gt;ä»é›¶æ„å»ºå‰çš„å‡†å¤‡&lt;/h2&gt;
&lt;h3 id=&quot;è®¾è®¡æ€è·¯&quot;&gt;è®¾è®¡æ€è·¯&lt;/h3&gt;
&lt;p&gt;ç†è®ºçŸ¥è¯†å·²ç»å‡†å¤‡å¥½äº†ï¼Œæ¥ä¸‹æ¥è¯¥å¼€å§‹å®è·µäº†ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚ä½•ä»é›¶å¼€å§‹å†™ä¸€ä¸ªCPU</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="åµŒå…¥å¼" scheme="https://blog.esing.dev/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="è®¡ç®—æœºåŸç†" scheme="https://blog.esing.dev/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="RISC-V" scheme="https://blog.esing.dev/tags/RISC-V/"/>
    
    <category term="SystemVerilog" scheme="https://blog.esing.dev/tags/SystemVerilog/"/>
    
  </entry>
  
  <entry>
    <title>Cloudflareã€ç¡è¦ºâ€”â€”å¤§è§„æ¨¡å®•æœºåçš„éšæƒ³</title>
    <link href="https://blog.esing.dev/2025/11/18/cloudflare-offline-oneday/"/>
    <id>https://blog.esing.dev/2025/11/18/cloudflare-offline-oneday/</id>
    <published>2025-11-18T14:45:37.000Z</published>
    <updated>2025-11-19T02:56:36.593Z</updated>
    
    <content type="html"><![CDATA[<div class="note orange icon-padding flat"><i class="note-icon fab fa-cloudflare"></i><p>å†™äº2025.11.18ï¼Œçºªå¿µ Cloudflare å‘ç”Ÿçš„å¤§è§„æ¨¡æ•…éšœã€‚</p></div><p>ä»Šå¹´çœŸæ˜¯ä¸ªå¤šäº‹ä¹‹å¹´å•Šã€‚</p><p>å¼€ç€ç»„ä¼šå‘¢ï¼Œç½‘ç«™çªç„¶å°±æ‰“ä¸å¼€äº†ï¼Œæ¥ç€å°±æ˜¯ç†Ÿæ‚‰çš„å°é»„äº‘500ã€‚è¿˜ä»¥ä¸ºæ˜¯æºç«™æŒ‚äº†ï¼Œéšå³å…³äº†æµè§ˆå™¨å†å¼€ã€‚å¥½å®¶ä¼™ï¼ŒGPTä¹Ÿå¡åœ¨å‰é¢çš„Cloudflare Challenge è®¤è¯ç•Œé¢ã€‚è¿™æ‰æ„è¯†åˆ°ï¼šCloudflareï¼Œå¤§æŠµæ˜¯åˆ<strong>ç‚¸</strong>äº†ã€‚è€Œè¿™ï¼Œå·²ç»æ˜¯ä»Šå¹´çš„ç¬¬ä¸‰æ¬¡äº†ã€‚</p><p><strong>ç½‘ç»œè©è¨ã€èµ›åšä¹‰çˆ¶ï¼Œç»ˆç©¶è¦é¡¶ä¸ä½è¿™æ³¼å¤©çš„â€œæµé‡â€äº†å—ã€‚</strong></p><hr><p>ç¿»äº†ä¸‹Telegramï¼Œå‡ ä¹æ‰€æœ‰ç¾¤ç»„éƒ½ç‚¸é”…äº†ï¼šâ€œCloudflareâ€ â€œå®•æœºâ€ â€œæ”»å‡»â€ çš„å­—æ ·å±‚å‡ºä¸ç©·ã€‚è°ä¹Ÿä¸çŸ¥é“ï¼Œç©¶ç«Ÿæ˜¯ä¸€ä¸ªå‘˜å·¥çš„æ— å¿ƒä¹‹ä¸¾ï¼Œè¿˜æ˜¯ä¸€ä¸ªéƒ¨é—¨çš„ä¸€æ¬¡éƒ¨ç½²å¤±è¯¯ï¼Œäº¦æˆ–æ˜¯ä»€ä¹ˆç»„ç»‡çš„å¤§è§„æ¨¡ç½‘ç»œæ”»å‡»ï¼Œå¯¼è‡´äº†è¿™ä¸€åœºç¾éš¾ã€‚å¾®ä¿¡ç¾¤é‡ŒåŒæ ·ç‚¸äº†é”…ï¼šåŒå­¦åš·åš·ç€è‡ªå·±çœ‹æ–‡çŒ®çš„ç½‘ç«™æ‰“ä¸å¼€ã€ChatGPTè¿›ä¸å»â€¦â€¦å°±è¿æˆ‘çš„åšå®¢å’Œä¸€ç³»åˆ—Cloudflare WorkersæœåŠ¡ä¹Ÿæ²¡èƒ½å¹¸å…äºéš¾ï¼Œåªå‰©ä¸‹äº†å‰å‡ å¤©æ–°æ­å»ºçš„ <a href="/2025/10/31/onelastkiss-image/" title="One Last Kiss é£æ ¼å›¾ç‰‡ç”Ÿæˆ">OneLastKissç”Ÿæˆå™¨</a> è¿˜æ´»ç€ TuT</p><p>çœ‹ç€<a href="https://www.cloudflarestatus.com/">Cloudflare Status</a>é‚£è‰²å½©ç¼¤çº·çš„<span style="color:#DA304C;">ä¸‰</span><span style="color:#FBAE40;">è‰²</span><span style="color:#2C7CB0;">æ¡</span>ï¼Œæˆ‘ä¸ç”±å¾—å¸Œæœ›ï¼Œä»Šå¹´ç»“æŸä¹‹å‰ä¸è¦å†è§åˆ°å®ƒã€‚</p><img src="https://webp.esing.dev/img/-6116001428162677917_119_251118_2311_fD5D.jpg" alt="MJJæœ€ä¸æƒ³çœ‹è§çš„é¢œè‰²ï¼ˆç¬‘ï¼‰" style="zoom:25%;" /><p>è¿‡äº†å‡ åˆ†é’Ÿï¼Œå°±è¿ç›‘æ§CloudflareçŠ¶æ€çš„<a href="https://www.cloudflarestatus.com/">Cloudflare Status</a>ä¹Ÿç‚¸äº†ã€‚</p><img src="https://webp.esing.dev/img/-6116318431108861140_119_251118_2307_bqC2.jpg" alt="å½»åº•çˆ†ç‚¸çš„Cloudflare Status" style="zoom:25%;" /><p>ä¸è¿‡è¿˜æœ‰ä¸€éƒ¨åˆ†ä¼ä¸šç½‘ç«™å¹¸å…äºéš¾ï¼Œæ¯”å¦‚<a href="https://csgo.com/">CSGOå›½é™…å®˜ç½‘</a>ï¼Œå¯èƒ½æ˜¯Enterpriseæœ‰ç€ä¸åŒçº¿è·¯ï¼Ÿæ¯•ç«ŸChatGPTæŒ‚æ‰çš„ä¹Ÿåªæ˜¯äººæœºéªŒè¯éƒ¨åˆ†ã€‚è¿™ä¹ˆç®—æ¥ï¼Œç²—ç•¥ä¼°ç®—çš„è¯ï¼Œä¸–ç•Œä¸Šæœ‰<strong>äº”åˆ†ä¹‹ä¸€</strong>çš„ç½‘ç«™åº”è¯¥éƒ½å—åˆ°äº†å½±å“â€”â€”ä»DNSåˆ°é™æ€é¡µé¢æ‰˜ç®¡ï¼Œå†åˆ°åå‘ä»£ç†ã€‚ä¸æ„§æ˜¯ä½ ï¼ŒCloudflareã€‚</p><hr><p>åœ¨ä¸¤ä¸ªå°æ—¶åï¼Œ22:50ï¼Œå®˜æ–¹ç»ˆäºå‘æ¶ˆæ¯ç§°ä¿®å¤å®Œæ¯•ã€‚<a href="https://t.me/vps_xhq/766">VPSä¿¡å·æ——æ’­æŠ¥</a>ä¹Ÿç»™åˆ°äº†<span style="color:#FBAE40;">Level B</span>çš„é‡è¦ç­‰çº§ã€‚åªèƒ½è¯´å°è€å¼Ÿè¿˜å¾—å¤šç»ƒï¼Œæƒ³è¾¾åˆ°ä½ è°·å“¥<a href="https://t.me/vps_xhq/161">ä»¥å‰</a>çš„<span style="color:#DA304C;">Level A</span>è¿˜æœ‰å¾ˆé•¿çš„è·¯å‘¢ã€‚</p><hr><p>æˆ‘æƒ³åˆ°äº†ã€ŠçƒçŠ¶é—ªç”µã€‹ã€‚</p><p><em><strong>â€œæ‘§æ¯èŠ¯ç‰‡çš„å®èšå˜å¯ä»¥ä½¿åœ°çƒè¿™å—å¤§ç¡¬ç›˜è¢«æ ¼å¼åŒ–ï¼Œè¶Šå…ˆè¿›çš„å›½å®¶å—åˆ°çš„æ‰“å‡»å°±è¶Šå¤§ã€‚è€Œåœ¨å‘ä¿¡æ¯æ—¶ä»£çš„æ¢å¤è¿‡ç¨‹ä¸­ï¼Œå°†å‡ºç°ä¸€ä¸ªä¸ç¡®å®šçš„å…¨æ–°çš„ä¸–ç•Œæ ¼å±€ã€‚â€</strong></em></p><p>å€˜è‹¥çœŸæœ‰ä¸€æ—¥ï¼Œäº’è”ç½‘å…¨éƒ¨ç˜«ç—ªâ€”â€”æˆ–æ˜¯æ›´ä¸¥é‡ï¼Œå¦‚åŒã€Šå…¨é¢‘æ®µé˜»å¡å¹²æ‰°ã€‹é‚£æ ·â€”â€”äººç±»çš„ç”Ÿæ´»ä¼šæ€ä¹ˆæ ·ï¼Ÿ<strong>æ˜¯äºåºŸå¢Ÿä¸­æºæ‰‹é‡å»ºå¾€æ—¥çš„ä¿¡æ¯æ—¶ä»£ï¼Œè¿˜æ˜¯å€Ÿæ··ä¹±ä¹‹æ—¶é‡å»ºå„è‡ªæ¸´æœ›çš„ä¸–ç•Œæ ¼å±€ï¼Ÿ</strong></p><hr><p>ä¸€è§‰é†’æ¥ï¼ŒCloudflareä¹Ÿå‘äº†<a href="https://blog.cloudflare.com/18-november-2025-outage/">å®˜æ–¹å£°æ˜</a>ï¼Œè§£é‡Šæœ¬æ¬¡æ•…éšœåŸå› ï¼š</p><blockquote><p>æ•…éšœæ˜¯ç”±äºå·¥ç¨‹å¸ˆæ›´æ”¹äº†ä¸€ä¸ªæ•°æ®åº“ç³»ç»Ÿçš„æƒé™æ‰€å¼•å‘çš„ã€‚è¯¥è®¾ç½®ä¼šå¯¼è‡´æ•°æ®åº“å‘ Bot ç®¡ç†ç³»ç»Ÿæ‰€ä½¿ç”¨çš„â€œç‰¹å¾æ–‡ä»¶ï¼ˆfeature fileï¼‰â€ä¸­è¾“å‡ºå¤šé‡æ¡ç›®ï¼Œè¿›è€Œå¯¼è‡´è¯¥ç‰¹å¾æ–‡ä»¶çš„å¤§å°ç¿»äº†ä¸€ç•ªã€‚éšåï¼Œæœ‰é—®é¢˜çš„ç‰¹å¾æ–‡ä»¶è¢«åˆ†å‘åˆ°äº†ç½‘ç»œä¸­çš„æ‰€æœ‰æœºå™¨ä¸Šã€‚</p><p>ç½‘ç»œä¸­çš„è®¾å¤‡è½¯ä»¶å¯¹ç‰¹å¾æ–‡ä»¶çš„å¤§å°è®¾å®šäº†ä¸Šé™ï¼Œè€Œç¿»å€åçš„æ–‡ä»¶è¶…è¿‡äº†è¿™ä¸€é™åˆ¶ï¼Œå¯¼è‡´è½¯ä»¶å´©æºƒã€‚</p></blockquote><p>Cloudflare ä¸€åº¦æ€€ç–‘è¿™æ˜¯ç”±è¶…å¤§è§„æ¨¡ DDoS æ”»å‡»å¼•èµ·çš„ï¼Œä½†å¾ˆå¿«é”å®šäº†æ ¸å¿ƒé—®é¢˜ï¼ŒæˆåŠŸé˜»æ­¢äº†ä½“ç§¯å¼‚å¸¸çš„ç‰¹å¾æ–‡ä»¶è¿›ä¸€æ­¥ä¼ æ’­ã€‚å°†å…¶æ›¿æ¢ä¸ºè¯¥æ–‡ä»¶çš„æ—©æœŸç‰ˆæœ¬åæ ¸å¿ƒæµé‡åŸºæœ¬æ¢å¤æ­£å¸¸æµè½¬ã€‚ä½†éšç€æµé‡é‡æ–°æ¶Œå…¥ï¼ŒCloudflare æœ€ç»ˆè€—è´¹äº†æ•°å°æ—¶æ¥ç¼“è§£ç½‘ç»œå„éƒ¨åˆ†å¢åŠ çš„è´Ÿè½½ã€‚</p><p>æœç„¶æ˜¯å·¥ç¨‹å¸ˆçš„è¯¯æ“ä½œå¯¼è‡´çš„ï¼Œå”‰è‰å°ç­å­ ^__^ã€‚ä¸çŸ¥é“å·¥ç¨‹å¸ˆæ˜¯ä¸æ˜¯è¢«æ‹‰å»ç¥­å¤©äº†ï¼Ÿè¿™æ¯ç§’æŸå¤±å¯ä¸æ˜¯æŒ–æ–­å›½é˜²å…‰ç¼†èƒ½æ¯”çš„ã€‚</p>]]></content>
    
    
    <summary type="html">å†™äº2025.11.18ï¼Œçºªå¿µ Cloudflare å‘ç”Ÿçš„å¤§è§„æ¨¡æ•…éšœã€‚</summary>
    
    
    
    <category term="éšç¬”" scheme="https://blog.esing.dev/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
    <category term="Cloudflare" scheme="https://blog.esing.dev/tags/Cloudflare/"/>
    
    <category term="ä»£ç†" scheme="https://blog.esing.dev/tags/%E4%BB%A3%E7%90%86/"/>
    
    <category term="Workers" scheme="https://blog.esing.dev/tags/Workers/"/>
    
  </entry>
  
  <entry>
    <title>æ›´é€‚åˆPowershellä½“è´¨çš„ln</title>
    <link href="https://blog.esing.dev/2025/11/17/powershell-ln/"/>
    <id>https://blog.esing.dev/2025/11/17/powershell-ln/</id>
    <published>2025-11-17T06:13:32.000Z</published>
    <updated>2025-11-17T06:22:14.360Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>åœ¨<a href="/2025/10/20/powershell-grep/" title="æ›´é€‚åˆPowershellä½“è´¨çš„grep">æ›´é€‚åˆPowershellä½“è´¨çš„grep</a>ä¸­é‡å®šä¹‰äº†<code>grep</code>ã€‚Linuxä¸­çš„<code>ln</code>å‘½ä»¤ä¹Ÿéå¸¸å¥½ç”¨ï¼Œåˆ›å»ºè½¯é“¾æ¥ï¼Œå¯ä»¥çœä¸‹å¾ˆå¤šéœ€è¦å¤ç”¨çš„æ–‡ä»¶ç©ºé—´ã€‚</p><p>æ²¡æƒ³åˆ°Powershellä¸­æ²¡åŠæ³•ä½¿ç”¨cmdçš„<code>mklink</code>ï¼Œè‡ªå¸¦çš„åˆ›å»ºè½¯è¿æ¥å‘½ä»¤æ¯”æˆ‘å‘½è¿˜é•¿ã€‚è‡ªå·±å†™ä¸€ä¸ªè„šæœ¬é‡å®šå‘ï¼</p><h2 id="ä»£ç ">ä»£ç </h2><p>å› ä¸ºä¸èƒ½æ‰§è¡Œcmdå‘½ä»¤ï¼Œåªèƒ½ä½¿ç”¨Powershellå‡½æ•°ï¼Œå› æ­¤æ–°å»ºä¸€ä¸ª<code>ln.psm1</code>æ¨¡å—ï¼Œå¹¶ä¿å­˜åˆ°<code>C:\Users\UserName\Documents\PowerShell\Modules\ln</code>ï¼Œåœ¨Powershellåˆå§‹åŒ–æ—¶å¯¼å…¥å³å¯ã€‚</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ln</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">param</span>(</span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$d</span>,      <span class="comment"># -d: å¼ºåˆ¶ç›®å½•é“¾æ¥</span></span><br><span class="line">        [<span class="type">switch</span>]<span class="variable">$h</span>,      <span class="comment"># -h: æ˜¾ç¤ºå¸®åŠ©</span></span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$target</span>,</span><br><span class="line">        [<span class="built_in">string</span>]<span class="variable">$link</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ======== å½©è‰²å¸®åŠ© ========</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$h</span> <span class="operator">-or</span> <span class="operator">-not</span> <span class="variable">$target</span> <span class="operator">-or</span> <span class="operator">-not</span> <span class="variable">$link</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span>  <span class="comment"># ç©ºè¡Œ</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;ln: create symbolic link &quot;</span> <span class="literal">-ForegroundColor</span> Cyan <span class="literal">-NoNewline</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;(PowerShell version)&quot;</span> <span class="literal">-ForegroundColor</span> DarkGray</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Usage:&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  ln [-d] &lt;target&gt; &lt;link&gt;&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Options:&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  -d        create directory symbolic link&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  -h        display this help&quot;</span> <span class="literal">-ForegroundColor</span> White</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;Examples:&quot;</span> <span class="literal">-ForegroundColor</span> Yellow</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  ln C:\real\file.txt C:\link\file.txt&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  ln C:\realDir C:\linkDir&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;  ln -d C:\realDir C:\linkDir&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line"></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ======== å‚æ•°æ£€æŸ¥ ========</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="operator">-not</span> (<span class="built_in">Test-Path</span> <span class="variable">$target</span>)) &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;ln: target &#x27;<span class="variable">$target</span>&#x27; not found&quot;</span> <span class="literal">-ForegroundColor</span> Red</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ======== è®¾ç½®ç±»å‹ï¼ˆSymbolicLinkï¼‰========</span></span><br><span class="line">    <span class="variable">$itemType</span> = <span class="string">&quot;SymbolicLink&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ======== åˆ›å»ºç¬¦å·é“¾æ¥ ========</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">New-Item</span> <span class="literal">-ItemType</span> <span class="variable">$itemType</span> <span class="literal">-Path</span> <span class="variable">$link</span> <span class="literal">-Target</span> <span class="variable">$target</span> | <span class="built_in">Out-Null</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;ln: created symbolic link &quot;</span> <span class="literal">-ForegroundColor</span> Cyan <span class="literal">-NoNewline</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&#x27;<span class="variable">$link</span>&#x27;&quot;</span> <span class="literal">-ForegroundColor</span> Green <span class="literal">-NoNewline</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot; â†’ &quot;</span> <span class="literal">-ForegroundColor</span> DarkGray <span class="literal">-NoNewline</span></span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;&#x27;<span class="variable">$target</span>&#x27;&quot;</span> <span class="literal">-ForegroundColor</span> Green</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> &#123;</span><br><span class="line">        <span class="built_in">Write-Host</span> <span class="string">&quot;ln: failed to create link: <span class="variable">$</span>(<span class="variable">$_</span>.Exception.Message)&quot;</span> <span class="literal">-ForegroundColor</span> Red</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨Powershellé‡Œæ‰§è¡Œ<code>$PROFILE</code>å³å¯çœ‹åˆ°é…ç½®æ–‡ä»¶ä½ç½®ï¼Œä¸€èˆ¬åœ¨<code>C:\Users\UserName\Documents\PowerShell\Microsoft.PowerShell_profile.ps1</code>ã€‚</p><p>åœ¨æœ«å°¾åŠ ä¸Š<code>Import-Module ln</code>å³å¯ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;åœ¨&lt;a href=&quot;/2025/10/20/powershell-grep/&quot; title=&quot;æ›´é€‚åˆPowershellä½“è´¨çš„grep&quot;&gt;æ›´é€‚åˆPower</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Powershell" scheme="https://blog.esing.dev/tags/Powershell/"/>
    
  </entry>
  
  <entry>
    <title>é™ä½è…¾è®¯ACEåä½œå¼Šæ‰«ç›˜ä¼˜å…ˆçº§å¹¶æå‡æ¸¸æˆæ€§èƒ½</title>
    <link href="https://blog.esing.dev/2025/11/15/fuckoff-aceguard/"/>
    <id>https://blog.esing.dev/2025/11/15/fuckoff-aceguard/</id>
    <published>2025-11-15T12:53:32.000Z</published>
    <updated>2025-11-15T12:56:53.818Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>æ‰“å¤§ä¹±æ–—åŠ¨ä¸åŠ¨å°±å¡ï¼Œå¤ªçƒ¦äº†ã€‚è¿™Båä½œå¼Šè·Ÿå°è“ç†Šåä¸€æ¡Œå»ã€‚</p><h2 id="æ³¨å†Œè¡¨ä¿®æ”¹">æ³¨å†Œè¡¨ä¿®æ”¹</h2><p>å‚è€ƒï¼š<a href="https://www.bilibili.com/video/av115529217998860">è§£å†³è‹±é›„è”ç›ŸLOLå¡é¡¿æ‰å¸§é—®é¢˜å¾ˆå¤šæ–¹æ³•éƒ½æ²¡ç”¨çš„è¯•ä¸‹è¿™ä¸ª - å“”å“©å“”å“©</a></p><p>æ–°å»ºä¸€ä¸ªæ³¨å†Œè¡¨æ–‡ä»¶<code>1.reg</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\DeltaForceClient-Win64-Shipping.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000003</span><br><span class="line">&quot;IoPriority&quot;=dword:00000003</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\League of Legends.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000003</span><br><span class="line">&quot;IoPriority&quot;=dword:00000003</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\LeagueClient.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000003</span><br><span class="line">&quot;IoPriority&quot;=dword:00000003</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\ACE-Tray.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000001</span><br><span class="line">&quot;IoPriority&quot;=dword:00000001</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\SGuard64.exe\PerfOptions]</span><br><span class="line">&quot;CpuPriorityClass&quot;=dword:00000001</span><br><span class="line">&quot;IoPriority&quot;=dword:00000001</span><br></pre></td></tr></table></figure><p>ç„¶ååŒå‡»å¯¼å…¥å³å¯ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;æ‰“å¤§ä¹±æ–—åŠ¨ä¸åŠ¨å°±å¡ï¼Œå¤ªçƒ¦äº†ã€‚è¿™Båä½œå¼Šè·Ÿå°è“ç†Šåä¸€æ¡Œå»ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ³¨å†Œè¡¨ä¿®æ”¹&quot;&gt;æ³¨å†Œè¡¨ä¿®æ”¹&lt;/h2&gt;
&lt;p&gt;å‚è€ƒï¼š&lt;a href=&quot;htt</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
  </entry>
  
  <entry>
    <title>å­¦é“¶åœ¨çº¿è§£é™¤ç²˜è´´é™åˆ¶</title>
    <link href="https://blog.esing.dev/2025/11/12/fuckoff-xueyinonline/"/>
    <id>https://blog.esing.dev/2025/11/12/fuckoff-xueyinonline/</id>
    <published>2025-11-12T11:41:03.000Z</published>
    <updated>2025-11-12T12:27:28.779Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><div class="note primary flat"><p>æ‡’å¾—çœ‹çš„ç›´æ¥è·³è½¬<a href="#%E8%84%9A%E6%9C%AC%E6%BA%90%E7%A0%81">è„šæœ¬æºç </a></p></div><p><strong>AIå¼€è¯¾è¿˜è¦å¸ƒç½®ä½œä¸šï¼Œä½ æ— æ•Œäº†ã€‚æˆ‘å¯»æ€è¿™è¯¾ä¸æ˜¯è€ƒå¯Ÿå—ï¼Ÿ</strong></p><p>å­¦é“¶åœ¨çº¿æäº¤ä½œä¸šç•Œé¢ç”šè‡³æ— æ³•ç²˜è´´ï¼Œä¼šæç¤ºâ€œåªèƒ½å½•å…¥ä¸èƒ½ç²˜è´´ï¼â€</p><p>ä»€ä¹ˆåƒåœ¾ç©æ„ï¼Ÿçœ‹æˆ‘å¹²ä¸å¹²ä½ å°±å®Œäº‹äº†ã€‚</p><h2 id="ç ´è§£">ç ´è§£</h2><h3 id="å®šä½ä»£ç -ä¿®æ”¹">å®šä½ä»£ç &amp;ä¿®æ”¹</h3><p>è¿™ç§ç¦æ­¢ç²˜è´´100%æ˜¯JS+å‰ç«¯æ‹¦æˆªã€‚ç›´æ¥è¿›æ§åˆ¶å°æœæºä»£ç ï¼Œå®šä½åˆ°ï¼š</p><img src="https://webp.esing.dev/img/image-20251112200416938_251112_2004_AQoQ.png" alt="ç›‘å¬å‡½æ•°" style="zoom:80%;" /><p>ç„¶åç›´æ¥å†™è„šæœ¬æ›¿æ¢ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         å­¦é“¶åœ¨çº¿å…è®¸ç²˜è´´</span></span><br><span class="line"><span class="comment">// @namespace    https://blog.esing.dev/</span></span><br><span class="line"><span class="comment">// @version      0.7.2.1</span></span><br><span class="line"><span class="comment">// @description  ç§»é™¤å­¦é“¶åœ¨çº¿çš„ç¼–è¾‘å™¨é™åˆ¶ï¼Œå…è®¸ç²˜è´´</span></span><br><span class="line"><span class="comment">// @match        https://mooc1.xueyinonline.com/mooc-ans/*</span></span><br><span class="line"><span class="comment">// @run-at       document-end</span></span><br><span class="line"><span class="comment">// @grant        unsafeWindow</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">overrideEditorPaste</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> unsafeWindow.<span class="property">editorPaste</span> === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">                unsafeWindow.<span class="property">editorPaste</span> = <span class="keyword">function</span>(<span class="params">o, html</span>) &#123;</span><br><span class="line">                    <span class="comment">// ä¸æ¸…ç©º html.htmlï¼Œè®©ç¼–è¾‘å™¨æ­£å¸¸æ’å…¥ç²˜è´´å†…å®¹</span></span><br><span class="line">                    <span class="comment">// ä¹Ÿä¸å†å¼¹â€œåªèƒ½å½•å…¥ä¸èƒ½ç²˜è´´ï¼â€</span></span><br><span class="line">                    <span class="comment">// ä¸€èˆ¬è¿”å› true/ä¸è¿”å›éƒ½å¯ä»¥ï¼Œçœ‹ç¼–è¾‘å™¨å®ç°ä¹ æƒ¯</span></span><br><span class="line">                    <span class="comment">// è¿™é‡Œè¿”å› trueï¼Œè¡¨ç¤ºå…è®¸ç²˜è´´</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[Tampermonkey] editorPaste overridden, paste is now allowed.&#x27;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;[Tampermonkey] Failed to override editorPaste:&#x27;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è¯•è¦†ç›–ä¸€æ¬¡</span></span><br><span class="line">    <span class="title function_">overrideEditorPaste</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ‰äº›ç«™ç‚¹ä¼šæ™šä¸€ç‚¹æ‰å®šä¹‰ editorPasteï¼Œè¿™é‡Œæ¯éš” 1 ç§’å†å°è¯•ä¸€ä¸‹</span></span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">overrideEditorPaste</span>()) &#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(timer); <span class="comment">// è¦†ç›–æˆåŠŸåå°±ä¸ç”¨å†é‡å¤å°è¯•äº†</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¡è¿›æ²¹çŒ´æµ‹è¯•ã€‚</p><p>æ²¡æœ‰æ•ˆæœï¼Ÿé‚£ç»§ç»­ã€‚</p><h3 id="åˆ†æè¾“å…¥æ¡†ä»£ç ">åˆ†æè¾“å…¥æ¡†ä»£ç </h3><p>ç»§ç»­æ£€æŸ¥å…ƒç´ ï¼Œå®šä½åˆ°è¾“å…¥æ¡†ä»£ç ã€‚æ£€æŸ¥ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œè¿™é‡Œæœ‰ä¸ªå¥‡æ€ªçš„scriptï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;stem_answer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;eidtDiv&quot;</span> <span class="attr">style</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;edui-default&quot;</span> <span class="attr">style</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ... --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;answer1919810&quot;</span> <span class="attr">name</span>=<span class="string">&quot;answer1919810&quot;</span> <span class="attr">_initadjustheight</span>=<span class="string">&quot;36&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 72px; display: none&quot;</span>&gt;</span>FUCKOFF<span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> wordNum = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (wordNum == <span class="string">&quot;&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                wordNum = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> wordMinNum = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (wordMinNum == <span class="string">&quot;&quot;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                wordMinNum = <span class="number">0</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> qtype = <span class="string">&quot;4&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// var wordCount = false;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// if (qtype == 4) &#123;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// wordCount = true;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">UEDITOR_CONFIG</span>.<span class="property">initialFrameHeight</span> = <span class="number">150</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> wordCount = <span class="literal">true</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="built_in">parseInt</span>(wordNum) == <span class="number">0</span> &amp;&amp; <span class="built_in">parseInt</span>(wordMinNum) == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                wordCount = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">UEDITOR_CONFIG</span>.<span class="property">wordCount</span> = wordCount;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">UEDITOR_CONFIG</span>.<span class="property">wordCountTimer</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// window.UEDITOR_CONFIG.maximumWords = wordNum;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">// window.UEDITOR_CONFIG.minimumWords = wordMinNum;</span></span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            &lt;!-- ç¼–è¾‘å™¨å®šä¹‰ä»£ç  --&gt;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> editor1 = <span class="variable constant_">UE</span>.<span class="title function_">getEditor</span>(<span class="string">&quot;answer1919810&quot;</span>, &#123; <span class="attr">pasteplain</span>: <span class="literal">true</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="property">options</span>.<span class="property">maximumWords</span> = wordNum;</span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="property">options</span>.<span class="property">minimumWords</span> = wordMinNum;</span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="title function_">addListener</span>(<span class="string">&quot;blur&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> count = <span class="variable constant_">UE</span>.<span class="title function_">getEditor</span>(<span class="string">&quot;answer1919810&quot;</span>).<span class="title function_">pureWordCount</span>();</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> max = <span class="built_in">parseInt</span>(<span class="variable constant_">UE</span>.<span class="title function_">getEditor</span>(<span class="string">&quot;answer1919810&quot;</span>).<span class="property">options</span>.<span class="property">maximumWords</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> min = <span class="built_in">parseInt</span>(<span class="variable constant_">UE</span>.<span class="title function_">getEditor</span>(<span class="string">&quot;answer1919810&quot;</span>).<span class="property">options</span>.<span class="property">minimumWords</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borblue&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borred&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((max &gt; <span class="number">0</span> &amp;&amp; count &gt; max) || (min &gt; <span class="number">0</span> &amp;&amp; min &gt; count)) &#123;</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borblue&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">addClass</span>(<span class="string">&quot;borred&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borblue&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                    $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borred&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="title function_">addListener</span>(<span class="string">&quot;focus&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">addClass</span>(<span class="string">&quot;borblue&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                $(<span class="string">&quot;#answer1919810&quot;</span>).<span class="title function_">parent</span>().<span class="title function_">find</span>(<span class="string">&quot;.edui-editor.edui-default&quot;</span>).<span class="title function_">removeClass</span>(<span class="string">&quot;borred&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            &lt;!-- ç²˜è´´è®¸å¯ç›¸å…³ --&gt;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> allowPaste = <span class="string">&quot;1&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (<span class="built_in">parseInt</span>(allowPaste) == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                editor1.<span class="title function_">addListener</span>(<span class="string">&quot;beforepaste&quot;</span>, editorPaste);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            &lt;!-- ä¸€ä¸ªå¥‡æ€ªçš„ç›‘å¬å™¨ --&gt;</span></span><br><span class="line"><span class="language-javascript">            editor1.<span class="title function_">addListener</span>(<span class="string">&quot;contentChange&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">loadEditorAnswerd</span>(<span class="number">1919810</span>, <span class="number">4</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">answerContentChange</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            &lt;!-- åº”è¯¥å°±æ˜¯ä½ äº† --&gt;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">UEDITOR_CONFIG</span>.<span class="property">wordCount</span> = <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¯çŸ¥ï¼šè¿™ä¸ªç¼–è¾‘å™¨æ˜¯ç™¾åº¦çš„<strong>UEditor</strong>ï¼Œä¸”åœ¨<code>beforepaste</code>äº‹ä»¶ä¸Šé¢æŒ‚äº†<code>editorPaste</code>è¿™ä¸ªå›è°ƒå‡½æ•°ã€‚å› æ­¤ï¼ŒçœŸæ­£è¦å¹²æ‰çš„æ˜¯æ‰€æœ‰çš„<code>UEditor</code>ä¸Šé¢æŒ‚çš„<code>beforepaste</code>ç›‘è§†å™¨ã€‚</p><h3 id="ä¿®æ”¹è„šæœ¬">ä¿®æ”¹è„šæœ¬</h3><p>æŠŠUEditorä¸Šé¢æŒ‚çš„<code>beforepaste</code>ç›‘è§†å™¨æ‹¿æ‰å³å¯ã€‚æ³¨æ„çœ‹å‡½æ•°ä¸Šé¢æœ‰ä¸ª<code>addListener(&quot;beforepaste&quot;, editorPaste)</code>ï¼Œè¿™æ˜¯æŒ‚ä¸Šå»çš„ä»£ç ã€‚é‚£æˆ‘<code>removeListener</code>ä½ ä¸ç‚¸äº†å—ï¼Ÿ</p><p>ç›´æ¥æŠŠéœ€æ±‚å‘Šè¯‰AIè®©å®ƒä¿®æ”¹å°±è¡Œäº†ã€‚AIå¤ªå¥½ç”¨äº†ä½ ä»¬çŸ¥é“å—</p><h3 id="è„šæœ¬æºç ">è„šæœ¬æºç </h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         å­¦é“¶åœ¨çº¿å…è®¸ç²˜è´´</span></span><br><span class="line"><span class="comment">// @namespace    https://blog.esing.dev/</span></span><br><span class="line"><span class="comment">// @version      0.7.2.1</span></span><br><span class="line"><span class="comment">// @description  ç§»é™¤å­¦é“¶åœ¨çº¿çš„ç¼–è¾‘å™¨é™åˆ¶ï¼Œå…è®¸ç²˜è´´</span></span><br><span class="line"><span class="comment">// @match        https://mooc1.xueyinonline.com/mooc-ans/*</span></span><br><span class="line"><span class="comment">// @run-at       document-end</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è¯•å¯¹æ‰€æœ‰ UEditor å®ä¾‹ç§»é™¤ beforepaste çš„ editorPaste ç›‘å¬</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">unlockPaste</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// UEditor å…¨å±€å¯¹è±¡ä¸€èˆ¬å« UE</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">window</span>.<span class="property">UE</span> || !<span class="variable constant_">UE</span>.<span class="property">instants</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> done = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> <span class="variable constant_">UE</span>.<span class="property">instants</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">hasOwnProperty</span>.<span class="title function_">call</span>(<span class="variable constant_">UE</span>.<span class="property">instants</span>, key)) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">const</span> ed = <span class="variable constant_">UE</span>.<span class="property">instants</span>[key];</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå…¨å±€æœ‰ editorPaste å‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªç¼–è¾‘å™¨æœ‰ removeListener æ–¹æ³•</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">window</span>.<span class="property">editorPaste</span> === <span class="string">&quot;function&quot;</span> &amp;&amp; ed.<span class="property">removeListener</span>) &#123;</span><br><span class="line">                    ed.<span class="title function_">removeListener</span>(<span class="string">&quot;beforepaste&quot;</span>, <span class="variable language_">window</span>.<span class="property">editorPaste</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[Userscript] removed beforepaste listener from editor:&quot;</span>, key);</span><br><span class="line">                    done = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;[Userscript] removeListener error:&quot;</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> done;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆæ¬¡å°è¯•</span></span><br><span class="line">    <span class="title function_">unlockPaste</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ‰æ—¶å€™ç¼–è¾‘å™¨æ˜¯å¼‚æ­¥åˆå§‹åŒ–çš„ï¼Œè¿™é‡Œè½®è¯¢å‡ æ¬¡ï¼Œç¡®ä¿æŒ‚åˆ°å®ä¾‹ä¸Šä¹‹åå†ç§»é™¤</span></span><br><span class="line">    <span class="keyword">const</span> timer = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">unlockPaste</span>()) &#123;</span><br><span class="line">            <span class="built_in">clearInterval</span>(timer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;paste-unlock-indicator&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">        div.<span class="property">id</span> = <span class="string">&quot;paste-unlock-indicator&quot;</span>;</span><br><span class="line">        div.<span class="property">textContent</span> = <span class="string">&quot;ç²˜è´´å·²è§£é”ğŸ˜‹&quot;</span>;</span><br><span class="line">        div.<span class="property">style</span>.<span class="property">cssText</span> =</span><br><span class="line">            <span class="string">&quot;position:fixed;bottom:10px;right:10px;padding:4px 8px;font-size:12px;background:#4caf50;color:#fff;z-index:99999;border-radius:4px;opacity:0.7;&quot;</span>;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ”¶å·¥ã€‚</p>]]></content>
    
    
    <summary type="html">é˜²å›å­ã€ä¸é˜²å°äººä¹Ÿã€‚</summary>
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="JavaScript" scheme="https://blog.esing.dev/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>GTKWaveä¿®æ”¹å­—ä½“å¤§å°</title>
    <link href="https://blog.esing.dev/2025/11/10/gtkwave-fontsize/"/>
    <id>https://blog.esing.dev/2025/11/10/gtkwave-fontsize/</id>
    <published>2025-11-10T12:47:01.000Z</published>
    <updated>2025-11-11T09:49:22.808Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>ç›®å‰çœ‹æ³¢å½¢ä¾æ—§æ²¡æœ‰ä»€ä¹ˆç°ä»£åŒ–çš„è½¯ä»¶ï¼Œè¿˜æ˜¯å¾—ç”¨GTKWaveã€‚è¿™ç©æ„æœ¬æ¥æ˜¯ç»™Linuxç”¨çš„ï¼ŒWindowsä¸Šçš„ç•Œé¢çœ‹èµ·æ¥å¾ˆå¥‡æ€ªã€‚è€Œä¸”å­—ä½“å¤ªå°äº†ï¼Œçœ¼ç›å—ä¸äº†ã€‚å¦‚ä½•ä¿®æ”¹å­—ä½“å’Œå­—ä½“å¤§å°å‘¢ï¼Ÿ</p><h2 id="é…ç½®æ–‡ä»¶ä¸å¯åŠ¨å‚æ•°">é…ç½®æ–‡ä»¶ä¸å¯åŠ¨å‚æ•°</h2><p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://gtkwave.sourceforge.net/gtkwave.pdf">GTKWave 3.3 Wave Analyzer User's Guide</a></p><p>ç¼–è¾‘ç”¨æˆ·æ–‡ä»¶å¤¹ä¸‹çš„<code>.gtkwaverc</code>æ–‡ä»¶ï¼ˆä¸å­˜åœ¨å°±æ–°å»ºä¸€ä¸ªï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use_big_fonts 8        //å­—ä½“å­—å·</span><br><span class="line">highlight_wavewindow 1 //é«˜äº®è¢«é€‰æ‹©çš„ä¿¡å·æ³¢å½¢</span><br><span class="line">// color_grid feeeed   // é«˜äº®ä¿¡å·é¢œè‰²</span><br><span class="line">fill_waveform 1        //é«˜å€¼å¡«å……</span><br><span class="line">disable_mouseover 0    //é¼ æ ‡å¯æŸ¥çœ‹æ³¢å½¢</span><br><span class="line">hier_max_level 5       //æ˜¾ç¤ºä¿¡å·å½’å±å±‚çº§çš„æœ€å¤§å€¼</span><br><span class="line">left_justify_sigs 1    //ä¿¡å·å·¦å¯¹é½</span><br></pre></td></tr></table></figure><p>ä¹‹åç”¨å‚æ•°å¯åŠ¨ï¼š</p><p><code> gtkwave -r path/to/config/.gtkwaverc your_vcdfile</code>å³å¯ã€‚</p><p>å…¶å®ä¹Ÿå¯ä»¥ä¿®æ”¹å­—ä½“ï¼š</p><p><code>fontname_signals XXX</code>å³å¯ã€‚ä½†æ˜¯æ˜¾ç¤ºå¾ˆå¥‡æ€ªã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;ç›®å‰çœ‹æ³¢å½¢ä¾æ—§æ²¡æœ‰ä»€ä¹ˆç°ä»£åŒ–çš„è½¯ä»¶ï¼Œè¿˜æ˜¯å¾—ç”¨GTKWaveã€‚è¿™ç©æ„æœ¬æ¥æ˜¯ç»™Linuxç”¨çš„ï¼ŒWindowsä¸Šçš„ç•Œé¢çœ‹èµ·æ¥å¾ˆå¥‡æ€ªã€‚è€Œä¸”å­—ä½“å¤ªå°äº†ï¼Œçœ¼ç›å—ä¸äº†ã€‚</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
  </entry>
  
  <entry>
    <title>è¶…å¤§è§„æ¨¡é›†æˆç”µè·¯è®¾è®¡ç¬”è®°ï¼šç¬¬å…­ç¯‡</title>
    <link href="https://blog.esing.dev/2025/11/08/vd-p6/"/>
    <id>https://blog.esing.dev/2025/11/08/vd-p6/</id>
    <published>2025-11-08T15:22:28.000Z</published>
    <updated>2025-11-10T03:53:43.556Z</updated>
    
    <content type="html"><![CDATA[<div class="note info flat"><p>åº”ä»˜ä¸€ä¸‹åº”è¯•ã€‚</p></div><h2 id="ç¼©å†™">ç¼©å†™</h2><ul><li><strong>PLA</strong>: Programmable Logic Array</li><li><strong>PAL</strong>: Programmable Array Logic</li><li><strong>PLD</strong>: Programmable Logic Device</li><li><strong>ROM</strong>: Read-Only Memory</li><li><strong>RAM</strong>: Random Access Memory</li><li><strong>ALU</strong>: Arithmetic Logic Unit</li><li><strong>IEEE</strong>: Institute of Electrical and Electronics Engineers</li><li><strong>VHDL</strong>: VHSIC Hardware Description Language</li><li><strong>CMOS</strong>: Complementary Metal Oxide Semiconductor</li><li><strong>FPGA</strong>: Field-Programmable Gate Array</li><li><strong>RISC</strong>: Reduced Instruction Set Computer</li><li><strong>CISC</strong>: Complex Instruction Set Computer</li><li><strong>DSA</strong>: Domain Specific Architecture</li><li><strong>SoC</strong>: System on Chip</li><li><strong>FP</strong>: Float Point</li><li><strong>ISA</strong>: Instruction Set Architecture</li><li><strong>RTC</strong>: Real-Time Clock</li><li><strong>SPI</strong>: Serial Peripheral Interface</li><li><strong>PMC</strong>: Power Management Controller</li><li><strong>DMA</strong>: Direct Memory Access</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info flat&quot;&gt;&lt;p&gt;åº”ä»˜ä¸€ä¸‹åº”è¯•ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;ç¼©å†™&quot;&gt;ç¼©å†™&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;PLA&lt;/strong&gt;:</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å¤ä¹ " scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="æ•°å­—ç³»ç»Ÿè®¾è®¡" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>One Last Kiss é£æ ¼å›¾ç‰‡ç”Ÿæˆ</title>
    <link href="https://blog.esing.dev/2025/10/31/onelastkiss-image/"/>
    <id>https://blog.esing.dev/2025/10/31/onelastkiss-image/</id>
    <published>2025-10-31T10:57:56.000Z</published>
    <updated>2025-10-31T11:16:30.695Z</updated>
    
    <content type="html"><![CDATA[    <div id="aplayer-ANgRERXS" class="aplayer aplayer-tag-marker meting-tag-marker"         data-id="1824020871" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="false" data-mutex="true" data-listmaxheight="340px" data-preload="auto" data-theme="#ff80ac" data-volume="0.3" data-loop="none"    ></div><h2 id="å‰è¨€">å‰è¨€</h2><p>åœ¨Githubä¸Šé—²é€›æ—¶çœ‹åˆ°äº†è¿™ä¸ªåº“ï¼š<a href="https://github.com/itorr/one-last-image">ã€ŒOne Last Imageã€å¢æµ®å®«ç”Ÿæˆå™¨ - itorr/one-last-image</a></p><p>åœ¨çº¿è¯•äº†ä¸€ä¸‹ï¼Œæ•ˆæœå¾ˆä¸é”™ï¼Œå¯æƒœå¯¼å‡ºçš„å›¾ç‰‡éƒ½è¢«é‡é‡‡æ ·åˆ°1080Päº†ï¼Œäºæ˜¯æ‹‰æºç è‡ªå·±ä¿®æ”¹äº†ä¸€ç‰ˆï¼Œå¯ä»¥å¼€å¯é«˜æ¸…æ¨¡å¼ï¼Œå¹¶éšæ„è°ƒæ•´æ°´å°ä½ç½®ï¼š</p><p><img src="https://webp.esing.dev/img/image-20251031190219051_251031_1902_tsQn.png" alt="ä¿®æ”¹ç‰ˆ"></p><p>åœ°å€åœ¨<a href="https://louvre.esing.dev/">louvre.esing.dev</a>ã€‚</p><p>æ•ˆæœè¿˜è¡Œï¼š</p><p><img src="https://opic.esing.dev/img/louvre_251031_1910_J7A1.webp" alt="æ•ˆæœå›¾ï¼ŒåŸå›¾ä¸ºp112423002"></p>]]></content>
    
    
    <summary type="html">ã€Œã€€ç¬¬ä¸€æ¬¡å»å¢æµ®å®« å¹¶æ— ä»€ä¹ˆç‰¹åˆ«çš„æ„Ÿè§‰&lt;br&gt;ã€€ã€€å› ä¸ºç‹¬å±äºæˆ‘çš„è’™å¨œä¸½è æˆ‘æ—©å·²é‡è§ã€€ã€</summary>
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="äºŒæ¬¡å…ƒ" scheme="https://blog.esing.dev/tags/%E4%BA%8C%E6%AC%A1%E5%85%83/"/>
    
    <category term="EVA" scheme="https://blog.esing.dev/tags/EVA/"/>
    
  </entry>
  
  <entry>
    <title>è¶…å¤§è§„æ¨¡é›†æˆç”µè·¯è®¾è®¡ç¬”è®°ï¼šç¬¬äº”ç¯‡</title>
    <link href="https://blog.esing.dev/2025/10/29/vd-p5/"/>
    <id>https://blog.esing.dev/2025/10/29/vd-p5/</id>
    <published>2025-10-29T08:46:50.000Z</published>
    <updated>2025-11-04T04:56:47.097Z</updated>
    
    <content type="html"><![CDATA[<div class="note info flat"><p>è¿™ä¸€ç« ä¸è€ƒï¼Œè‡³å°‘å¾€å¹´é¢˜æ²¡æœ‰è€ƒè¿‡ã€‚</p></div><h2 id="SoCæ€»çº¿">SoCæ€»çº¿</h2><ul><li>æ€»çº¿æä¾›äº†ç³»ç»Ÿä¸­<strong>å„ä¸ªè®¾å¤‡ä¹‹é—´</strong>ä¸€ç§<strong>äº’è¿</strong>çš„<strong>è®¿é—®å…±äº«ç¡¬ä»¶</strong>æœºåˆ¶</li><li>åœ¨æ•°å­—ç³»ç»Ÿä¸­ï¼Œæ€»çº¿<strong>æ‰¿æ‹…æ•°æ®ä¼ è¾“ä»»åŠ¡</strong>ï¼Œå¦‚å¤„ç†å™¨å’Œå­˜å‚¨å™¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“</li><li>æ€»çº¿çš„ä¼ è¾“èƒ½åŠ›ç”±æ€»çº¿çš„<strong>å¸¦å®½</strong>å’Œ<strong>å·¥ä½œé¢‘ç‡</strong>å†³å®š</li><li>æ€»çº¿çš„è®¾è®¡é€šå¸¸è¦è€ƒè™‘4ä¸ªå› ç´ ï¼š<strong>æ€»çº¿å®½åº¦ã€æ—¶é’Ÿé¢‘ç‡ã€ä»²è£æœºåˆ¶å’Œä¼ è¾“ç±»å‹</strong></li></ul><p>å¸¸è§çš„æ€»çº¿æœ‰ï¼š</p><ul><li>AMBAï¼šARMå…¬å¸å®šä¹‰çš„æ€»çº¿ä½“ç³»ï¼Œå¹¿æ³›ç”¨äºåµŒå…¥å¼SoCï¼ŒåŒ…æ‹¬ AHBã€APBã€AXI ç­‰å¤šä¸ªå­åè®®</li><li>OCPï¼šå¼€æ”¾å¼æ ¸å¿ƒæ¥å£åè®®ï¼Œæ¨¡å—åŒ–è®¾è®¡ï¼Œé€‚åˆIPæ ¸é›†æˆ</li><li>Wishboneï¼šç”±OpenCoreså®šä¹‰çš„å¼€æºSoCæ€»çº¿ï¼Œç®€å•æ˜“ç”¨ï¼Œé€‚åˆæ•™å­¦æˆ–FPGAè®¾è®¡</li><li>Avalonï¼šåŸAlteraå…¬å¸å®šä¹‰çš„ç‰‡ä¸Šæ€»çº¿åè®®</li></ul><h3 id="AMBA">AMBA</h3><img src="https://webp.esing.dev/img/image-20251029172831688_251029_1728_zyBZ.png" alt="AMBA-AHBç³»ç»Ÿ" style="zoom: 33%;" /><br><img src="https://webp.esing.dev/img/image-20251029172845655_251029_1728_fIGf.png" alt="AMBA-AXIç³»ç»Ÿ" style="zoom: 67%;" /><h2 id="å¸¸è§IP">å¸¸è§IP</h2><p>SoCä¸­çš„å¸¸è§IPåŒ…æ‹¬ï¼šä¸­æ–­æ§åˆ¶å™¨ã€å®æ—¶æ—¶é’Ÿã€SPIã€å®šæ—¶å™¨ã€çœ‹é—¨ç‹—ç­‰ã€‚</p><p>ä¸€ä¸ªå®Œæ•´çš„ SoC é€šå¸¸åŒ…å«å¦‚ä¸‹æ¨¡å—ï¼ˆIPï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span><br><span class="line">â”‚        CPU / DSP         â”‚   â† æ§åˆ¶/è®¡ç®—IP</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚   Cache / MMU / Memory   â”‚   â† å­˜å‚¨IP</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚   AXI / AHB Interconnect â”‚   â† ç‰‡ä¸Šæ€»çº¿IP</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚ UART | SPI | IÂ²C | GPIO  â”‚   â† å¤–è®¾IP</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚     DMA / Timer / WDT    â”‚   â† æ§åˆ¶ç±»IP</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚  USB / PCIe / Ethernet   â”‚   â† é€šä¿¡æ¥å£IP</span><br><span class="line">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span><br><span class="line">â”‚   Security / Crypto / PM â”‚   â† å®‰å…¨ä¸ç”µæºç®¡ç†IP</span><br><span class="line">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span><br></pre></td></tr></table></figure><h3 id="ä¸­æ–­æ§åˆ¶å™¨">ä¸­æ–­æ§åˆ¶å™¨</h3><p>ä¸­æ–­æ§åˆ¶å™¨ï¼ˆInterrupt Controllerï¼‰æ˜¯ SoCä¸­ç”¨äºç®¡ç†å’Œåˆ†å‘ä¸­æ–­è¯·æ±‚ï¼ˆIRQï¼‰çš„å…³é”®æ¨¡å—ï¼Œç›´æ¥å½±å“ç³»ç»Ÿçš„<strong>å®æ—¶æ€§</strong>å’Œ<strong>å“åº”èƒ½åŠ›</strong>ã€‚</p><ul><li>RISC-Vï¼šCLINã€PLIC</li><li>ARMï¼šNVICã€GIC</li><li>x86ï¼šAPIC</li></ul><h3 id="å®æ—¶æ—¶é’Ÿ-RTC">å®æ—¶æ—¶é’Ÿ RTC</h3><p>RTCï¼ˆReal-Time Clockï¼Œå®æ—¶æ—¶é’Ÿï¼‰æ˜¯SoCä¸­ç”¨äºæä¾›ç²¾ç¡®æ—¶é—´å’Œæ—¥å†åŠŸèƒ½çš„ç‹¬ç«‹æ¨¡å—ï¼Œå³ä½¿åœ¨ç³»ç»Ÿæ–­ç”µæ—¶ä¹Ÿèƒ½æŒç»­è¿è¡Œï¼ˆé€šå¸¸ä¾é å¤‡ç”¨ç”µæ± ä¾›ç”µï¼‰ã€‚RTCæ‹¥æœ‰æŠ¥è­¦åŠŸèƒ½ï¼Œå½“è¾¾åˆ°æ‰€éœ€çš„æ—¥æœŸæˆ–æ—¶é—´æ—¶ï¼Œå¯ä»¥ç”¨æ¥è§¦å‘ä¸­æ–­ï¼ˆå”¤é†’ï¼‰ã€‚</p><h3 id="SPI">SPI</h3><p>SPIï¼ˆSerial Peripheral Interfaceï¼Œä¸²è¡Œå¤–è®¾æ¥å£ï¼‰å…è®¸ä¸å¤–å›´è®¾å¤‡çš„å…¨åŒå·¥åŒæ­¥ä¸²è¡Œé€šä¿¡ã€‚</p><img src="https://pic.esing.dev/img/OIP_251029_1744_9Mi4.qDQZR6LGNmkKAxd41-dJkQHaFP" alt="SPIæ€»çº¿ç¤ºæ„å›¾" style="zoom: 50%;" /><h3 id="å®šæ—¶å™¨ä¸çœ‹é—¨ç‹—">å®šæ—¶å™¨ä¸çœ‹é—¨ç‹—</h3><p>Timerï¼ˆå®šæ—¶å™¨ï¼‰å’ŒWatchdogï¼ˆçœ‹é—¨ç‹—ï¼‰æ˜¯ä¸¤ç§å…³é”®çš„å¤–è®¾æ¨¡å—ï¼Œåˆ†åˆ«ç”¨äºæ—¶é—´ç®¡ç†å’Œç³»ç»Ÿå¯é æ€§ä¿éšœã€‚å®ƒä»¬éƒ½åŸºäº<strong>è®¡æ—¶åŸç†</strong>ï¼Œä½†ç”¨é€”å®Œå…¨ä¸åŒï¼š</p><ul><li>å®šæ—¶å™¨ç”¨æ¥â€œ<strong>è®¡æ—¶ä¸è§¦å‘äº‹ä»¶</strong>â€ï¼›</li><li>çœ‹é—¨ç‹—ç”¨æ¥â€œ<strong>ç›‘æ§ç³»ç»Ÿè¿è¡Œæ˜¯å¦å¡æ­»</strong>â€ã€‚</li></ul><h3 id="PMC">PMC</h3><p>PMCï¼ˆPower Management Controllerï¼‰ æ˜¯SoCä¸­è´Ÿè´£ç”µæºç®¡ç†ã€åŠŸè€—æ§åˆ¶ã€æ—¶é’Ÿåˆ†é…å’Œç³»ç»Ÿå”¤é†’çš„æ ¸å¿ƒæ¨¡å—ï¼Œç›´æ¥å½±å“èŠ¯ç‰‡çš„èƒ½æ•ˆæ¯”å’Œç»­èˆªèƒ½åŠ›ã€‚ä¸»è¦é€šè¿‡ç”µæºç®¡ç†ã€æ—¶é’Ÿç®¡ç†ã€è½¯ä»¶ç®¡ç†ç­‰æ–¹å¼æ¥è¾¾åˆ°æ§åˆ¶åŠŸè€—çš„ç›®çš„ã€‚</p><table><thead><tr><th style="text-align:left">æ¨¡å¼</th><th style="text-align:left">åŠŸè€—</th><th style="text-align:left">å”¤é†’å»¶è¿Ÿ</th><th style="text-align:left">å…¸å‹åº”ç”¨</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Active</strong></td><td style="text-align:left">é«˜</td><td style="text-align:left">æ— </td><td style="text-align:left">CPUå…¨é€Ÿè¿è¡Œä»»åŠ¡ã€‚</td></tr><tr><td style="text-align:left"><strong>Idle</strong></td><td style="text-align:left">ä¸­</td><td style="text-align:left">å¾®ç§’çº§</td><td style="text-align:left">ç­‰å¾…ä¸­æ–­ï¼ˆå¦‚æ‰‹æœºå¾…æœºï¼‰ã€‚</td></tr><tr><td style="text-align:left"><strong>Standby</strong></td><td style="text-align:left">ä½</td><td style="text-align:left">æ¯«ç§’çº§</td><td style="text-align:left">ä»…ä¿ç•™SRAMå’ŒRTCï¼ˆå¦‚IoTè®¾å¤‡ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><strong>Off</strong></td><td style="text-align:left">æä½</td><td style="text-align:left">ç§’çº§</td><td style="text-align:left">å®Œå…¨æ–­ç”µï¼Œéœ€ç¡¬ä»¶å¤ä½å”¤é†’ã€‚</td></tr></tbody></table><h3 id="DMAC">DMAC</h3><p><s>AMDåæ’</s></p><p>DMACï¼ˆDirect Memory Access Controllerï¼‰ æ˜¯SoCä¸­ç”¨äºåœ¨ä¸å ç”¨CPUèµ„æºçš„æƒ…å†µä¸‹ï¼Œå®ç°å¤–è®¾ä¸å†…å­˜ï¼ˆæˆ–å†…å­˜ä¸å†…å­˜ï¼‰ä¹‹é—´é«˜é€Ÿæ•°æ®ä¼ è¾“çš„ç¡¬ä»¶æ¨¡å—ã€‚å®ƒæ˜¾è‘—æå‡ç³»ç»Ÿæ•ˆç‡ï¼Œå°¤å…¶é€‚ç”¨äºå¤§æ•°æ®é‡ã€å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆå¦‚éŸ³è§†é¢‘å¤„ç†ã€ç½‘ç»œé€šä¿¡ï¼‰ã€‚</p><p>DMACä¸€èˆ¬åŒ…æ‹¬å¦‚ä¸‹æ¨¡å—ï¼š</p><ul><li>é€šé“æ§åˆ¶å™¨ï¼šæ¯ä¸ªé€šé“ç‹¬ç«‹é…ç½®æºåœ°å€ã€ç›®æ ‡åœ°å€ã€ä¼ è¾“é•¿åº¦ç­‰å‚æ•°</li><li>ä»²è£å™¨ï¼šç®¡ç†å¤šä¸ªé€šé“çš„ä¼˜å…ˆçº§ï¼ˆå›ºå®šä¼˜å…ˆçº§æˆ–è½®è¯¢ï¼‰</li><li>æ•°æ®FIFOï¼šç¼“å†²æ•°æ®ï¼Œè§£å†³æº/ç›®æ ‡è®¾å¤‡é€Ÿåº¦ä¸åŒ¹é…é—®é¢˜</li><li>å¯„å­˜å™¨ç»„ï¼šå­˜å‚¨æ§åˆ¶å‚æ•°ï¼ˆå¦‚ä¼ è¾“æ¨¡å¼ã€ä¸­æ–­ä½¿èƒ½ï¼‰</li><li>æ€»çº¿æ¥å£ï¼šè¿æ¥ç³»ç»Ÿæ€»çº¿ï¼ˆå¦‚AXIã€AHBï¼‰ï¼Œè®¿é—®å†…å­˜å’Œå¤–è®¾</li></ul><h2 id="ä¸­æ–­ä¸å¼‚å¸¸">ä¸­æ–­ä¸å¼‚å¸¸</h2><p>ä¸­æ–­æœºåˆ¶å’Œå¼‚å¸¸æœºåˆ¶å³åœ¨ä¸­æ–­å’Œå¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¤„ç†å™¨å°†æš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼Œè½¬è€Œæ‰§è¡Œä¸­æ–­å’Œå¼‚å¸¸å¤„ç†ç¨‹åºï¼Œè¿”å›æ—¶å¤„ç†å™¨æ¢å¤ä¹‹å‰è¢«æ‰§è¡Œçš„ç¨‹åºã€‚å¯¹äºå¤„ç†å™¨è€Œè¨€ï¼Œä¸­æ–­å’Œå¼‚å¸¸çš„å¤„ç†æœºåˆ¶åŸºæœ¬ä¸Šä¸€æ ·ï¼Œå› æ­¤åˆç§°å¹¿ä¹‰å¼‚å¸¸ã€‚</p><p>å¼‚å¸¸å¯åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>åŒæ­¥å¼‚å¸¸ï¼šåŸå› å¯ä»¥ç²¾ç¡®å®šä½åˆ°æŸä¸€æ¡æ‰§è¡ŒæŒ‡ä»¤ï¼Œç”±<strong>å½“å‰æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤æœ¬èº«</strong>ç›´æ¥å¼•èµ·çš„å¼‚å¸¸ã€‚</li><li>å¼‚æ­¥å¼‚å¸¸ï¼šæ¯æ¬¡å‘ç”Ÿæ—¶æŒ‡ä»¤çš„PCå¯èƒ½ä¸ä¸€æ ·ï¼Œä¾‹å¦‚ä¸­æ–­ä¾¿æ˜¯ä¸€ç§å¼‚æ­¥å¼‚å¸¸<ul><li>ç²¾ç¡®å¼‚æ­¥å¼‚å¸¸ï¼šåœ¨å“åº”å¼‚å¸¸åçš„å¤„ç†å™¨çŠ¶æ€èƒ½å¤Ÿ<strong>ç²¾ç¡®åæ˜ </strong>ä¸ºæŸä¸€æ¡æŒ‡ä»¤çš„è¾¹ç•Œ</li><li>éç²¾ç¡®å¼‚æ­¥å¼‚å¸¸ï¼šåœ¨å“åº”å¼‚å¸¸åçš„å¤„ç†å™¨çŠ¶æ€æ— æ³•ç²¾ç¡®åæ˜ ä¸ºæŸä¸€æ¡æŒ‡ä»¤çš„è¾¹ç•Œ</li></ul></li></ul><pre class="mermaid">flowchart TD    A[æ­£å¸¸æ‰§è¡Œ: <br/>PC æŒ‡å‘å½“å‰æŒ‡ä»¤] --> B{æ˜¯å¦å‘ç”Ÿ<br/>å¼‚å¸¸/ä¸­æ–­?}    B -- å¦ --> A    %% è¿›å…¥å¼‚å¸¸    B -- æ˜¯ --> C[ç¡¬ä»¶æ•è·å¼‚å¸¸]    C --> D[ä¿å­˜ç°åœºåˆ° CSR]    D -->|mepc â† è§¦å‘æ—¶çš„ PC<br/>mcause â† å¼‚å¸¸åŸå› <br/>mtval â† å¼‚å¸¸ç›¸å…³å€¼ï¼ˆå¯é€‰ï¼‰<br/>mstatus â† æ›´æ–° MIEâ†’MPIEã€åˆ‡æ¢ç‰¹æƒçº§| E    E --> F[PC â† mtvecï¼ˆé™·å…¥å…¥å£ï¼‰]    F --> G[å¼€å§‹æ‰§è¡Œ<br/>å¼‚å¸¸/ä¸­æ–­å¤„ç†ç¨‹åº]    %% å¤„ç†è¿‡ç¨‹    G --> H{å¤„ç†å®Œæˆ<br/>å¹¶å‡†å¤‡è¿”å›?}    H -- å¦ --> G    %% é€€å‡ºå¼‚å¸¸ï¼ˆæœºå™¨æ¨¡å¼ï¼‰    H -- æ˜¯ --> I[æ‰§è¡Œ MRET æŒ‡ä»¤]    I --> J[ç¡¬ä»¶æ¢å¤çŠ¶æ€]    J -->|PC â† mepc<br/>mstatus â† æ¢å¤ MPIEâ†’MIE ç­‰| K[è¿”å›åˆ°<br/>è¢«ä¸­æ–­/å¼‚å¸¸çš„ç¨‹åº]    K --> A</pre><h2 id="èœ‚é¸ŸE203çš„ä¸­æ–­å¤„ç†">èœ‚é¸ŸE203çš„ä¸­æ–­å¤„ç†</h2><p>E203åœ¨å¤„ç†å™¨é¡¶å±‚æ¥å£ä¸­æœ‰4æ ¹ä¸­æ–­è¾“å…¥ä¿¡å·ï¼Œåˆ†åˆ«æ˜¯è½¯ä»¶ä¸­æ–­ã€è®¡æ—¶å™¨ä¸­æ–­ã€å¤–éƒ¨ä¸­æ–­å’Œè°ƒè¯•ä¸­æ–­ã€‚CLINTæ¨¡å—äº§ç”Ÿä¸€æ ¹è½¯ä»¶ä¸­æ–­ä¿¡å·å’Œä¸€æ ¹è®¡æ—¶å™¨ä¸­æ–­ä¿¡å·ï¼Œé€šç»™èœ‚é¸ŸE203å¤„ç†å™¨ï¼›PLICæ¨¡å—æ¥å…¥å¤šä¸ªå¤–éƒ¨ä¸­æ–­æºï¼Œå°†å…¶ä»²è£åç”Ÿæˆä¸€æ ¹å¤–éƒ¨ä¸­æ–­ä¿¡å·ï¼Œé€šç»™èœ‚é¸ŸE203å¤„ç†å™¨ã€‚SoCå±‚é¢çš„è°ƒè¯•æ¨¡å—ç”Ÿæˆä¸€æ ¹è°ƒè¯•ä¸­æ–­ï¼Œé€šç»™èœ‚é¸ŸE203å¤„ç†å™¨æ ¸ã€‚æ‰€æœ‰çš„ä¸­æ–­ä¿¡å·å‡ç”±E203çš„<strong>äº¤ä»˜æ¨¡å—</strong>è¿›è¡Œå¤„ç†ã€‚</p><h3 id="CLINT">CLINT</h3><p>CLINTï¼ˆCore Local Interrupts Controllerï¼Œæ ¸å¿ƒæœ¬åœ°ä¸­æ–­æ§åˆ¶å™¨ï¼‰æ˜¯ä¸€ä¸ªå­˜å‚¨å™¨åœ°å€æ˜ å°„çš„æ¨¡å—ï¼ŒæŒ‚è½½åœ¨èœ‚é¸ŸE203 BIUä¸Šï¼Œç”¨äºäº§ç”Ÿ<strong>è½¯ä»¶ä¸­æ–­</strong>å’Œ<strong>å®šæ—¶å™¨ä¸­æ–­</strong>ã€‚CLINTè®¡æ—¶å™¨æ ¹æ®ä½é€Ÿè¾“å…¥èŠ‚æ‹ä¿¡å·ï¼ˆæ¥è‡ªç”µæºå¸¸å¼€åŸŸï¼‰è¿›è¡Œè®¡æ—¶ï¼Œä¸Šç”µåé»˜è®¤ä¸€ç›´è®¡æ•°ï¼Œå¯é€šè¿‡èœ‚é¸ŸE203è‡ªå®šä¹‰CSRå¯„å­˜å™¨<code>mcounterstop</code>æ¥å…³é—­ã€‚</p><h3 id="PLIC">PLIC</h3><p>PLICï¼ˆPlatform Level Interrupt Controllerï¼Œå¹³å°çº§ä¸­æ–­æ§åˆ¶å™¨ï¼‰æ˜¯ä¸€ä¸ªå­˜å‚¨å™¨åœ°å€æ˜ å°„çš„æ¨¡å—ï¼ŒæŒ‚è½½åœ¨èœ‚é¸ŸE203 BIUä¸Šï¼Œä¸“é—¨ç”¨æ¥ç®¡ç†<strong>å¤–éƒ¨ä¸­æ–­æº</strong>ï¼Œå¹¶å°†å®ƒä»¬ç»Ÿä¸€åˆ†å‘åˆ°å¤„ç†å™¨ã€‚</p><h3 id="å¼‚å¸¸å¤„ç†å®ç°">å¼‚å¸¸å¤„ç†å®ç°</h3><p>èœ‚é¸ŸE203äº¤ä»˜æ¨¡å—å¯¹ä¸­æ–­å’Œå¼‚å¸¸çš„å¤„ç†ï¼š</p><ul><li>ä¼˜å…ˆçº§ï¼šé•¿æŒ‡ä»¤é€ æˆçš„å¼‚æ­¥å¼‚å¸¸ &gt; ä¸­æ–­é€ æˆçš„å¼‚æ­¥å¼‚å¸¸ &gt; ALUé€ æˆçš„åŒæ­¥å¼‚å¸¸</li><li>å¼‚å¸¸ä¸€æ—¦å‘ç”Ÿï¼Œä¾¿ä¼š<strong>å†²åˆ·æµæ°´çº¿</strong>ï¼Œé‡æ–°ä»æ–°çš„PCåœ°å€å¼€å§‹å–æŒ‡ä»¤</li><li><code>mret</code>æŒ‡ä»¤ä¼šè§¦å‘å¤„ç†å™¨é€€å‡ºå¼‚å¸¸æ¨¡å¼ï¼Œè¢«<strong>å½“ä½œä¸€ç§è·³è½¬æŒ‡ä»¤</strong>æ¥æ‰§è¡Œï¼Œè·³è½¬PCä¸º<code>mepc</code>å¯„å­˜å™¨å€¼</li><li>å¯¹äºåŒæ­¥å¼‚å¸¸ï¼Œ<code>mepc</code>å¯„å­˜å™¨æ›´æ–°ä¸ºå½“å‰<strong>æ­£åœ¨äº¤ä»˜æŒ‡ä»¤</strong>çš„PCå€¼</li><li>å¯¹äºç²¾ç¡®å¼‚æ­¥å¼‚å¸¸ï¼ˆä¸­æ–­ï¼‰ï¼Œ<code>mepc</code>å¯„å­˜å™¨æ›´æ–°ä¸º<strong>ä¸‹ä¸€æ¡å¾…äº¤ä»˜æŒ‡ä»¤</strong>çš„PCå€¼</li><li>å¯¹äºéç²¾ç¡®å¼‚æ­¥å¼‚å¸¸ï¼ˆé•¿æŒ‡ä»¤ï¼‰ï¼Œ<code>mepc</code>å¯„å­˜å™¨æ›´æ–°ä¸º<strong>å‘ç”Ÿå¼‚å¸¸æŒ‡ä»¤</strong>çš„PCå€¼</li></ul><h2 id="èœ‚é¸ŸE203çš„è°ƒè¯•æœºåˆ¶">èœ‚é¸ŸE203çš„è°ƒè¯•æœºåˆ¶</h2><p>å¤„ç†å™¨å¯¹äºè¿è¡Œäºå…¶ä¸Šçš„è½¯ä»¶ç¨‹åºæä¾›è°ƒè¯•èƒ½åŠ›æ˜¯è‡³å…³é‡è¦çš„ã€‚è°ƒè¯•æœºåˆ¶æ˜¯ä¸ªéå¸¸å¤æ‚çš„è½¯ç¡¬ä»¶åä½œæœºåˆ¶ï¼Œè½¯ç¡¬ä»¶çš„å®ç°éš¾åº¦å¾ˆå¤§ã€‚å¯¹äºå¤„ç†å™¨çš„è°ƒè¯•åŠŸèƒ½è€Œè¨€ï¼Œå¸¸ç”¨çš„ä¸¤ç§æ˜¯â€œäº¤äº’å¼è°ƒè¯•â€å’Œâ€œè¿½è¸ªè°ƒè¯•â€ï¼š</p><ul><li>äº¤äº’å¼è°ƒè¯•ï¼ˆInteractive Debugï¼‰æ˜¯æœ€å¸¸è§çš„è°ƒè¯•åŠŸèƒ½ã€‚è°ƒè¯•å™¨è½¯ä»¶ï¼ˆå¦‚GDBï¼‰èƒ½å¤Ÿç›´æ¥å¯¹å¤„ç†å™¨å–å¾—æ§åˆ¶æƒï¼Œè¿›è€Œå¯¹å…¶ä»¥ä¸€ç§äº¤äº’æ–¹å¼è¿›è¡Œè°ƒè¯•ï¼Œç¼ºç‚¹æ˜¯å¯¹å¤„ç†å™¨çš„è¿è¡Œå…·æœ‰æ‰“æ‰°æ€§ã€‚</li><li>è¿½è¸ªè°ƒè¯•ï¼ˆTrace Debugï¼‰åªè·Ÿè¸ªè®°å½•å¤„ç†å™¨æ ¸æ‰§è¡Œè¿‡çš„æ‰€æœ‰ç¨‹åºæŒ‡ä»¤ï¼Œè€Œä¸ä¼šæ‰“æ–­å¹²æ‰°å¤„ç†å™¨çš„æ‰§è¡Œè¿‡ç¨‹ã€‚ç›¸æ¯”äº¤äº’å¼è°ƒè¯•ï¼Œå®ç°éš¾åº¦æ›´å¤§ï¼Œç¡¬ä»¶å¼€é”€ä¹Ÿæ›´å¤§ã€‚</li></ul><h3 id="è°ƒè¯•èµ„æº">è°ƒè¯•èµ„æº</h3><p>E203ä¸­å·²æœ‰ DTMï¼ˆDebug Transport Moduleï¼‰å°†JTAGæ ‡å‡†æ¥å£è½¬æ¢æˆä¸ºå†…éƒ¨çš„è°ƒè¯•æ€»çº¿ï¼ˆDebug Busï¼‰ï¼Œä¸»è¦æ˜¯ä½¿ç”¨çŠ¶æ€æœºå¯¹JTAGåè®®è¿›è¡Œè§£æã€‚ç”±äºDTMæ¨¡å—å¤„äºJTAGæ—¶é’ŸåŸŸï¼Œä¸è°ƒè¯•æ€»çº¿è¦è®¿é—®çš„è°ƒè¯•æ¨¡å—ä¸å±äºåŒä¸€ä¸ªæ—¶é’ŸåŸŸï¼Œå› æ­¤éœ€è¦è¢«åŒæ­¥ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜æœ‰è°ƒè¯•æ¨¡å—ï¼ˆDebug Moduleï¼‰ï¼Œå®ç°äº†RISC-Vè°ƒè¯•æ–‡æ¡£â€œ0.11ç‰ˆæœ¬â€ä¸­å®šä¹‰çš„è‹¥å¹²å¯„å­˜å™¨ã€Debug-ROMå’ŒDebug-RAMã€‚è¿™äº›èµ„æºæ—¢å¯ä»¥è¢«è°ƒè¯•æ€»çº¿è®¿é—®åˆ°ï¼Œä¹Ÿå¯ä»¥è¢«ç³»ç»Ÿå­˜å‚¨æ€»çº¿è®¿é—®åˆ°ï¼š</p><ul><li>Debug-ROMåŒ…å«äº†å¤„ç†å™¨è¿›å…¥è°ƒè¯•æ¨¡å¼ä¸‹éœ€è¦æ‰§è¡Œçš„å¼‚å¸¸å¤„ç†ç¨‹åºï¼›</li><li>Debug-RAMä¸»è¦åœ¨è¿è¡ŒDebug-ROMä¸­å›ºå®šå¼‚å¸¸å¤„ç†ç¨‹åºæ—¶ä½œä¸ºæ•°æ®æ®µä½¿ç”¨ï¼Œç”¨äºå­˜æ”¾ä¸€äº›ä¸´æ—¶æ•°æ®å’Œä¸­é—´æ•°æ®ã€‚</li></ul><h3 id="è°ƒè¯•æµç¨‹">è°ƒè¯•æµç¨‹</h3><p>è°ƒè¯•æœºåˆ¶æŒ‡ä»¤çš„å®ç°ï¼š</p><ul><li>ebreakï¼šè§¦å‘å¤„ç†å™¨è¿›å…¥å¼‚å¸¸æ¨¡å¼ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰<ul><li>è°ƒè¯•ä¸­æ–­ä¸€æ—¦è¢«æ¥æ”¶ï¼Œä¾¿ä¼šå†²åˆ·æµæ°´çº¿ï¼Œå¤„ç†å™¨PCè·³è½¬åˆ°<code>0x800</code>åœ°å€</li><li>CSRå¯„å­˜å™¨dpcçš„å€¼æ›´æ–°ä¸ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤PC</li><li>CSRå¯„å­˜å™¨dcsrçš„<code>cause</code>åŸŸå€¼æ›´æ–°ä¸ºå¼•å‘è¿›å…¥è°ƒè¯•æ¨¡å¼çš„è§¦å‘åŸå› </li></ul></li><li>dretï¼šè§¦å‘å¤„ç†å™¨é€€å‡ºå¼‚å¸¸æ¨¡å¼ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰<ul><li>è¢«å½“ä½œä¸€ç§è·³è½¬æŒ‡ä»¤æ¥æ‰§è¡Œï¼Œè·³è½¬PCä¸ºCSRå¯„å­˜å™¨dpcçš„å€¼</li><li>å°†dcsrå¯„å­˜å™¨ä¸­çš„<code>cause</code>åŸŸæ¸…é™¤</li></ul></li></ul><h2 id="æœªæ¥ï¼šè¶…è¶Šæ‘©å°”å®šå¾‹">æœªæ¥ï¼šè¶…è¶Šæ‘©å°”å®šå¾‹</h2><p>DSAï¼ˆDomain-Specific Architectureï¼Œé¢†åŸŸä¸“ç”¨æ¶æ„ï¼‰æ–¹é¢ï¼š</p><ul><li>ä½¿ç”¨ä¸“ç”¨å†…å­˜ä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æ•°æ®ç§»åŠ¨</li><li>å°†èµ„æºæŠ•å…¥åˆ°æ›´å¤šçš„è¿ç®—å•å…ƒæˆ–æ›´å¤§çš„å†…å­˜ä¸­</li><li>ä½¿ç”¨ä¸åŸŸåŒ¹é…çš„æœ€ç®€å•çš„å¹¶è¡Œå½¢å¼</li><li>å°†æ•°æ®å¤§å°å’Œç±»å‹å‡å°‘åˆ°åŸŸæ‰€éœ€çš„æœ€ç®€å•ç¨‹åº¦</li><li>ä½¿ç”¨åŸŸç‰¹å®šçš„ç¼–ç¨‹è¯­è¨€</li></ul><div class="note primary flat"><p>ä»€ä¹ˆæ˜¯â€œåŸŸç‰¹å®šçš„ç¼–ç¨‹è¯­è¨€â€ï¼Ÿå³DSLï¼ˆDomain-Specific Languageï¼Œé¢†åŸŸä¸“ç”¨è¯­è¨€ï¼‰ã€‚æ¯”å¦‚å‰ä¸¤å¹´çš„<a href="https://www.modular.com/mojo">Mojo</a>å’Œ<a href="https://www.taichi-lang.org/">Taichi</a>éƒ½ç®—æ˜¯Pythonç»†åŒ–çš„DSLã€‚</p></div>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info flat&quot;&gt;&lt;p&gt;è¿™ä¸€ç« ä¸è€ƒï¼Œè‡³å°‘å¾€å¹´é¢˜æ²¡æœ‰è€ƒè¿‡ã€‚&lt;/p&gt;
&lt;/div&gt;
&lt;h2 id=&quot;SoCæ€»çº¿&quot;&gt;SoCæ€»çº¿&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;æ€»çº¿æä¾›äº†ç³»</summary>
      
    
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="å¤ä¹ " scheme="https://blog.esing.dev/tags/%E5%A4%8D%E4%B9%A0/"/>
    
    <category term="æ•°å­—ç³»ç»Ÿè®¾è®¡" scheme="https://blog.esing.dev/tags/%E6%95%B0%E5%AD%97%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/"/>
    
    <category term="Verilog" scheme="https://blog.esing.dev/tags/Verilog/"/>
    
    <category term="VLSI" scheme="https://blog.esing.dev/tags/VLSI/"/>
    
  </entry>
  
  <entry>
    <title>LaTeXä»£ç å¼€å¯è¿å­—ç­‰ç‰¹æ€§</title>
    <link href="https://blog.esing.dev/2025/10/23/latex-ligature/"/>
    <id>https://blog.esing.dev/2025/10/23/latex-ligature/</id>
    <published>2025-10-23T11:27:57.000Z</published>
    <updated>2025-10-23T14:53:20.925Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€">å‰è¨€</h2><p>åœ¨ <a href="/2024/11/19/latex-code-highlight/" title="LaTeXæ’å…¥ä»£ç å¹¶è®¾ç½®é«˜äº®">LaTeXæ’å…¥ä»£ç å¹¶è®¾ç½®é«˜äº®</a>ä¸­ï¼Œä½¿ç”¨<code>minted</code>å’Œ<code>listings</code> ä¸ºä»£ç å—æ·»åŠ äº†é«˜äº®ã€‚ä½†è®¸å¤šç­‰å®½å­—ä½“éƒ½åŒ…å«è¿å­—ï¼ˆLigatureï¼‰ç‰¹æ€§ï¼Œå¯ä»¥å¢å¼ºä»£ç çš„å¯è¯»æ€§ï¼Œè§†è§‰æ•ˆæœæ›´å¥½ã€‚é‚£å¦‚ä½•åœ¨ä»£ç å—é‡Œä¹Ÿå¼€å¯è¿å­—ç‰¹æ€§å‘¢ï¼Ÿ</p><div class="note primary flat"><p>è¿™é‡Œå®‰åˆ©<a href="https://github.com/subframe7536/maple-font">Maple Mono</a>å­—ä½“ï¼Œå¯¹ä¸­æ–‡æ˜¾ç¤ºæå…¶å‹å¥½ï¼Œå®Œç¾çš„ä¸­è‹±æ–‡2:1æ¯”ä¾‹ï¼Œè¿˜æ”¯æŒNerd Fontã€‚æˆ‘å·²ç»å°†æ‰€æœ‰ç­‰å®½å­—ä½“éƒ½æ¢æˆ<code>Maple Mono Normal NF CN</code>äº†ã€‚</p></div><h2 id="ä¿®æ”¹æ ·å¼">ä¿®æ”¹æ ·å¼</h2><p>é¦–å…ˆè¦ç¡®ä¿ä½¿ç”¨äº†<code>fontspec</code>å®åŒ…ï¼š<code>\RequirePackage&#123;fontspec&#125;</code></p><p>æ¥ç€æŒ‡å®šç­‰å®½å­—ä½“ï¼Œå¹¶æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">\setmonofont[</span><br><span class="line">    AutoFakeBold=true,</span><br><span class="line">    ItalicFont=MapleItalic,     % æŒ‡å®šæ–œä½“å­—ä½“</span><br><span class="line">    Contextuals = Alternate,    % å¼€å¯è¿å­—</span><br><span class="line">    Ligatures = Common,         % liga</span><br><span class="line">    CharacterVariant=&#123;1,62,63&#125;, % cvç‰¹æ€§</span><br><span class="line">    StylisticSet=&#123;3,11&#125;,        % ssç‰¹æ€§</span><br><span class="line">    Extension = .ttf,</span><br><span class="line">    Path=fonts/</span><br><span class="line">]&#123;Maple&#125;</span><br></pre></td></tr></table></figure><p>éšåé‡æ–°ç¼–è¯‘å°±å¯ä»¥äº†ï¼</p><p>ç»è¿‡æµ‹è¯•ï¼Œ<code>verbatim</code>ç¯å¢ƒä¸‹ä¸€åˆ‡æ­£å¸¸ï¼Œ<code>listings</code>ç¯å¢ƒä¸‹ä»…æœ‰éƒ¨åˆ†è¿å­—ç”Ÿæ•ˆï¼ŒåŸå› ä¸æ˜ã€‚</p><img src="https://webp.esing.dev/img/image-20251023214343776_251023_2143_caYa.png" alt="verbatimç¯å¢ƒ" style="zoom:50%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;å‰è¨€&lt;/h2&gt;
&lt;p&gt;åœ¨ &lt;a href=&quot;/2024/11/19/latex-code-highlight/&quot; title=&quot;LaTeXæ’å…¥ä»£ç å¹¶è®¾ç½®é«˜äº®&quot;&gt;LaTeXæ’å…¥ä»£</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://blog.esing.dev/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="å­¦ä¹ " scheme="https://blog.esing.dev/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="LaTeX" scheme="https://blog.esing.dev/tags/LaTeX/"/>
    
  </entry>
  
</feed>
